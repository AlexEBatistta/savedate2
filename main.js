/*! For license information please see main.js.LICENSE.txt */
(()=>{var t={924:(t,e,n)=>{"use strict";var r=n(210),i=n(559),s=i(r("String.prototype.indexOf"));t.exports=function(t,e){var n=r(t,!!e);return"function"==typeof n&&s(t,".prototype.")>-1?i(n):n}},559:(t,e,n)=>{"use strict";var r=n(612),i=n(210),s=i("%Function.prototype.apply%"),o=i("%Function.prototype.call%"),a=i("%Reflect.apply%",!0)||r.call(o,s),h=i("%Object.getOwnPropertyDescriptor%",!0),l=i("%Object.defineProperty%",!0),u=i("%Math.max%");if(l)try{l({},"a",{value:1})}catch(d){l=null}t.exports=function(t){var e=a(r,o,arguments);h&&l&&(h(e,"length").configurable&&l(e,"length",{value:1+u(0,t.length-(arguments.length-1))}));return e};var c=function(){return a(r,s,arguments)};l?l(t.exports,"apply",{value:c}):t.exports.apply=c},187:t=>{"use strict";function e(t,e,r){r=r||2;var s,o,a,h,c,d,p,m=e&&e.length,g=m?e[0]*r:t.length,_=n(t,0,g,r,!0),y=[];if(!_||_.next===_.prev)return y;if(m&&(_=function(t,e,r,i){var s,o,a,h=[];for(s=0,o=e.length;s<o;s++)(a=n(t,e[s]*i,s<o-1?e[s+1]*i:t.length,i,!1))===a.next&&(a.steiner=!0),h.push(f(a));for(h.sort(l),s=0;s<h.length;s++)r=u(h[s],r);return r}(t,e,_,r)),t.length>80*r){s=a=t[0],o=h=t[1];for(var v=r;v<g;v+=r)(c=t[v])<s&&(s=c),(d=t[v+1])<o&&(o=d),c>a&&(a=c),d>h&&(h=d);p=0!==(p=Math.max(a-s,h-o))?32767/p:0}return i(_,y,r,s,o,p,0),y}function n(t,e,n,r,i){var s,o;if(i===A(t,e,n,r)>0)for(s=e;s<n;s+=r)o=w(s,t[s],t[s+1],o);else for(s=n-r;s>=e;s-=r)o=w(s,t[s],t[s+1],o);return o&&_(o,o.next)&&(T(o),o=o.next),o}function r(t,e){if(!t)return t;e||(e=t);var n,r=t;do{if(n=!1,r.steiner||!_(r,r.next)&&0!==g(r.prev,r,r.next))r=r.next;else{if(T(r),(r=e=r.prev)===r.next)break;n=!0}}while(n||r!==e);return e}function i(t,e,n,l,u,c,f){if(t){!f&&c&&function(t,e,n,r){var i=t;do{0===i.z&&(i.z=d(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,n,r,i,s,o,a,h,l=1;do{for(n=t,t=null,s=null,o=0;n;){for(o++,r=n,a=0,e=0;e<l&&(a++,r=r.nextZ);e++);for(h=l;a>0||h>0&&r;)0!==a&&(0===h||!r||n.z<=r.z)?(i=n,n=n.nextZ,a--):(i=r,r=r.nextZ,h--),s?s.nextZ=i:t=i,i.prevZ=s,s=i;n=r}s.nextZ=null,l*=2}while(o>1)}(i)}(t,l,u,c);for(var p,m,g=t;t.prev!==t.next;)if(p=t.prev,m=t.next,c?o(t,l,u,c):s(t))e.push(p.i/n|0),e.push(t.i/n|0),e.push(m.i/n|0),T(t),t=m.next,g=m.next;else if((t=m)===g){f?1===f?i(t=a(r(t),e,n),e,n,l,u,c,2):2===f&&h(t,e,n,l,u,c):i(r(t),e,n,l,u,c,1);break}}}function s(t){var e=t.prev,n=t,r=t.next;if(g(e,n,r)>=0)return!1;for(var i=e.x,s=n.x,o=r.x,a=e.y,h=n.y,l=r.y,u=i<s?i<o?i:o:s<o?s:o,c=a<h?a<l?a:l:h<l?h:l,d=i>s?i>o?i:o:s>o?s:o,f=a>h?a>l?a:l:h>l?h:l,m=r.next;m!==e;){if(m.x>=u&&m.x<=d&&m.y>=c&&m.y<=f&&p(i,a,s,h,o,l,m.x,m.y)&&g(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function o(t,e,n,r){var i=t.prev,s=t,o=t.next;if(g(i,s,o)>=0)return!1;for(var a=i.x,h=s.x,l=o.x,u=i.y,c=s.y,f=o.y,m=a<h?a<l?a:l:h<l?h:l,_=u<c?u<f?u:f:c<f?c:f,y=a>h?a>l?a:l:h>l?h:l,v=u>c?u>f?u:f:c>f?c:f,b=d(m,_,e,n,r),x=d(y,v,e,n,r),E=t.prevZ,w=t.nextZ;E&&E.z>=b&&w&&w.z<=x;){if(E.x>=m&&E.x<=y&&E.y>=_&&E.y<=v&&E!==i&&E!==o&&p(a,u,h,c,l,f,E.x,E.y)&&g(E.prev,E,E.next)>=0)return!1;if(E=E.prevZ,w.x>=m&&w.x<=y&&w.y>=_&&w.y<=v&&w!==i&&w!==o&&p(a,u,h,c,l,f,w.x,w.y)&&g(w.prev,w,w.next)>=0)return!1;w=w.nextZ}for(;E&&E.z>=b;){if(E.x>=m&&E.x<=y&&E.y>=_&&E.y<=v&&E!==i&&E!==o&&p(a,u,h,c,l,f,E.x,E.y)&&g(E.prev,E,E.next)>=0)return!1;E=E.prevZ}for(;w&&w.z<=x;){if(w.x>=m&&w.x<=y&&w.y>=_&&w.y<=v&&w!==i&&w!==o&&p(a,u,h,c,l,f,w.x,w.y)&&g(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function a(t,e,n){var i=t;do{var s=i.prev,o=i.next.next;!_(s,o)&&y(s,i,i.next,o)&&x(s,o)&&x(o,s)&&(e.push(s.i/n|0),e.push(i.i/n|0),e.push(o.i/n|0),T(i),T(i.next),i=t=o),i=i.next}while(i!==t);return r(i)}function h(t,e,n,s,o,a){var h=t;do{for(var l=h.next.next;l!==h.prev;){if(h.i!==l.i&&m(h,l)){var u=E(h,l);return h=r(h,h.next),u=r(u,u.next),i(h,e,n,s,o,a,0),void i(u,e,n,s,o,a,0)}l=l.next}h=h.next}while(h!==t)}function l(t,e){return t.x-e.x}function u(t,e){var n=function(t,e){var n,r=e,i=t.x,s=t.y,o=-Infinity;do{if(s<=r.y&&s>=r.next.y&&r.next.y!==r.y){var a=r.x+(s-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=i&&a>o&&(o=a,n=r.x<r.next.x?r:r.next,a===i))return n}r=r.next}while(r!==e);if(!n)return null;var h,l=n,u=n.x,d=n.y,f=Infinity;r=n;do{i>=r.x&&r.x>=u&&i!==r.x&&p(s<d?i:o,s,u,d,s<d?o:i,s,r.x,r.y)&&(h=Math.abs(s-r.y)/(i-r.x),x(r,t)&&(h<f||h===f&&(r.x>n.x||r.x===n.x&&c(n,r)))&&(n=r,f=h)),r=r.next}while(r!==l);return n}(t,e);if(!n)return e;var i=E(n,t);return r(i,i.next),r(n,n.next)}function c(t,e){return g(t.prev,t,e.prev)<0&&g(e.next,t,t.next)<0}function d(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function f(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function p(t,e,n,r,i,s,o,a){return(i-o)*(e-a)>=(t-o)*(s-a)&&(t-o)*(r-a)>=(n-o)*(e-a)&&(n-o)*(s-a)>=(i-o)*(r-a)}function m(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&y(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(x(t,e)&&x(e,t)&&function(t,e){var n=t,r=!1,i=(t.x+e.x)/2,s=(t.y+e.y)/2;do{n.y>s!=n.next.y>s&&n.next.y!==n.y&&i<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(g(t.prev,t,e.prev)||g(t,e.prev,e))||_(t,e)&&g(t.prev,t,t.next)>0&&g(e.prev,e,e.next)>0)}function g(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function _(t,e){return t.x===e.x&&t.y===e.y}function y(t,e,n,r){var i=b(g(t,e,n)),s=b(g(t,e,r)),o=b(g(n,r,t)),a=b(g(n,r,e));return i!==s&&o!==a||(!(0!==i||!v(t,n,e))||(!(0!==s||!v(t,r,e))||(!(0!==o||!v(n,t,r))||!(0!==a||!v(n,e,r)))))}function v(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function b(t){return t>0?1:t<0?-1:0}function x(t,e){return g(t.prev,t,t.next)<0?g(t,e,t.next)>=0&&g(t,t.prev,e)>=0:g(t,e,t.prev)<0||g(t,t.next,e)<0}function E(t,e){var n=new S(t.i,t.x,t.y),r=new S(e.i,e.x,e.y),i=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,s.next=r,r.prev=s,r}function w(t,e,n,r){var i=new S(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function T(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function S(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function A(t,e,n,r){for(var i=0,s=e,o=n-r;s<n;s+=r)i+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return i}t.exports=e,t.exports["default"]=e,e.deviation=function(t,e,n,r){var i=e&&e.length,s=i?e[0]*n:t.length,o=Math.abs(A(t,0,s,n));if(i)for(var a=0,h=e.length;a<h;a++){var l=e[a]*n,u=a<h-1?e[a+1]*n:t.length;o-=Math.abs(A(t,l,u,n))}var c=0;for(a=0;a<r.length;a+=3){var d=r[a]*n,f=r[a+1]*n,p=r[a+2]*n;c+=Math.abs((t[d]-t[p])*(t[f+1]-t[d+1])-(t[d]-t[f])*(t[p+1]-t[d+1]))}return 0===o&&0===c?0:Math.abs((c-o)/o)},e.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var s=0;s<t[i].length;s++)for(var o=0;o<e;o++)n.vertices.push(t[i][s][o]);i>0&&(r+=t[i-1].length,n.holes.push(r))}return n}},729:t=>{"use strict";var e=Object.prototype.hasOwnProperty,n="~";function r(){}function i(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function s(t,e,r,s,o){if("function"!=typeof r)throw new TypeError("The listener must be a function");var a=new i(r,s||t,o),h=n?n+e:e;return t._events[h]?t._events[h].fn?t._events[h]=[t._events[h],a]:t._events[h].push(a):(t._events[h]=a,t._eventsCount++),t}function o(t,e){0==--t._eventsCount?t._events=new r:delete t._events[e]}function a(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),a.prototype.eventNames=function(){var t,r,i=[];if(0===this._eventsCount)return i;for(r in t=this._events)e.call(t,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(t)):i},a.prototype.listeners=function(t){var e=n?n+t:t,r=this._events[e];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,s=r.length,o=new Array(s);i<s;i++)o[i]=r[i].fn;return o},a.prototype.listenerCount=function(t){var e=n?n+t:t,r=this._events[e];return r?r.fn?1:r.length:0},a.prototype.emit=function(t,e,r,i,s,o){var a=n?n+t:t;if(!this._events[a])return!1;var h,l,u=this._events[a],c=arguments.length;if(u.fn){switch(u.once&&this.removeListener(t,u.fn,undefined,!0),c){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,e),!0;case 3:return u.fn.call(u.context,e,r),!0;case 4:return u.fn.call(u.context,e,r,i),!0;case 5:return u.fn.call(u.context,e,r,i,s),!0;case 6:return u.fn.call(u.context,e,r,i,s,o),!0}for(l=1,h=new Array(c-1);l<c;l++)h[l-1]=arguments[l];u.fn.apply(u.context,h)}else{var d,f=u.length;for(l=0;l<f;l++)switch(u[l].once&&this.removeListener(t,u[l].fn,undefined,!0),c){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,e);break;case 3:u[l].fn.call(u[l].context,e,r);break;case 4:u[l].fn.call(u[l].context,e,r,i);break;default:if(!h)for(d=1,h=new Array(c-1);d<c;d++)h[d-1]=arguments[d];u[l].fn.apply(u[l].context,h)}}return!0},a.prototype.on=function(t,e,n){return s(this,t,e,n,!1)},a.prototype.once=function(t,e,n){return s(this,t,e,n,!0)},a.prototype.removeListener=function(t,e,r,i){var s=n?n+t:t;if(!this._events[s])return this;if(!e)return o(this,s),this;var a=this._events[s];if(a.fn)a.fn!==e||i&&!a.once||r&&a.context!==r||o(this,s);else{for(var h=0,l=[],u=a.length;h<u;h++)(a[h].fn!==e||i&&!a[h].once||r&&a[h].context!==r)&&l.push(a[h]);l.length?this._events[s]=1===l.length?l[0]:l:o(this,s)}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=n?n+t:t,this._events[e]&&o(this,e)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,t.exports=a},648:t=>{"use strict";var e=Array.prototype.slice,n=Object.prototype.toString;t.exports=function(t){var r=this;if("function"!=typeof r||"[object Function]"!==n.call(r))throw new TypeError("Function.prototype.bind called on incompatible "+r);for(var i,s=e.call(arguments,1),o=Math.max(0,r.length-s.length),a=[],h=0;h<o;h++)a.push("$"+h);if(i=Function("binder","return function ("+a.join(",")+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof i){var n=r.apply(this,s.concat(e.call(arguments)));return Object(n)===n?n:this}return r.apply(t,s.concat(e.call(arguments)))})),r.prototype){var l=function(){};l.prototype=r.prototype,i.prototype=new l,l.prototype=null}return i}},612:(t,e,n)=>{"use strict";var r=n(648);t.exports=Function.prototype.bind||r},210:(t,e,n)=>{"use strict";var r,i=SyntaxError,s=Function,o=TypeError,a=function(t){try{return s('"use strict"; return ('+t+").constructor;")()}catch(e){}},h=Object.getOwnPropertyDescriptor;if(h)try{h({},"")}catch(P){h=null}var l=function(){throw new o},u=h?function(){try{return l}catch(t){try{return h(arguments,"callee").get}catch(e){return l}}}():l,c=n(405)(),d=n(185)(),f=Object.getPrototypeOf||(d?function(t){return t.__proto__}:null),p={},m="undefined"!=typeof Uint8Array&&f?f(Uint8Array):r,g={"%AggregateError%":"undefined"==typeof AggregateError?r:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?r:ArrayBuffer,"%ArrayIteratorPrototype%":c&&f?f([][Symbol.iterator]()):r,"%AsyncFromSyncIteratorPrototype%":r,"%AsyncFunction%":p,"%AsyncGenerator%":p,"%AsyncGeneratorFunction%":p,"%AsyncIteratorPrototype%":p,"%Atomics%":"undefined"==typeof Atomics?r:Atomics,"%BigInt%":"undefined"==typeof BigInt?r:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?r:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?r:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?r:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?r:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?r:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?r:FinalizationRegistry,"%Function%":s,"%GeneratorFunction%":p,"%Int8Array%":"undefined"==typeof Int8Array?r:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?r:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?r:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":c&&f?f(f([][Symbol.iterator]())):r,"%JSON%":"object"==typeof JSON?JSON:r,"%Map%":"undefined"==typeof Map?r:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&c&&f?f((new Map)[Symbol.iterator]()):r,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?r:Promise,"%Proxy%":"undefined"==typeof Proxy?r:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?r:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?r:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&c&&f?f((new Set)[Symbol.iterator]()):r,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?r:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":c&&f?f(""[Symbol.iterator]()):r,"%Symbol%":c?Symbol:r,"%SyntaxError%":i,"%ThrowTypeError%":u,"%TypedArray%":m,"%TypeError%":o,"%Uint8Array%":"undefined"==typeof Uint8Array?r:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?r:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?r:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?r:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?r:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?r:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?r:WeakSet};if(f)try{null.error}catch(P){var _=f(f(P));g["%Error.prototype%"]=_}var y=function M(t){var e;if("%AsyncFunction%"===t)e=a("async function () {}");else if("%GeneratorFunction%"===t)e=a("function* () {}");else if("%AsyncGeneratorFunction%"===t)e=a("async function* () {}");else if("%AsyncGenerator%"===t){var n=M("%AsyncGeneratorFunction%");n&&(e=n.prototype)}else if("%AsyncIteratorPrototype%"===t){var r=M("%AsyncGenerator%");r&&f&&(e=f(r.prototype))}return g[t]=e,e},v={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},b=n(612),x=n(642),E=b.call(Function.call,Array.prototype.concat),w=b.call(Function.apply,Array.prototype.splice),T=b.call(Function.call,String.prototype.replace),S=b.call(Function.call,String.prototype.slice),A=b.call(Function.call,RegExp.prototype.exec),C=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,I=/\\(\\)?/g,R=function(t,e){var n,r=t;if(x(v,r)&&(r="%"+(n=v[r])[0]+"%"),x(g,r)){var s=g[r];if(s===p&&(s=y(r)),void 0===s&&!e)throw new o("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:n,name:r,value:s}}throw new i("intrinsic "+t+" does not exist!")};t.exports=function(t,e){if("string"!=typeof t||0===t.length)throw new o("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof e)throw new o('"allowMissing" argument must be a boolean');if(null===A(/^%?[^%]*%?$/,t))throw new i("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=function(t){var e=S(t,0,1),n=S(t,-1);if("%"===e&&"%"!==n)throw new i("invalid intrinsic syntax, expected closing `%`");if("%"===n&&"%"!==e)throw new i("invalid intrinsic syntax, expected opening `%`");var r=[];return T(t,C,(function(t,e,n,i){r[r.length]=n?T(i,I,"$1"):e||t})),r}(t),r=n.length>0?n[0]:"",s=R("%"+r+"%",e),a=s.name,l=s.value,u=!1,c=s.alias;c&&(r=c[0],w(n,E([0,1],c)));for(var d=1,f=!0;d<n.length;d+=1){var p=n[d],m=S(p,0,1),_=S(p,-1);if(('"'===m||"'"===m||"`"===m||'"'===_||"'"===_||"`"===_)&&m!==_)throw new i("property names with quotes must have matching quotes");if("constructor"!==p&&f||(u=!0),x(g,a="%"+(r+="."+p)+"%"))l=g[a];else if(null!=l){if(!(p in l)){if(!e)throw new o("base intrinsic for "+t+" exists, but the property is not available.");return}if(h&&d+1>=n.length){var y=h(l,p);l=(f=!!y)&&"get"in y&&!("originalValue"in y.get)?y.get:l[p]}else f=x(l,p),l=l[p];f&&!u&&(g[a]=l)}}return l}},185:t=>{"use strict";var e={foo:{}},n=Object;t.exports=function(){return{__proto__:e}.foo===e.foo&&!({__proto__:null}instanceof n)}},405:(t,e,n)=>{"use strict";var r="undefined"!=typeof Symbol&&Symbol,i=n(419);t.exports=function(){return"function"==typeof r&&("function"==typeof Symbol&&("symbol"==typeof r("foo")&&("symbol"==typeof Symbol("bar")&&i())))}},419:t=>{"use strict";t.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var t={},e=Symbol("test"),n=Object(e);if("string"==typeof e)return!1;if("[object Symbol]"!==Object.prototype.toString.call(e))return!1;if("[object Symbol]"!==Object.prototype.toString.call(n))return!1;for(e in t[e]=42,t)return!1;if("function"==typeof Object.keys&&0!==Object.keys(t).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(t).length)return!1;var r=Object.getOwnPropertySymbols(t);if(1!==r.length||r[0]!==e)return!1;if(!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var i=Object.getOwnPropertyDescriptor(t,e);if(42!==i.value||!0!==i.enumerable)return!1}return!0}},642:(t,e,n)=>{"use strict";var r=n(612);t.exports=r.call(Function.call,Object.prototype.hasOwnProperty)},483:(t,e,n)=>{t.exports=function r(t,e,n){function i(o,a){if(!e[o]){if(!t[o]){var h=undefined;if(!a&&h)return require(o,!0);if(s)return s(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var u=e[o]={exports:{}};t[o][0].call(u.exports,(function(e){var n=t[o][1][e];return i(n||e)}),u,u.exports,r,t,e,n)}return e[o].exports}for(var s=undefined,o=0;o<n.length;o++)i(n[o]);return i}({1:[function(t,e,r){(function(t){"use strict";var n,r,i=t.MutationObserver||t.WebKitMutationObserver;if(i){var s=0,o=new i(u),a=t.document.createTextNode("");o.observe(a,{characterData:!0}),n=function(){a.data=s=++s%2}}else if(t.setImmediate||"undefined"==typeof t.MessageChannel)n="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){u(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(u,0)};else{var h=new t.MessageChannel;h.port1.onmessage=u,n=function(){h.port2.postMessage(0)}}var l=[];function u(){var t,e;r=!0;for(var n=l.length;n;){for(e=l,l=[],t=-1;++t<n;)e[t]();n=l.length}r=!1}function c(t){1!==l.push(t)||r||n()}e.exports=c}).call(this,"undefined"!=typeof n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(t,e,n){"use strict";var r=t(1);function i(){}var s={},o=["REJECTED"],a=["FULFILLED"],h=["PENDING"];function l(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=h,this.queue=[],this.outcome=void 0,t!==i&&f(this,t)}function u(t,e,n){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function c(t,e,n){r((function(){var r;try{r=e(n)}catch(i){return s.reject(t,i)}r===t?s.reject(t,new TypeError("Cannot resolve promise with itself")):s.resolve(t,r)}))}function d(t){var e=t&&t.then;if(t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof e)return function(){e.apply(t,arguments)}}function f(t,e){var n=!1;function r(e){n||(n=!0,s.reject(t,e))}function i(e){n||(n=!0,s.resolve(t,e))}function o(){e(i,r)}var a=p(o);"error"===a.status&&r(a.value)}function p(t,e){var n={};try{n.value=t(e),n.status="success"}catch(r){n.status="error",n.value=r}return n}function m(t){return t instanceof this?t:s.resolve(new this(i),t)}function g(t){var e=new this(i);return s.reject(e,t)}function _(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var n=t.length,r=!1;if(!n)return this.resolve([]);for(var o=new Array(n),a=0,h=-1,l=new this(i);++h<n;)u(t[h],h);return l;function u(t,i){function h(t){o[i]=t,++a!==n||r||(r=!0,s.resolve(l,o))}e.resolve(t).then(h,(function(t){r||(r=!0,s.reject(l,t))}))}}function y(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var n=t.length,r=!1;if(!n)return this.resolve([]);for(var o=-1,a=new this(i);++o<n;)h(t[o]);return a;function h(t){e.resolve(t).then((function(t){r||(r=!0,s.resolve(a,t))}),(function(t){r||(r=!0,s.reject(a,t))}))}}e.exports=l,l.prototype["catch"]=function(t){return this.then(null,t)},l.prototype.then=function(t,e){if("function"!=typeof t&&this.state===a||"function"!=typeof e&&this.state===o)return this;var n=new this.constructor(i);return this.state!==h?c(n,this.state===a?t:e,this.outcome):this.queue.push(new u(n,t,e)),n},u.prototype.callFulfilled=function(t){s.resolve(this.promise,t)},u.prototype.otherCallFulfilled=function(t){c(this.promise,this.onFulfilled,t)},u.prototype.callRejected=function(t){s.reject(this.promise,t)},u.prototype.otherCallRejected=function(t){c(this.promise,this.onRejected,t)},s.resolve=function(t,e){var n=p(d,e);if("error"===n.status)return s.reject(t,n.value);var r=n.value;if(r)f(t,r);else{t.state=a,t.outcome=e;for(var i=-1,o=t.queue.length;++i<o;)t.queue[i].callFulfilled(e)}return t},s.reject=function(t,e){t.state=o,t.outcome=e;for(var n=-1,r=t.queue.length;++n<r;)t.queue[n].callRejected(e);return t},l.resolve=m,l.reject=g,l.all=_,l.race=y},{1:1}],3:[function(t,e,r){(function(e){"use strict";"function"!=typeof e.Promise&&(e.Promise=t(2))}).call(this,"undefined"!=typeof n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(t,e,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(t){return}}var o=s();function a(){try{if(!o||!o.open)return!1;var t="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),e="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!t||e)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(n){return!1}}function h(t,e){t=t||[],e=e||{};try{return new Blob(t,e)}catch(i){if("TypeError"!==i.name)throw i;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<t.length;r+=1)n.append(t[r]);return n.getBlob(e.type)}}"undefined"==typeof Promise&&t(3);var l=Promise;function u(t,e){e&&t.then((function(t){e(null,t)}),(function(t){e(t)}))}function c(t,e,n){"function"==typeof e&&t.then(e),"function"==typeof n&&t["catch"](n)}function d(t){return"string"!=typeof t&&(t=String(t)),t}function f(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var p="local-forage-detect-blob-support",m=void 0,g={},_=Object.prototype.toString,y="readonly",v="readwrite";function b(t){for(var e=t.length,n=new ArrayBuffer(e),r=new Uint8Array(n),i=0;i<e;i++)r[i]=t.charCodeAt(i);return n}function x(t){return new l((function(e){var n=t.transaction(p,v),r=h([""]);n.objectStore(p).put(r,"key"),n.onabort=function(t){t.preventDefault(),t.stopPropagation(),e(!1)},n.oncomplete=function(){var t=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);e(n||!t||parseInt(t[1],10)>=43)}}))["catch"]((function(){return!1}))}function E(t){return"boolean"==typeof m?l.resolve(m):x(t).then((function(t){return m=t}))}function w(t){var e=g[t.name],n={};n.promise=new l((function(t,e){n.resolve=t,n.reject=e})),e.deferredOperations.push(n),e.dbReady?e.dbReady=e.dbReady.then((function(){return n.promise})):e.dbReady=n.promise}function T(t){var e=g[t.name].deferredOperations.pop();if(e)return e.resolve(),e.promise}function S(t,e){var n=g[t.name].deferredOperations.pop();if(n)return n.reject(e),n.promise}function A(t,e){return new l((function(n,r){if(g[t.name]=g[t.name]||L(),t.db){if(!e)return n(t.db);w(t),t.db.close()}var i=[t.name];e&&i.push(t.version);var s=o.open.apply(o,i);e&&(s.onupgradeneeded=function(e){var n=s.result;try{n.createObjectStore(t.storeName),e.oldVersion<=1&&n.createObjectStore(p)}catch(r){if("ConstraintError"!==r.name)throw r}}),s.onerror=function(t){t.preventDefault(),r(s.error)},s.onsuccess=function(){var e=s.result;e.onversionchange=function(t){t.target.close()},n(e),T(t)}}))}function C(t){return A(t,!1)}function I(t){return A(t,!0)}function R(t,e){if(!t.db)return!0;var n=!t.db.objectStoreNames.contains(t.storeName),r=t.version<t.db.version,i=t.version>t.db.version;if(r&&(t.version,t.version=t.db.version),i||n){if(n){var s=t.db.version+1;s>t.version&&(t.version=s)}return!0}return!1}function P(t){return new l((function(e,n){var r=new FileReader;r.onerror=n,r.onloadend=function(n){var r=btoa(n.target.result||"");e({__local_forage_encoded_blob:!0,data:r,type:t.type})},r.readAsBinaryString(t)}))}function M(t){return h([b(atob(t.data))],{type:t.type})}function O(t){return t&&t.__local_forage_encoded_blob}function D(t){var e=this,n=e._initReady().then((function(){var t=g[e._dbInfo.name];if(t&&t.dbReady)return t.dbReady}));return c(n,t,t),n}function N(t){w(t);for(var e=g[t.name],n=e.forages,r=0;r<n.length;r++){var i=n[r];i._dbInfo.db&&(i._dbInfo.db.close(),i._dbInfo.db=null)}return t.db=null,C(t).then((function(e){return t.db=e,R(t)?I(t):e})).then((function(r){t.db=e.db=r;for(var i=0;i<n.length;i++)n[i]._dbInfo.db=r}))["catch"]((function(e){throw S(t,e),e}))}function k(t,e,n,r){r===undefined&&(r=1);try{var i=t.db.transaction(t.storeName,e);n(null,i)}catch(s){if(r>0&&(!t.db||"InvalidStateError"===s.name||"NotFoundError"===s.name))return l.resolve().then((function(){if(!t.db||"NotFoundError"===s.name&&!t.db.objectStoreNames.contains(t.storeName)&&t.version<=t.db.version)return t.db&&(t.version=t.db.version+1),I(t)})).then((function(){return N(t).then((function(){k(t,e,n,r-1)}))}))["catch"](n);n(s)}}function L(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function F(t){var e=this,n={db:null};if(t)for(var r in t)n[r]=t[r];var i=g[n.name];i||(i=L(),g[n.name]=i),i.forages.push(e),e._initReady||(e._initReady=e.ready,e.ready=D);var s=[];function o(){return l.resolve()}for(var a=0;a<i.forages.length;a++){var h=i.forages[a];h!==e&&s.push(h._initReady()["catch"](o))}var u=i.forages.slice(0);return l.all(s).then((function(){return n.db=i.db,C(n)})).then((function(t){return n.db=t,R(n,e._defaultConfig.version)?I(n):t})).then((function(t){n.db=i.db=t,e._dbInfo=n;for(var r=0;r<u.length;r++){var s=u[r];s!==e&&(s._dbInfo.db=n.db,s._dbInfo.version=n.version)}}))}function B(t,e){var n=this;t=d(t);var r=new l((function(e,r){n.ready().then((function(){k(n._dbInfo,y,(function(i,s){if(i)return r(i);try{var o=s.objectStore(n._dbInfo.storeName).get(t);o.onsuccess=function(){var t=o.result;t===undefined&&(t=null),O(t)&&(t=M(t)),e(t)},o.onerror=function(){r(o.error)}}catch(a){r(a)}}))}))["catch"](r)}));return u(r,e),r}function U(t,e){var n=this,r=new l((function(e,r){n.ready().then((function(){k(n._dbInfo,y,(function(i,s){if(i)return r(i);try{var o=s.objectStore(n._dbInfo.storeName).openCursor(),a=1;o.onsuccess=function(){var n=o.result;if(n){var r=n.value;O(r)&&(r=M(r));var i=t(r,n.key,a++);void 0!==i?e(i):n["continue"]()}else e()},o.onerror=function(){r(o.error)}}catch(h){r(h)}}))}))["catch"](r)}));return u(r,e),r}function j(t,e,n){var r=this;t=d(t);var i=new l((function(n,i){var s;r.ready().then((function(){return s=r._dbInfo,"[object Blob]"===_.call(e)?E(s.db).then((function(t){return t?e:P(e)})):e})).then((function(e){k(r._dbInfo,v,(function(s,o){if(s)return i(s);try{var a=o.objectStore(r._dbInfo.storeName);null===e&&(e=undefined);var h=a.put(e,t);o.oncomplete=function(){e===undefined&&(e=null),n(e)},o.onabort=o.onerror=function(){var t=h.error?h.error:h.transaction.error;i(t)}}catch(l){i(l)}}))}))["catch"](i)}));return u(i,n),i}function G(t,e){var n=this;t=d(t);var r=new l((function(e,r){n.ready().then((function(){k(n._dbInfo,v,(function(i,s){if(i)return r(i);try{var o=s.objectStore(n._dbInfo.storeName)["delete"](t);s.oncomplete=function(){e()},s.onerror=function(){r(o.error)},s.onabort=function(){var t=o.error?o.error:o.transaction.error;r(t)}}catch(a){r(a)}}))}))["catch"](r)}));return u(r,e),r}function H(t){var e=this,n=new l((function(t,n){e.ready().then((function(){k(e._dbInfo,v,(function(r,i){if(r)return n(r);try{var s=i.objectStore(e._dbInfo.storeName).clear();i.oncomplete=function(){t()},i.onabort=i.onerror=function(){var t=s.error?s.error:s.transaction.error;n(t)}}catch(o){n(o)}}))}))["catch"](n)}));return u(n,t),n}function z(t){var e=this,n=new l((function(t,n){e.ready().then((function(){k(e._dbInfo,y,(function(r,i){if(r)return n(r);try{var s=i.objectStore(e._dbInfo.storeName).count();s.onsuccess=function(){t(s.result)},s.onerror=function(){n(s.error)}}catch(o){n(o)}}))}))["catch"](n)}));return u(n,t),n}function W(t,e){var n=this,r=new l((function(e,r){t<0?e(null):n.ready().then((function(){k(n._dbInfo,y,(function(i,s){if(i)return r(i);try{var o=s.objectStore(n._dbInfo.storeName),a=!1,h=o.openKeyCursor();h.onsuccess=function(){var n=h.result;n?0===t||a?e(n.key):(a=!0,n.advance(t)):e(null)},h.onerror=function(){r(h.error)}}catch(l){r(l)}}))}))["catch"](r)}));return u(r,e),r}function V(t){var e=this,n=new l((function(t,n){e.ready().then((function(){k(e._dbInfo,y,(function(r,i){if(r)return n(r);try{var s=i.objectStore(e._dbInfo.storeName).openKeyCursor(),o=[];s.onsuccess=function(){var e=s.result;e?(o.push(e.key),e["continue"]()):t(o)},s.onerror=function(){n(s.error)}}catch(a){n(a)}}))}))["catch"](n)}));return u(n,t),n}function X(t,e){e=f.apply(this,arguments);var n=this.config();(t="function"!=typeof t&&t||{}).name||(t.name=t.name||n.name,t.storeName=t.storeName||n.storeName);var r,i=this;if(t.name){var s=t.name===n.name&&i._dbInfo.db?l.resolve(i._dbInfo.db):C(t).then((function(e){var n=g[t.name],r=n.forages;n.db=e;for(var i=0;i<r.length;i++)r[i]._dbInfo.db=e;return e}));r=t.storeName?s.then((function(e){if(e.objectStoreNames.contains(t.storeName)){var n=e.version+1;w(t);var r=g[t.name],i=r.forages;e.close();for(var s=0;s<i.length;s++){var a=i[s];a._dbInfo.db=null,a._dbInfo.version=n}var h=new l((function(e,r){var i=o.open(t.name,n);i.onerror=function(t){i.result.close(),r(t)},i.onupgradeneeded=function(){i.result.deleteObjectStore(t.storeName)},i.onsuccess=function(){var t=i.result;t.close(),e(t)}}));return h.then((function(t){r.db=t;for(var e=0;e<i.length;e++){var n=i[e];n._dbInfo.db=t,T(n._dbInfo)}}))["catch"]((function(e){throw(S(t,e)||l.resolve())["catch"]((function(){})),e}))}})):s.then((function(e){w(t);var n=g[t.name],r=n.forages;e.close();for(var i=0;i<r.length;i++)r[i]._dbInfo.db=null;var s=new l((function(e,n){var r=o.deleteDatabase(t.name);r.onerror=function(){var t=r.result;t&&t.close(),n(r.error)},r.onblocked=function(){},r.onsuccess=function(){var t=r.result;t&&t.close(),e(t)}}));return s.then((function(t){n.db=t;for(var e=0;e<r.length;e++)T(r[e]._dbInfo)}))["catch"]((function(e){throw(S(t,e)||l.resolve())["catch"]((function(){})),e}))}))}else r=l.reject("Invalid arguments");return u(r,e),r}var $={_driver:"asyncStorage",_initStorage:F,_support:a(),iterate:U,getItem:B,setItem:j,removeItem:G,clear:H,length:z,key:W,keys:V,dropInstance:X};function Y(){return"function"==typeof openDatabase}var q="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",K="~~local_forage_type~",Q=/^~~local_forage_type~([^~]+)~/,Z="__lfsc__:",J=Z.length,tt="arbf",et="blob",nt="si08",rt="ui08",it="uic8",st="si16",ot="si32",at="ur16",ht="ui32",lt="fl32",ut="fl64",ct=J+tt.length,dt=Object.prototype.toString;function ft(t){var e,n,r,i,s,o=.75*t.length,a=t.length,h=0;"="===t[t.length-1]&&(o--,"="===t[t.length-2]&&o--);var l=new ArrayBuffer(o),u=new Uint8Array(l);for(e=0;e<a;e+=4)n=q.indexOf(t[e]),r=q.indexOf(t[e+1]),i=q.indexOf(t[e+2]),s=q.indexOf(t[e+3]),u[h++]=n<<2|r>>4,u[h++]=(15&r)<<4|i>>2,u[h++]=(3&i)<<6|63&s;return l}function pt(t){var e,n=new Uint8Array(t),r="";for(e=0;e<n.length;e+=3)r+=q[n[e]>>2],r+=q[(3&n[e])<<4|n[e+1]>>4],r+=q[(15&n[e+1])<<2|n[e+2]>>6],r+=q[63&n[e+2]];return n.length%3==2?r=r.substring(0,r.length-1)+"=":n.length%3==1&&(r=r.substring(0,r.length-2)+"=="),r}function mt(t,e){var n="";if(t&&(n=dt.call(t)),t&&("[object ArrayBuffer]"===n||t.buffer&&"[object ArrayBuffer]"===dt.call(t.buffer))){var r,i=Z;t instanceof ArrayBuffer?(r=t,i+=tt):(r=t.buffer,"[object Int8Array]"===n?i+=nt:"[object Uint8Array]"===n?i+=rt:"[object Uint8ClampedArray]"===n?i+=it:"[object Int16Array]"===n?i+=st:"[object Uint16Array]"===n?i+=at:"[object Int32Array]"===n?i+=ot:"[object Uint32Array]"===n?i+=ht:"[object Float32Array]"===n?i+=lt:"[object Float64Array]"===n?i+=ut:e(new Error("Failed to get type for BinaryArray"))),e(i+pt(r))}else if("[object Blob]"===n){var s=new FileReader;s.onload=function(){var n=K+t.type+"~"+pt(this.result);e(Z+et+n)},s.readAsArrayBuffer(t)}else try{e(JSON.stringify(t))}catch(o){e(null,o)}}function gt(t){if(t.substring(0,J)!==Z)return JSON.parse(t);var e,n=t.substring(ct),r=t.substring(J,ct);if(r===et&&Q.test(n)){var i=n.match(Q);e=i[1],n=n.substring(i[0].length)}var s=ft(n);switch(r){case tt:return s;case et:return h([s],{type:e});case nt:return new Int8Array(s);case rt:return new Uint8Array(s);case it:return new Uint8ClampedArray(s);case st:return new Int16Array(s);case at:return new Uint16Array(s);case ot:return new Int32Array(s);case ht:return new Uint32Array(s);case lt:return new Float32Array(s);case ut:return new Float64Array(s);default:throw new Error("Unkown type: "+r)}}var _t={serialize:mt,deserialize:gt,stringToBuffer:ft,bufferToString:pt};function yt(t,e,n,r){t.executeSql("CREATE TABLE IF NOT EXISTS "+e.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,r)}function vt(t){var e=this,n={db:null};if(t)for(var r in t)n[r]="string"!=typeof t[r]?t[r].toString():t[r];var i=new l((function(t,r){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(i){return r(i)}n.db.transaction((function(i){yt(i,n,(function(){e._dbInfo=n,t()}),(function(t,e){r(e)}))}),r)}));return n.serializer=_t,i}function bt(t,e,n,r,i,s){t.executeSql(n,r,i,(function(t,o){o.code===o.SYNTAX_ERR?t.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[e.storeName],(function(t,a){a.rows.length?s(t,o):yt(t,e,(function(){t.executeSql(n,r,i,s)}),s)}),s):s(t,o)}),s)}function xt(t,e){var n=this;t=d(t);var r=new l((function(e,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){bt(n,i,"SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[t],(function(t,n){var r=n.rows.length?n.rows.item(0).value:null;r&&(r=i.serializer.deserialize(r)),e(r)}),(function(t,e){r(e)}))}))}))["catch"](r)}));return u(r,e),r}function Et(t,e){var n=this,r=new l((function(e,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){bt(n,i,"SELECT * FROM "+i.storeName,[],(function(n,r){for(var s=r.rows,o=s.length,a=0;a<o;a++){var h=s.item(a),l=h.value;if(l&&(l=i.serializer.deserialize(l)),void 0!==(l=t(l,h.key,a+1)))return void e(l)}e()}),(function(t,e){r(e)}))}))}))["catch"](r)}));return u(r,e),r}function wt(t,e,n,r){var i=this;t=d(t);var s=new l((function(s,o){i.ready().then((function(){e===undefined&&(e=null);var a=e,h=i._dbInfo;h.serializer.serialize(e,(function(e,l){l?o(l):h.db.transaction((function(n){bt(n,h,"INSERT OR REPLACE INTO "+h.storeName+" (key, value) VALUES (?, ?)",[t,e],(function(){s(a)}),(function(t,e){o(e)}))}),(function(e){if(e.code===e.QUOTA_ERR){if(r>0)return void s(wt.apply(i,[t,a,n,r-1]));o(e)}}))}))}))["catch"](o)}));return u(s,n),s}function Tt(t,e,n){return wt.apply(this,[t,e,n,1])}function St(t,e){var n=this;t=d(t);var r=new l((function(e,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){bt(n,i,"DELETE FROM "+i.storeName+" WHERE key = ?",[t],(function(){e()}),(function(t,e){r(e)}))}))}))["catch"](r)}));return u(r,e),r}function At(t){var e=this,n=new l((function(t,n){e.ready().then((function(){var r=e._dbInfo;r.db.transaction((function(e){bt(e,r,"DELETE FROM "+r.storeName,[],(function(){t()}),(function(t,e){n(e)}))}))}))["catch"](n)}));return u(n,t),n}function Ct(t){var e=this,n=new l((function(t,n){e.ready().then((function(){var r=e._dbInfo;r.db.transaction((function(e){bt(e,r,"SELECT COUNT(key) as c FROM "+r.storeName,[],(function(e,n){var r=n.rows.item(0).c;t(r)}),(function(t,e){n(e)}))}))}))["catch"](n)}));return u(n,t),n}function It(t,e){var n=this,r=new l((function(e,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){bt(n,i,"SELECT key FROM "+i.storeName+" WHERE id = ? LIMIT 1",[t+1],(function(t,n){var r=n.rows.length?n.rows.item(0).key:null;e(r)}),(function(t,e){r(e)}))}))}))["catch"](r)}));return u(r,e),r}function Rt(t){var e=this,n=new l((function(t,n){e.ready().then((function(){var r=e._dbInfo;r.db.transaction((function(e){bt(e,r,"SELECT key FROM "+r.storeName,[],(function(e,n){for(var r=[],i=0;i<n.rows.length;i++)r.push(n.rows.item(i).key);t(r)}),(function(t,e){n(e)}))}))}))["catch"](n)}));return u(n,t),n}function Pt(t){return new l((function(e,n){t.transaction((function(r){r.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(n,r){for(var i=[],s=0;s<r.rows.length;s++)i.push(r.rows.item(s).name);e({db:t,storeNames:i})}),(function(t,e){n(e)}))}),(function(t){n(t)}))}))}function Mt(t,e){e=f.apply(this,arguments);var n=this.config();(t="function"!=typeof t&&t||{}).name||(t.name=t.name||n.name,t.storeName=t.storeName||n.storeName);var r,i=this;return u(r=t.name?new l((function(e){var r;r=t.name===n.name?i._dbInfo.db:openDatabase(t.name,"","",0),t.storeName?e({db:r,storeNames:[t.storeName]}):e(Pt(r))})).then((function(t){return new l((function(e,n){t.db.transaction((function(r){function i(t){return new l((function(e,n){r.executeSql("DROP TABLE IF EXISTS "+t,[],(function(){e()}),(function(t,e){n(e)}))}))}for(var s=[],o=0,a=t.storeNames.length;o<a;o++)s.push(i(t.storeNames[o]));l.all(s).then((function(){e()}))["catch"]((function(t){n(t)}))}),(function(t){n(t)}))}))})):l.reject("Invalid arguments"),e),r}var Ot={_driver:"webSQLStorage",_initStorage:vt,_support:Y(),iterate:Et,getItem:xt,setItem:Tt,removeItem:St,clear:At,length:Ct,key:It,keys:Rt,dropInstance:Mt};function Dt(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(t){return!1}}function Nt(t,e){var n=t.name+"/";return t.storeName!==e.storeName&&(n+=t.storeName+"/"),n}function kt(){var t="_localforage_support_test";try{return localStorage.setItem(t,!0),localStorage.removeItem(t),!1}catch(e){return!0}}function Lt(){return!kt()||localStorage.length>0}function Ft(t){var e=this,n={};if(t)for(var r in t)n[r]=t[r];return n.keyPrefix=Nt(t,e._defaultConfig),Lt()?(e._dbInfo=n,n.serializer=_t,l.resolve()):l.reject()}function Bt(t){var e=this,n=e.ready().then((function(){for(var t=e._dbInfo.keyPrefix,n=localStorage.length-1;n>=0;n--){var r=localStorage.key(n);0===r.indexOf(t)&&localStorage.removeItem(r)}}));return u(n,t),n}function Ut(t,e){var n=this;t=d(t);var r=n.ready().then((function(){var e=n._dbInfo,r=localStorage.getItem(e.keyPrefix+t);return r&&(r=e.serializer.deserialize(r)),r}));return u(r,e),r}function jt(t,e){var n=this,r=n.ready().then((function(){for(var e=n._dbInfo,r=e.keyPrefix,i=r.length,s=localStorage.length,o=1,a=0;a<s;a++){var h=localStorage.key(a);if(0===h.indexOf(r)){var l=localStorage.getItem(h);if(l&&(l=e.serializer.deserialize(l)),void 0!==(l=t(l,h.substring(i),o++)))return l}}}));return u(r,e),r}function Gt(t,e){var n=this,r=n.ready().then((function(){var e,r=n._dbInfo;try{e=localStorage.key(t)}catch(i){e=null}return e&&(e=e.substring(r.keyPrefix.length)),e}));return u(r,e),r}function Ht(t){var e=this,n=e.ready().then((function(){for(var t=e._dbInfo,n=localStorage.length,r=[],i=0;i<n;i++){var s=localStorage.key(i);0===s.indexOf(t.keyPrefix)&&r.push(s.substring(t.keyPrefix.length))}return r}));return u(n,t),n}function zt(t){var e=this.keys().then((function(t){return t.length}));return u(e,t),e}function Wt(t,e){var n=this;t=d(t);var r=n.ready().then((function(){var e=n._dbInfo;localStorage.removeItem(e.keyPrefix+t)}));return u(r,e),r}function Vt(t,e,n){var r=this;t=d(t);var i=r.ready().then((function(){e===undefined&&(e=null);var n=e;return new l((function(i,s){var o=r._dbInfo;o.serializer.serialize(e,(function(e,r){if(r)s(r);else try{localStorage.setItem(o.keyPrefix+t,e),i(n)}catch(a){"QuotaExceededError"!==a.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==a.name||s(a),s(a)}}))}))}));return u(i,n),i}function Xt(t,e){if(e=f.apply(this,arguments),!(t="function"!=typeof t&&t||{}).name){var n=this.config();t.name=t.name||n.name,t.storeName=t.storeName||n.storeName}var r,i=this;return r=t.name?new l((function(e){t.storeName?e(Nt(t,i._defaultConfig)):e(t.name+"/")})).then((function(t){for(var e=localStorage.length-1;e>=0;e--){var n=localStorage.key(e);0===n.indexOf(t)&&localStorage.removeItem(n)}})):l.reject("Invalid arguments"),u(r,e),r}var $t={_driver:"localStorageWrapper",_initStorage:Ft,_support:Dt(),iterate:jt,getItem:Ut,setItem:Vt,removeItem:Wt,clear:Bt,length:zt,key:Gt,keys:Ht,dropInstance:Xt},Yt=function(t,e){return t===e||"number"==typeof t&&"number"==typeof e&&isNaN(t)&&isNaN(e)},qt=function(t,e){for(var n=t.length,r=0;r<n;){if(Yt(t[r],e))return!0;r++}return!1},Kt=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},Qt={},Zt={},Jt={INDEXEDDB:$,WEBSQL:Ot,LOCALSTORAGE:$t},te=[Jt.INDEXEDDB._driver,Jt.WEBSQL._driver,Jt.LOCALSTORAGE._driver],ee=["dropInstance"],ne=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(ee),re={description:"",driver:te.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function ie(t,e){t[e]=function(){var n=arguments;return t.ready().then((function(){return t[e].apply(t,n)}))}}function se(){for(var t=1;t<arguments.length;t++){var e=arguments[t];if(e)for(var n in e)e.hasOwnProperty(n)&&(Kt(e[n])?arguments[0][n]=e[n].slice():arguments[0][n]=e[n])}return arguments[0]}var oe=function(){function t(e){for(var n in i(this,t),Jt)if(Jt.hasOwnProperty(n)){var r=Jt[n],s=r._driver;this[n]=s,Qt[s]||this.defineDriver(r)}this._defaultConfig=se({},re),this._config=se({},this._defaultConfig,e),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver)["catch"]((function(){}))}return t.prototype.config=function(t){if("object"===(void 0===t?"undefined":r(t))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var e in t){if("storeName"===e&&(t[e]=t[e].replace(/\W/g,"_")),"version"===e&&"number"!=typeof t[e])return new Error("Database version must be a number.");this._config[e]=t[e]}return!("driver"in t)||!t.driver||this.setDriver(this._config.driver)}return"string"==typeof t?this._config[t]:this._config},t.prototype.defineDriver=function(t,e,n){var r=new l((function(e,n){try{var r=t._driver,i=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!t._driver)return void n(i);for(var s=ne.concat("_initStorage"),o=0,a=s.length;o<a;o++){var h=s[o];if((!qt(ee,h)||t[h])&&"function"!=typeof t[h])return void n(i)}var c=function(){for(var e=function(t){return function(){var e=new Error("Method "+t+" is not implemented by the current driver"),n=l.reject(e);return u(n,arguments[arguments.length-1]),n}},n=0,r=ee.length;n<r;n++){var i=ee[n];t[i]||(t[i]=e(i))}};c();var d=function(n){Qt[r],Qt[r]=t,Zt[r]=n,e()};"_support"in t?t._support&&"function"==typeof t._support?t._support().then(d,n):d(!!t._support):d(!0)}catch(f){n(f)}}));return c(r,e,n),r},t.prototype.driver=function(){return this._driver||null},t.prototype.getDriver=function(t,e,n){var r=Qt[t]?l.resolve(Qt[t]):l.reject(new Error("Driver not found."));return c(r,e,n),r},t.prototype.getSerializer=function(t){var e=l.resolve(_t);return c(e,t),e},t.prototype.ready=function(t){var e=this,n=e._driverSet.then((function(){return null===e._ready&&(e._ready=e._initDriver()),e._ready}));return c(n,t,t),n},t.prototype.setDriver=function(t,e,n){var r=this;Kt(t)||(t=[t]);var i=this._getSupportedDrivers(t);function s(){r._config.driver=r.driver()}function o(t){return r._extend(t),s(),r._ready=r._initStorage(r._config),r._ready}function a(t){return function(){var e=0;function n(){for(;e<t.length;){var i=t[e];return e++,r._dbInfo=null,r._ready=null,r.getDriver(i).then(o)["catch"](n)}s();var a=new Error("No available storage method found.");return r._driverSet=l.reject(a),r._driverSet}return n()}}var h=null!==this._driverSet?this._driverSet["catch"]((function(){return l.resolve()})):l.resolve();return this._driverSet=h.then((function(){var t=i[0];return r._dbInfo=null,r._ready=null,r.getDriver(t).then((function(t){r._driver=t._driver,s(),r._wrapLibraryMethodsWithReady(),r._initDriver=a(i)}))}))["catch"]((function(){s();var t=new Error("No available storage method found.");return r._driverSet=l.reject(t),r._driverSet})),c(this._driverSet,e,n),this._driverSet},t.prototype.supports=function(t){return!!Zt[t]},t.prototype._extend=function(t){se(this,t)},t.prototype._getSupportedDrivers=function(t){for(var e=[],n=0,r=t.length;n<r;n++){var i=t[n];this.supports(i)&&e.push(i)}return e},t.prototype._wrapLibraryMethodsWithReady=function(){for(var t=0,e=ne.length;t<e;t++)ie(this,ne[t])},t.prototype.createInstance=function(e){return new t(e)},t}(),ae=new oe;e.exports=ae},{3:3}]},{},[4])(4)},631:(t,e,n)=>{var r="function"==typeof Map&&Map.prototype,i=Object.getOwnPropertyDescriptor&&r?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,s=r&&i&&"function"==typeof i.get?i.get:null,o=r&&Map.prototype.forEach,a="function"==typeof Set&&Set.prototype,h=Object.getOwnPropertyDescriptor&&a?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,l=a&&h&&"function"==typeof h.get?h.get:null,u=a&&Set.prototype.forEach,c="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,d="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,f="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,p=Boolean.prototype.valueOf,m=Object.prototype.toString,g=Function.prototype.toString,_=String.prototype.match,y=String.prototype.slice,v=String.prototype.replace,b=String.prototype.toUpperCase,x=String.prototype.toLowerCase,E=RegExp.prototype.test,w=Array.prototype.concat,T=Array.prototype.join,S=Array.prototype.slice,A=Math.floor,C="function"==typeof BigInt?BigInt.prototype.valueOf:null,I=Object.getOwnPropertySymbols,R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,P="function"==typeof Symbol&&"object"==typeof Symbol.iterator,M="function"==typeof Symbol&&Symbol.toStringTag&&(typeof Symbol.toStringTag===P||"symbol")?Symbol.toStringTag:null,O=Object.prototype.propertyIsEnumerable,D=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(t){return t.__proto__}:null);function N(t,e){if(t===Infinity||t===-Infinity||t!=t||t&&t>-1e3&&t<1e3||E.call(/e/,e))return e;var n=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof t){var r=t<0?-A(-t):A(t);if(r!==t){var i=String(r),s=y.call(e,i.length+1);return v.call(i,n,"$&_")+"."+v.call(v.call(s,/([0-9]{3})/g,"$&_"),/_$/,"")}}return v.call(e,n,"$&_")}var k=n(654),L=k.custom,F=H(L)?L:null;function B(t,e,n){var r="double"===(n.quoteStyle||e)?'"':"'";return r+t+r}function U(t){return v.call(String(t),/"/g,"&quot;")}function j(t){return!("[object Array]"!==V(t)||M&&"object"==typeof t&&M in t)}function G(t){return!("[object RegExp]"!==V(t)||M&&"object"==typeof t&&M in t)}function H(t){if(P)return t&&"object"==typeof t&&t instanceof Symbol;if("symbol"==typeof t)return!0;if(!t||"object"!=typeof t||!R)return!1;try{return R.call(t),!0}catch(e){}return!1}t.exports=function tt(t,e,n,r){var i=e||{};if(W(i,"quoteStyle")&&"single"!==i.quoteStyle&&"double"!==i.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(W(i,"maxStringLength")&&("number"==typeof i.maxStringLength?i.maxStringLength<0&&i.maxStringLength!==Infinity:null!==i.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var a=!W(i,"customInspect")||i.customInspect;if("boolean"!=typeof a&&"symbol"!==a)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(W(i,"indent")&&null!==i.indent&&"\t"!==i.indent&&!(parseInt(i.indent,10)===i.indent&&i.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(W(i,"numericSeparator")&&"boolean"!=typeof i.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var h=i.numericSeparator;if(void 0===t)return"undefined";if(null===t)return"null";if("boolean"==typeof t)return t?"true":"false";if("string"==typeof t)return $(t,i);if("number"==typeof t){if(0===t)return Infinity/t>0?"0":"-0";var m=String(t);return h?N(t,m):m}if("bigint"==typeof t){var b=String(t)+"n";return h?N(t,b):b}var E="undefined"==typeof i.depth?5:i.depth;if(void 0===n&&(n=0),n>=E&&E>0&&"object"==typeof t)return j(t)?"[Array]":"[Object]";var A=function(t,e){var n;if("\t"===t.indent)n="\t";else{if(!("number"==typeof t.indent&&t.indent>0))return null;n=T.call(Array(t.indent+1)," ")}return{base:n,prev:T.call(Array(e+1),n)}}(i,n);if(void 0===r)r=[];else if(X(r,t)>=0)return"[Circular]";function I(t,e,s){if(e&&(r=S.call(r)).push(e),s){var o={depth:i.depth};return W(i,"quoteStyle")&&(o.quoteStyle=i.quoteStyle),tt(t,o,n+1,r)}return tt(t,i,n+1,r)}if("function"==typeof t&&!G(t)){var L=function(t){if(t.name)return t.name;var e=_.call(g.call(t),/^function\s*([\w$]+)/);if(e)return e[1];return null}(t),z=J(t,I);return"[Function"+(L?": "+L:" (anonymous)")+"]"+(z.length>0?" { "+T.call(z,", ")+" }":"")}if(H(t)){var Y=P?v.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):R.call(t);return"object"!=typeof t||P?Y:q(Y)}if(function(t){if(!t||"object"!=typeof t)return!1;if("undefined"!=typeof HTMLElement&&t instanceof HTMLElement)return!0;return"string"==typeof t.nodeName&&"function"==typeof t.getAttribute}(t)){for(var et="<"+x.call(String(t.nodeName)),nt=t.attributes||[],rt=0;rt<nt.length;rt++)et+=" "+nt[rt].name+"="+B(U(nt[rt].value),"double",i);return et+=">",t.childNodes&&t.childNodes.length&&(et+="..."),et+="</"+x.call(String(t.nodeName))+">"}if(j(t)){if(0===t.length)return"[]";var it=J(t,I);return A&&!function(t){for(var e=0;e<t.length;e++)if(X(t[e],"\n")>=0)return!1;return!0}(it)?"["+Z(it,A)+"]":"[ "+T.call(it,", ")+" ]"}if(function(t){return!("[object Error]"!==V(t)||M&&"object"==typeof t&&M in t)}(t)){var st=J(t,I);return"cause"in Error.prototype||!("cause"in t)||O.call(t,"cause")?0===st.length?"["+String(t)+"]":"{ ["+String(t)+"] "+T.call(st,", ")+" }":"{ ["+String(t)+"] "+T.call(w.call("[cause]: "+I(t.cause),st),", ")+" }"}if("object"==typeof t&&a){if(F&&"function"==typeof t[F]&&k)return k(t,{depth:E-n});if("symbol"!==a&&"function"==typeof t.inspect)return t.inspect()}if(function(t){if(!s||!t||"object"!=typeof t)return!1;try{s.call(t);try{l.call(t)}catch(et){return!0}return t instanceof Map}catch(e){}return!1}(t)){var ot=[];return o&&o.call(t,(function(e,n){ot.push(I(n,t,!0)+" => "+I(e,t))})),Q("Map",s.call(t),ot,A)}if(function(t){if(!l||!t||"object"!=typeof t)return!1;try{l.call(t);try{s.call(t)}catch(e){return!0}return t instanceof Set}catch(n){}return!1}(t)){var at=[];return u&&u.call(t,(function(e){at.push(I(e,t))})),Q("Set",l.call(t),at,A)}if(function(t){if(!c||!t||"object"!=typeof t)return!1;try{c.call(t,c);try{d.call(t,d)}catch(et){return!0}return t instanceof WeakMap}catch(e){}return!1}(t))return K("WeakMap");if(function(t){if(!d||!t||"object"!=typeof t)return!1;try{d.call(t,d);try{c.call(t,c)}catch(et){return!0}return t instanceof WeakSet}catch(e){}return!1}(t))return K("WeakSet");if(function(t){if(!f||!t||"object"!=typeof t)return!1;try{return f.call(t),!0}catch(e){}return!1}(t))return K("WeakRef");if(function(t){return!("[object Number]"!==V(t)||M&&"object"==typeof t&&M in t)}(t))return q(I(Number(t)));if(function(t){if(!t||"object"!=typeof t||!C)return!1;try{return C.call(t),!0}catch(e){}return!1}(t))return q(I(C.call(t)));if(function(t){return!("[object Boolean]"!==V(t)||M&&"object"==typeof t&&M in t)}(t))return q(p.call(t));if(function(t){return!("[object String]"!==V(t)||M&&"object"==typeof t&&M in t)}(t))return q(I(String(t)));if(!function(t){return!("[object Date]"!==V(t)||M&&"object"==typeof t&&M in t)}(t)&&!G(t)){var ht=J(t,I),lt=D?D(t)===Object.prototype:t instanceof Object||t.constructor===Object,ut=t instanceof Object?"":"null prototype",ct=!lt&&M&&Object(t)===t&&M in t?y.call(V(t),8,-1):ut?"Object":"",dt=(lt||"function"!=typeof t.constructor?"":t.constructor.name?t.constructor.name+" ":"")+(ct||ut?"["+T.call(w.call([],ct||[],ut||[]),": ")+"] ":"");return 0===ht.length?dt+"{}":A?dt+"{"+Z(ht,A)+"}":dt+"{ "+T.call(ht,", ")+" }"}return String(t)};var z=Object.prototype.hasOwnProperty||function(t){return t in this};function W(t,e){return z.call(t,e)}function V(t){return m.call(t)}function X(t,e){if(t.indexOf)return t.indexOf(e);for(var n=0,r=t.length;n<r;n++)if(t[n]===e)return n;return-1}function $(t,e){if(t.length>e.maxStringLength){var n=t.length-e.maxStringLength,r="... "+n+" more character"+(n>1?"s":"");return $(y.call(t,0,e.maxStringLength),e)+r}return B(v.call(v.call(t,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,Y),"single",e)}function Y(t){var e=t.charCodeAt(0),n={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return n?"\\"+n:"\\x"+(e<16?"0":"")+b.call(e.toString(16))}function q(t){return"Object("+t+")"}function K(t){return t+" { ? }"}function Q(t,e,n,r){return t+" ("+e+") {"+(r?Z(n,r):T.call(n,", "))+"}"}function Z(t,e){if(0===t.length)return"";var n="\n"+e.prev+e.base;return n+T.call(t,","+n)+"\n"+e.prev}function J(t,e){var n=j(t),r=[];if(n){r.length=t.length;for(var i=0;i<t.length;i++)r[i]=W(t,i)?e(t[i],t):""}var s,o="function"==typeof I?I(t):[];if(P){s={};for(var a=0;a<o.length;a++)s["$"+o[a]]=o[a]}for(var h in t)W(t,h)&&(n&&String(Number(h))===h&&h<t.length||P&&s["$"+h]instanceof Symbol||(E.call(/[^\w$]/,h)?r.push(e(h,t)+": "+e(t[h],t)):r.push(h+": "+e(t[h],t))));if("function"==typeof I)for(var l=0;l<o.length;l++)O.call(t,o[l])&&r.push("["+e(o[l])+"]: "+e(t[o[l]],t));return r}},798:t=>{"use strict";var e=String.prototype.replace,n=/%20/g,r="RFC1738",i="RFC3986";t.exports={"default":i,formatters:{RFC1738:function(t){return e.call(t,n,"+")},RFC3986:function(t){return String(t)}},RFC1738:r,RFC3986:i}},129:(t,e,n)=>{"use strict";var r=n(261),i=n(235),s=n(798);t.exports={formats:s,parse:i,stringify:r}},235:(t,e,n)=>{"use strict";var r=n(769),i=Object.prototype.hasOwnProperty,s=Array.isArray,o={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:r.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},a=function(t){return t.replace(/&#(\d+);/g,(function(t,e){return String.fromCharCode(parseInt(e,10))}))},h=function(t,e){return t&&"string"==typeof t&&e.comma&&t.indexOf(",")>-1?t.split(","):t},l=function(t,e,n,r){if(t){var s=n.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,o=/(\[[^[\]]*])/g,a=n.depth>0&&/(\[[^[\]]*])/.exec(s),l=a?s.slice(0,a.index):s,u=[];if(l){if(!n.plainObjects&&i.call(Object.prototype,l)&&!n.allowPrototypes)return;u.push(l)}for(var c=0;n.depth>0&&null!==(a=o.exec(s))&&c<n.depth;){if(c+=1,!n.plainObjects&&i.call(Object.prototype,a[1].slice(1,-1))&&!n.allowPrototypes)return;u.push(a[1])}return a&&u.push("["+s.slice(a.index)+"]"),function(t,e,n,r){for(var i=r?e:h(e,n),s=t.length-1;s>=0;--s){var o,a=t[s];if("[]"===a&&n.parseArrays)o=[].concat(i);else{o=n.plainObjects?Object.create(null):{};var l="["===a.charAt(0)&&"]"===a.charAt(a.length-1)?a.slice(1,-1):a,u=parseInt(l,10);n.parseArrays||""!==l?!isNaN(u)&&a!==l&&String(u)===l&&u>=0&&n.parseArrays&&u<=n.arrayLimit?(o=[])[u]=i:"__proto__"!==l&&(o[l]=i):o={0:i}}i=o}return i}(u,e,n,r)}};t.exports=function(t,e){var n=function(t){if(!t)return o;if(null!==t.decoder&&t.decoder!==undefined&&"function"!=typeof t.decoder)throw new TypeError("Decoder has to be a function.");if("undefined"!=typeof t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var e="undefined"==typeof t.charset?o.charset:t.charset;return{allowDots:"undefined"==typeof t.allowDots?o.allowDots:!!t.allowDots,allowPrototypes:"boolean"==typeof t.allowPrototypes?t.allowPrototypes:o.allowPrototypes,allowSparse:"boolean"==typeof t.allowSparse?t.allowSparse:o.allowSparse,arrayLimit:"number"==typeof t.arrayLimit?t.arrayLimit:o.arrayLimit,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:o.charsetSentinel,comma:"boolean"==typeof t.comma?t.comma:o.comma,decoder:"function"==typeof t.decoder?t.decoder:o.decoder,delimiter:"string"==typeof t.delimiter||r.isRegExp(t.delimiter)?t.delimiter:o.delimiter,depth:"number"==typeof t.depth||!1===t.depth?+t.depth:o.depth,ignoreQueryPrefix:!0===t.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof t.interpretNumericEntities?t.interpretNumericEntities:o.interpretNumericEntities,parameterLimit:"number"==typeof t.parameterLimit?t.parameterLimit:o.parameterLimit,parseArrays:!1!==t.parseArrays,plainObjects:"boolean"==typeof t.plainObjects?t.plainObjects:o.plainObjects,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:o.strictNullHandling}}(e);if(""===t||null==t)return n.plainObjects?Object.create(null):{};for(var u="string"==typeof t?function(t,e){var n,l={__proto__:null},u=e.ignoreQueryPrefix?t.replace(/^\?/,""):t,c=e.parameterLimit===Infinity?undefined:e.parameterLimit,d=u.split(e.delimiter,c),f=-1,p=e.charset;if(e.charsetSentinel)for(n=0;n<d.length;++n)0===d[n].indexOf("utf8=")&&("utf8=%E2%9C%93"===d[n]?p="utf-8":"utf8=%26%2310003%3B"===d[n]&&(p="iso-8859-1"),f=n,n=d.length);for(n=0;n<d.length;++n)if(n!==f){var m,g,_=d[n],y=_.indexOf("]="),v=-1===y?_.indexOf("="):y+1;-1===v?(m=e.decoder(_,o.decoder,p,"key"),g=e.strictNullHandling?null:""):(m=e.decoder(_.slice(0,v),o.decoder,p,"key"),g=r.maybeMap(h(_.slice(v+1),e),(function(t){return e.decoder(t,o.decoder,p,"value")}))),g&&e.interpretNumericEntities&&"iso-8859-1"===p&&(g=a(g)),_.indexOf("[]=")>-1&&(g=s(g)?[g]:g),i.call(l,m)?l[m]=r.combine(l[m],g):l[m]=g}return l}(t,n):t,c=n.plainObjects?Object.create(null):{},d=Object.keys(u),f=0;f<d.length;++f){var p=d[f],m=l(p,u[p],n,"string"==typeof t);c=r.merge(c,m,n)}return!0===n.allowSparse?c:r.compact(c)}},261:(t,e,n)=>{"use strict";var r=n(478),i=n(769),s=n(798),o=Object.prototype.hasOwnProperty,a={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},h=Array.isArray,l=Array.prototype.push,u=function(t,e){l.apply(t,h(e)?e:[e])},c=Date.prototype.toISOString,d=s["default"],f={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:i.encode,encodeValuesOnly:!1,format:d,formatter:s.formatters[d],indices:!1,serializeDate:function(t){return c.call(t)},skipNulls:!1,strictNullHandling:!1},p={},m=function g(t,e,n,s,o,a,l,c,d,m,_,y,v,b,x,E){for(var w,T=t,S=E,A=0,C=!1;(S=S.get(p))!==void undefined&&!C;){var I=S.get(t);if(A+=1,void 0!==I){if(I===A)throw new RangeError("Cyclic object value");C=!0}void 0===S.get(p)&&(A=0)}if("function"==typeof c?T=c(e,T):T instanceof Date?T=_(T):"comma"===n&&h(T)&&(T=i.maybeMap(T,(function(t){return t instanceof Date?_(t):t}))),null===T){if(o)return l&&!b?l(e,f.encoder,x,"key",y):e;T=""}if("string"==typeof(w=T)||"number"==typeof w||"boolean"==typeof w||"symbol"==typeof w||"bigint"==typeof w||i.isBuffer(T))return l?[v(b?e:l(e,f.encoder,x,"key",y))+"="+v(l(T,f.encoder,x,"value",y))]:[v(e)+"="+v(String(T))];var R,P=[];if(void 0===T)return P;if("comma"===n&&h(T))b&&l&&(T=i.maybeMap(T,l)),R=[{value:T.length>0?T.join(",")||null:void undefined}];else if(h(c))R=c;else{var M=Object.keys(T);R=d?M.sort(d):M}for(var O=s&&h(T)&&1===T.length?e+"[]":e,D=0;D<R.length;++D){var N=R[D],k="object"==typeof N&&"undefined"!=typeof N.value?N.value:T[N];if(!a||null!==k){var L=h(T)?"function"==typeof n?n(O,N):O:O+(m?"."+N:"["+N+"]");E.set(t,A);var F=r();F.set(p,E),u(P,g(k,L,n,s,o,a,"comma"===n&&b&&h(T)?null:l,c,d,m,_,y,v,b,x,F))}}return P};t.exports=function(t,e){var n,i=t,l=function(t){if(!t)return f;if(null!==t.encoder&&"undefined"!=typeof t.encoder&&"function"!=typeof t.encoder)throw new TypeError("Encoder has to be a function.");var e=t.charset||f.charset;if("undefined"!=typeof t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var n=s["default"];if("undefined"!=typeof t.format){if(!o.call(s.formatters,t.format))throw new TypeError("Unknown format option provided.");n=t.format}var r=s.formatters[n],i=f.filter;return("function"==typeof t.filter||h(t.filter))&&(i=t.filter),{addQueryPrefix:"boolean"==typeof t.addQueryPrefix?t.addQueryPrefix:f.addQueryPrefix,allowDots:"undefined"==typeof t.allowDots?f.allowDots:!!t.allowDots,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:f.charsetSentinel,delimiter:"undefined"==typeof t.delimiter?f.delimiter:t.delimiter,encode:"boolean"==typeof t.encode?t.encode:f.encode,encoder:"function"==typeof t.encoder?t.encoder:f.encoder,encodeValuesOnly:"boolean"==typeof t.encodeValuesOnly?t.encodeValuesOnly:f.encodeValuesOnly,filter:i,format:n,formatter:r,serializeDate:"function"==typeof t.serializeDate?t.serializeDate:f.serializeDate,skipNulls:"boolean"==typeof t.skipNulls?t.skipNulls:f.skipNulls,sort:"function"==typeof t.sort?t.sort:null,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:f.strictNullHandling}}(e);"function"==typeof l.filter?i=(0,l.filter)("",i):h(l.filter)&&(n=l.filter);var c,d=[];if("object"!=typeof i||null===i)return"";c=e&&e.arrayFormat in a?e.arrayFormat:e&&"indices"in e?e.indices?"indices":"repeat":"indices";var p=a[c];if(e&&"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var g="comma"===p&&e&&e.commaRoundTrip;n||(n=Object.keys(i)),l.sort&&n.sort(l.sort);for(var _=r(),y=0;y<n.length;++y){var v=n[y];l.skipNulls&&null===i[v]||u(d,m(i[v],v,p,g,l.strictNullHandling,l.skipNulls,l.encode?l.encoder:null,l.filter,l.sort,l.allowDots,l.serializeDate,l.format,l.formatter,l.encodeValuesOnly,l.charset,_))}var b=d.join(l.delimiter),x=!0===l.addQueryPrefix?"?":"";return l.charsetSentinel&&("iso-8859-1"===l.charset?x+="utf8=%26%2310003%3B&":x+="utf8=%E2%9C%93&"),b.length>0?x+b:""}},769:(t,e,n)=>{"use strict";var r=n(798),i=Object.prototype.hasOwnProperty,s=Array.isArray,o=function(){for(var t=[],e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t}(),a=function(t,e){for(var n=e&&e.plainObjects?Object.create(null):{},r=0;r<t.length;++r)"undefined"!=typeof t[r]&&(n[r]=t[r]);return n};t.exports={arrayToObject:a,assign:function(t,e){return Object.keys(e).reduce((function(t,n){return t[n]=e[n],t}),t)},combine:function(t,e){return[].concat(t,e)},compact:function(t){for(var e=[{obj:{o:t},prop:"o"}],n=[],r=0;r<e.length;++r)for(var i=e[r],o=i.obj[i.prop],a=Object.keys(o),h=0;h<a.length;++h){var l=a[h],u=o[l];"object"==typeof u&&null!==u&&-1===n.indexOf(u)&&(e.push({obj:o,prop:l}),n.push(u))}return function(t){for(;t.length>1;){var e=t.pop(),n=e.obj[e.prop];if(s(n)){for(var r=[],i=0;i<n.length;++i)"undefined"!=typeof n[i]&&r.push(n[i]);e.obj[e.prop]=r}}}(e),t},decode:function(t,e,n){var r=t.replace(/\+/g," ");if("iso-8859-1"===n)return r.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(r)}catch(i){return r}},encode:function(t,e,n,i,s){if(0===t.length)return t;var a=t;if("symbol"==typeof t?a=Symbol.prototype.toString.call(t):"string"!=typeof t&&(a=String(t)),"iso-8859-1"===n)return escape(a).replace(/%u[0-9a-f]{4}/gi,(function(t){return"%26%23"+parseInt(t.slice(2),16)+"%3B"}));for(var h="",l=0;l<a.length;++l){var u=a.charCodeAt(l);45===u||46===u||95===u||126===u||u>=48&&u<=57||u>=65&&u<=90||u>=97&&u<=122||s===r.RFC1738&&(40===u||41===u)?h+=a.charAt(l):u<128?h+=o[u]:u<2048?h+=o[192|u>>6]+o[128|63&u]:u<55296||u>=57344?h+=o[224|u>>12]+o[128|u>>6&63]+o[128|63&u]:(l+=1,u=65536+((1023&u)<<10|1023&a.charCodeAt(l)),h+=o[240|u>>18]+o[128|u>>12&63]+o[128|u>>6&63]+o[128|63&u])}return h},isBuffer:function(t){return!(!t||"object"!=typeof t)&&!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))},isRegExp:function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},maybeMap:function(t,e){if(s(t)){for(var n=[],r=0;r<t.length;r+=1)n.push(e(t[r]));return n}return e(t)},merge:function h(t,e,n){if(!e)return t;if("object"!=typeof e){if(s(t))t.push(e);else{if(!t||"object"!=typeof t)return[t,e];(n&&(n.plainObjects||n.allowPrototypes)||!i.call(Object.prototype,e))&&(t[e]=!0)}return t}if(!t||"object"!=typeof t)return[t].concat(e);var r=t;return s(t)&&!s(e)&&(r=a(t,n)),s(t)&&s(e)?(e.forEach((function(e,r){if(i.call(t,r)){var s=t[r];s&&"object"==typeof s&&e&&"object"==typeof e?t[r]=h(s,e,n):t.push(e)}else t[r]=e})),t):Object.keys(e).reduce((function(t,r){var s=e[r];return i.call(t,r)?t[r]=h(t[r],s,n):t[r]=s,t}),r)}}},478:(t,e,n)=>{"use strict";var r=n(210),i=n(924),s=n(631),o=r("%TypeError%"),a=r("%WeakMap%",!0),h=r("%Map%",!0),l=i("WeakMap.prototype.get",!0),u=i("WeakMap.prototype.set",!0),c=i("WeakMap.prototype.has",!0),d=i("Map.prototype.get",!0),f=i("Map.prototype.set",!0),p=i("Map.prototype.has",!0),m=function(t,e){for(var n,r=t;null!==(n=r.next);r=n)if(n.key===e)return r.next=n.next,n.next=t.next,t.next=n,n};t.exports=function(){var t,e,n,r={assert:function(t){if(!r.has(t))throw new o("Side channel does not contain "+s(t))},get:function(r){if(a&&r&&("object"==typeof r||"function"==typeof r)){if(t)return l(t,r)}else if(h){if(e)return d(e,r)}else if(n)return function(t,e){var n=m(t,e);return n&&n.value}(n,r)},has:function(r){if(a&&r&&("object"==typeof r||"function"==typeof r)){if(t)return c(t,r)}else if(h){if(e)return p(e,r)}else if(n)return function(t,e){return!!m(t,e)}(n,r);return!1},set:function(r,i){a&&r&&("object"==typeof r||"function"==typeof r)?(t||(t=new a),u(t,r,i)):h?(e||(e=new h),f(e,r,i)):(n||(n={key:{},next:null}),function(t,e,n){var r=m(t,e);r?r.value=n:t.next={key:e,next:t.next,value:n}}(n,r,i))}};return r}},466:function(t){var e;t.exports=((e=function(){function t(t){return i.appendChild(t.dom),t}function n(t){for(var e=0;e<i.children.length;e++)i.children[e].style.display=e===t?"block":"none";r=t}var r=0,i=document.createElement("div");i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",(function(t){t.preventDefault(),n(++r%i.children.length)}),!1);var s=(performance||Date).now(),o=s,a=0,h=t(new e.Panel("FPS","#0ff","#002")),l=t(new e.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var u=t(new e.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:i,addPanel:t,showPanel:n,begin:function(){s=(performance||Date).now()},end:function(){a++;var t=(performance||Date).now();if(l.update(t-s,200),t>o+1e3&&(h.update(1e3*a/(t-o),100),o=t,a=0,u)){var e=performance.memory;u.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return t},update:function(){s=this.end()},domElement:i,setMode:n}}).Panel=function(t,e,n){var r=Infinity,i=0,s=Math.round,o=s(window.devicePixelRatio||1),a=80*o,h=48*o,l=3*o,u=2*o,c=3*o,d=15*o,f=74*o,p=30*o,m=document.createElement("canvas");m.width=a,m.height=h,m.style.cssText="width:80px;height:48px";var g=m.getContext("2d");return g.font="bold "+9*o+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=n,g.fillRect(0,0,a,h),g.fillStyle=e,g.fillText(t,l,u),g.fillRect(c,d,f,p),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(c,d,f,p),{dom:m,update:function(h,_){r=Math.min(r,h),i=Math.max(i,h),g.fillStyle=n,g.globalAlpha=1,g.fillRect(0,0,a,d),g.fillStyle=e,g.fillText(s(h)+" "+t+" ("+s(r)+"-"+s(i)+")",l,u),g.drawImage(m,c+o,d,f-o,p,c,d,f-o,p),g.fillRect(c+f-o,d,o,p),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(c+f-o,d,o,s((1-h/_)*p))}}},e)},511:function(t,e,n){var r;t=n.nmd(t),function(i){e&&e.nodeType,t&&t.nodeType;var s="object"==typeof n.g&&n.g;s.global!==s&&s.window!==s&&s.self;var o,a=2147483647,h=36,l=1,u=26,c=38,d=700,f=72,p=128,m="-",g=/^xn--/,_=/[^\x20-\x7E]/,y=/[\x2E\u3002\uFF0E\uFF61]/g,v={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},b=h-l,x=Math.floor,E=String.fromCharCode;function w(t){throw new RangeError(v[t])}function T(t,e){for(var n=t.length,r=[];n--;)r[n]=e(t[n]);return r}function S(t,e){var n=t.split("@"),r="";return n.length>1&&(r=n[0]+"@",t=n[1]),r+T((t=t.replace(y,".")).split("."),e).join(".")}function A(t){for(var e,n,r=[],i=0,s=t.length;i<s;)(e=t.charCodeAt(i++))>=55296&&e<=56319&&i<s?56320==(64512&(n=t.charCodeAt(i++)))?r.push(((1023&e)<<10)+(1023&n)+65536):(r.push(e),i--):r.push(e);return r}function C(t){return T(t,(function(t){var e="";return t>65535&&(e+=E((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+=E(t)})).join("")}function I(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function R(t,e,n){var r=0;for(t=n?x(t/d):t>>1,t+=x(t/e);t>b*u>>1;r+=h)t=x(t/b);return x(r+(b+1)*t/(t+c))}function P(t){var e,n,r,i,s,o,c,d,g,_,y,v=[],b=t.length,E=0,T=p,S=f;for((n=t.lastIndexOf(m))<0&&(n=0),r=0;r<n;++r)t.charCodeAt(r)>=128&&w("not-basic"),v.push(t.charCodeAt(r));for(i=n>0?n+1:0;i<b;){for(s=E,o=1,c=h;i>=b&&w("invalid-input"),((d=(y=t.charCodeAt(i++))-48<10?y-22:y-65<26?y-65:y-97<26?y-97:h)>=h||d>x((a-E)/o))&&w("overflow"),E+=d*o,!(d<(g=c<=S?l:c>=S+u?u:c-S));c+=h)o>x(a/(_=h-g))&&w("overflow"),o*=_;S=R(E-s,e=v.length+1,0==s),x(E/e)>a-T&&w("overflow"),T+=x(E/e),E%=e,v.splice(E++,0,T)}return C(v)}function M(t){var e,n,r,i,s,o,c,d,g,_,y,v,b,T,S,C=[];for(v=(t=A(t)).length,e=p,n=0,s=f,o=0;o<v;++o)(y=t[o])<128&&C.push(E(y));for(r=i=C.length,i&&C.push(m);r<v;){for(c=a,o=0;o<v;++o)(y=t[o])>=e&&y<c&&(c=y);for(c-e>x((a-n)/(b=r+1))&&w("overflow"),n+=(c-e)*b,e=c,o=0;o<v;++o)if((y=t[o])<e&&++n>a&&w("overflow"),y==e){for(d=n,g=h;!(d<(_=g<=s?l:g>=s+u?u:g-s));g+=h)S=d-_,T=h-_,C.push(E(I(_+S%T,0))),d=x(S/T);C.push(E(I(d,0))),s=R(n,b,r==i),n=0,++r}++n,++e}return C.join("")}o={version:"1.4.1",ucs2:{decode:A,encode:C},decode:P,encode:M,toASCII:function(t){return S(t,(function(t){return _.test(t)?"xn--"+M(t):t}))},toUnicode:function(t){return S(t,(function(t){return g.test(t)?P(t.slice(4).toLowerCase()):t}))}},(r=function(){return o}.call(e,n,e,t))===undefined||(t.exports=r)}()},575:(t,e,n)=>{"use strict";var r=n(511);function i(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var s=/^([a-z0-9.+-]+:)/i,o=/:[0-9]*$/,a=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,h=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),l=["'"].concat(h),u=["%","/","?",";","#"].concat(l),c=["/","?","#"],d=/^[+a-z0-9A-Z_-]{0,63}$/,f=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,p={javascript:!0,"javascript:":!0},m={javascript:!0,"javascript:":!0},g={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},_=n(129);function y(t,e,n){if(t&&"object"==typeof t&&t instanceof i)return t;var r=new i;return r.parse(t,e,n),r}i.prototype.parse=function(t,e,n){if("string"!=typeof t)throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var i=t.indexOf("?"),o=-1!==i&&i<t.indexOf("#")?"?":"#",h=t.split(o);h[0]=h[0].replace(/\\/g,"/");var y=t=h.join(o);if(y=y.trim(),!n&&1===t.split("#").length){var v=a.exec(y);if(v)return this.path=y,this.href=y,this.pathname=v[1],v[2]?(this.search=v[2],this.query=e?_.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var b=s.exec(y);if(b){var x=(b=b[0]).toLowerCase();this.protocol=x,y=y.substr(b.length)}if(n||b||y.match(/^\/\/[^@/]+@[^@/]+/)){var E="//"===y.substr(0,2);!E||b&&m[b]||(y=y.substr(2),this.slashes=!0)}if(!m[b]&&(E||b&&!g[b])){for(var w,T,S=-1,A=0;A<c.length;A++){-1!==(C=y.indexOf(c[A]))&&(-1===S||C<S)&&(S=C)}-1!==(T=-1===S?y.lastIndexOf("@"):y.lastIndexOf("@",S))&&(w=y.slice(0,T),y=y.slice(T+1),this.auth=decodeURIComponent(w)),S=-1;for(A=0;A<u.length;A++){var C;-1!==(C=y.indexOf(u[A]))&&(-1===S||C<S)&&(S=C)}-1===S&&(S=y.length),this.host=y.slice(0,S),y=y.slice(S),this.parseHost(),this.hostname=this.hostname||"";var I="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!I)for(var R=this.hostname.split(/\./),P=(A=0,R.length);A<P;A++){var M=R[A];if(M&&!M.match(d)){for(var O="",D=0,N=M.length;D<N;D++)M.charCodeAt(D)>127?O+="x":O+=M[D];if(!O.match(d)){var k=R.slice(0,A),L=R.slice(A+1),F=M.match(f);F&&(k.push(F[1]),L.unshift(F[2])),L.length&&(y="/"+L.join(".")+y),this.hostname=k.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),I||(this.hostname=r.toASCII(this.hostname));var B=this.port?":"+this.port:"",U=this.hostname||"";this.host=U+B,this.href+=this.host,I&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==y[0]&&(y="/"+y))}if(!p[x])for(A=0,P=l.length;A<P;A++){var j=l[A];if(-1!==y.indexOf(j)){var G=encodeURIComponent(j);G===j&&(G=escape(j)),y=y.split(j).join(G)}}var H=y.indexOf("#");-1!==H&&(this.hash=y.substr(H),y=y.slice(0,H));var z=y.indexOf("?");if(-1!==z?(this.search=y.substr(z),this.query=y.substr(z+1),e&&(this.query=_.parse(this.query)),y=y.slice(0,z)):e&&(this.search="",this.query={}),y&&(this.pathname=y),g[x]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){B=this.pathname||"";var W=this.search||"";this.path=B+W}return this.href=this.format(),this},i.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",n=this.pathname||"",r=this.hash||"",i=!1,s="";this.host?i=t+this.host:this.hostname&&(i=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&"object"==typeof this.query&&Object.keys(this.query).length&&(s=_.stringify(this.query));var o=this.search||s&&"?"+s||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||g[e])&&!1!==i?(i="//"+(i||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):i||(i=""),r&&"#"!==r.charAt(0)&&(r="#"+r),o&&"?"!==o.charAt(0)&&(o="?"+o),e+i+(n=n.replace(/[?#]/g,(function(t){return encodeURIComponent(t)})))+(o=o.replace("#","%23"))+r},i.prototype.resolve=function(t){return this.resolveObject(y(t,!1,!0)).format()},i.prototype.resolveObject=function(t){if("string"==typeof t){var e=new i;e.parse(t,!1,!0),t=e}for(var n=new i,r=Object.keys(this),s=0;s<r.length;s++){var o=r[s];n[o]=this[o]}if(n.hash=t.hash,""===t.href)return n.href=n.format(),n;if(t.slashes&&!t.protocol){for(var a=Object.keys(t),h=0;h<a.length;h++){var l=a[h];"protocol"!==l&&(n[l]=t[l])}return g[n.protocol]&&n.hostname&&!n.pathname&&(n.pathname="/",n.path=n.pathname),n.href=n.format(),n}if(t.protocol&&t.protocol!==n.protocol){if(!g[t.protocol]){for(var u=Object.keys(t),c=0;c<u.length;c++){var d=u[c];n[d]=t[d]}return n.href=n.format(),n}if(n.protocol=t.protocol,t.host||m[t.protocol])n.pathname=t.pathname;else{for(var f=(t.pathname||"").split("/");f.length&&!(t.host=f.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==f[0]&&f.unshift(""),f.length<2&&f.unshift(""),n.pathname=f.join("/")}if(n.search=t.search,n.query=t.query,n.host=t.host||"",n.auth=t.auth,n.hostname=t.hostname||t.host,n.port=t.port,n.pathname||n.search){var p=n.pathname||"",_=n.search||"";n.path=p+_}return n.slashes=n.slashes||t.slashes,n.href=n.format(),n}var y=n.pathname&&"/"===n.pathname.charAt(0),v=t.host||t.pathname&&"/"===t.pathname.charAt(0),b=v||y||n.host&&t.pathname,x=b,E=n.pathname&&n.pathname.split("/")||[],w=(f=t.pathname&&t.pathname.split("/")||[],n.protocol&&!g[n.protocol]);if(w&&(n.hostname="",n.port=null,n.host&&(""===E[0]?E[0]=n.host:E.unshift(n.host)),n.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===f[0]?f[0]=t.host:f.unshift(t.host)),t.host=null),b=b&&(""===f[0]||""===E[0])),v)n.host=t.host||""===t.host?t.host:n.host,n.hostname=t.hostname||""===t.hostname?t.hostname:n.hostname,n.search=t.search,n.query=t.query,E=f;else if(f.length)E||(E=[]),E.pop(),E=E.concat(f),n.search=t.search,n.query=t.query;else if(null!=t.search){if(w)n.host=E.shift(),n.hostname=n.host,(I=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=I.shift(),n.hostname=I.shift(),n.host=n.hostname);return n.search=t.search,n.query=t.query,null===n.pathname&&null===n.search||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n}if(!E.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var T=E.slice(-1)[0],S=(n.host||t.host||E.length>1)&&("."===T||".."===T)||""===T,A=0,C=E.length;C>=0;C--)"."===(T=E[C])?E.splice(C,1):".."===T?(E.splice(C,1),A++):A&&(E.splice(C,1),A--);if(!b&&!x)for(;A--;A)E.unshift("..");!b||""===E[0]||E[0]&&"/"===E[0].charAt(0)||E.unshift(""),S&&"/"!==E.join("/").substr(-1)&&E.push("");var I,R=""===E[0]||E[0]&&"/"===E[0].charAt(0);w&&(n.hostname=R?"":E.length?E.shift():"",n.host=n.hostname,(I=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=I.shift(),n.hostname=I.shift(),n.host=n.hostname));return(b=b||n.host&&E.length)&&!R&&E.unshift(""),E.length>0?n.pathname=E.join("/"):(n.pathname=null,n.path=null),null===n.pathname&&null===n.search||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=t.auth||n.auth,n.slashes=n.slashes||t.slashes,n.href=n.format(),n},i.prototype.parseHost=function(){var t=this.host,e=o.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)},e.Qc=y,e.DB=function(t,e){return y(t,!1,!0).resolve(e)},e.WU=function(t){return"string"==typeof t&&(t=y(t)),t instanceof i?t.format():i.prototype.format.call(t)}},654:()=>{}},e={};function n(r){var i=e[r];if(i!==undefined)return i.exports;var s=e[r]={id:r,loaded:!1,exports:{}};return t[r].call(s.exports,s,s.exports,n),s.loaded=!0,s.exports}n.n=t=>{var e=t&&t.__esModule?()=>t["default"]:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.nmd=t=>(t.paths=[],t.children||(t.children=[]),t);var r={};(()=>{"use strict";n.d(r,{dK:()=>d_});var t={};n.r(t),n.d(t,{BUILD_DATE:()=>Wl,CSV_FROM_GOOGLE:()=>Ql,DEBUG:()=>Vl,LANG:()=>Zl,PIXI_VERSION:()=>ti,PROJECT_NAME:()=>Kl,SAVEDATA_VERSION:()=>ql,SHOW_COLLIDERS:()=>Xl,STATS:()=>$l,VERSION:()=>Yl});var e=(t=>(t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2",t))(e||{}),i=(t=>(t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS",t))(i||{}),s=(t=>(t[t.COLOR=16384]="COLOR",t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL",t))(s||{}),o=(t=>(t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR",t))(o||{}),a=(t=>(t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t))(a||{}),h=(t=>(t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.RG=33319]="RG",t[t.RED=6403]="RED",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t))(h||{}),l=(t=>(t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t))(l||{}),u=(t=>(t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.BYTE=5120]="BYTE",t[t.SHORT=5122]="SHORT",t[t.INT=5124]="INT",t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.HALF_FLOAT=36193]="HALF_FLOAT",t))(u||{}),c=(t=>(t[t.FLOAT=0]="FLOAT",t[t.INT=1]="INT",t[t.UINT=2]="UINT",t))(c||{}),d=(t=>(t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR",t))(d||{}),f=(t=>(t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t))(f||{}),p=(t=>(t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON",t[t.ON_MANUAL=3]="ON_MANUAL",t))(p||{}),m=(t=>(t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",t))(m||{}),g=(t=>(t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.AUTO=2]="AUTO",t[t.BLEND=0]="BLEND",t[t.CLEAR=1]="CLEAR",t[t.BLIT=2]="BLIT",t))(g||{}),_=(t=>(t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL",t))(_||{}),y=(t=>(t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp",t))(y||{}),v=(t=>(t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE",t[t.COLOR=4]="COLOR",t))(v||{}),b=(t=>(t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH",t))(b||{}),x=(t=>(t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t))(x||{});const E={createCanvas:(t,e)=>{const n=document.createElement("canvas");return n.width=t,n.height=e,n},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(t,e)=>fetch(t,e),parseXML:t=>(new DOMParser).parseFromString(t,"text/xml")},w={ADAPTER:E,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var T=/iPhone/i,S=/iPod/i,A=/iPad/i,C=/\biOS-universal(?:.+)Mac\b/i,I=/\bAndroid(?:.+)Mobile\b/i,R=/Android/i,P=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,M=/Silk/i,O=/Windows Phone/i,D=/\bWindows(?:.+)ARM\b/i,N=/BlackBerry/i,k=/BB10/i,L=/Opera Mini/i,F=/\b(CriOS|Chrome)(?:.+)Mobile/i,B=/Mobile(?:.+)Firefox\b/i,U=function(t){return void 0!==t&&"MacIntel"===t.platform&&"number"==typeof t.maxTouchPoints&&t.maxTouchPoints>1&&"undefined"==typeof MSStream};function j(t){var e={userAgent:"",platform:"",maxTouchPoints:0};t||"undefined"==typeof navigator?"string"==typeof t?e.userAgent=t:t&&t.userAgent&&(e={userAgent:t.userAgent,platform:t.platform,maxTouchPoints:t.maxTouchPoints||0}):e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0};var n=e.userAgent,r=n.split("[FBAN");"undefined"!=typeof r[1]&&(n=r[0]),"undefined"!=typeof(r=n.split("Twitter"))[1]&&(n=r[0]);var i=function(t){return function(e){return e.test(t)}}(n),s={apple:{phone:i(T)&&!i(O),ipod:i(S),tablet:!i(T)&&(i(A)||U(e))&&!i(O),universal:i(C),device:(i(T)||i(S)||i(A)||i(C)||U(e))&&!i(O)},amazon:{phone:i(P),tablet:!i(P)&&i(M),device:i(P)||i(M)},android:{phone:!i(O)&&i(P)||!i(O)&&i(I),tablet:!i(O)&&!i(P)&&!i(I)&&(i(M)||i(R)),device:!i(O)&&(i(P)||i(M)||i(I)||i(R))||i(/\bokhttp\b/i)},windows:{phone:i(O),tablet:i(D),device:i(O)||i(D)},other:{blackberry:i(N),blackberry10:i(k),opera:i(L),firefox:i(B),chrome:i(F),device:i(N)||i(k)||i(L)||i(B)||i(F)},any:!1,phone:!1,tablet:!1};return s.any=s.apple.device||s.android.device||s.windows.device||s.other.device,s.phone=s.apple.phone||s.android.phone||s.windows.phone,s.tablet=s.apple.tablet||s.android.tablet||s.windows.tablet,s}const G=(j["default"]??j)(globalThis.navigator);w.RETINA_PREFIX=/@([0-9\.]+)x/,w.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var H=n(729),z=n(187),W=n(575);const V={parse:W.Qc,format:W.WU,resolve:W.DB};function X(t){if("string"!=typeof t)throw new TypeError(`Path must be a string. Received ${JSON.stringify(t)}`)}function $(t){return t.split("?")[0].split("#")[0]}const Y={toPosix(t){return e="\\",n="/",t.replace(new RegExp(e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),n);var e,n},isUrl(t){return/^https?:/.test(this.toPosix(t))},isDataUrl(t){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(t)},hasProtocol(t){return/^[^/:]+:\//.test(this.toPosix(t))},getProtocol(t){X(t),t=this.toPosix(t);let e="";const n=/^file:\/\/\//.exec(t),r=/^[^/:]+:\/\//.exec(t),i=/^[^/:]+:\//.exec(t);if(n||r||i){const s=n?.[0]||r?.[0]||i?.[0];e=s,t=t.slice(s.length)}return e},toAbsolute(t,e,n){if(this.isDataUrl(t))return t;const r=$(this.toPosix(e??w.ADAPTER.getBaseUrl())),i=$(this.toPosix(n??this.rootname(r)));if(X(t),(t=this.toPosix(t)).startsWith("/"))return Y.join(i,t.slice(1));return this.isAbsolute(t)?t:this.join(r,t)},normalize(t){if(X(t=this.toPosix(t)),0===t.length)return".";let e="";const n=t.startsWith("/");this.hasProtocol(t)&&(e=this.rootname(t),t=t.slice(e.length));const r=t.endsWith("/");return t=function(t,e){let n="",r=0,i=-1,s=0,o=-1;for(let a=0;a<=t.length;++a){if(a<t.length)o=t.charCodeAt(a);else{if(47===o)break;o=47}if(47===o){if(i===a-1||1===s);else if(i!==a-1&&2===s){if(n.length<2||2!==r||46!==n.charCodeAt(n.length-1)||46!==n.charCodeAt(n.length-2))if(n.length>2){const t=n.lastIndexOf("/");if(t!==n.length-1){-1===t?(n="",r=0):(n=n.slice(0,t),r=n.length-1-n.lastIndexOf("/")),i=a,s=0;continue}}else if(2===n.length||1===n.length){n="",r=0,i=a,s=0;continue}e&&(n.length>0?n+="/..":n="..",r=2)}else n.length>0?n+=`/${t.slice(i+1,a)}`:n=t.slice(i+1,a),r=a-i-1;i=a,s=0}else 46===o&&-1!==s?++s:s=-1}return n}(t,!1),t.length>0&&r&&(t+="/"),n?`/${t}`:e+t},isAbsolute(t){return X(t),t=this.toPosix(t),!!this.hasProtocol(t)||t.startsWith("/")},join(...t){if(0===t.length)return".";let e;for(let n=0;n<t.length;++n){const r=t[n];if(X(r),r.length>0)if(void 0===e)e=r;else{const i=t[n-1]??"";this.extname(i)?e+=`/../${r}`:e+=`/${r}`}}return void 0===e?".":this.normalize(e)},dirname(t){if(X(t),0===t.length)return".";let e=(t=this.toPosix(t)).charCodeAt(0);const n=47===e;let r=-1,i=!0;const s=this.getProtocol(t),o=t;for(let a=(t=t.slice(s.length)).length-1;a>=1;--a)if(e=t.charCodeAt(a),47===e){if(!i){r=a;break}}else i=!1;return-1===r?n?"/":this.isUrl(o)?s+t:s:n&&1===r?"//":s+t.slice(0,r)},rootname(t){X(t);let e="";if(e=(t=this.toPosix(t)).startsWith("/")?"/":this.getProtocol(t),this.isUrl(t)){const n=t.indexOf("/",e.length);e=-1!==n?t.slice(0,n):t,e.endsWith("/")||(e+="/")}return e},basename(t,e){X(t),e&&X(e),t=$(this.toPosix(t));let n,r=0,i=-1,s=!0;if(void 0!==e&&e.length>0&&e.length<=t.length){if(e.length===t.length&&e===t)return"";let o=e.length-1,a=-1;for(n=t.length-1;n>=0;--n){const h=t.charCodeAt(n);if(47===h){if(!s){r=n+1;break}}else-1===a&&(s=!1,a=n+1),o>=0&&(h===e.charCodeAt(o)?-1==--o&&(i=n):(o=-1,i=a))}return r===i?i=a:-1===i&&(i=t.length),t.slice(r,i)}for(n=t.length-1;n>=0;--n)if(47===t.charCodeAt(n)){if(!s){r=n+1;break}}else-1===i&&(s=!1,i=n+1);return-1===i?"":t.slice(r,i)},extname(t){X(t);let e=-1,n=0,r=-1,i=!0,s=0;for(let o=(t=$(this.toPosix(t))).length-1;o>=0;--o){const a=t.charCodeAt(o);if(47!==a)-1===r&&(i=!1,r=o+1),46===a?-1===e?e=o:1!==s&&(s=1):-1!==e&&(s=-1);else if(!i){n=o+1;break}}return-1===e||-1===r||0===s||1===s&&e===r-1&&e===n+1?"":t.slice(e,r)},parse(t){X(t);const e={root:"",dir:"",base:"",ext:"",name:""};if(0===t.length)return e;let n=(t=$(this.toPosix(t))).charCodeAt(0);const r=this.isAbsolute(t);let i;e.root=this.rootname(t),i=r||this.hasProtocol(t)?1:0;let s=-1,o=0,a=-1,h=!0,l=t.length-1,u=0;for(;l>=i;--l)if(n=t.charCodeAt(l),47!==n)-1===a&&(h=!1,a=l+1),46===n?-1===s?s=l:1!==u&&(u=1):-1!==s&&(u=-1);else if(!h){o=l+1;break}return-1===s||-1===a||0===u||1===u&&s===a-1&&s===o+1?-1!==a&&(e.base=e.name=0===o&&r?t.slice(1,a):t.slice(o,a)):(0===o&&r?(e.name=t.slice(1,s),e.base=t.slice(1,a)):(e.name=t.slice(o,s),e.base=t.slice(o,a)),e.ext=t.slice(s,a)),e.dir=this.dirname(t),e},sep:"/",delimiter:":"},q={};function K(t,e,n=3){if(q[e])return;let r=(new Error).stack;void 0===r||(r=r.split("\n").splice(n).join("\n"),console.groupCollapsed),q[e]=!0}let Q;var Z={grad:.9,turn:360,rad:360/(2*Math.PI)},J=function(t){return"string"==typeof t?t.length>0:"number"==typeof t},tt=function(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=Math.pow(10,e)),Math.round(n*t)/n+0},et=function(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=1),t>n?n:t>e?t:e},nt=function(t){return(t=isFinite(t)?t%360:0)>0?t:t+360},rt=function(t){return{r:et(t.r,0,255),g:et(t.g,0,255),b:et(t.b,0,255),a:et(t.a)}},it=function(t){return{r:tt(t.r),g:tt(t.g),b:tt(t.b),a:tt(t.a,3)}},st=/^#([0-9a-f]{3,8})$/i,ot=function(t){var e=t.toString(16);return e.length<2?"0"+e:e},at=function(t){var e=t.r,n=t.g,r=t.b,i=t.a,s=Math.max(e,n,r),o=s-Math.min(e,n,r),a=o?s===e?(n-r)/o:s===n?2+(r-e)/o:4+(e-n)/o:0;return{h:60*(a<0?a+6:a),s:s?o/s*100:0,v:s/255*100,a:i}},ht=function(t){var e=t.h,n=t.s,r=t.v,i=t.a;e=e/360*6,n/=100,r/=100;var s=Math.floor(e),o=r*(1-n),a=r*(1-(e-s)*n),h=r*(1-(1-e+s)*n),l=s%6;return{r:255*[r,a,o,o,h,r][l],g:255*[h,r,r,a,o,o][l],b:255*[o,o,h,r,r,a][l],a:i}},lt=function(t){return{h:nt(t.h),s:et(t.s,0,100),l:et(t.l,0,100),a:et(t.a)}},ut=function(t){return{h:tt(t.h),s:tt(t.s),l:tt(t.l),a:tt(t.a,3)}},ct=function(t){return ht((n=(e=t).s,{h:e.h,s:(n*=((r=e.l)<50?r:100-r)/100)>0?2*n/(r+n)*100:0,v:r+n,a:e.a}));var e,n,r},dt=function(t){return{h:(e=at(t)).h,s:(i=(200-(n=e.s))*(r=e.v)/100)>0&&i<200?n*r/100/(i<=100?i:200-i)*100:0,l:i/2,a:e.a};var e,n,r,i},ft=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,pt=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,mt=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,gt=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,_t={string:[[function(t){var e=st.exec(t);return e?(t=e[1]).length<=4?{r:parseInt(t[0]+t[0],16),g:parseInt(t[1]+t[1],16),b:parseInt(t[2]+t[2],16),a:4===t.length?tt(parseInt(t[3]+t[3],16)/255,2):1}:6===t.length||8===t.length?{r:parseInt(t.substr(0,2),16),g:parseInt(t.substr(2,2),16),b:parseInt(t.substr(4,2),16),a:8===t.length?tt(parseInt(t.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(t){var e=mt.exec(t)||gt.exec(t);return e?e[2]!==e[4]||e[4]!==e[6]?null:rt({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:void 0===e[7]?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(t){var e=ft.exec(t)||pt.exec(t);if(!e)return null;var n,r,i=lt({h:(n=e[1],r=e[2],void 0===r&&(r="deg"),Number(n)*(Z[r]||1)),s:Number(e[3]),l:Number(e[4]),a:void 0===e[5]?1:Number(e[5])/(e[6]?100:1)});return ct(i)},"hsl"]],object:[[function(t){var e=t.r,n=t.g,r=t.b,i=t.a,s=void 0===i?1:i;return J(e)&&J(n)&&J(r)?rt({r:Number(e),g:Number(n),b:Number(r),a:Number(s)}):null},"rgb"],[function(t){var e=t.h,n=t.s,r=t.l,i=t.a,s=void 0===i?1:i;if(!J(e)||!J(n)||!J(r))return null;var o=lt({h:Number(e),s:Number(n),l:Number(r),a:Number(s)});return ct(o)},"hsl"],[function(t){var e=t.h,n=t.s,r=t.v,i=t.a,s=void 0===i?1:i;if(!J(e)||!J(n)||!J(r))return null;var o=function(t){return{h:nt(t.h),s:et(t.s,0,100),v:et(t.v,0,100),a:et(t.a)}}({h:Number(e),s:Number(n),v:Number(r),a:Number(s)});return ht(o)},"hsv"]]},yt=function(t,e){for(var n=0;n<e.length;n++){var r=e[n][0](t);if(r)return[r,e[n][1]]}return[null,void 0]},vt=function(t){return"string"==typeof t?yt(t.trim(),_t.string):"object"==typeof t&&null!==t?yt(t,_t.object):[null,void 0]},bt=function(t,e){var n=dt(t);return{h:n.h,s:et(n.s+100*e,0,100),l:n.l,a:n.a}},xt=function(t){return(299*t.r+587*t.g+114*t.b)/1e3/255},Et=function(t,e){var n=dt(t);return{h:n.h,s:n.s,l:et(n.l+100*e,0,100),a:n.a}},wt=function(){function t(t){this.parsed=vt(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return t.prototype.isValid=function(){return null!==this.parsed},t.prototype.brightness=function(){return tt(xt(this.rgba),2)},t.prototype.isDark=function(){return xt(this.rgba)<.5},t.prototype.isLight=function(){return xt(this.rgba)>=.5},t.prototype.toHex=function(){return e=(t=it(this.rgba)).r,n=t.g,r=t.b,s=(i=t.a)<1?ot(tt(255*i)):"","#"+ot(e)+ot(n)+ot(r)+s;var t,e,n,r,i,s},t.prototype.toRgb=function(){return it(this.rgba)},t.prototype.toRgbString=function(){return e=(t=it(this.rgba)).r,n=t.g,r=t.b,(i=t.a)<1?"rgba("+e+", "+n+", "+r+", "+i+")":"rgb("+e+", "+n+", "+r+")";var t,e,n,r,i},t.prototype.toHsl=function(){return ut(dt(this.rgba))},t.prototype.toHslString=function(){return e=(t=ut(dt(this.rgba))).h,n=t.s,r=t.l,(i=t.a)<1?"hsla("+e+", "+n+"%, "+r+"%, "+i+")":"hsl("+e+", "+n+"%, "+r+"%)";var t,e,n,r,i},t.prototype.toHsv=function(){return t=at(this.rgba),{h:tt(t.h),s:tt(t.s),v:tt(t.v),a:tt(t.a,3)};var t},t.prototype.invert=function(){return Tt({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},t.prototype.saturate=function(t){return void 0===t&&(t=.1),Tt(bt(this.rgba,t))},t.prototype.desaturate=function(t){return void 0===t&&(t=.1),Tt(bt(this.rgba,-t))},t.prototype.grayscale=function(){return Tt(bt(this.rgba,-1))},t.prototype.lighten=function(t){return void 0===t&&(t=.1),Tt(Et(this.rgba,t))},t.prototype.darken=function(t){return void 0===t&&(t=.1),Tt(Et(this.rgba,-t))},t.prototype.rotate=function(t){return void 0===t&&(t=15),this.hue(this.hue()+t)},t.prototype.alpha=function(t){return"number"==typeof t?Tt({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):tt(this.rgba.a,3);var e},t.prototype.hue=function(t){var e=dt(this.rgba);return"number"==typeof t?Tt({h:t,s:e.s,l:e.l,a:e.a}):tt(e.h)},t.prototype.isEqual=function(t){return this.toHex()===Tt(t).toHex()},t}(),Tt=function(t){return t instanceof wt?t:new wt(t)},St=[];!function(t){t.forEach((function(t){St.indexOf(t)<0&&(t(wt,_t),St.push(t))}))}([function(t,e){var n={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},r={};for(var i in n)r[n[i]]=i;var s={};t.prototype.toName=function(e){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var i,o,a=r[this.toHex()];if(a)return a;if(null==e?void 0:e.closest){var h=this.toRgb(),l=1/0,u="black";if(!s.length)for(var c in n)s[c]=new t(n[c]).toRgb();for(var d in n){var f=(i=h,o=s[d],Math.pow(i.r-o.r,2)+Math.pow(i.g-o.g,2)+Math.pow(i.b-o.b,2));f<l&&(l=f,u=d)}return u}},e.string.push([function(e){var r=e.toLowerCase(),i="transparent"===r?"#0000":n[r];return i?new t(i).toRgb():null},"name"])}]);const At=class{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){if(t instanceof At)this._value=this.cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(null===t)throw new Error("Cannot set PIXI.Color#value to null");null!==this._value&&this.isSourceEqual(this._value,t)||(this.normalize(t),this._value=this.cloneSource(t))}}get value(){return this._value}cloneSource(t){return"string"==typeof t||"number"==typeof t||t instanceof Number||null===t?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):"object"==typeof t&&null!==t?{...t}:t}isSourceEqual(t,e){const n=typeof t;if(n!==typeof e)return!1;if("number"===n||"string"===n||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length===e.length&&t.every(((t,n)=>t===e[n]));if(null!==t&&null!==e){const n=Object.keys(t),r=Object.keys(e);return n.length===r.length&&n.every((n=>t[n]===e[n]))}return t===e}toRgba(){const[t,e,n,r]=this._components;return{r:t,g:e,b:n,a:r}}toRgb(){const[t,e,n]=this._components;return{r:t,g:e,b:n}}toRgbaString(){const[t,e,n]=this.toUint8RgbArray();return`rgba(${t},${e},${n},${this.alpha})`}toUint8RgbArray(t){const[e,n,r]=this._components;return(t=t??[])[0]=Math.round(255*e),t[1]=Math.round(255*n),t[2]=Math.round(255*r),t}toRgbArray(t){t=t??[];const[e,n,r]=this._components;return t[0]=e,t[1]=n,t[2]=r,t}toNumber(){return this._int}toLittleEndianNumber(){const t=this._int;return(t>>16)+(65280&t)+((255&t)<<16)}multiply(t){const[e,n,r,i]=At.temp.setValue(t)._components;return this._components[0]*=e,this._components[1]*=n,this._components[2]*=r,this._components[3]*=i,this.refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this.refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(1===t)return(255<<24)+this._int;if(0===t)return e?0:this._int;let n=this._int>>16&255,r=this._int>>8&255,i=255&this._int;return e&&(n=n*t+.5|0,r=r*t+.5|0,i=i*t+.5|0),(255*t<<24)+(n<<16)+(r<<8)+i}toHex(){const t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){const t=Math.round(255*this._components[3]).toString(16);return this.toHex()+"00".substring(0,2-t.length)+t}setAlpha(t){return this._components[3]=this._clamp(t),this}round(t){const[e,n,r]=this._components;return this._components[0]=Math.round(e*t)/t,this._components[1]=Math.round(n*t)/t,this._components[2]=Math.round(r*t)/t,this.refreshInt(),this._value=null,this}toArray(t){t=t??[];const[e,n,r,i]=this._components;return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t}normalize(t){let e,n,r,i;if(("number"==typeof t||t instanceof Number)&&t>=0&&t<=16777215){e=(t>>16&255)/255,n=(t>>8&255)/255,r=(255&t)/255,i=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[e,n,r,i=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[e,n,r,i=255]=t,e/=255,n/=255,r/=255,i/=255;else if("string"==typeof t||"object"==typeof t){if("string"==typeof t){const e=At.HEX_PATTERN.exec(t);e&&(t=`#${e[2]}`)}const s=Tt(t);s.isValid()&&(({r:e,g:n,b:r,a:i}=s.rgba),e/=255,n/=255,r/=255)}if(void 0===e)throw new Error(`Unable to convert color ${t}`);this._components[0]=e,this._components[1]=n,this._components[2]=r,this._components[3]=i,this.refreshInt()}refreshInt(){this._clamp(this._components);const[t,e,n]=this._components;this._int=(255*t<<16)+(255*e<<8)+(255*n|0)}_clamp(t,e=0,n=1){return"number"==typeof t?Math.min(Math.max(t,e),n):(t.forEach(((r,i)=>{t[i]=Math.min(Math.max(r,e),n)})),t)}};let Ct=At;Ct.shared=new At,Ct.temp=new At,Ct.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;const It=function(){const t=[],e=[];for(let r=0;r<32;r++)t[r]=r,e[r]=r;t[o.NORMAL_NPM]=o.NORMAL,t[o.ADD_NPM]=o.ADD,t[o.SCREEN_NPM]=o.SCREEN,e[o.NORMAL]=o.NORMAL_NPM,e[o.ADD]=o.ADD_NPM,e[o.SCREEN]=o.SCREEN_NPM;const n=[];return n.push(e),n.push(t),n}();function Rt(t,e){return It[e?1:0][t]}function Pt(t){if(4===t.BYTES_PER_ELEMENT)return t instanceof Float32Array?"Float32Array":t instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===t.BYTES_PER_ELEMENT){if(t instanceof Uint16Array)return"Uint16Array"}else if(1===t.BYTES_PER_ELEMENT&&t instanceof Uint8Array)return"Uint8Array";return null}Float32Array,Uint32Array,Int32Array,Uint8Array;function Mt(t){return t+=0===t?1:0,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)+1}function Ot(t){return!(t&t-1||!t)}function Dt(t){let e=(t>65535?1:0)<<4,n=((t>>>=e)>255?1:0)<<3;return e|=n,n=((t>>>=n)>15?1:0)<<2,e|=n,n=((t>>>=n)>3?1:0)<<1,e|=n,e|(t>>>=n)>>1}function Nt(t,e,n){const r=t.length;let i;if(e>=r||0===n)return;const s=r-(n=e+n>r?r-e:n);for(i=e;i<s;++i)t[i]=t[i+n];t.length=s}function kt(t){return 0===t?0:t<0?-1:1}let Lt=0;function Ft(){return++Lt}const Bt=class{constructor(t,e,n,r){this.left=t,this.top=e,this.right=n,this.bottom=r}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};let Ut=Bt;Ut.EMPTY=new Bt(0,0,0,0);const jt={},Gt=Object.create(null),Ht=Object.create(null);class zt{constructor(t,e,n){this._canvas=w.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=n||w.RESOLUTION,this.resize(t,e)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(t,e){this._checkDestroyed(),this._canvas.width=Math.round(t*this.resolution),this._canvas.height=Math.round(e*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(t){this._checkDestroyed(),this._canvas.width=Math.round(t)}get height(){return this._checkDestroyed(),this._canvas.height}set height(t){this._checkDestroyed(),this._canvas.height=Math.round(t)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(null===this._canvas)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function Wt(t,e,n){for(let r=0,i=4*n*e;r<e;++r,i+=4)if(0!==t[i+3])return!1;return!0}function Vt(t,e,n,r,i){const s=4*e;for(let o=r,a=r*s+4*n;o<=i;++o,a+=s)if(0!==t[a+3])return!1;return!0}function Xt(t){const e=function(t){const{width:e,height:n}=t,r=t.getContext("2d",{willReadFrequently:!0});if(null===r)throw new TypeError("Failed to get canvas 2D context");const i=r.getImageData(0,0,e,n).data;let s=0,o=0,a=e-1,h=n-1;for(;o<n&&Wt(i,e,o);)++o;if(o===n)return Ut.EMPTY;for(;Wt(i,e,h);)--h;for(;Vt(i,e,s,o,h);)++s;for(;Vt(i,e,a,o,h);)--a;return++a,++h,new Ut(s,o,a,h)}(t),{width:n,height:r}=e;let i=null;if(!e.isEmpty()){const s=t.getContext("2d");if(null===s)throw new TypeError("Failed to get canvas 2D context");i=s.getImageData(e.left,e.top,n,r)}return{width:n,height:r,data:i}}let $t;function Yt(t,e=1){const n=w.RETINA_PREFIX?.exec(t);return n?parseFloat(n[1]):e}var qt=(t=>(t.Renderer="renderer",t.Application="application",t.RendererSystem="renderer-webgl-system",t.RendererPlugin="renderer-webgl-plugin",t.CanvasRendererSystem="renderer-canvas-system",t.CanvasRendererPlugin="renderer-canvas-plugin",t.Asset="asset",t.LoadParser="load-parser",t.ResolveParser="resolve-parser",t.CacheParser="cache-parser",t.DetectionParser="detection-parser",t))(qt||{});const Kt=t=>{if("function"==typeof t||"object"==typeof t&&t.extension){if(!t.extension)throw new Error("Extension class must have an extension object");t={..."object"!=typeof t.extension?{type:t.extension}:t.extension,ref:t}}if("object"!=typeof t)throw new Error("Invalid extension type");return"string"==typeof(t={...t}).type&&(t.type=[t.type]),t},Qt=(t,e)=>Kt(t).priority??e,Zt={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...t){return t.map(Kt).forEach((t=>{t.type.forEach((e=>this._removeHandlers[e]?.(t)))})),this},add(...t){return t.map(Kt).forEach((t=>{t.type.forEach((e=>{const n=this._addHandlers,r=this._queue;n[e]?n[e](t):(r[e]=r[e]||[],r[e].push(t))}))})),this},handle(t,e,n){const r=this._addHandlers,i=this._removeHandlers;if(r[t]||i[t])throw new Error(`Extension type ${t} already has a handler`);r[t]=e,i[t]=n;const s=this._queue;return s[t]&&(s[t].forEach((t=>e(t))),delete s[t]),this},handleByMap(t,e){return this.handle(t,(t=>{e[t.name]=t.ref}),(t=>{delete e[t.name]}))},handleByList(t,e,n=-1){return this.handle(t,(t=>{e.includes(t.ref)||(e.push(t.ref),e.sort(((t,e)=>Qt(e,n)-Qt(t,n))))}),(t=>{const n=e.indexOf(t.ref);-1!==n&&e.splice(n,1)}))}};class Jt{constructor(t){"number"==typeof t?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}const te=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function ee(t){let e="";for(let n=0;n<t;++n)n>0&&(e+="\nelse "),n<t-1&&(e+=`if(test == ${n}.0){}`);return e}class ne{constructor(){this.data=0,this.blendMode=o.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(1&this.data)}set blend(t){!!(1&this.data)!==t&&(this.data^=1)}get offsets(){return!!(2&this.data)}set offsets(t){!!(2&this.data)!==t&&(this.data^=2)}get culling(){return!!(4&this.data)}set culling(t){!!(4&this.data)!==t&&(this.data^=4)}get depthTest(){return!!(8&this.data)}set depthTest(t){!!(8&this.data)!==t&&(this.data^=8)}get depthMask(){return!!(32&this.data)}set depthMask(t){!!(32&this.data)!==t&&(this.data^=32)}get clockwiseFrontFace(){return!!(16&this.data)}set clockwiseFrontFace(t){!!(16&this.data)!==t&&(this.data^=16)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==o.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}toString(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){const t=new ne;return t.depthTest=!1,t.blend=!0,t}}const re=[];function ie(t,e){if(!t)return null;let n="";if("string"==typeof t){const e=/\.(\w{3,4})(?:$|\?|#)/i.exec(t);e&&(n=e[1].toLowerCase())}for(let r=re.length-1;r>=0;--r){const i=re[r];if(i.test&&i.test(t,n))return new i(t,e)}throw new Error("Unrecognized source type to auto-detect Resource")}class se{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,e,n,r,i,s,o,a){if(arguments.length>8)throw new Error("max arguments reached");const{name:h,items:l}=this;this._aliasCount++;for(let u=0,c=l.length;u<c;u++)l[u][h](t,e,n,r,i,s,o,a);return l===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return-1!==e&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return 0===this.items.length}get name(){return this._name}}Object.defineProperties(se.prototype,{dispatch:{value:se.prototype.emit},run:{value:se.prototype.emit}});class oe{constructor(t=0,e=0){this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new se("setRealSize"),this.onUpdate=new se("update"),this.onError=new se("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,e){t===this._width&&e===this._height||(this._width=t,this._height=e,this.onResize.emit(t,e))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,e,n){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,e){return!1}}class ae extends oe{constructor(t,e){const{width:n,height:r}=e||{};if(!n||!r)throw new Error("BufferResource width or height invalid");super(n,r),this.data=t}upload(t,e,n){const r=t.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===m.UNPACK);const i=e.realWidth,s=e.realHeight;return n.width===i&&n.height===s?r.texSubImage2D(e.target,0,0,0,i,s,e.format,n.type,this.data):(n.width=i,n.height=s,r.texImage2D(e.target,0,n.internalFormat,i,s,0,e.format,n.type,this.data)),!0}dispose(){this.data=null}static test(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array}}const he={scaleMode:d.NEAREST,format:h.RGBA,alphaMode:m.NPM},le=class extends H{constructor(t=null,e=null){super(),e=Object.assign({},le.defaultOptions,e);const{alphaMode:n,mipmap:r,anisotropicLevel:i,scaleMode:s,width:o,height:a,wrapMode:h,format:l,type:u,target:c,resolution:d,resourceOptions:f}=e;!t||t instanceof oe||((t=ie(t,f)).internal=!0),this.resolution=d||w.RESOLUTION,this.width=Math.round((o||0)*this.resolution)/this.resolution,this.height=Math.round((a||0)*this.resolution)/this.resolution,this._mipmap=r,this.anisotropicLevel=i,this._wrapMode=h,this._scaleMode=s,this.format=l,this.type=u,this.target=c,this.alphaMode=n,this.uid=Ft(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=o>0&&a>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(t)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)}setStyle(t,e){let n;return void 0!==t&&t!==this.scaleMode&&(this.scaleMode=t,n=!0),void 0!==e&&e!==this.mipmap&&(this.mipmap=e,n=!0),n&&this.dirtyStyleId++,this}setSize(t,e,n){return n=n||this.resolution,this.setRealSize(t*n,e*n,n)}setRealSize(t,e,n){return this.resolution=n||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=Ot(this.realWidth)&&Ot(this.realHeight)}setResolution(t){const e=this.resolution;return e===t||(this.resolution=t,this.valid&&(this.width=Math.round(this.width*e)/t,this.height=Math.round(this.height*e)/t,this.emit("update",this)),this._refreshPOT()),this}setResource(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(t){this.emit("error",this,t)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Ht[this.cacheId],delete Gt[this.cacheId],this.cacheId=null),this.dispose(),le.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(t,e,n=w.STRICT_TEXTURE_CACHE){const r="string"==typeof t;let i=null;if(r)i=t;else{if(!t._pixiId){const n=e?.pixiIdPrefix||"pixiid";t._pixiId=`${n}_${Ft()}`}i=t._pixiId}let s=Ht[i];if(r&&n&&!s)throw new Error(`The cacheId "${i}" does not exist in BaseTextureCache.`);return s||(s=new le(t,e),s.cacheId=i,le.addToCache(s,i)),s}static fromBuffer(t,e,n,r){t=t||new Float32Array(e*n*4);const i=new ae(t,{width:e,height:n}),s=t instanceof Float32Array?u.FLOAT:u.UNSIGNED_BYTE;return new le(i,Object.assign({},he,{type:s},r))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),Ht[e]&&Ht[e],Ht[e]=t)}static removeFromCache(t){if("string"==typeof t){const e=Ht[t];if(e){const n=e.textureCacheIds.indexOf(t);return n>-1&&e.textureCacheIds.splice(n,1),delete Ht[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)delete Ht[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}};let ue=le;ue.defaultOptions={mipmap:p.POW2,anisotropicLevel:0,scaleMode:d.LINEAR,wrapMode:f.CLAMP,alphaMode:m.UNPACK,target:l.TEXTURE_2D,format:h.RGBA,type:u.UNSIGNED_BYTE},ue._globalBatch=0;class ce{constructor(){this.texArray=null,this.blend=0,this.type=a.TRIANGLES,this.start=0,this.size=0,this.data=null}}let de=0;class fe{constructor(t,e=!0,n=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=n,this["static"]=e,this.id=de++,this.disposeRunner=new se("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?x.ELEMENT_ARRAY_BUFFER:x.ARRAY_BUFFER}get index(){return this.type===x.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new fe(t)}}class pe{constructor(t,e=0,n=!1,r=u.FLOAT,i,s,o,a=1){this.buffer=t,this.size=e,this.normalized=n,this.type=r,this.stride=i,this.start=s,this.instance=o,this.divisor=a}destroy(){this.buffer=null}static from(t,e,n,r,i){return new pe(t,e,n,r,i)}}const me={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array};const ge={5126:4,5123:2,5121:1};let _e=0;const ye={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array};class ve{constructor(t=[],e={}){this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=_e++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new se("disposeGeometry"),this.refCount=0}addAttribute(t,e,n=0,r=!1,i,s,o,a=!1){if(!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof fe||(e instanceof Array&&(e=new Float32Array(e)),e=new fe(e));const h=t.split("|");if(h.length>1){for(let t=0;t<h.length;t++)this.addAttribute(h[t],e,n,r,i);return this}let l=this.buffers.indexOf(e);return-1===l&&(this.buffers.push(e),l=this.buffers.length-1),this.attributes[t]=new pe(l,n,r,i,s,o,a),this.instanced=this.instanced||a,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof fe||(t instanceof Array&&(t=new Uint16Array(t)),t=new fe(t)),t.type=x.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(1===this.buffers.length||2===this.buffers.length&&this.indexBuffer)return this;const t=[],e=[],n=new fe;let r;for(r in this.attributes){const n=this.attributes[r],i=this.buffers[n.buffer];t.push(i.data),e.push(n.size*ge[n.type]/4),n.buffer=0}for(n.data=function(t,e){let n=0,r=0;const i={};for(let h=0;h<t.length;h++)r+=e[h],n+=t[h].length;const s=new ArrayBuffer(4*n);let o=null,a=0;for(let h=0;h<t.length;h++){const n=e[h],l=t[h],u=Pt(l);i[u]||(i[u]=new me[u](s)),o=i[u];for(let t=0;t<l.length;t++)o[(t/n|0)*r+a+t%n]=l[t];a+=n}return new Float32Array(s)}(t,e),r=0;r<this.buffers.length;r++)this.buffers[r]!==this.indexBuffer&&this.buffers[r].destroy();return this.buffers=[n],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new ve;for(let e=0;e<this.buffers.length;e++)t.buffers[e]=new fe(this.buffers[e].data.slice(0));for(const e in this.attributes){const n=this.attributes[e];t.attributes[e]=new pe(n.buffer,n.size,n.normalized,n.type,n.stride,n.start,n.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=x.ELEMENT_ARRAY_BUFFER),t}static merge(t){const e=new ve,n=[],r=[],i=[];let s;for(let o=0;o<t.length;o++){s=t[o];for(let t=0;t<s.buffers.length;t++)r[t]=r[t]||0,r[t]+=s.buffers[t].data.length,i[t]=0}for(let o=0;o<s.buffers.length;o++)n[o]=new(ye[Pt(s.buffers[o].data)])(r[o]),e.buffers[o]=new fe(n[o]);for(let o=0;o<t.length;o++){s=t[o];for(let t=0;t<s.buffers.length;t++)n[t].set(s.buffers[t].data,i[t]),i[t]+=s.buffers[t].data.length}if(e.attributes=s.attributes,s.indexBuffer){e.indexBuffer=e.buffers[s.buffers.indexOf(s.indexBuffer)],e.indexBuffer.type=x.ELEMENT_ARRAY_BUFFER;let n=0,r=0,i=0,o=0;for(let t=0;t<s.buffers.length;t++)if(s.buffers[t]!==s.indexBuffer){o=t;break}for(const t in s.attributes){const e=s.attributes[t];(0|e.buffer)===o&&(r+=e.size*ge[e.type]/4)}for(let s=0;s<t.length;s++){const a=t[s].indexBuffer.data;for(let t=0;t<a.length;t++)e.indexBuffer.data[t+i]+=n;n+=t[s].buffers[o].data.length/r,i+=a.length}}return e}}class be extends ve{constructor(t=!1){super(),this._buffer=new fe(null,t,!1),this._indexBuffer=new fe(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,u.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,u.FLOAT).addAttribute("aColor",this._buffer,4,!0,u.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,u.FLOAT).addIndex(this._indexBuffer)}}const xe=2*Math.PI,Ee=180/Math.PI,we=Math.PI/180;var Te=(t=>(t[t.POLY=0]="POLY",t[t.RECT=1]="RECT",t[t.CIRC=2]="CIRC",t[t.ELIP=3]="ELIP",t[t.RREC=4]="RREC",t))(Te||{});class Se{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new Se(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}toString(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`}}const Ae=[new Se,new Se,new Se,new Se];class Ce{constructor(t=0,e=0,n=0,r=0){this.x=Number(t),this.y=Number(e),this.width=Number(n),this.height=Number(r),this.type=Te.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new Ce(0,0,0,0)}clone(){return new Ce(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return!(this.width<=0||this.height<=0)&&(t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height)}intersects(t,e){if(!e){const e=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=e)return!1;const n=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>n}const n=this.left,r=this.right,i=this.top,s=this.bottom;if(r<=n||s<=i)return!1;const o=Ae[0].set(t.left,t.top),a=Ae[1].set(t.left,t.bottom),h=Ae[2].set(t.right,t.top),l=Ae[3].set(t.right,t.bottom);if(h.x<=o.x||a.y<=o.y)return!1;const u=Math.sign(e.a*e.d-e.b*e.c);if(0===u)return!1;if(e.apply(o,o),e.apply(a,a),e.apply(h,h),e.apply(l,l),Math.max(o.x,a.x,h.x,l.x)<=n||Math.min(o.x,a.x,h.x,l.x)>=r||Math.max(o.y,a.y,h.y,l.y)<=i||Math.min(o.y,a.y,h.y,l.y)>=s)return!1;const c=u*(a.y-o.y),d=u*(o.x-a.x),f=c*n+d*i,p=c*r+d*i,m=c*n+d*s,g=c*r+d*s;if(Math.max(f,p,m,g)<=c*o.x+d*o.y||Math.min(f,p,m,g)>=c*l.x+d*l.y)return!1;const _=u*(o.y-h.y),y=u*(h.x-o.x),v=_*n+y*i,b=_*r+y*i,x=_*n+y*s,E=_*r+y*s;return!(Math.max(v,b,x,E)<=_*o.x+y*o.y||Math.min(v,b,x,E)>=_*l.x+y*l.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e,this}fit(t){const e=Math.max(this.x,t.x),n=Math.min(this.x+this.width,t.x+t.width),r=Math.max(this.y,t.y),i=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(n-e,0),this.y=r,this.height=Math.max(i-r,0),this}ceil(t=1,e=.001){const n=Math.ceil((this.x+this.width-e)*t)/t,r=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=n-this.x,this.height=r-this.y,this}enlarge(t){const e=Math.min(this.x,t.x),n=Math.max(this.x+this.width,t.x+t.width),r=Math.min(this.y,t.y),i=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=n-e,this.y=r,this.height=i-r,this}toString(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class Ie{constructor(t=0,e=0,n=0){this.x=t,this.y=e,this.radius=n,this.type=Te.CIRC}clone(){return new Ie(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const n=this.radius*this.radius;let r=this.x-t,i=this.y-e;return r*=r,i*=i,r+i<=n}getBounds(){return new Ce(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)}toString(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class Re{constructor(t=0,e=0,n=0,r=0){this.x=t,this.y=e,this.width=n,this.height=r,this.type=Te.ELIP}clone(){return new Re(this.x,this.y,this.width,this.height)}contains(t,e){if(this.width<=0||this.height<=0)return!1;let n=(t-this.x)/this.width,r=(e-this.y)/this.height;return n*=n,r*=r,n+r<=1}getBounds(){return new Ce(this.x-this.width,this.y-this.height,this.width,this.height)}toString(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class Pe{constructor(...t){let e=Array.isArray(t[0])?t[0]:t;if("number"!=typeof e[0]){const t=[];for(let n=0,r=e.length;n<r;n++)t.push(e[n].x,e[n].y);e=t}this.points=e,this.type=Te.POLY,this.closeStroke=!0}clone(){const t=this.points.slice(),e=new Pe(t);return e.closeStroke=this.closeStroke,e}contains(t,e){let n=!1;const r=this.points.length/2;for(let i=0,s=r-1;i<r;s=i++){const r=this.points[2*i],o=this.points[2*i+1],a=this.points[2*s],h=this.points[2*s+1];o>e!=h>e&&t<(e-o)/(h-o)*(a-r)+r&&(n=!n)}return n}toString(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce(((t,e)=>`${t}, ${e}`),"")}]`}}class Me{constructor(t=0,e=0,n=0,r=0,i=20){this.x=t,this.y=e,this.width=n,this.height=r,this.radius=i,this.type=Te.RREC}clone(){return new Me(this.x,this.y,this.width,this.height,this.radius)}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const n=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+n&&e<=this.y+this.height-n||t>=this.x+n&&t<=this.x+this.width-n)return!0;let r=t-(this.x+n),i=e-(this.y+n);const s=n*n;if(r*r+i*i<=s)return!0;if(r=t-(this.x+this.width-n),r*r+i*i<=s)return!0;if(i=e-(this.y+this.height-n),r*r+i*i<=s)return!0;if(r=t-(this.x+n),r*r+i*i<=s)return!0}return!1}toString(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}class Oe{constructor(t=1,e=0,n=0,r=1,i=0,s=0){this.array=null,this.a=t,this.b=e,this.c=n,this.d=r,this.tx=i,this.ty=s}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,n,r,i,s){return this.a=t,this.b=e,this.c=n,this.d=r,this.tx=i,this.ty=s,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const n=e||this.array;return t?(n[0]=this.a,n[1]=this.b,n[2]=0,n[3]=this.c,n[4]=this.d,n[5]=0,n[6]=this.tx,n[7]=this.ty,n[8]=1):(n[0]=this.a,n[1]=this.c,n[2]=this.tx,n[3]=this.b,n[4]=this.d,n[5]=this.ty,n[6]=0,n[7]=0,n[8]=1),n}apply(t,e){e=e||new Se;const n=t.x,r=t.y;return e.x=this.a*n+this.c*r+this.tx,e.y=this.b*n+this.d*r+this.ty,e}applyInverse(t,e){e=e||new Se;const n=1/(this.a*this.d+this.c*-this.b),r=t.x,i=t.y;return e.x=this.d*n*r+-this.c*n*i+(this.ty*this.c-this.tx*this.d)*n,e.y=this.a*n*i+-this.b*n*r+(-this.ty*this.a+this.tx*this.b)*n,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),n=Math.sin(t),r=this.a,i=this.c,s=this.tx;return this.a=r*e-this.b*n,this.b=r*n+this.b*e,this.c=i*e-this.d*n,this.d=i*n+this.d*e,this.tx=s*e-this.ty*n,this.ty=s*n+this.ty*e,this}append(t){const e=this.a,n=this.b,r=this.c,i=this.d;return this.a=t.a*e+t.b*r,this.b=t.a*n+t.b*i,this.c=t.c*e+t.d*r,this.d=t.c*n+t.d*i,this.tx=t.tx*e+t.ty*r+this.tx,this.ty=t.tx*n+t.ty*i+this.ty,this}setTransform(t,e,n,r,i,s,o,a,h){return this.a=Math.cos(o+h)*i,this.b=Math.sin(o+h)*i,this.c=-Math.sin(o-a)*s,this.d=Math.cos(o-a)*s,this.tx=t-(n*this.a+r*this.c),this.ty=e-(n*this.b+r*this.d),this}prepend(t){const e=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){const e=this.a,n=this.c;this.a=e*t.a+this.b*t.c,this.b=e*t.b+this.b*t.d,this.c=n*t.a+this.d*t.c,this.d=n*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,n=this.b,r=this.c,i=this.d,s=t.pivot,o=-Math.atan2(-r,i),a=Math.atan2(n,e),h=Math.abs(o+a);return h<1e-5||Math.abs(xe-h)<1e-5?(t.rotation=a,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=o,t.skew.y=a),t.scale.x=Math.sqrt(e*e+n*n),t.scale.y=Math.sqrt(r*r+i*i),t.position.x=this.tx+(s.x*e+s.y*r),t.position.y=this.ty+(s.x*n+s.y*i),t}invert(){const t=this.a,e=this.b,n=this.c,r=this.d,i=this.tx,s=t*r-e*n;return this.a=r/s,this.b=-e/s,this.c=-n/s,this.d=t/s,this.tx=(n*this.ty-r*i)/s,this.ty=-(t*this.ty-e*i)/s,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new Oe;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}toString(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return new Oe}static get TEMP_MATRIX(){return new Oe}}const De=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Ne=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],ke=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Le=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Fe=[],Be=[],Ue=Math.sign;!function(){for(let t=0;t<16;t++){const e=[];Fe.push(e);for(let n=0;n<16;n++){const r=Ue(De[t]*De[n]+ke[t]*Ne[n]),i=Ue(Ne[t]*De[n]+Le[t]*Ne[n]),s=Ue(De[t]*ke[n]+ke[t]*Le[n]),o=Ue(Ne[t]*ke[n]+Le[t]*Le[n]);for(let t=0;t<16;t++)if(De[t]===r&&Ne[t]===i&&ke[t]===s&&Le[t]===o){e.push(t);break}}}for(let t=0;t<16;t++){const e=new Oe;e.set(De[t],Ne[t],ke[t],Le[t],0,0),Be.push(e)}}();const je={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:t=>De[t],uY:t=>Ne[t],vX:t=>ke[t],vY:t=>Le[t],inv:t=>8&t?15&t:7&-t,add:(t,e)=>Fe[t][e],sub:(t,e)=>Fe[t][je.inv(e)],rotate180:t=>4^t,isVertical:t=>2==(3&t),byDirection:(t,e)=>2*Math.abs(t)<=Math.abs(e)?e>=0?je.S:je.N:2*Math.abs(e)<=Math.abs(t)?t>0?je.E:je.W:e>0?t>0?je.SE:je.SW:t>0?je.NE:je.NW,matrixAppendRotationInv:(t,e,n=0,r=0)=>{const i=Be[je.inv(e)];i.tx=n,i.ty=r,t.append(i)}};class Ge{constructor(t,e,n=0,r=0){this._x=n,this._y=r,this.cb=t,this.scope=e}clone(t=this.cb,e=this.scope){return new Ge(t,e,this._x,this._y)}set(t=0,e=t){return this._x===t&&this._y===e||(this._x=t,this._y=e,this.cb.call(this.scope)),this}copyFrom(t){return this._x===t.x&&this._y===t.y||(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}toString(){return`[@pixi/math:ObservablePoint x=0 y=0 scope=${this.scope}]`}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}const He=class{constructor(){this.worldTransform=new Oe,this.localTransform=new Oe,this.position=new Ge(this.onChange,this,0,0),this.scale=new Ge(this.onChange,this,1,1),this.pivot=new Ge(this.onChange,this,0,0),this.skew=new Ge(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}toString(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}updateLocalTransform(){const t=this.localTransform;this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(t){const e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==t._worldID){const n=t.worldTransform,r=this.worldTransform;r.a=e.a*n.a+e.b*n.c,r.b=e.a*n.b+e.b*n.d,r.c=e.c*n.a+e.d*n.c,r.d=e.c*n.b+e.d*n.d,r.tx=e.tx*n.a+e.ty*n.c+n.tx,r.ty=e.tx*n.b+e.ty*n.d+n.ty,this._parentID=t._worldID,this._worldID++}}setFromMatrix(t){t.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(t){this._rotation!==t&&(this._rotation=t,this.updateSkew())}};let ze=He;ze.IDENTITY=new He;const We=[{test:t=>"float"===t.type&&1===t.size&&!t.isArray,code:t=>`\n            if(uv["${t}"] !== ud["${t}"].value)\n            {\n                ud["${t}"].value = uv["${t}"]\n                gl.uniform1f(ud["${t}"].location, uv["${t}"])\n            }\n            `},{test:(t,e)=>!("sampler2D"!==t.type&&"samplerCube"!==t.type&&"sampler2DArray"!==t.type||1!==t.size||t.isArray||null!=e&&void 0===e.castToBaseTexture),code:t=>`t = syncData.textureCount++;\n\n            renderer.texture.bind(uv["${t}"], t);\n\n            if(ud["${t}"].value !== t)\n            {\n                ud["${t}"].value = t;\n                gl.uniform1i(ud["${t}"].location, t);\n; // eslint-disable-line max-len\n            }`},{test:(t,e)=>"mat3"===t.type&&1===t.size&&!t.isArray&&void 0!==e.a,code:t=>`\n            gl.uniformMatrix3fv(ud["${t}"].location, false, uv["${t}"].toArray(true));\n            `,codeUbo:t=>`\n                var ${t}_matrix = uv.${t}.toArray(true);\n\n                data[offset] = ${t}_matrix[0];\n                data[offset+1] = ${t}_matrix[1];\n                data[offset+2] = ${t}_matrix[2];\n        \n                data[offset + 4] = ${t}_matrix[3];\n                data[offset + 5] = ${t}_matrix[4];\n                data[offset + 6] = ${t}_matrix[5];\n        \n                data[offset + 8] = ${t}_matrix[6];\n                data[offset + 9] = ${t}_matrix[7];\n                data[offset + 10] = ${t}_matrix[8];\n            `},{test:(t,e)=>"vec2"===t.type&&1===t.size&&!t.isArray&&void 0!==e.x,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud["${t}"].location, v.x, v.y);\n                }`,codeUbo:t=>`\n                v = uv.${t};\n\n                data[offset] = v.x;\n                data[offset+1] = v.y;\n            `},{test:t=>"vec2"===t.type&&1===t.size&&!t.isArray,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud["${t}"].location, v[0], v[1]);\n                }\n            `},{test:(t,e)=>"vec4"===t.type&&1===t.size&&!t.isArray&&void 0!==e.width,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud["${t}"].location, v.x, v.y, v.width, v.height)\n                }`,codeUbo:t=>`\n                    v = uv.${t};\n\n                    data[offset] = v.x;\n                    data[offset+1] = v.y;\n                    data[offset+2] = v.width;\n                    data[offset+3] = v.height;\n                `},{test:(t,e)=>"vec4"===t.type&&1===t.size&&!t.isArray&&void 0!==e.red,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)\n                {\n                    cv[0] = v.red;\n                    cv[1] = v.green;\n                    cv[2] = v.blue;\n                    cv[3] = v.alpha;\n                    gl.uniform4f(ud["${t}"].location, v.red, v.green, v.blue, v.alpha)\n                }`,codeUbo:t=>`\n                    v = uv.${t};\n\n                    data[offset] = v.red;\n                    data[offset+1] = v.green;\n                    data[offset+2] = v.blue;\n                    data[offset+3] = v.alpha;\n                `},{test:(t,e)=>"vec3"===t.type&&1===t.size&&!t.isArray&&void 0!==e.red,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)\n                {\n                    cv[0] = v.red;\n                    cv[1] = v.green;\n                    cv[2] = v.blue;\n    \n                    gl.uniform3f(ud["${t}"].location, v.red, v.green, v.blue)\n                }`,codeUbo:t=>`\n                    v = uv.${t};\n\n                    data[offset] = v.red;\n                    data[offset+1] = v.green;\n                    data[offset+2] = v.blue;\n                `},{test:t=>"vec4"===t.type&&1===t.size&&!t.isArray,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud["${t}"].location, v[0], v[1], v[2], v[3])\n                }`}],Ve={float:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1f(location, v);\n    }",vec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",vec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4f(location, v[0], v[1], v[2], v[3]);\n    }",int:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",ivec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",ivec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",ivec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",uint:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1ui(location, v);\n    }",uvec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2ui(location, v[0], v[1]);\n    }",uvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3ui(location, v[0], v[1], v[2]);\n    }",uvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);\n    }",bool:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1i(location, v);\n    }",bvec2:"\n    if (cv[0] != v[0] || cv[1] != v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",bvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",bvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",samplerCube:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",sampler2DArray:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }"},Xe={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};const $e={};let Ye,qe=$e;function Ke(){if(!Ye){Ye=y.MEDIUM;const t=function(){if(qe===$e||qe?.isContextLost()){const t=w.ADAPTER.createCanvas();let n;w.PREFER_ENV>=e.WEBGL2&&(n=t.getContext("webgl2",{})),n||(n=t.getContext("webgl",{})||t.getContext("experimental-webgl",{}),n?n.getExtension("WEBGL_draw_buffers"):n=null),qe=n}return qe}();if(t&&t.getShaderPrecisionFormat){const e=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);Ye=e.precision?y.HIGH:y.MEDIUM}}return Ye}const Qe={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Ze(t){return Qe[t]}let Je=null;const tn={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function en(t,e){if(!Je){const e=Object.keys(tn);Je={};for(let n=0;n<e.length;++n){const r=e[n];Je[t[r]]=tn[r]}}return Je[e]}function nn(t,e,n){if("precision"!==t.substring(0,9)){let r=e;return e===y.HIGH&&n!==y.HIGH&&(r=y.MEDIUM),`precision ${r} float;\n${t}`}return n!==y.HIGH&&"precision highp"===t.substring(0,15)?t.replace("precision highp","precision mediump"):t}let rn=0;const sn={},on=class{constructor(t,e,n="pixi-shader",r={}){this.extra={},this.id=rn++,this.vertexSrc=t||on.defaultVertexSrc,this.fragmentSrc=e||on.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=r,"#version"!==this.vertexSrc.substring(0,8)&&(n=n.replace(/\s+/g,"-"),sn[n]?(sn[n]++,n+=`-${sn[n]}`):sn[n]=1,this.vertexSrc=`#define SHADER_NAME ${n}\n${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${n}\n${this.fragmentSrc}`,this.vertexSrc=nn(this.vertexSrc,on.defaultVertexPrecision,y.HIGH),this.fragmentSrc=nn(this.fragmentSrc,on.defaultFragmentPrecision,Ke())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n"}static get defaultFragmentSrc(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}"}static from(t,e,n){const r=t+e;let i=jt[r];return i||(jt[r]=i=new on(t,e,n)),i}};let an=on;an.defaultVertexPrecision=y.HIGH,an.defaultFragmentPrecision=G.apple.device?y.HIGH:y.MEDIUM;let hn=0;class ln{constructor(t,e,n){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=hn++,this["static"]=!!e,this.ubo=!!n,t instanceof fe?(this.buffer=t,this.buffer.type=x.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new fe(new Float32Array(1)),this.buffer.type=x.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,e,n){if(this.ubo)throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them");this.uniforms[t]=new ln(e,n)}static from(t,e,n){return new ln(t,e,n)}static uboFrom(t,e){return new ln(t,e??!0,!0)}}class un{constructor(t,e){this.uniformBindCount=0,this.program=t,this.uniformGroup=e?e instanceof ln?e:new ln(e):new ln({}),this.disposeRunner=new se("disposeShader")}checkUniformExists(t,e){if(e.uniforms[t])return!0;for(const n in e.uniforms){const r=e.uniforms[n];if(r.group&&this.checkUniformExists(t,r))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,e,n){const r=an.from(t,e);return new un(r,n)}}class cn{constructor(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!e.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const e=new Int32Array(t);for(let r=0;r<t;r++)e[r]=r;this.defaultGroupCache[t]=ln.from({uSamplers:e},!0);let n=this.fragTemplate;n=n.replace(/%count%/gi,`${t}`),n=n.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new an(this.vertexSrc,n)}const e={tint:new Float32Array([1,1,1,1]),translationMatrix:new Oe,"default":this.defaultGroupCache[t]};return new un(this.programCache[t],e)}generateSampleSrc(t){let e="";e+="\n",e+="\n";for(let n=0;n<t;n++)n>0&&(e+="\nelse "),n<t-1&&(e+=`if(vTextureId < ${n}.5)`),e+="\n{",e+=`\n\tcolor = texture2D(uSamplers[${n}], vTextureCoord);`,e+="\n}";return e+="\n",e+="\n",e}}class dn{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}class fn{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}const pn=class extends fn{constructor(t){super(t),this.setShaderGenerator(),this.geometryClass=be,this.vertexSize=6,this.state=ne.for2d(),this.size=4*pn.defaultBatchSize,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),t.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??function(t){let e=!0;const n=w.ADAPTER.getNavigator();if(G.tablet||G.phone){if(G.apple.device){const t=n.userAgent.match(/OS (\d+)_(\d+)?/);t&&parseInt(t[1],10)<11&&(e=!1)}if(G.android.device){const t=n.userAgent.match(/Android\s([0-9.]*)/);t&&parseInt(t[1],10)<7&&(e=!1)}}return e?t:4}(32),this._defaultMaxTextures}static set defaultMaxTextures(t){this._defaultMaxTextures=t}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??!G.apple.device,this._canUploadSameBuffer}static set canUploadSameBuffer(t){this._canUploadSameBuffer=t}get MAX_TEXTURES(){return K(0,"BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return"precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n"}static get defaultFragmentTemplate(){return"varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n"}setShaderGenerator({vertex:t=pn.defaultVertexSrc,fragment:e=pn.defaultFragmentTemplate}={}){this.shaderGenerator=new cn(t,e)}contextChange(){const t=this.renderer.gl;w.PREFER_ENV===e.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),pn.defaultMaxTextures),this.maxTextures=function(t,e){if(0===t)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const n=e.createShader(e.FRAGMENT_SHADER);for(;;){const r=te.replace(/%forloop%/gi,ee(t));if(e.shaderSource(n,r),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS))break;t=t/2|0}return t}(this.maxTextures,t)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:t,_textureArrayPool:e}=pn,n=this.size/4,r=Math.floor(n/this.maxTextures)+1;for(;t.length<n;)t.push(new ce);for(;e.length<r;)e.push(new dn);for(let i=0;i<this.maxTextures;i++)this._tempBoundTextures[i]=null}onPrerender(){this._flushId=0}render(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)}buildTexturesAndDrawCalls(){const{_bufferedTextures:t,maxTextures:e}=this,n=pn._textureArrayPool,r=this.renderer.batch,i=this._tempBoundTextures,s=this.renderer.textureGC.count;let o=++ue._globalBatch,a=0,h=n[0],l=0;r.copyBoundTextures(i,e);for(let u=0;u<this._bufferSize;++u){const c=t[u];t[u]=null,c._batchEnabled!==o&&(h.count>=e&&(r.boundArray(h,i,o,e),this.buildDrawCalls(h,l,u),l=u,h=n[++a],++o),c._batchEnabled=o,c.touched=s,h.elements[h.count++]=c)}h.count>0&&(r.boundArray(h,i,o,e),this.buildDrawCalls(h,l,this._bufferSize),++a,++o);for(let u=0;u<i.length;u++)i[u]=null;ue._globalBatch=o}buildDrawCalls(t,e,n){const{_bufferedElements:r,_attributeBuffer:i,_indexBuffer:s,vertexSize:o}=this,a=pn._drawCallPool;let h=this._dcIndex,l=this._aIndex,u=this._iIndex,c=a[h];c.start=this._iIndex,c.texArray=t;for(let d=e;d<n;++d){const n=r[d],f=n._texture.baseTexture,p=It[f.alphaMode?1:0][n.blendMode];r[d]=null,e<d&&c.blend!==p&&(c.size=u-c.start,e=d,c=a[++h],c.texArray=t,c.start=u),this.packInterleavedGeometry(n,i,s,l,u),l+=n.vertexData.length/2*o,u+=n.indices.length,c.blend=p}e<n&&(c.size=u-c.start,++h),this._dcIndex=h,this._aIndex=l,this._iIndex=u}bindAndClearTexArray(t){const e=this.renderer.texture;for(let n=0;n<t.count;n++)e.bind(t.elements[n],t.ids[n]),t.elements[n]=null;t.count=0}updateGeometry(){const{_packedGeometries:t,_attributeBuffer:e,_indexBuffer:n}=this;pn.canUploadSameBuffer?(t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(n),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(n),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const t=this._dcIndex,{gl:e,state:n}=this.renderer,r=pn._drawCallPool;let i=null;for(let s=0;s<t;s++){const{texArray:t,type:o,size:a,start:h,blend:l}=r[s];i!==t&&(i=t,this.bindAndClearTexArray(t)),this.state.blendMode=l,n.set(this.state),e.drawElements(o,a,e.UNSIGNED_SHORT,2*h)}}flush(){0!==this._vertexCount&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),pn.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(t){const e=Mt(Math.ceil(t/8)),n=Dt(e),r=8*e;this._aBuffers.length<=n&&(this._iBuffers.length=n+1);let i=this._aBuffers[r];return i||(this._aBuffers[r]=i=new Jt(r*this.vertexSize*4)),i}getIndexBuffer(t){const e=Mt(Math.ceil(t/12)),n=Dt(e),r=12*e;this._iBuffers.length<=n&&(this._iBuffers.length=n+1);let i=this._iBuffers[n];return i||(this._iBuffers[n]=i=new Uint16Array(r)),i}packInterleavedGeometry(t,e,n,r,i){const{uint32View:s,float32View:o}=e,a=r/this.vertexSize,h=t.uvs,l=t.indices,u=t.vertexData,c=t._texture.baseTexture._batchLocation,d=Math.min(t.worldAlpha,1),f=Ct.shared.setValue(t._tintRGB).toPremultiplied(d,t._texture.baseTexture.alphaMode>0);for(let p=0;p<u.length;p+=2)o[r++]=u[p],o[r++]=u[p+1],o[r++]=h[p],o[r++]=h[p+1],s[r++]=f,o[r++]=c;for(let p=0;p<l.length;p++)n[i++]=a+l[p]}};let mn=pn;mn.defaultBatchSize=4096,mn.extension={name:"batch",type:qt.RendererPlugin},mn._drawCallPool=[],mn._textureArrayPool=[],Zt.add(mn);const gn=class extends un{constructor(t,e,n){super(an.from(t||gn.defaultVertexSrc,e||gn.defaultFragmentSrc),n),this.padding=0,this.resolution=gn.defaultResolution,this.multisample=gn.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new ne}apply(t,e,n,r,i){t.applyFilter(this,e,n,r)}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}get resolution(){return this._resolution}set resolution(t){this._resolution=t}static get defaultVertexSrc(){return"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n"}static get defaultFragmentSrc(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n"}};let _n=gn;_n.defaultResolution=1,_n.defaultMultisample=b.NONE;class yn{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new Ct(0),this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender;const{backgroundColor:e,background:n,backgroundAlpha:r}=t,i=n??e;void 0!==i&&(this.color=i),this.alpha=r}get color(){return this._backgroundColor.value}set color(t){this._backgroundColor.setValue(t)}get alpha(){return this._backgroundColor.alpha}set alpha(t){this._backgroundColor.setAlpha(t)}get backgroundColor(){return this._backgroundColor}destroy(){}}yn.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},yn.extension={type:[qt.RendererSystem,qt.CanvasRendererSystem],name:"background"},Zt.add(yn);class vn{constructor(t){this.renderer=t,this.emptyRenderer=new fn(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,e){const{boundTextures:n}=this.renderer.texture;for(let r=e-1;r>=0;--r)t[r]=n[r]||null,t[r]&&(t[r]._batchLocation=r)}boundArray(t,e,n,r){const{elements:i,ids:s,count:o}=t;let a=0;for(let h=0;h<o;h++){const t=i[h],o=t._batchLocation;if(o>=0&&o<r&&e[o]===t)s[h]=o;else for(;a<r;){const r=e[a];if(!r||r._batchEnabled!==n||r._batchLocation!==a){s[h]=a,t._batchLocation=a,e[a]=t;break}a++}}}destroy(){this.renderer=null}}vn.extension={type:qt.RendererSystem,name:"batch"},Zt.add(vn);let bn=0;class xn{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=bn++}init(t){if(t.context)this.initFromContext(t.context);else{const e=this.renderer.background.alpha<1,n=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:e,premultipliedAlpha:n,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=bn++,this.renderer.runners.contextChange.emit(t);const e=this.renderer.view;void 0!==e.addEventListener&&(e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const e=this.createContext(this.renderer.view,t);this.initFromContext(e)}createContext(t,n){let r;if(w.PREFER_ENV>=e.WEBGL2&&(r=t.getContext("webgl2",n)),r)this.webGLVersion=2;else if(this.webGLVersion=1,r=t.getContext("webgl",n)||t.getContext("experimental-webgl",n),!r)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=r,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,e={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};1===this.webGLVersion?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):2===this.webGLVersion&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout((()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()}),0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,void 0!==t.removeEventListener&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const e=t.getContextAttributes(),n="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;n&&(this.webGLVersion=2),e&&e.stencil;const r=n||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=r}}xn.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},xn.extension={type:qt.RendererSystem,name:"context"},Zt.add(xn);class En extends ae{upload(t,e,n){const r=t.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===m.UNPACK);const i=e.realWidth,s=e.realHeight;return n.width===i&&n.height===s?r.texSubImage2D(e.target,0,0,0,i,s,e.format,n.type,this.data):(n.width=i,n.height=s,r.texImage2D(e.target,0,n.internalFormat,i,s,0,e.format,n.type,this.data)),!0}}class wn{constructor(t,e){this.width=Math.round(t||100),this.height=Math.round(e||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new se("disposeFramebuffer"),this.multisample=b.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,e){return this.colorTextures[t]=e||new ue(null,{scaleMode:d.NEAREST,resolution:1,mipmap:p.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new ue(new En(null,{width:this.width,height:this.height}),{scaleMode:d.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:p.OFF,format:h.DEPTH_COMPONENT,type:u.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,e){if(t=Math.round(t),e=Math.round(e),t!==this.width||e!==this.height){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(let n=0;n<this.colorTextures.length;n++){const r=this.colorTextures[n],i=r.resolution;r.setSize(t/i,e/i)}if(this.depthTexture){const n=this.depthTexture.resolution;this.depthTexture.setSize(t/n,e/n)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class Tn extends ue{constructor(t={}){if("number"==typeof t){t={width:arguments[0],height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]}}t.width=t.width||100,t.height=t.height||100,t.multisample??(t.multisample=b.NONE),super(null,t),this.mipmap=p.OFF,this.valid=!0,this._clear=new Ct([0,0,0,0]),this.framebuffer=new wn(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(t){this._clear.setValue(t)}get clearColor(){return this._clear.value}get clear(){return this._clear}resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class Sn extends oe{constructor(t){const e=t;super(e.naturalWidth||e.videoWidth||e.width,e.naturalHeight||e.videoHeight||e.height),this.source=t,this.noSubImage=!1}static crossOrigin(t,e,n){void 0!==n||e.startsWith("data:")?!1!==n&&(t.crossOrigin="string"==typeof n?n:"anonymous"):t.crossOrigin=function(t,e=globalThis.location){if(t.startsWith("data:"))return"";e=e||globalThis.location,$t||($t=document.createElement("a")),$t.href=t;const n=V.parse($t.href),r=!n.port&&""===e.port||n.port===e.port;return n.hostname===e.hostname&&r&&n.protocol===e.protocol?"":"anonymous"}(e)}upload(t,e,n,r){const i=t.gl,s=e.realWidth,o=e.realHeight;if(r=r||this.source,"undefined"!=typeof HTMLImageElement&&r instanceof HTMLImageElement){if(!r.complete||0===r.naturalWidth)return!1}else if("undefined"!=typeof HTMLVideoElement&&r instanceof HTMLVideoElement&&r.readyState<=1&&0===r.buffered.length)return!1;return i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===m.UNPACK),this.noSubImage||e.target!==i.TEXTURE_2D||n.width!==s||n.height!==o?(n.width=s,n.height=o,i.texImage2D(e.target,0,n.internalFormat,e.format,n.type,r)):i.texSubImage2D(i.TEXTURE_2D,0,0,0,e.format,n.type,r),!0}update(){if(this.destroyed)return;const t=this.source,e=t.naturalWidth||t.videoWidth||t.width,n=t.naturalHeight||t.videoHeight||t.height;this.resize(e,n),super.update()}dispose(){this.source=null}}class An extends Sn{constructor(t,e){if(e=e||{},"string"==typeof t){const n=new Image;Sn.crossOrigin(n,t,e.crossorigin),n.src=t,t=n}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(e.createBitmap??w.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode="number"==typeof e.alphaMode?e.alphaMode:null,this.bitmap=null,this._load=null,!1!==e.autoLoad&&this.load()}load(t){return this._load||(void 0!==t&&(this.createBitmap=t),this._load=new Promise(((t,e)=>{const n=this.source;this.url=n.src;const r=()=>{this.destroyed||(n.onload=null,n.onerror=null,this.resize(n.width,n.height),this._load=null,this.createBitmap?t(this.process()):t(this))};n.complete&&n.src?r():(n.onload=r,n.onerror=t=>{e(t),this.onError.emit(t)})}))),this._load}process(){const t=this.source;if(null!==this._process)return this._process;if(null!==this.bitmap||!globalThis.createImageBitmap)return Promise.resolve(this);const e=globalThis.createImageBitmap,n=!t.crossOrigin||"anonymous"===t.crossOrigin;return this._process=fetch(t.src,{mode:n?"cors":"no-cors"}).then((t=>t.blob())).then((n=>e(n,0,0,t.width,t.height,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===m.UNPACK?"premultiply":"none"}))).then((t=>this.destroyed?Promise.reject():(this.bitmap=t,this.update(),this._process=null,Promise.resolve(this)))),this._process}upload(t,e,n){if("number"==typeof this.alphaMode&&(e.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,e,n);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,e,n,this.bitmap),!this.preserveBitmap){let t=!0;const r=e._glTextures;for(const i in r){const s=r[i];if(s!==n&&s.dirtyId!==e.dirtyId){t=!1;break}}t&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return"undefined"!=typeof HTMLImageElement&&("string"==typeof t||t instanceof HTMLImageElement)}}class Cn{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,n){const r=e.width,i=e.height;if(n){const e=t.width/2/r,s=t.height/2/i,o=t.x/r+e,a=t.y/i+s;n=je.add(n,je.NW),this.x0=o+e*je.uX(n),this.y0=a+s*je.uY(n),n=je.add(n,2),this.x1=o+e*je.uX(n),this.y1=a+s*je.uY(n),n=je.add(n,2),this.x2=o+e*je.uX(n),this.y2=a+s*je.uY(n),n=je.add(n,2),this.x3=o+e*je.uX(n),this.y3=a+s*je.uY(n)}else this.x0=t.x/r,this.y0=t.y/i,this.x1=(t.x+t.width)/r,this.y1=t.y/i,this.x2=(t.x+t.width)/r,this.y2=(t.y+t.height)/i,this.x3=t.x/r,this.y3=(t.y+t.height)/i;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}toString(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`}}const In=new Cn;function Rn(t){t.destroy=function(){},t.on=function(){},t.once=function(){},t.emit=function(){}}class Pn extends H{constructor(t,e,n,r,i,s,o){if(super(),this.noFrame=!1,e||(this.noFrame=!0,e=new Ce(0,0,1,1)),t instanceof Pn&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=r,this.valid=!1,this._uvs=In,this.uvMatrix=null,this.orig=n||e,this._rotate=Number(i||0),!0===i)this._rotate=2;else if(this._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=s?new Se(s.x,s.y):new Se(0,0),this.defaultBorders=o,this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=e:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:t}=this.baseTexture;t?.url&&Gt[t.url]&&Pn.removeFromCache(t.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,Pn.removeFromCache(this),this.textureCacheIds=null}clone(){const t=this._frame.clone(),e=this._frame===this.orig?t:this.orig.clone(),n=new Pn(this.baseTexture,!this.noFrame&&t,e,this.trim?.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(n._frame=t),n}updateUvs(){this._uvs===In&&(this._uvs=new Cn),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,e={},n=w.STRICT_TEXTURE_CACHE){const r="string"==typeof t;let i=null;if(r)i=t;else if(t instanceof ue){if(!t.cacheId){const n=e?.pixiIdPrefix||"pixiid";t.cacheId=`${n}-${Ft()}`,ue.addToCache(t,t.cacheId)}i=t.cacheId}else{if(!t._pixiId){const n=e?.pixiIdPrefix||"pixiid";t._pixiId=`${n}_${Ft()}`}i=t._pixiId}let s=Gt[i];if(r&&n&&!s)throw new Error(`The cacheId "${i}" does not exist in TextureCache.`);return s||t instanceof ue?!s&&t instanceof ue&&(s=new Pn(t),Pn.addToCache(s,i)):(e.resolution||(e.resolution=Yt(t)),s=new Pn(new ue(t,e)),s.baseTexture.cacheId=i,ue.addToCache(s.baseTexture,i),Pn.addToCache(s,i)),s}static fromURL(t,e){const n=Object.assign({autoLoad:!1},e?.resourceOptions),r=Pn.from(t,Object.assign({resourceOptions:n},e),!1),i=r.baseTexture.resource;return r.baseTexture.valid?Promise.resolve(r):i.load().then((()=>Promise.resolve(r)))}static fromBuffer(t,e,n,r){return new Pn(ue.fromBuffer(t,e,n,r))}static fromLoader(t,e,n,r){const i=new ue(t,Object.assign({scaleMode:ue.defaultOptions.scaleMode,resolution:Yt(e)},r)),{resource:s}=i;s instanceof An&&(s.url=e);const o=new Pn(i);return n||(n=e),ue.addToCache(o.baseTexture,n),Pn.addToCache(o,n),n!==e&&(ue.addToCache(o.baseTexture,e),Pn.addToCache(o,e)),o.baseTexture.valid?Promise.resolve(o):new Promise((t=>{o.baseTexture.once("loaded",(()=>t(o)))}))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),Gt[e]&&Gt[e],Gt[e]=t)}static removeFromCache(t){if("string"==typeof t){const e=Gt[t];if(e){const n=e.textureCacheIds.indexOf(t);return n>-1&&e.textureCacheIds.splice(n,1),delete Gt[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)Gt[t.textureCacheIds[e]]===t&&delete Gt[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:e,y:n,width:r,height:i}=t,s=e+r>this.baseTexture.width,o=n+i>this.baseTexture.height;if(s||o){const t=s&&o?"and":"or",a=`X: ${e} + ${r} = ${e+r} > ${this.baseTexture.width}`,h=`Y: ${n} + ${i} = ${n+i} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${a} ${t} ${h}`)}this.valid=r&&i&&this.baseTexture.valid,this.trim||this.rotate||(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return Pn._EMPTY||(Pn._EMPTY=new Pn(new ue),Rn(Pn._EMPTY),Rn(Pn._EMPTY.baseTexture)),Pn._EMPTY}static get WHITE(){if(!Pn._WHITE){const t=w.ADAPTER.createCanvas(16,16),e=t.getContext("2d");t.width=16,t.height=16,e.fillStyle="white",e.fillRect(0,0,16,16),Pn._WHITE=new Pn(ue.from(t)),Rn(Pn._WHITE),Rn(Pn._WHITE.baseTexture)}return Pn._WHITE}}class Mn extends Pn{constructor(t,e){super(t,e),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e,n=!0){const r=this.baseTexture.resolution,i=Math.round(t*r)/r,s=Math.round(e*r)/r;this.valid=i>0&&s>0,this._frame.width=this.orig.width=i,this._frame.height=this.orig.height=s,n&&this.baseTexture.resize(i,s),this.updateUvs()}setResolution(t){const{baseTexture:e}=this;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))}static create(t){return new Mn(new Tn(t))}}class On{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,e,n=b.NONE){const r=new Tn(Object.assign({width:t,height:e,resolution:1,multisample:n},this.textureOptions));return new Mn(r)}getOptimalTexture(t,e,n=1,r=b.NONE){let i;t=Math.ceil(t*n-1e-6),e=Math.ceil(e*n-1e-6),this.enableFullScreen&&t===this._pixelsWidth&&e===this._pixelsHeight?i=r>1?-r:-1:(i=((65535&(t=Mt(t)))<<16|65535&(e=Mt(e)))>>>0,r>1&&(i+=4294967296*r)),this.texturePool[i]||(this.texturePool[i]=[]);let s=this.texturePool[i].pop();return s||(s=this.createTexture(t,e,r)),s.filterPoolKey=i,s.setResolution(n),s}getFilterTexture(t,e,n){const r=this.getOptimalTexture(t.width,t.height,e||t.resolution,n||b.NONE);return r.filterFrame=t.filterFrame,r}returnTexture(t){const e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=!1!==t)for(const e in this.texturePool){const t=this.texturePool[e];if(t)for(let e=0;e<t.length;e++)t[e].destroy(!0)}this.texturePool={}}setScreenSize(t){if(t.width!==this._pixelsWidth||t.height!==this._pixelsHeight){this.enableFullScreen=t.width>0&&t.height>0;for(const t in this.texturePool){if(!(Number(t)<0))continue;const e=this.texturePool[t];if(e)for(let t=0;t<e.length;t++)e[t].destroy(!0);this.texturePool[t]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}}On.SCREEN_KEY=-1;class Dn extends ve{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class Nn extends ve{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new fe(this.vertices),this.uvBuffer=new fe(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,e){let n=0,r=0;return this.uvs[0]=n,this.uvs[1]=r,this.uvs[2]=n+e.width/t.width,this.uvs[3]=r,this.uvs[4]=n+e.width/t.width,this.uvs[5]=r+e.height/t.height,this.uvs[6]=n,this.uvs[7]=r+e.height/t.height,n=e.x,r=e.y,this.vertices[0]=n,this.vertices[1]=r,this.vertices[2]=n+e.width,this.vertices[3]=r,this.vertices[4]=n+e.width,this.vertices[5]=r+e.height,this.vertices[6]=n,this.vertices[7]=r+e.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class kn{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=b.NONE,this.sourceFrame=new Ce,this.destinationFrame=new Ce,this.bindingSourceFrame=new Ce,this.bindingDestinationFrame=new Ce,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const Ln=[new Se,new Se,new Se,new Se],Fn=new Oe;class Bn{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new On,this.statePool=[],this.quad=new Dn,this.quadUv=new Nn,this.tempRect=new Ce,this.activeState={},this.globalUniforms=new ln({outputFrame:new Ce,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,e){const n=this.renderer,r=this.defaultFilterStack,i=this.statePool.pop()||new kn,s=this.renderer.renderTexture;let o=e[0].resolution,a=e[0].multisample,h=e[0].padding,l=e[0].autoFit,u=e[0].legacy??!0;for(let f=1;f<e.length;f++){const t=e[f];o=Math.min(o,t.resolution),a=Math.min(a,t.multisample),h=this.useMaxPadding?Math.max(h,t.padding):h+t.padding,l=l&&t.autoFit,u=u||(t.legacy??!0)}1===r.length&&(this.defaultFilterStack[0].renderTexture=s.current),r.push(i),i.resolution=o,i.multisample=a,i.legacy=u,i.target=t,i.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),i.sourceFrame.pad(h);const c=this.tempRect.copyFrom(s.sourceFrame);n.projection.transform&&this.transformAABB(Fn.copyFrom(n.projection.transform).invert(),c),l?(i.sourceFrame.fit(c),(i.sourceFrame.width<=0||i.sourceFrame.height<=0)&&(i.sourceFrame.width=0,i.sourceFrame.height=0)):i.sourceFrame.intersects(c)||(i.sourceFrame.width=0,i.sourceFrame.height=0),this.roundFrame(i.sourceFrame,s.current?s.current.resolution:n.resolution,s.sourceFrame,s.destinationFrame,n.projection.transform),i.renderTexture=this.getOptimalFilterTexture(i.sourceFrame.width,i.sourceFrame.height,o,a),i.filters=e,i.destinationFrame.width=i.renderTexture.width,i.destinationFrame.height=i.renderTexture.height;const d=this.tempRect;d.x=0,d.y=0,d.width=i.sourceFrame.width,d.height=i.sourceFrame.height,i.renderTexture.filterFrame=i.sourceFrame,i.bindingSourceFrame.copyFrom(s.sourceFrame),i.bindingDestinationFrame.copyFrom(s.destinationFrame),i.transform=n.projection.transform,n.projection.transform=null,s.bind(i.renderTexture,i.sourceFrame,d),n.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,e=t.pop(),n=e.filters;this.activeState=e;const r=this.globalUniforms.uniforms;r.outputFrame=e.sourceFrame,r.resolution=e.resolution;const i=r.inputSize,s=r.inputPixel,o=r.inputClamp;if(i[0]=e.destinationFrame.width,i[1]=e.destinationFrame.height,i[2]=1/i[0],i[3]=1/i[1],s[0]=Math.round(i[0]*e.resolution),s[1]=Math.round(i[1]*e.resolution),s[2]=1/s[0],s[3]=1/s[1],o[0]=.5*s[2],o[1]=.5*s[3],o[2]=e.sourceFrame.width*i[2]-.5*s[2],o[3]=e.sourceFrame.height*i[3]-.5*s[3],e.legacy){const t=r.filterArea;t[0]=e.destinationFrame.width,t[1]=e.destinationFrame.height,t[2]=e.sourceFrame.x,t[3]=e.sourceFrame.y,r.filterClamp=r.inputClamp}this.globalUniforms.update();const a=t[t.length-1];if(this.renderer.framebuffer.blit(),1===n.length)n[0].apply(this,e.renderTexture,a.renderTexture,g.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let t=e.renderTexture,r=this.getOptimalFilterTexture(t.width,t.height,e.resolution);r.filterFrame=t.filterFrame;let i=0;for(i=0;i<n.length-1;++i){1===i&&e.multisample>1&&(r=this.getOptimalFilterTexture(t.width,t.height,e.resolution),r.filterFrame=t.filterFrame),n[i].apply(this,t,r,g.CLEAR,e);const s=t;t=r,r=s}n[i].apply(this,t,a.renderTexture,g.BLEND,e),i>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(t),this.returnFilterTexture(r)}e.clear(),this.statePool.push(e)}bindAndClear(t,e=g.CLEAR){const{renderTexture:n,state:r}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t?.filterFrame){const e=this.tempRect;e.x=0,e.y=0,e.width=t.filterFrame.width,e.height=t.filterFrame.height,n.bind(t,t.filterFrame,e)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?n.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const i=1&r.stateId||this.forceClear;(e===g.CLEAR||e===g.BLIT&&i)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,e,n,r){const i=this.renderer;i.state.set(t.state),this.bindAndClear(n,r),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,i.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),i.geometry.bind(this.quadUv),i.geometry.draw(a.TRIANGLES)):(i.geometry.bind(this.quad),i.geometry.draw(a.TRIANGLE_STRIP))}calculateSpriteMatrix(t,e){const{sourceFrame:n,destinationFrame:r}=this.activeState,{orig:i}=e._texture,s=t.set(r.width,0,0,r.height,n.x,n.y),o=e.worldTransform.copyTo(Oe.TEMP_MATRIX);return o.invert(),s.prepend(o),s.scale(1/i.width,1/i.height),s.translate(e.anchor.x,e.anchor.y),s}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,e,n=1,r=b.NONE){return this.texturePool.getOptimalTexture(t,e,n,r)}getFilterTexture(t,e,n){if("number"==typeof t){const n=t;t=e,e=n}t=t||this.activeState.renderTexture;const r=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,n||b.NONE);return r.filterFrame=t.filterFrame,r}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,e){const n=Ln[0],r=Ln[1],i=Ln[2],s=Ln[3];n.set(e.left,e.top),r.set(e.left,e.bottom),i.set(e.right,e.top),s.set(e.right,e.bottom),t.apply(n,n),t.apply(r,r),t.apply(i,i),t.apply(s,s);const o=Math.min(n.x,r.x,i.x,s.x),a=Math.min(n.y,r.y,i.y,s.y),h=Math.max(n.x,r.x,i.x,s.x),l=Math.max(n.y,r.y,i.y,s.y);e.x=o,e.y=a,e.width=h-o,e.height=l-a}roundFrame(t,e,n,r,i){if(!(t.width<=0||t.height<=0||n.width<=0||n.height<=0)){if(i){const{a:t,b:e,c:n,d:r}=i;if((Math.abs(e)>1e-4||Math.abs(n)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(r)>1e-4))return}(i=i?Fn.copyFrom(i):Fn.identity()).translate(-n.x,-n.y).scale(r.width/n.width,r.height/n.height).translate(r.x,r.y),this.transformAABB(i,t),t.ceil(e),this.transformAABB(i.invert(),t)}}}Bn.extension={type:qt.RendererSystem,name:"filter"},Zt.add(Bn);class Un{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=b.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const jn=new Ce;class Gn{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new wn(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Ce,this.hasMRT=!0,this.writeDepthTexture=!0,1===this.renderer.context.webGLVersion){let n=this.renderer.context.extensions.drawBuffers,r=this.renderer.context.extensions.depthTexture;w.PREFER_ENV===e.WEBGL_LEGACY&&(n=null,r=null),n?t.drawBuffers=t=>n.drawBuffersWEBGL(t):(this.hasMRT=!1,t.drawBuffers=()=>{}),r||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,e,n=0){const{gl:r}=this;if(t){const i=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,r.bindFramebuffer(r.FRAMEBUFFER,i.framebuffer)),i.mipLevel!==n&&(t.dirtyId++,t.dirtyFormat++,i.mipLevel=n),i.dirtyId!==t.dirtyId&&(i.dirtyId=t.dirtyId,i.dirtyFormat!==t.dirtyFormat?(i.dirtyFormat=t.dirtyFormat,i.dirtySize=t.dirtySize,this.updateFramebuffer(t,n)):i.dirtySize!==t.dirtySize&&(i.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let e=0;e<t.colorTextures.length;e++){const n=t.colorTextures[e];this.renderer.texture.unbind(n.parentTextureArray||n)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){const t=e.width>>n,r=e.height>>n,i=t/e.width;this.setViewport(e.x*i,e.y*i,t,r)}else{const e=t.width>>n,r=t.height>>n;this.setViewport(0,0,e,r)}}else this.current&&(this.current=null,r.bindFramebuffer(r.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,e,n,r){const i=this.viewport;t=Math.round(t),e=Math.round(e),n=Math.round(n),r=Math.round(r),i.width===n&&i.height===r&&i.x===t&&i.y===e||(i.x=t,i.y=e,i.width=n,i.height=r,this.gl.viewport(t,e,n,r))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,e,n,r,i=s.COLOR|s.DEPTH){const{gl:o}=this;o.clearColor(t,e,n,r),o.clear(i)}initFramebuffer(t){const{gl:e}=this,n=new Un(e.createFramebuffer());return n.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=n,this.managedFramebuffers.push(t),t.disposeRunner.add(this),n}resizeFramebuffer(t){const{gl:e}=this,n=t.glFramebuffers[this.CONTEXT_UID];n.stencil&&(e.bindRenderbuffer(e.RENDERBUFFER,n.stencil),n.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,n.multisample,e.DEPTH24_STENCIL8,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height));const r=t.colorTextures;let i=r.length;e.drawBuffers||(i=Math.min(i,1));for(let s=0;s<i;s++){const i=r[s],o=i.parentTextureArray||i;this.renderer.texture.bind(o,0),0===s&&n.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,n.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,n.multisample,o._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,e){const{gl:n}=this,r=t.glFramebuffers[this.CONTEXT_UID],i=t.colorTextures;let s=i.length;n.drawBuffers||(s=Math.min(s,1)),r.multisample>1&&this.canMultisampleFramebuffer(t)?r.msaaBuffer=r.msaaBuffer||n.createRenderbuffer():r.msaaBuffer&&(n.deleteRenderbuffer(r.msaaBuffer),r.msaaBuffer=null,r.blitFramebuffer&&(r.blitFramebuffer.dispose(),r.blitFramebuffer=null));const o=[];for(let a=0;a<s;a++){const s=i[a],h=s.parentTextureArray||s;this.renderer.texture.bind(h,0),0===a&&r.msaaBuffer?(n.bindRenderbuffer(n.RENDERBUFFER,r.msaaBuffer),n.renderbufferStorageMultisample(n.RENDERBUFFER,r.multisample,h._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,r.msaaBuffer)):(n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+a,s.target,h._glTextures[this.CONTEXT_UID].texture,e),o.push(n.COLOR_ATTACHMENT0+a))}if(o.length>1&&n.drawBuffers(o),t.depthTexture){if(this.writeDepthTexture){const r=t.depthTexture;this.renderer.texture.bind(r,0),n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,r._glTextures[this.CONTEXT_UID].texture,e)}}!t.stencil&&!t.depth||t.depthTexture&&this.writeDepthTexture?r.stencil&&(n.deleteRenderbuffer(r.stencil),r.stencil=null):(r.stencil=r.stencil||n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,r.stencil),r.msaaBuffer?n.renderbufferStorageMultisample(n.RENDERBUFFER,r.multisample,n.DEPTH24_STENCIL8,t.width,t.height):n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,t.width,t.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,r.stencil))}canMultisampleFramebuffer(t){return 1!==this.renderer.context.webGLVersion&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:e}=this;let n=b.NONE;if(t<=1||null===e)return n;for(let r=0;r<e.length;r++)if(e[r]<=t){n=e[r];break}return 1===n&&(n=b.NONE),n}blit(t,e,n){const{current:r,renderer:i,gl:s,CONTEXT_UID:o}=this;if(2!==i.context.webGLVersion)return;if(!r)return;const a=r.glFramebuffers[o];if(!a)return;if(!t){if(!a.msaaBuffer)return;const e=r.colorTextures[0];if(!e)return;a.blitFramebuffer||(a.blitFramebuffer=new wn(r.width,r.height),a.blitFramebuffer.addColorTexture(0,e)),(t=a.blitFramebuffer).colorTextures[0]!==e&&(t.colorTextures[0]=e,t.dirtyId++,t.dirtyFormat++),t.width===r.width&&t.height===r.height||(t.width=r.width,t.height=r.height,t.dirtyId++,t.dirtySize++)}e||((e=jn).width=r.width,e.height=r.height),n||(n=e);const h=e.width===n.width&&e.height===n.height;this.bind(t),s.bindFramebuffer(s.READ_FRAMEBUFFER,a.framebuffer),s.blitFramebuffer(e.left,e.top,e.right,e.bottom,n.left,n.top,n.right,n.bottom,s.COLOR_BUFFER_BIT,h?s.NEAREST:s.LINEAR),s.bindFramebuffer(s.READ_FRAMEBUFFER,t.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(t,e){const n=t.glFramebuffers[this.CONTEXT_UID],r=this.gl;if(!n)return;delete t.glFramebuffers[this.CONTEXT_UID];const i=this.managedFramebuffers.indexOf(t);i>=0&&this.managedFramebuffers.splice(i,1),t.disposeRunner.remove(this),e||(r.deleteFramebuffer(n.framebuffer),n.msaaBuffer&&r.deleteRenderbuffer(n.msaaBuffer),n.stencil&&r.deleteRenderbuffer(n.stencil)),n.blitFramebuffer&&this.disposeFramebuffer(n.blitFramebuffer,e)}disposeAll(t){const e=this.managedFramebuffers;this.managedFramebuffers=[];for(let n=0;n<e.length;n++)this.disposeFramebuffer(e[n],t)}forceStencil(){const t=this.current;if(!t)return;const e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil)return;t.stencil=!0;const n=t.width,r=t.height,i=this.gl,s=i.createRenderbuffer();i.bindRenderbuffer(i.RENDERBUFFER,s),e.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,e.multisample,i.DEPTH24_STENCIL8,n,r):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,n,r),e.stencil=s,i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,s)}reset(){this.current=this.unknownFramebuffer,this.viewport=new Ce}destroy(){this.renderer=null}}Gn.extension={type:qt.RendererSystem,name:"framebuffer"},Zt.add(Gn);const Hn={5126:4,5123:2,5121:1};class zn{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,n=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,2!==n.webGLVersion){let n=this.renderer.context.extensions.vertexArrayObject;w.PREFER_ENV===e.WEBGL_LEGACY&&(n=null),n?(t.createVertexArray=()=>n.createVertexArrayOES(),t.bindVertexArray=t=>n.bindVertexArrayOES(t),t.deleteVertexArray=t=>n.deleteVertexArrayOES(t)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(2!==n.webGLVersion){const e=t.getExtension("ANGLE_instanced_arrays");e?(t.vertexAttribDivisor=(t,n)=>e.vertexAttribDivisorANGLE(t,n),t.drawElementsInstanced=(t,n,r,i,s)=>e.drawElementsInstancedANGLE(t,n,r,i,s),t.drawArraysInstanced=(t,n,r,i)=>e.drawArraysInstancedANGLE(t,n,r,i)):this.hasInstance=!1}this.canUseUInt32ElementIndex=2===n.webGLVersion||!!n.extensions.uint32ElementIndex}bind(t,e){e=e||this.renderer.shader.shader;const{gl:n}=this;let r=t.glVertexArrayObjects[this.CONTEXT_UID],i=!1;r||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=r={},i=!0);const s=r[e.program.id]||this.initGeometryVao(t,e,i);this._activeGeometry=t,this._activeVao!==s&&(this._activeVao=s,this.hasVao?n.bindVertexArray(s):this.activateVao(t,e.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,e=this.renderer.buffer;for(let n=0;n<t.buffers.length;n++){const r=t.buffers[n];e.update(r)}}checkCompatibility(t,e){const n=t.attributes,r=e.attributeData;for(const i in r)if(!n[i])throw new Error(`shader and geometry incompatible, geometry missing the "${i}" attribute`)}getSignature(t,e){const n=t.attributes,r=e.attributeData,i=["g",t.id];for(const s in n)r[s]&&i.push(s,r[s].location);return i.join("-")}initGeometryVao(t,e,n=!0){const r=this.gl,i=this.CONTEXT_UID,s=this.renderer.buffer,o=e.program;o.glPrograms[i]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,o);const a=this.getSignature(t,o),h=t.glVertexArrayObjects[this.CONTEXT_UID];let l=h[a];if(l)return h[o.id]=l,l;const u=t.buffers,c=t.attributes,d={},f={};for(const p in u)d[p]=0,f[p]=0;for(const p in c)!c[p].size&&o.attributeData[p]?c[p].size=o.attributeData[p].size:c[p].size,d[c[p].buffer]+=c[p].size*Hn[c[p].type];for(const p in c){const t=c[p],e=t.size;void 0===t.stride&&(d[t.buffer]===e*Hn[t.type]?t.stride=0:t.stride=d[t.buffer]),void 0===t.start&&(t.start=f[t.buffer],f[t.buffer]+=e*Hn[t.type])}l=r.createVertexArray(),r.bindVertexArray(l);for(let p=0;p<u.length;p++){const t=u[p];s.bind(t),n&&t._glBuffers[i].refCount++}return this.activateVao(t,o),h[o.id]=l,h[a]=l,r.bindVertexArray(null),s.unbind(x.ARRAY_BUFFER),l}disposeGeometry(t,e){if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const n=t.glVertexArrayObjects[this.CONTEXT_UID],r=this.gl,i=t.buffers,s=this.renderer?.buffer;if(t.disposeRunner.remove(this),n){if(s)for(let t=0;t<i.length;t++){const n=i[t]._glBuffers[this.CONTEXT_UID];n&&(n.refCount--,0!==n.refCount||e||s.dispose(i[t],e))}if(!e)for(const t in n)if("g"===t[0]){const e=n[t];this._activeVao===e&&this.unbind(),r.deleteVertexArray(e)}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const e=Object.keys(this.managedGeometries);for(let n=0;n<e.length;n++)this.disposeGeometry(this.managedGeometries[e[n]],t)}activateVao(t,e){const n=this.gl,r=this.CONTEXT_UID,i=this.renderer.buffer,s=t.buffers,o=t.attributes;t.indexBuffer&&i.bind(t.indexBuffer);let a=null;for(const h in o){const t=o[h],l=s[t.buffer],u=l._glBuffers[r];if(e.attributeData[h]){a!==u&&(i.bind(l),a=u);const r=e.attributeData[h].location;if(n.enableVertexAttribArray(r),n.vertexAttribPointer(r,t.size,t.type||n.FLOAT,t.normalized,t.stride,t.start),t.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");n.vertexAttribDivisor(r,t.divisor)}}}}draw(t,e,n,r){const{gl:i}=this,s=this._activeGeometry;if(s.indexBuffer){const o=s.indexBuffer.data.BYTES_PER_ELEMENT,a=2===o?i.UNSIGNED_SHORT:i.UNSIGNED_INT;(2===o||4===o&&this.canUseUInt32ElementIndex)&&(s.instanced?i.drawElementsInstanced(t,e||s.indexBuffer.data.length,a,(n||0)*o,r||1):i.drawElements(t,e||s.indexBuffer.data.length,a,(n||0)*o))}else s.instanced?i.drawArraysInstanced(t,n,e||s.getSize(),r||1):i.drawArrays(t,n,e||s.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}zn.extension={type:qt.RendererSystem,name:"geometry"},Zt.add(zn);const Wn=new Oe;class Vn{constructor(t,e){this._texture=t,this.mapCoord=new Oe,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=void 0===e?.5:e,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,e){void 0===e&&(e=t);const n=this.mapCoord;for(let r=0;r<t.length;r+=2){const i=t[r],s=t[r+1];e[r]=i*n.a+s*n.c+n.tx,e[r+1]=i*n.b+s*n.d+n.ty}return e}update(t){const e=this._texture;if(!e||!e.valid)return!1;if(!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;const n=e._uvs;this.mapCoord.set(n.x1-n.x0,n.y1-n.y0,n.x3-n.x0,n.y3-n.y0,n.x0,n.y0);const r=e.orig,i=e.trim;i&&(Wn.set(r.width/i.width,0,0,r.height/i.height,-i.x/i.width,-i.y/i.height),this.mapCoord.append(Wn));const s=e.baseTexture,o=this.uClampFrame,a=this.clampMargin/s.resolution,h=this.clampOffset;return o[0]=(e._frame.x+a+h)/s.width,o[1]=(e._frame.y+a+h)/s.height,o[2]=(e._frame.x+e._frame.width-a+h)/s.width,o[3]=(e._frame.y+e._frame.height-a+h)/s.height,this.uClampOffset[0]=h/s.realWidth,this.uClampOffset[1]=h/s.realHeight,this.isSimple=e._frame.width===s.width&&e._frame.height===s.height&&0===e.rotate,!0}}class Xn extends _n{constructor(t,e,n){let r=null;"string"!=typeof t&&void 0===e&&void 0===n&&(r=t,t=void 0,e=void 0,n=void 0),super(t||"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n",e||"varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n",n),this.maskSprite=r,this.maskMatrix=new Oe}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,e,n,r){const i=this._maskSprite,s=i._texture;s.valid&&(s.uvMatrix||(s.uvMatrix=new Vn(s,0)),s.uvMatrix.update(),this.uniforms.npmAlpha=s.baseTexture.alphaMode?0:1,this.uniforms.mask=s,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,i).prepend(s.uvMatrix.mapCoord),this.uniforms.alpha=i.worldAlpha,this.uniforms.maskClamp=s.uvMatrix.uClampFrame,t.applyFilter(this,e,n,r))}}class $n{constructor(t=null){this.type=v.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=_n.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=v.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class Yn{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,e){let n=e;if(!n.isMaskData){const t=this.maskDataPool.pop()||new $n;t.pooled=!0,t.maskObject=e,n=t}const r=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null;if(n.copyCountersOrReset(r),n._colorMask=r?r._colorMask:15,n.autoDetect&&this.detect(n),n._target=t,n.type!==v.SPRITE&&this.maskStack.push(n),n.enabled)switch(n.type){case v.SCISSOR:this.renderer.scissor.push(n);break;case v.STENCIL:this.renderer.stencil.push(n);break;case v.SPRITE:n.copyCountersOrReset(null),this.pushSpriteMask(n);break;case v.COLOR:this.pushColorMask(n)}n.type===v.SPRITE&&this.maskStack.push(n)}pop(t){const e=this.maskStack.pop();if(e&&e._target===t){if(e.enabled)switch(e.type){case v.SCISSOR:this.renderer.scissor.pop(e);break;case v.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case v.SPRITE:this.popSpriteMask(e);break;case v.COLOR:this.popColorMask(e)}if(e.reset(),e.pooled&&this.maskDataPool.push(e),0!==this.maskStack.length){const t=this.maskStack[this.maskStack.length-1];t.type===v.SPRITE&&t._filters&&(t._filters[0].maskSprite=t.maskObject)}}}detect(t){const e=t.maskObject;e?e.isSprite?t.type=v.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=v.SCISSOR:t.type=v.STENCIL:t.type=v.COLOR}pushSpriteMask(t){const{maskObject:e}=t,n=t._target;let r=t._filters;r||(r=this.alphaMaskPool[this.alphaMaskIndex],r||(r=this.alphaMaskPool[this.alphaMaskIndex]=[new Xn]));const i=this.renderer,s=i.renderTexture;let o,a;if(s.current){const e=s.current;o=t.resolution||e.resolution,a=t.multisample??e.multisample}else o=t.resolution||i.resolution,a=t.multisample??i.multisample;r[0].resolution=o,r[0].multisample=a,r[0].maskSprite=e;const h=n.filterArea;n.filterArea=e.getBounds(!0),i.filter.push(n,r),n.filterArea=h,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const e=t._colorMask,n=t._colorMask=e&t.colorMask;n!==e&&this.renderer.gl.colorMask(0!=(1&n),0!=(2&n),0!=(4&n),0!=(8&n))}popColorMask(t){const e=t._colorMask,n=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;n!==e&&this.renderer.gl.colorMask(0!=(1&n),0!=(2&n),0!=(4&n),0!=(8&n))}destroy(){this.renderer=null}}Yn.extension={type:qt.RendererSystem,name:"mask"},Zt.add(Yn);class qn{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:e}=this.renderer,n=this.getStackLength();this.maskStack=t;const r=this.getStackLength();r!==n&&(0===r?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const Kn=new Oe,Qn=[],Zn=class extends qn{constructor(t){super(t),this.glConst=w.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0}calcScissorRect(t){if(t._scissorRectLocal)return;const e=t._scissorRect,{maskObject:n}=t,{renderer:r}=this,i=r.renderTexture,s=n.getBounds(!0,Qn.pop()??new Ce);this.roundFrameToPixels(s,i.current?i.current.resolution:r.resolution,i.sourceFrame,i.destinationFrame,r.projection.transform),e&&s.fit(e),t._scissorRectLocal=s}static isMatrixRotated(t){if(!t)return!1;const{a:e,b:n,c:r,d:i}=t;return(Math.abs(n)>1e-4||Math.abs(r)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(i)>1e-4)}testScissor(t){const{maskObject:e}=t;if(!e.isFastRect||!e.isFastRect())return!1;if(Zn.isMatrixRotated(e.worldTransform))return!1;if(Zn.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);const n=t._scissorRectLocal;return n.width>0&&n.height>0}roundFrameToPixels(t,e,n,r,i){Zn.isMatrixRotated(i)||((i=i?Kn.copyFrom(i):Kn.identity()).translate(-n.x,-n.y).scale(r.width/n.width,r.height/n.height).translate(r.x,r.y),this.renderer.filter.transformAABB(i,t),t.fit(r),t.x=Math.round(t.x*e),t.y=Math.round(t.y*e),t.width=Math.round(t.width*e),t.height=Math.round(t.height*e))}push(t){t._scissorRectLocal||this.calcScissorRect(t);const{gl:e}=this.renderer;t._scissorRect||e.enable(e.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent()}pop(t){const{gl:e}=this.renderer;t&&Qn.push(t._scissorRectLocal),this.getStackLength()>0?this._useCurrent():e.disable(e.SCISSOR_TEST)}_useCurrent(){const t=this.maskStack[this.maskStack.length-1]._scissorRect;let e;e=this.renderer.renderTexture.current?t.y:this.renderer.height-t.height-t.y,this.renderer.gl.scissor(t.x,e,t.width,t.height)}};let Jn=Zn;Jn.extension={type:qt.RendererSystem,name:"scissor"},Zt.add(Jn);class tr extends qn{constructor(t){super(t),this.glConst=w.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const e=t.maskObject,{gl:n}=this.renderer,r=t._stencilCounter;0===r&&(this.renderer.framebuffer.forceStencil(),n.clearStencil(0),n.clear(n.STENCIL_BUFFER_BIT),n.enable(n.STENCIL_TEST)),t._stencilCounter++;const i=t._colorMask;0!==i&&(t._colorMask=0,n.colorMask(!1,!1,!1,!1)),n.stencilFunc(n.EQUAL,r,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,0!==i&&(t._colorMask=i,n.colorMask(0!=(1&i),0!=(2&i),0!=(4&i),0!=(8&i))),this._useCurrent()}pop(t){const e=this.renderer.gl;if(0===this.getStackLength())e.disable(e.STENCIL_TEST);else{const n=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null,r=n?n._colorMask:15;0!==r&&(n._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,0!==r&&(n._colorMask=r,e.colorMask(0!=(1&r),0!=(2&r),0!=(4&r),0!=(8&r))),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}tr.extension={type:qt.RendererSystem,name:"stencil"},Zt.add(tr);class er{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return K(0,"renderer.plugins.extract has moved to renderer.extract"),t.extract}},prepare:{enumerable:!1,get(){return K(0,"renderer.plugins.prepare has moved to renderer.prepare"),t.prepare}},interaction:{enumerable:!1,get(){return K(0,"renderer.plugins.interaction has been deprecated, use renderer.events"),t.events}}})}init(){const t=this.rendererPlugins;for(const e in t)this.plugins[e]=new t[e](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}er.extension={type:[qt.RendererSystem,qt.CanvasRendererSystem],name:"_plugin"},Zt.add(er);class nr{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Oe,this.transform=null}update(t,e,n,r){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,n,r),this.transform&&this.projectionMatrix.append(this.transform);const i=this.renderer;i.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,i.globalUniforms.update(),i.shader.shader&&i.shader.syncUniformGroup(i.shader.shader.uniforms.globals)}calculateProjection(t,e,n,r){const i=this.projectionMatrix,s=r?-1:1;i.identity(),i.a=1/e.width*2,i.d=s*(1/e.height*2),i.tx=-1-e.x*i.a,i.ty=-s-e.y*i.d}setTransform(t){}destroy(){this.renderer=null}}nr.extension={type:qt.RendererSystem,name:"projection"},Zt.add(nr);const rr=new ze;class ir{constructor(t){this.renderer=t,this._tempMatrix=new Oe}generateTexture(t,e){const{region:n,...r}=e||{},i=n||t.getLocalBounds(null,!0);0===i.width&&(i.width=1),0===i.height&&(i.height=1);const s=Mn.create({width:i.width,height:i.height,...r});this._tempMatrix.tx=-i.x,this._tempMatrix.ty=-i.y;const o=t.transform;return t.transform=rr,this.renderer.render(t,{renderTexture:s,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=o,s}destroy(){}}ir.extension={type:[qt.RendererSystem,qt.CanvasRendererSystem],name:"textureGenerator"},Zt.add(ir);const sr=new Ce,or=new Ce;class ar{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Ce,this.destinationFrame=new Ce,this.viewportFrame=new Ce}contextChange(){const t=this.renderer?.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}bind(t=null,e,n){const r=this.renderer;let i,s,o;this.current=t,t?(i=t.baseTexture,o=i.resolution,e||(sr.width=t.frame.width,sr.height=t.frame.height,e=sr),n||(or.x=t.frame.x,or.y=t.frame.y,or.width=e.width,or.height=e.height,n=or),s=i.framebuffer):(o=r.resolution,e||(sr.width=r._view.screen.width,sr.height=r._view.screen.height,e=sr),n||((n=sr).width=e.width,n.height=e.height));const a=this.viewportFrame;a.x=n.x*o,a.y=n.y*o,a.width=n.width*o,a.height=n.height*o,t||(a.y=r.view.height-(a.y+a.height)),a.ceil(),this.renderer.framebuffer.bind(s,a),this.renderer.projection.update(n,e,o,!s),t?this.renderer.mask.setMaskStack(i.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(n)}clear(t,e){const n=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,r=Ct.shared.setValue(t||n);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&r.premultiply(r.alpha);const i=this.destinationFrame,s=this.current?this.current.baseTexture:this.renderer._view.screen,o=i.width!==s.width||i.height!==s.height;if(o){let{x:t,y:e,width:n,height:r}=this.viewportFrame;t=Math.round(t),e=Math.round(e),n=Math.round(n),r=Math.round(r),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(t,e,n,r)}this.renderer.framebuffer.clear(r.red,r.green,r.blue,r.alpha,e),o&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}ar.extension={type:qt.RendererSystem,name:"renderTexture"},Zt.add(ar);class hr{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function lr(t,e,n){const r=t.createShader(e);return t.shaderSource(r,n),t.compileShader(r),r}function ur(t){const e=new Array(t);for(let n=0;n<e.length;n++)e[n]=!1;return e}function cr(t,e){switch(t){case"float":case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return ur(2*e);case"bvec3":return ur(3*e);case"bvec4":return ur(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}function dr(t,e){const n=t.getShaderSource(e).split("\n").map(((t,e)=>`${e}: ${t}`)),r=t.getShaderInfoLog(e).split("\n"),i={},s=r.map((t=>parseFloat(t.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1")))).filter((t=>!(!t||i[t])&&(i[t]=!0,!0))),o=[""];s.forEach((t=>{n[t-1]=`%c${n[t-1]}%c`,o.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")}));const a=n.join("\n");o[0]=a}function fr(t,e){const n=lr(t,t.VERTEX_SHADER,e.vertexSrc),r=lr(t,t.FRAGMENT_SHADER,e.fragmentSrc),i=t.createProgram();t.attachShader(i,n),t.attachShader(i,r);const s=e.extra?.transformFeedbackVaryings;if(s&&("function"!=typeof t.transformFeedbackVaryings||t.transformFeedbackVaryings(i,s.names,"separate"===s.bufferMode?t.SEPARATE_ATTRIBS:t.INTERLEAVED_ATTRIBS)),t.linkProgram(i),t.getProgramParameter(i,t.LINK_STATUS)||function(t,e,n,r){t.getProgramParameter(e,t.LINK_STATUS)||(t.getShaderParameter(n,t.COMPILE_STATUS)||dr(t,n),t.getShaderParameter(r,t.COMPILE_STATUS)||dr(t,r),t.getProgramInfoLog(e))}(t,i,n,r),e.attributeData=function(t,e){const n={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const r=e.getActiveAttrib(t,i);if(r.name.startsWith("gl_"))continue;const s=en(e,r.type),o={type:s,name:r.name,size:Ze(s),location:e.getAttribLocation(t,r.name)};n[r.name]=o}return n}(i,t),e.uniformData=function(t,e){const n={},r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<r;i++){const r=e.getActiveUniform(t,i),s=r.name.replace(/\[.*?\]$/,""),o=!!r.name.match(/\[.*?\]$/),a=en(e,r.type);n[s]={name:s,index:i,type:a,size:r.size,isArray:o,value:cr(a,r.size)}}return n}(i,t),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(e.vertexSrc)){const n=Object.keys(e.attributeData);n.sort(((t,e)=>t>e?1:-1));for(let r=0;r<n.length;r++)e.attributeData[n[r]].location=r,t.bindAttribLocation(i,r,n[r]);t.linkProgram(i)}t.deleteShader(n),t.deleteShader(r);const o={};for(const a in e.uniformData){const n=e.uniformData[a];o[a]={location:t.getUniformLocation(i,a),value:cr(n.type,n.size)}}return new hr(i,o)}function pr(t,e,n,r,i){n.buffer.update(i)}const mr={float:"\n        data[offset] = v;\n    ",vec2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n    ",vec3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n    ",vec4:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n        data[offset+3] = v[3];\n    ",mat2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n\n        data[offset+4] = v[2];\n        data[offset+5] = v[3];\n    ",mat3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n        data[offset + 4] = v[3];\n        data[offset + 5] = v[4];\n        data[offset + 6] = v[5];\n\n        data[offset + 8] = v[6];\n        data[offset + 9] = v[7];\n        data[offset + 10] = v[8];\n    ",mat4:"\n        for(var i = 0; i < 16; i++)\n        {\n            data[offset + i] = v[i];\n        }\n    "},gr={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:32,mat3:48,mat4:64};function _r(t,e){if(!t.autoManage)return{size:0,syncFunc:pr};const n=function(t,e){const n=[];for(const r in t)e[r]&&n.push(e[r]);return n.sort(((t,e)=>t.index-e.index)),n}(t.uniforms,e),{uboElements:r,size:i}=function(t){const e=t.map((t=>({data:t,offset:0,dataLen:0,dirty:0})));let n=0,r=0,i=0;for(let s=0;s<e.length;s++){const t=e[s];if(n=gr[t.data.type],t.data.size>1&&(n=Math.max(n,16)*t.data.size),t.dataLen=n,r%n!=0&&r<16){const t=r%n%16;r+=t,i+=t}r+n>16?(i=16*Math.ceil(i/16),t.offset=i,i+=n,r=n):(t.offset=i,r+=n,i+=n)}return i=16*Math.ceil(i/16),{uboElements:e,size:i}}(n),s=["\n    var v = null;\n    var v2 = null;\n    var cv = null;\n    var t = 0;\n    var gl = renderer.gl\n    var index = 0;\n    var data = buffer.data;\n    "];for(let o=0;o<r.length;o++){const e=r[o],n=t.uniforms[e.data.name],i=e.data.name;let a=!1;for(let t=0;t<We.length;t++){const r=We[t];if(r.codeUbo&&r.test(e.data,n)){s.push(`offset = ${e.offset/4};`,We[t].codeUbo(e.data.name,n)),a=!0;break}}if(!a)if(e.data.size>1){const t=Ze(e.data.type),n=Math.max(gr[e.data.type]/16,1),r=t/n,o=(4-r%4)%4;s.push(`\n                cv = ud.${i}.value;\n                v = uv.${i};\n                offset = ${e.offset/4};\n\n                t = 0;\n\n                for(var i=0; i < ${e.data.size*n}; i++)\n                {\n                    for(var j = 0; j < ${r}; j++)\n                    {\n                        data[offset++] = v[t++];\n                    }\n                    offset += ${o};\n                }\n\n                `)}else{const t=mr[e.data.type];s.push(`\n                cv = ud.${i}.value;\n                v = uv.${i};\n                offset = ${e.offset/4};\n                ${t};\n                `)}}return s.push("\n       renderer.buffer.update(buffer);\n    "),{size:i,syncFunc:new Function("ud","uv","renderer","syncData","buffer",s.join("\n"))}}let yr;let vr=0;const br={textureCount:0,uboCount:0};class xr{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=vr++}systemCheck(){if(!function(){if("boolean"==typeof yr)return yr;try{const t=new Function("param1","param2","param3","return param1[param2] === param3;");yr=!0===t({a:"b"},"a","b")}catch(et){yr=!1}return yr}())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const n=t.program,r=n.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==n&&(this.program=n,this.gl.useProgram(r.program)),e||(br.textureCount=0,br.uboCount=0,this.syncUniformGroup(t.uniformGroup,br)),r}setUniforms(t){const e=this.shader.program,n=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(n.uniformData,t,this.renderer)}syncUniformGroup(t,e){const n=this.getGlProgram();t["static"]&&t.dirtyId===n.uniformDirtyGroups[t.id]||(n.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,n,e))}syncUniforms(t,e,n){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,n)}createSyncGroups(t){const e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=function(t,e){const n=["\n        var v = null;\n        var cv = null;\n        var cu = null;\n        var t = 0;\n        var gl = renderer.gl;\n    "];for(const r in t.uniforms){const i=e[r];if(!i){t.uniforms[r]?.group&&(t.uniforms[r].ubo?n.push(`\n                        renderer.shader.syncUniformBufferGroup(uv.${r}, '${r}');\n                    `):n.push(`\n                        renderer.shader.syncUniformGroup(uv.${r}, syncData);\n                    `));continue}const s=t.uniforms[r];let o=!1;for(let t=0;t<We.length;t++)if(We[t].test(i,s)){n.push(We[t].code(r,s)),o=!0;break}if(!o){const t=(1!==i.size||i.isArray?Xe:Ve)[i.type].replace("location",`ud["${r}"].location`);n.push(`\n            cu = ud["${r}"];\n            cv = cu.value;\n            v = uv["${r}"];\n            ${t};`)}}return new Function("ud","uv","renderer","syncData",n.join("\n"))}(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,e){const n=this.getGlProgram();if(!t["static"]||0!==t.dirtyId||!n.uniformGroups[t.id]){t.dirtyId=0;const r=n.uniformGroups[t.id]||this.createSyncBufferGroup(t,n,e);t.buffer.update(),r(n.uniformData,t.uniforms,this.renderer,br,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,n.uniformBufferBindings[e])}createSyncBufferGroup(t,e,n){const{gl:r}=this.renderer;this.renderer.buffer.bind(t.buffer);const i=this.gl.getUniformBlockIndex(e.program,n);e.uniformBufferBindings[n]=this.shader.uniformBindCount,r.uniformBlockBinding(e.program,i,this.shader.uniformBindCount),this.shader.uniformBindCount++;const s=this.getSignature(t,this.shader.program.uniformData,"ubo");let o=this._uboCache[s];if(o||(o=this._uboCache[s]=_r(t,this.shader.program.uniformData)),t.autoManage){const e=new Float32Array(o.size/4);t.buffer.update(e)}return e.uniformGroups[t.id]=o.syncFunc,e.uniformGroups[t.id]}getSignature(t,e,n){const r=t.uniforms,i=[`${n}-`];for(const s in r)i.push(s),e[s]&&i.push(e[s].type);return i.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const e=this.gl,n=t.program,r=fr(e,n);return n.glPrograms[this.renderer.CONTEXT_UID]=r,r}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}xr.extension={type:qt.RendererSystem,name:"shader"},Zt.add(xr);class Er{constructor(t){this.renderer=t}run(t){const{renderer:e}=this;e.runners.init.emit(e.options),t.hello,e.resize(e.screen.width,e.screen.height)}destroy(){}}Er.defaultOptions={hello:!1},Er.extension={type:[qt.RendererSystem,qt.CanvasRendererSystem],name:"startup"},Zt.add(Er);const wr=class{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=o.NONE,this._blendEq=!1,this.map=[],this.map[0]=this.setBlend,this.map[1]=this.setOffset,this.map[2]=this.setCullFace,this.map[3]=this.setDepthTest,this.map[4]=this.setFrontFace,this.map[5]=this.setDepthMask,this.checks=[],this.defaultState=new ne,this.defaultState.blend=!0}contextChange(t){this.gl=t,this.blendModes=function(t,e=[]){return e[o.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[o.ADD]=[t.ONE,t.ONE],e[o.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[o.SCREEN]=[t.ONE,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[o.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[o.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[o.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[o.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[o.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[o.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[o.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[o.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[o.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[o.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[o.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[o.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[o.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[o.NONE]=[0,0],e[o.NORMAL_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[o.ADD_NPM]=[t.SRC_ALPHA,t.ONE,t.ONE,t.ONE],e[o.SCREEN_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[o.SRC_IN]=[t.DST_ALPHA,t.ZERO],e[o.SRC_OUT]=[t.ONE_MINUS_DST_ALPHA,t.ZERO],e[o.SRC_ATOP]=[t.DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[o.DST_OVER]=[t.ONE_MINUS_DST_ALPHA,t.ONE],e[o.DST_IN]=[t.ZERO,t.SRC_ALPHA],e[o.DST_OUT]=[t.ZERO,t.ONE_MINUS_SRC_ALPHA],e[o.DST_ATOP]=[t.ONE_MINUS_DST_ALPHA,t.SRC_ALPHA],e[o.XOR]=[t.ONE_MINUS_DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[o.SUBTRACT]=[t.ONE,t.ONE,t.ONE,t.ONE,t.FUNC_REVERSE_SUBTRACT,t.FUNC_ADD],e}(t),this.set(this.defaultState),this.reset()}set(t){if(t=t||this.defaultState,this.stateId!==t.data){let e=this.stateId^t.data,n=0;for(;e;)1&e&&this.map[n].call(this,!!(t.data&1<<n)),e>>=1,n++;this.stateId=t.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,t)}forceState(t){t=t||this.defaultState;for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data}setBlend(t){this.updateCheck(wr.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)}setOffset(t){this.updateCheck(wr.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])}setBlendMode(t){if(t===this.blendMode)return;this.blendMode=t;const e=this.blendModes[t],n=this.gl;2===e.length?n.blendFunc(e[0],e[1]):n.blendFuncSeparate(e[0],e[1],e[2],e[3]),6===e.length?(this._blendEq=!0,n.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,n.blendEquationSeparate(n.FUNC_ADD,n.FUNC_ADD))}setPolygonOffset(t,e){this.gl.polygonOffset(t,e)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(t,e){const n=this.checks.indexOf(t);e&&-1===n?this.checks.push(t):e||-1===n||this.checks.splice(n,1)}static checkBlendMode(t,e){t.setBlendMode(e.blendMode)}static checkPolygonOffset(t,e){t.setPolygonOffset(1,e.polygonOffset)}destroy(){this.gl=null}};let Tr=wr;Tr.extension={type:qt.RendererSystem,name:"state"},Zt.add(Tr);class Sr extends H{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);const e=(t.priority??[]).filter((e=>t.systems[e])),n=[...e,...Object.keys(t.systems).filter((t=>!e.includes(t)))];for(const r of n)this.addSystem(t.systems[r],r)}addRunners(...t){t.forEach((t=>{this.runners[t]=new se(t)}))}addSystem(t,e){const n=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=n,this._systemsHash[e]=n;for(const r in this.runners)this.runners[r].add(n);return this}emitWithCustomOptions(t,e){const n=Object.keys(this._systemsHash);t.items.forEach((r=>{const i=n.find((t=>this._systemsHash[t]===r));r[t.name](e[i])}))}destroy(){Object.values(this.runners).forEach((t=>{t.destroy()})),this._systemsHash={}}}const Ar=class{constructor(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=Ar.defaultMaxIdle,this.checkCountMax=Ar.defaultCheckCountMax,this.mode=Ar.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==_.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const t=this.renderer.texture,e=t.managedTextures;let n=!1;for(let r=0;r<e.length;r++){const i=e[r];!i.framebuffer&&this.count-i.touched>this.maxIdle&&(t.destroyTexture(i,!0),e[r]=null,n=!0)}if(n){let t=0;for(let n=0;n<e.length;n++)null!==e[n]&&(e[t++]=e[n]);e.length=t}}unload(t){const e=this.renderer.texture,n=t._texture;n&&!n.framebuffer&&e.destroyTexture(n);for(let r=t.children.length-1;r>=0;r--)this.unload(t.children[r])}destroy(){this.renderer=null}};let Cr=Ar;Cr.defaultMode=_.AUTO,Cr.defaultMaxIdle=3600,Cr.defaultCheckCountMax=600,Cr.extension={type:qt.RendererSystem,name:"textureGC"},Zt.add(Cr);class Ir{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=u.UNSIGNED_BYTE,this.internalFormat=h.RGBA,this.samplerType=0}}class Rr{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new ue,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=function(t){let e;return e="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext?{[u.UNSIGNED_BYTE]:{[h.RGBA]:t.RGBA8,[h.RGB]:t.RGB8,[h.RG]:t.RG8,[h.RED]:t.R8,[h.RGBA_INTEGER]:t.RGBA8UI,[h.RGB_INTEGER]:t.RGB8UI,[h.RG_INTEGER]:t.RG8UI,[h.RED_INTEGER]:t.R8UI,[h.ALPHA]:t.ALPHA,[h.LUMINANCE]:t.LUMINANCE,[h.LUMINANCE_ALPHA]:t.LUMINANCE_ALPHA},[u.BYTE]:{[h.RGBA]:t.RGBA8_SNORM,[h.RGB]:t.RGB8_SNORM,[h.RG]:t.RG8_SNORM,[h.RED]:t.R8_SNORM,[h.RGBA_INTEGER]:t.RGBA8I,[h.RGB_INTEGER]:t.RGB8I,[h.RG_INTEGER]:t.RG8I,[h.RED_INTEGER]:t.R8I},[u.UNSIGNED_SHORT]:{[h.RGBA_INTEGER]:t.RGBA16UI,[h.RGB_INTEGER]:t.RGB16UI,[h.RG_INTEGER]:t.RG16UI,[h.RED_INTEGER]:t.R16UI,[h.DEPTH_COMPONENT]:t.DEPTH_COMPONENT16},[u.SHORT]:{[h.RGBA_INTEGER]:t.RGBA16I,[h.RGB_INTEGER]:t.RGB16I,[h.RG_INTEGER]:t.RG16I,[h.RED_INTEGER]:t.R16I},[u.UNSIGNED_INT]:{[h.RGBA_INTEGER]:t.RGBA32UI,[h.RGB_INTEGER]:t.RGB32UI,[h.RG_INTEGER]:t.RG32UI,[h.RED_INTEGER]:t.R32UI,[h.DEPTH_COMPONENT]:t.DEPTH_COMPONENT24},[u.INT]:{[h.RGBA_INTEGER]:t.RGBA32I,[h.RGB_INTEGER]:t.RGB32I,[h.RG_INTEGER]:t.RG32I,[h.RED_INTEGER]:t.R32I},[u.FLOAT]:{[h.RGBA]:t.RGBA32F,[h.RGB]:t.RGB32F,[h.RG]:t.RG32F,[h.RED]:t.R32F,[h.DEPTH_COMPONENT]:t.DEPTH_COMPONENT32F},[u.HALF_FLOAT]:{[h.RGBA]:t.RGBA16F,[h.RGB]:t.RGB16F,[h.RG]:t.RG16F,[h.RED]:t.R16F},[u.UNSIGNED_SHORT_5_6_5]:{[h.RGB]:t.RGB565},[u.UNSIGNED_SHORT_4_4_4_4]:{[h.RGBA]:t.RGBA4},[u.UNSIGNED_SHORT_5_5_5_1]:{[h.RGBA]:t.RGB5_A1},[u.UNSIGNED_INT_2_10_10_10_REV]:{[h.RGBA]:t.RGB10_A2,[h.RGBA_INTEGER]:t.RGB10_A2UI},[u.UNSIGNED_INT_10F_11F_11F_REV]:{[h.RGB]:t.R11F_G11F_B10F},[u.UNSIGNED_INT_5_9_9_9_REV]:{[h.RGB]:t.RGB9_E5},[u.UNSIGNED_INT_24_8]:{[h.DEPTH_STENCIL]:t.DEPTH24_STENCIL8},[u.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[h.DEPTH_STENCIL]:t.DEPTH32F_STENCIL8}}:{[u.UNSIGNED_BYTE]:{[h.RGBA]:t.RGBA,[h.RGB]:t.RGB,[h.ALPHA]:t.ALPHA,[h.LUMINANCE]:t.LUMINANCE,[h.LUMINANCE_ALPHA]:t.LUMINANCE_ALPHA},[u.UNSIGNED_SHORT_5_6_5]:{[h.RGB]:t.RGB},[u.UNSIGNED_SHORT_4_4_4_4]:{[h.RGBA]:t.RGBA},[u.UNSIGNED_SHORT_5_5_5_1]:{[h.RGBA]:t.RGBA}},e}(t);const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(let r=0;r<e;r++)this.boundTextures[r]=null;this.emptyTextures={};const n=new Ir(t.createTexture());t.bindTexture(t.TEXTURE_2D,n.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=n,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new Ir(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let r=0;r<6;r++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let r=0;r<this.boundTextures.length;r++)this.bind(null,r)}bind(t,e=0){const{gl:n}=this;if(t=t?.castToBaseTexture(),t?.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const r=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,n.activeTexture(n.TEXTURE0+e)),n.bindTexture(t.target,r.texture)),r.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,n.activeTexture(n.TEXTURE0+e)),this.updateTexture(t)):r.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,n.activeTexture(n.TEXTURE0+e)),n.bindTexture(n.TEXTURE_2D,this.emptyTextures[n.TEXTURE_2D].texture),this.boundTextures[e]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:e,boundTextures:n}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let t=0;t<n.length;t++)n[t]===this.unknownTexture&&this.bind(null,t)}for(let r=0;r<n.length;r++)n[r]===t&&(this.currentLocation!==r&&(e.activeTexture(e.TEXTURE0+r),this.currentLocation=r),e.bindTexture(t.target,this.emptyTextures[t.target].texture),n[r]=null)}ensureSamplerType(t){const{boundTextures:e,hasIntegerTextures:n,CONTEXT_UID:r}=this;if(n)for(let i=t-1;i>=0;--i){const t=e[i];if(t){t._glTextures[r].samplerType!==c.FLOAT&&this.renderer.texture.unbind(t)}}}initTexture(t){const e=new Ir(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e}initTextureType(t,e){e.internalFormat=this.internalFormats[t.type]?.[t.format]??t.format,2===this.webGLVersion&&t.type===u.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type}updateTexture(t){const e=t._glTextures[this.CONTEXT_UID];if(!e)return;const n=this.renderer;if(this.initTextureType(t,e),t.resource?.upload(n,t,e))e.samplerType!==c.FLOAT&&(this.hasIntegerTextures=!0);else{const r=t.realWidth,i=t.realHeight,s=n.gl;(e.width!==r||e.height!==i||e.dirtyId<0)&&(e.width=r,e.height=i,s.texImage2D(t.target,0,e.internalFormat,r,i,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}destroyTexture(t,e){const{gl:n}=this;if((t=t.castToBaseTexture())._glTextures[this.CONTEXT_UID]&&(this.unbind(t),n.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){const e=this.managedTextures.indexOf(t);-1!==e&&Nt(this.managedTextures,e,1)}}updateTextureStyle(t){const e=t._glTextures[this.CONTEXT_UID];e&&(t.mipmap!==p.POW2&&2===this.webGLVersion||t.isPowerOfTwo?e.mipmap=t.mipmap>=1:e.mipmap=!1,2===this.webGLVersion||t.isPowerOfTwo?e.wrapMode=t.wrapMode:e.wrapMode=f.CLAMP,t.resource?.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)}setStyle(t,e){const n=this.gl;if(e.mipmap&&t.mipmap!==p.ON_MANUAL&&n.generateMipmap(t.target),n.texParameteri(t.target,n.TEXTURE_WRAP_S,e.wrapMode),n.texParameteri(t.target,n.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){n.texParameteri(t.target,n.TEXTURE_MIN_FILTER,t.scaleMode===d.LINEAR?n.LINEAR_MIPMAP_LINEAR:n.NEAREST_MIPMAP_NEAREST);const e=this.renderer.context.extensions.anisotropicFiltering;if(e&&t.anisotropicLevel>0&&t.scaleMode===d.LINEAR){const r=Math.min(t.anisotropicLevel,n.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT));n.texParameterf(t.target,e.TEXTURE_MAX_ANISOTROPY_EXT,r)}}else n.texParameteri(t.target,n.TEXTURE_MIN_FILTER,t.scaleMode===d.LINEAR?n.LINEAR:n.NEAREST);n.texParameteri(t.target,n.TEXTURE_MAG_FILTER,t.scaleMode===d.LINEAR?n.LINEAR:n.NEAREST)}destroy(){this.renderer=null}}Rr.extension={type:qt.RendererSystem,name:"texture"},Zt.add(Rr);class Pr{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:n}=this,r=t._glTransformFeedbacks[n]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,r)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,e){const{gl:n,renderer:r}=this;e&&r.shader.bind(e),n.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:e,renderer:n,CONTEXT_UID:r}=this,i=e.createTransformFeedback();t._glTransformFeedbacks[r]=i,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,i);for(let s=0;s<t.buffers.length;s++){const i=t.buffers[s];i&&(n.buffer.update(i),i._glBuffers[r].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,s,i._glBuffers[r].buffer||null))}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),i}disposeTransformFeedback(t,e){const n=t._glTransformFeedbacks[this.CONTEXT_UID],r=this.gl;t.disposeRunner.remove(this);const i=this.renderer.buffer;if(i)for(let s=0;s<t.buffers.length;s++){const n=t.buffers[s];if(!n)continue;const r=n._glBuffers[this.CONTEXT_UID];r&&(r.refCount--,0!==r.refCount||e||i.dispose(n,e))}n&&(e||r.deleteTransformFeedback(n),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}Pr.extension={type:qt.RendererSystem,name:"transformFeedback"},Zt.add(Pr);class Mr{constructor(t){this.renderer=t}init(t){this.screen=new Ce(0,0,t.width,t.height),this.element=t.view||w.ADAPTER.createCanvas(),this.resolution=t.resolution||w.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);const n=this.element.width/this.resolution,r=this.element.height/this.resolution;this.screen.width=n,this.screen.height=r,this.autoDensity&&(this.element.style.width=`${n}px`,this.element.style.height=`${r}px`),this.renderer.emit("resize",n,r),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){t&&this.element.parentNode?.removeChild(this.element),this.renderer=null,this.element=null,this.screen=null}}Mr.defaultOptions={width:800,height:600,resolution:w.RESOLUTION,autoDensity:!1},Mr.extension={type:[qt.RendererSystem,qt.CanvasRendererSystem],name:"_view"},Zt.add(Mr),w.PREFER_ENV=e.WEBGL2,w.STRICT_TEXTURE_CACHE=!1,w.RENDER_OPTIONS={...xn.defaultOptions,...yn.defaultOptions,...Mr.defaultOptions,...Er.defaultOptions},Object.defineProperties(w,{WRAP_MODE:{get(){return ue.defaultOptions.wrapMode},set(t){K(0,"settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),ue.defaultOptions.wrapMode=t}},SCALE_MODE:{get(){return ue.defaultOptions.scaleMode},set(t){K(0,"settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),ue.defaultOptions.scaleMode=t}},MIPMAP_TEXTURES:{get(){return ue.defaultOptions.mipmap},set(t){K(0,"settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),ue.defaultOptions.mipmap=t}},ANISOTROPIC_LEVEL:{get(){return ue.defaultOptions.anisotropicLevel},set(t){K(0,"settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),ue.defaultOptions.anisotropicLevel=t}},FILTER_RESOLUTION:{get(){return K(0,"settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),_n.defaultResolution},set(t){_n.defaultResolution=t}},FILTER_MULTISAMPLE:{get(){return K(0,"settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),_n.defaultMultisample},set(t){_n.defaultMultisample=t}},SPRITE_MAX_TEXTURES:{get(){return mn.defaultMaxTextures},set(t){K(0,"settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),mn.defaultMaxTextures=t}},SPRITE_BATCH_SIZE:{get(){return mn.defaultBatchSize},set(t){K(0,"settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),mn.defaultBatchSize=t}},CAN_UPLOAD_SAME_BUFFER:{get(){return mn.canUploadSameBuffer},set(t){K(0,"settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),mn.canUploadSameBuffer=t}},GC_MODE:{get(){return Cr.defaultMode},set(t){K(0,"settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),Cr.defaultMode=t}},GC_MAX_IDLE:{get(){return Cr.defaultMaxIdle},set(t){K(0,"settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),Cr.defaultMaxIdle=t}},GC_MAX_CHECK_COUNT:{get(){return Cr.defaultCheckCountMax},set(t){K(0,"settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),Cr.defaultCheckCountMax=t}},PRECISION_VERTEX:{get(){return an.defaultVertexPrecision},set(t){K(0,"settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),an.defaultVertexPrecision=t}},PRECISION_FRAGMENT:{get(){return an.defaultFragmentPrecision},set(t){K(0,"settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),an.defaultFragmentPrecision=t}}});var Or=(t=>(t[t.INTERACTION=50]="INTERACTION",t[t.HIGH=25]="HIGH",t[t.NORMAL=0]="NORMAL",t[t.LOW=-25]="LOW",t[t.UTILITY=-50]="UTILITY",t))(Or||{});class Dr{constructor(t,e=null,n=0,r=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=n,this.once=r}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}const Nr=class{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new Dr(null,null,Infinity),this.deltaMS=1/Nr.targetFPMS,this.elapsedMS=1/Nr.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&null===this._requestId&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,n=Or.NORMAL){return this._addListener(new Dr(t,e,n))}addOnce(t,e,n=Or.NORMAL){return this._addListener(new Dr(t,e,n,!0))}_addListener(t){let e=this._head.next,n=this._head;if(e){for(;e;){if(t.priority>e.priority){t.connect(n);break}n=e,e=e.next}t.previous||t.connect(n)}else t.connect(n);return this._startIfPossible(),this}remove(t,e){let n=this._head.next;for(;n;)n=n.match(t,e)?n.destroy():n.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){const e=t-this._lastFrame|0;if(e<this._minElapsedMS)return;this._lastFrame=t-e%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*Nr.targetFPMS;const n=this._head;let r=n.next;for(;r;)r=r.emit(this.deltaTime);n.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const e=Math.min(this.maxFPS,t),n=Math.min(Math.max(0,e)/1e3,Nr.targetFPMS);this._maxElapsedMS=1/n}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(0===t)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!Nr._shared){const t=Nr._shared=new Nr;t.autoStart=!0,t._protected=!0}return Nr._shared}static get system(){if(!Nr._system){const t=Nr._system=new Nr;t.autoStart=!0,t._protected=!0}return Nr._system}};let kr=Nr;kr.targetFPMS=.06,Object.defineProperties(w,{TARGET_FPMS:{get(){return kr.targetFPMS},set(t){K(0,"settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),kr.targetFPMS=t}}});class Lr{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(t){this._ticker&&this._ticker.remove(this.render,this),this._ticker=t,t&&t.add(this.render,this,Or.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?kr.shared:new kr,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}Lr.extension=qt.Application,Zt.add(Lr);const Fr=[];function Br(t){for(const e of Fr)if(e.test(t))return new e(t);throw new Error("Unable to auto-detect a suitable renderer.")}Zt.handleByList(qt.Renderer,Fr);const Ur="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n";class jr{constructor(t){this.renderer=t}contextChange(t){let e;if(1===this.renderer.context.webGLVersion){const n=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,n)}else{const n=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,n)}e>=b.HIGH?this.multisample=b.HIGH:e>=b.MEDIUM?this.multisample=b.MEDIUM:e>=b.LOW?this.multisample=b.LOW:this.multisample=b.NONE}destroy(){}}jr.extension={type:qt.RendererSystem,name:"_multisample"},Zt.add(jr);class Gr{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class Hr{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:n}=this,r=t._glBuffers[n]||this.createGLBuffer(t);e.bindBuffer(t.type,r.buffer)}unbind(t){const{gl:e}=this;e.bindBuffer(t,null)}bindBufferBase(t,e){const{gl:n,CONTEXT_UID:r}=this;if(this.boundBufferBases[e]!==t){const i=t._glBuffers[r]||this.createGLBuffer(t);this.boundBufferBases[e]=t,n.bindBufferBase(n.UNIFORM_BUFFER,e,i.buffer)}}bindBufferRange(t,e,n){const{gl:r,CONTEXT_UID:i}=this;n=n||0;const s=t._glBuffers[i]||this.createGLBuffer(t);r.bindBufferRange(r.UNIFORM_BUFFER,e||0,s.buffer,256*n,256)}update(t){const{gl:e,CONTEXT_UID:n}=this,r=t._glBuffers[n]||this.createGLBuffer(t);if(t._updateID!==r.updateID)if(r.updateID=t._updateID,e.bindBuffer(t.type,r.buffer),r.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{const n=t["static"]?e.STATIC_DRAW:e.DYNAMIC_DRAW;r.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,n)}}dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const n=t._glBuffers[this.CONTEXT_UID],r=this.gl;t.disposeRunner.remove(this),n&&(e||r.deleteBuffer(n.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const e=Object.keys(this.managedBuffers);for(let n=0;n<e.length;n++)this.dispose(this.managedBuffers[e[n]],t)}createGLBuffer(t){const{CONTEXT_UID:e,gl:n}=this;return t._glBuffers[e]=new Gr(n.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]}}Hr.extension={type:qt.RendererSystem,name:"buffer"},Zt.add(Hr);class zr{constructor(t){this.renderer=t}render(t,e){const n=this.renderer;let r,i,s,o;if(e&&(r=e.renderTexture,i=e.clear,s=e.transform,o=e.skipUpdateTransform),this.renderingToScreen=!r,n.runners.prerender.emit(),n.emit("prerender"),n.projection.transform=s,!n.context.isLost){if(r||(this.lastObjectRendered=t),!o){const e=t.enableTempParent();t.updateTransform(),t.disableTempParent(e)}n.renderTexture.bind(r),n.batch.currentRenderer.start(),(i??n.background.clearBeforeRender)&&n.renderTexture.clear(),t.render(n),n.batch.currentRenderer.flush(),r&&(e.blit&&n.framebuffer.blit(),r.baseTexture.update()),n.runners.postrender.emit(),n.projection.transform=null,n.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}zr.extension={type:qt.RendererSystem,name:"objectRenderer"},Zt.add(zr);const Wr=class extends Sr{constructor(t){super(),this.type=i.WEBGL,t=Object.assign({},w.RENDER_OPTIONS,t),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new ln({projectionMatrix:new Oe},!0);const e={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:Wr.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(e),"useContextAlpha"in t&&(K(0,"options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),t.premultipliedAlpha=t.useContextAlpha&&"notMultiplied"!==t.useContextAlpha,t.backgroundAlpha=!1===t.useContextAlpha?1:t.backgroundAlpha),this._plugin.rendererPlugins=Wr.__plugins,this.options=t,this.startup.run(this.options)}static test(t){return!t?.forceCanvas&&(void 0===Q&&(Q=function(){const t={stencil:!0,failIfMajorPerformanceCaveat:w.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!w.ADAPTER.getWebGLRenderingContext())return!1;const e=w.ADAPTER.createCanvas();let n=e.getContext("webgl",t)||e.getContext("experimental-webgl",t);const r=!!n?.getContextAttributes()?.stencil;if(n){const t=n.getExtension("WEBGL_lose_context");t&&t.loseContext()}return n=null,r}catch(et){return!1}}()),Q)}render(t,e){this.objectRenderer.render(t,e)}resize(t,e){this._view.resizeView(t,e)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(t=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:t}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(t){this._view.resolution=t,this.runners.resolutionChange.emit(t)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return K(0,"renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return K(0,"renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return K(0,"renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return K(0,"renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(t){K(0,"renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=t}get backgroundAlpha(){return K(0,"renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(t){K(0,"renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=t}get powerPreference(){return K(0,"renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(t,e){return this.textureGenerator.generateTexture(t,e)}};let Vr=Wr;Vr.extension={type:qt.Renderer,priority:1},Vr.__plugins={},Vr.__systems={},Zt.handleByMap(qt.RendererPlugin,Vr.__plugins),Zt.handleByMap(qt.RendererSystem,Vr.__systems),Zt.add(Vr);class Xr extends oe{constructor(t,e){const{width:n,height:r}=e||{};super(n,r),this.items=[],this.itemDirtyIds=[];for(let i=0;i<t;i++){const t=new ue;this.items.push(t),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,e){for(let n=0;n<this.length;n++)t[n]&&(t[n].castToBaseTexture?this.addBaseTextureAt(t[n].castToBaseTexture(),n):t[n]instanceof oe?this.addResourceAt(t[n],n):this.addResourceAt(ie(t[n],e),n))}dispose(){for(let t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,e){if(!this.items[e])throw new Error(`Index ${e} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this}bind(t){if(null!==this.baseTexture)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)}unbind(t){super.unbind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)}load(){if(this._load)return this._load;const t=this.items.map((t=>t.resource)).filter((t=>t)).map((t=>t.load()));return this._load=Promise.all(t).then((()=>{const{realWidth:t,realHeight:e}=this.items[0];return this.resize(t,e),Promise.resolve(this)})),this._load}}const $r=class extends Xr{constructor(t,e){const{width:n,height:r,autoLoad:i,linkBaseTexture:s}=e||{};if(t&&t.length!==$r.SIDES)throw new Error(`Invalid length. Got ${t.length}, expected 6`);super(6,{width:n,height:r});for(let o=0;o<$r.SIDES;o++)this.items[o].target=l.TEXTURE_CUBE_MAP_POSITIVE_X+o;this.linkBaseTexture=!1!==s,t&&this.initFromArray(t,e),!1!==i&&this.load()}bind(t){super.bind(t),t.target=l.TEXTURE_CUBE_MAP}addBaseTextureAt(t,e,n){if(void 0===n&&(n=this.linkBaseTexture),!this.items[e])throw new Error(`Index ${e} is out of bounds`);if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0){if(!t.resource)throw new Error("CubeResource does not support copying of renderTexture.");this.addResourceAt(t.resource,e)}else t.target=l.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this}upload(t,e,n){const r=this.itemDirtyIds;for(let i=0;i<$r.SIDES;i++){const s=this.items[i];(r[i]<s.dirtyId||n.dirtyId<e.dirtyId)&&(s.valid&&s.resource?(s.resource.upload(t,s,n),r[i]=s.dirtyId):r[i]<-1&&(t.gl.texImage2D(s.target,0,n.internalFormat,e.realWidth,e.realHeight,0,e.format,n.type,null),r[i]=-1))}return!0}static test(t){return Array.isArray(t)&&t.length===$r.SIDES}};let Yr=$r;Yr.SIDES=6;class qr extends Sn{constructor(t,e){let n,r;e=e||{},"string"==typeof t?(n=qr.EMPTY,r=t):(n=t,r=null),super(n),this.url=r,this.crossOrigin=e.crossOrigin??!0,this.alphaMode="number"==typeof e.alphaMode?e.alphaMode:null,this._load=null,!1!==e.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise((async(t,e)=>{if(null!==this.url)try{const e=await w.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const n=await e.blob();if(this.destroyed)return;const r=await createImageBitmap(n,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===m.UNPACK?"premultiply":"none"});if(this.destroyed)return;this.source=r,this.update(),t(this)}catch(et){if(this.destroyed)return;e(et),this.onError.emit(et)}else t(this)}))),this._load}upload(t,e,n){return this.source instanceof ImageBitmap?("number"==typeof this.alphaMode&&(e.alphaMode=this.alphaMode),super.upload(t,e,n)):(this.load(),!1)}dispose(){this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&"undefined"!=typeof ImageBitmap&&("string"==typeof t||t instanceof ImageBitmap)}static get EMPTY(){return qr._EMPTY=qr._EMPTY??w.ADAPTER.createCanvas(0,0),qr._EMPTY}}const Kr=class extends Sn{constructor(t,e){e=e||{},super(w.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=t,this.scale=e.scale||1,this._overrideWidth=e.width,this._overrideHeight=e.height,this._resolve=null,this._crossorigin=e.crossorigin,this._load=null,!1!==e.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise((t=>{if(this._resolve=()=>{this.resize(this.source.width,this.source.height),t(this)},Kr.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}))),this._load}_loadSvg(){const t=new Image;Sn.crossOrigin(t,this.svg,this._crossorigin),t.src=this.svg,t.onerror=e=>{this._resolve&&(t.onerror=null,this.onError.emit(e))},t.onload=()=>{if(!this._resolve)return;const e=t.width,n=t.height;if(!e||!n)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let r=e*this.scale,i=n*this.scale;(this._overrideWidth||this._overrideHeight)&&(r=this._overrideWidth||this._overrideHeight/n*e,i=this._overrideHeight||this._overrideWidth/e*n),r=Math.round(r),i=Math.round(i);const s=this.source;s.width=r,s.height=i,s._pixiId=`canvas_${Ft()}`,s.getContext("2d").drawImage(t,0,0,e,n,0,0,r,i),this._resolve(),this._resolve=null}}static getSize(t){const e=Kr.SVG_SIZE.exec(t),n={};return e&&(n[e[1]]=Math.round(parseFloat(e[3])),n[e[5]]=Math.round(parseFloat(e[7]))),n}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(t,e){return"svg"===e||"string"==typeof t&&t.startsWith("data:image/svg+xml")||"string"==typeof t&&Kr.SVG_XML.test(t)}};let Qr=Kr;Qr.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,Qr.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;const Zr=class extends Sn{constructor(t,e){if(e=e||{},!(t instanceof HTMLVideoElement)){const n=document.createElement("video");n.setAttribute("preload","auto"),n.setAttribute("webkit-playsinline",""),n.setAttribute("playsinline",""),"string"==typeof t&&(t=[t]);const r=t[0].src||t[0];Sn.crossOrigin(n,r,e.crossorigin);for(let e=0;e<t.length;++e){const r=document.createElement("source");let{src:i,mime:s}=t[e];i=i||t[e];const o=i.split("?").shift().toLowerCase(),a=o.slice(o.lastIndexOf(".")+1);s=s||Zr.MIME_TYPES[a]||`video/${a}`,r.src=i,r.type=s,n.appendChild(r)}t=n}super(t),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=e.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=!1!==e.autoPlay,this._load=null,this._resolve=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),!1!==e.autoLoad&&this.load()}update(t=0){if(!this.destroyed){const t=kr.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t),(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}load(){if(this._load)return this._load;const t=this.source;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart.bind(this)),t.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("error",this._onError,!0)),this._load=new Promise((e=>{this.valid?e(this):(this._resolve=e,t.load())})),this._load}_onError(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t)}_isSourcePlaying(){const t=this.source;return!t.paused&&!t.ended&&this._isSourceReady()}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(kr.shared.add(this.update,this),this._isConnectedToTicker=!0)}_onPlayStop(){this._isConnectedToTicker&&(kr.shared.remove(this.update,this),this._isConnectedToTicker=!1)}_onCanPlay(){const t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);const e=this.valid;this.resize(t.videoWidth,t.videoHeight),!e&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()}dispose(){this._isConnectedToTicker&&(kr.shared.remove(this.update,this),this._isConnectedToTicker=!1);const t=this.source;t&&(t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(kr.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(kr.shared.add(this.update,this),this._isConnectedToTicker=!0))}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t)}static test(t,e){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement||Zr.TYPES.includes(e)}};let Jr=Zr;Jr.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],Jr.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"},re.push(qr,An,class extends Sn{constructor(t){super(t)}static test(t){const{OffscreenCanvas:e}=globalThis;return!!(e&&t instanceof e)||globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}},Jr,Qr,ae,Yr,class extends Xr{constructor(t,e){const{width:n,height:r}=e||{};let i,s;Array.isArray(t)?(i=t,s=t.length):s=t,super(s,{width:n,height:r}),i&&this.initFromArray(i,e)}addBaseTextureAt(t,e){if(!t.resource)throw new Error("ArrayResource does not support RenderTexture");return this.addResourceAt(t.resource,e),this}bind(t){super.bind(t),t.target=l.TEXTURE_2D_ARRAY}upload(t,e,n){const{length:r,itemDirtyIds:i,items:s}=this,{gl:o}=t;n.dirtyId<0&&o.texImage3D(o.TEXTURE_2D_ARRAY,0,n.internalFormat,this._width,this._height,r,0,e.format,n.type,null);for(let a=0;a<r;a++){const t=s[a];i[a]<t.dirtyId&&(i[a]=t.dirtyId,t.valid&&o.texSubImage3D(o.TEXTURE_2D_ARRAY,0,0,0,a,t.resource.width,t.resource.height,1,e.format,n.type,t.resource.source))}return!0}});const ti="7.2.4";class ei{constructor(){this.minX=Infinity,this.minY=Infinity,this.maxX=-Infinity,this.maxY=-Infinity,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=Infinity,this.minY=Infinity,this.maxX=-Infinity,this.maxY=-Infinity}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?Ce.EMPTY:((t=t||new Ce(0,0,1,1)).x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,e){const{a:n,b:r,c:i,d:s,tx:o,ty:a}=t,h=n*e.x+i*e.y+o,l=r*e.x+s*e.y+a;this.minX=Math.min(this.minX,h),this.maxX=Math.max(this.maxX,h),this.minY=Math.min(this.minY,l),this.maxY=Math.max(this.maxY,l)}addQuad(t){let e=this.minX,n=this.minY,r=this.maxX,i=this.maxY,s=t[0],o=t[1];e=s<e?s:e,n=o<n?o:n,r=s>r?s:r,i=o>i?o:i,s=t[2],o=t[3],e=s<e?s:e,n=o<n?o:n,r=s>r?s:r,i=o>i?o:i,s=t[4],o=t[5],e=s<e?s:e,n=o<n?o:n,r=s>r?s:r,i=o>i?o:i,s=t[6],o=t[7],e=s<e?s:e,n=o<n?o:n,r=s>r?s:r,i=o>i?o:i,this.minX=e,this.minY=n,this.maxX=r,this.maxY=i}addFrame(t,e,n,r,i){this.addFrameMatrix(t.worldTransform,e,n,r,i)}addFrameMatrix(t,e,n,r,i){const s=t.a,o=t.b,a=t.c,h=t.d,l=t.tx,u=t.ty;let c=this.minX,d=this.minY,f=this.maxX,p=this.maxY,m=s*e+a*n+l,g=o*e+h*n+u;c=m<c?m:c,d=g<d?g:d,f=m>f?m:f,p=g>p?g:p,m=s*r+a*n+l,g=o*r+h*n+u,c=m<c?m:c,d=g<d?g:d,f=m>f?m:f,p=g>p?g:p,m=s*e+a*i+l,g=o*e+h*i+u,c=m<c?m:c,d=g<d?g:d,f=m>f?m:f,p=g>p?g:p,m=s*r+a*i+l,g=o*r+h*i+u,c=m<c?m:c,d=g<d?g:d,f=m>f?m:f,p=g>p?g:p,this.minX=c,this.minY=d,this.maxX=f,this.maxY=p}addVertexData(t,e,n){let r=this.minX,i=this.minY,s=this.maxX,o=this.maxY;for(let a=e;a<n;a+=2){const e=t[a],n=t[a+1];r=e<r?e:r,i=n<i?n:i,s=e>s?e:s,o=n>o?n:o}this.minX=r,this.minY=i,this.maxX=s,this.maxY=o}addVertices(t,e,n,r){this.addVerticesMatrix(t.worldTransform,e,n,r)}addVerticesMatrix(t,e,n,r,i=0,s=i){const o=t.a,a=t.b,h=t.c,l=t.d,u=t.tx,c=t.ty;let d=this.minX,f=this.minY,p=this.maxX,m=this.maxY;for(let g=n;g<r;g+=2){const t=e[g],n=e[g+1],r=o*t+h*n+u,_=l*n+a*t+c;d=Math.min(d,r-i),p=Math.max(p,r+i),f=Math.min(f,_-s),m=Math.max(m,_+s)}this.minX=d,this.minY=f,this.maxX=p,this.maxY=m}addBounds(t){const e=this.minX,n=this.minY,r=this.maxX,i=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<n?t.minY:n,this.maxX=t.maxX>r?t.maxX:r,this.maxY=t.maxY>i?t.maxY:i}addBoundsMask(t,e){const n=t.minX>e.minX?t.minX:e.minX,r=t.minY>e.minY?t.minY:e.minY,i=t.maxX<e.maxX?t.maxX:e.maxX,s=t.maxY<e.maxY?t.maxY:e.maxY;if(n<=i&&r<=s){const t=this.minX,e=this.minY,o=this.maxX,a=this.maxY;this.minX=n<t?n:t,this.minY=r<e?r:e,this.maxX=i>o?i:o,this.maxY=s>a?s:a}}addBoundsMatrix(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,e){const n=t.minX>e.x?t.minX:e.x,r=t.minY>e.y?t.minY:e.y,i=t.maxX<e.x+e.width?t.maxX:e.x+e.width,s=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(n<=i&&r<=s){const t=this.minX,e=this.minY,o=this.maxX,a=this.maxY;this.minX=n<t?n:t,this.minY=r<e?r:e,this.maxX=i>o?i:o,this.maxY=s>a?s:a}}pad(t=0,e=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)}addFramePad(t,e,n,r,i,s){t-=i,e-=s,n+=i,r+=s,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>n?this.maxX:n,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>r?this.maxY:r}}class ni extends H{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new ze,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new ei,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const e=Object.keys(t);for(let n=0;n<e.length;++n){const r=e[n];Object.defineProperty(ni.prototype,r,Object.getOwnPropertyDescriptor(t,r))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new Ce),e=this._boundsRect),this._bounds.getRectangle(e)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new Ce),t=this._localBoundsRect),this._localBounds||(this._localBounds=new ei);const e=this.transform,n=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;const r=this._bounds,i=this._boundsID;this._bounds=this._localBounds;const s=this.getBounds(!1,t);return this.parent=n,this.transform=e,this._bounds=r,this._bounds.updateID+=this._boundsID-i,s}toGlobal(t,e,n=!1){return n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)}toLocal(t,e,n,r){return e&&(t=e.toGlobal(t,n,r)),r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,n)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){this.parent?.removeChild(this)}setTransform(t=0,e=0,n=1,r=1,i=0,s=0,o=0,a=0,h=0){return this.position.x=t,this.position.y=e,this.scale.x=n||1,this.scale.y=r||1,this.rotation=i,this.skew.x=s,this.skew.y=o,this.pivot.x=a,this.pivot.y=h,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new ri),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*Ee}set angle(t){this.transform.rotation=t*we}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(t._maskRefCount--,0===t._maskRefCount&&(t.renderable=!0,t.isMask=!1))}if(this._mask=t,this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(0===t._maskRefCount&&(t.renderable=!1,t.isMask=!0),t._maskRefCount++)}}}}class ri extends ni{constructor(){super(...arguments),this.sortDirty=null}}ni.prototype.displayObjectUpdateTransform=ni.prototype.updateTransform;const ii=new Oe;function si(t,e){return t.zIndex===e.zIndex?t._lastSortedIndex-e._lastSortedIndex:t.zIndex-e.zIndex}const oi=class extends ni{constructor(){super(),this.children=[],this.sortableChildren=oi.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(t){}addChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.addChild(t[e]);else{const e=t[0];e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this)}return t[0]}addChildAt(t,e){if(e<0||e>this.children.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${this.children.length}`);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t}swapChildren(t,e){if(t===e)return;const n=this.getChildIndex(t),r=this.getChildIndex(e);this.children[n]=e,this.children[r]=t,this.onChildrenChange(n<r?n:r)}getChildIndex(t){const e=this.children.indexOf(t);if(-1===e)throw new Error("The supplied DisplayObject must be a child of the caller");return e}setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);const n=this.getChildIndex(t);Nt(this.children,n,1),this.children.splice(e,0,t),this.onChildrenChange(e)}getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]}removeChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.removeChild(t[e]);else{const e=t[0],n=this.children.indexOf(e);if(-1===n)return null;e.parent=null,e.transform._parentID=-1,Nt(this.children,n,1),this._boundsID++,this.onChildrenChange(n),e.emit("removed",this),this.emit("childRemoved",e,this,n)}return t[0]}removeChildAt(t){const e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,Nt(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e}removeChildren(t=0,e=this.children.length){const n=t,r=e-n;let i;if(r>0&&r<=e){i=this.children.splice(n,r);for(let t=0;t<i.length;++t)i[t].parent=null,i[t].transform&&(i[t].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(let t=0;t<i.length;++t)i[t].emit("removed",this),this.emit("childRemoved",i[t],this,t);return i}if(0===r&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let t=!1;for(let e=0,n=this.children.length;e<n;++e){const n=this.children[e];n._lastSortedIndex=e,t||0===n.zIndex||(t=!0)}t&&this.children.length>1&&this.children.sort(si),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let t=0,e=this.children.length;t<e;++t){const e=this.children[t];e.visible&&e.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let t=0;t<this.children.length;t++){const e=this.children[t];if(e.visible&&e.renderable)if(e.calculateBounds(),e._mask){const t=e._mask.isMaskData?e._mask.maskObject:e._mask;t?(t.calculateBounds(),this._bounds.addBoundsMask(e._bounds,t._bounds)):this._bounds.addBounds(e._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(t,e=!1){const n=super.getLocalBounds(t);if(!e)for(let r=0,i=this.children.length;r<i;++r){const t=this.children[r];t.visible&&t.updateTransform()}return n}_calculateBounds(){}_renderWithCulling(t){const e=t.renderTexture.sourceFrame;if(!(e.width>0&&e.height>0))return;let n,r;this.cullArea?(n=this.cullArea,r=this.worldTransform):this._render!==oi.prototype._render&&(n=this.getBounds(!0));const i=t.projection.transform;if(i&&(r?(r=ii.copyFrom(r),r.prepend(i)):r=i),n&&e.intersects(n,r))this._render(t);else if(this.cullArea)return;for(let s=0,o=this.children.length;s<o;++s){const e=this.children[s],n=e.cullable;e.cullable=n||!this.cullArea,e.render(t),e.cullable=n}}render(t){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||this.filters?.length)this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(let e=0,n=this.children.length;e<n;++e)this.children[e].render(t)}}renderAdvanced(t){const e=this.filters,n=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let t=0;t<e.length;t++)e[t].enabled&&this._enabledFilters.push(e[t])}const r=e&&this._enabledFilters?.length||n&&(!n.isMaskData||n.enabled&&(n.autoDetect||n.type!==v.NONE));if(r&&t.batch.flush(),e&&this._enabledFilters?.length&&t.filter.push(this,this._enabledFilters),n&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(let e=0,n=this.children.length;e<n;++e)this.children[e].render(t)}r&&t.batch.flush(),n&&t.mask.pop(this),e&&this._enabledFilters?.length&&t.filter.pop()}_render(t){}destroy(t){super.destroy(),this.sortDirty=!1;const e="boolean"==typeof t?t:t?.children,n=this.removeChildren(0,this.children.length);if(e)for(let r=0;r<n.length;++r)n[r].destroy(t)}get width(){return this.scale.x*this.getLocalBounds().width}set width(t){const e=this.getLocalBounds().width;this.scale.x=0!==e?t/e:1,this._width=t}get height(){return this.scale.y*this.getLocalBounds().height}set height(t){const e=this.getLocalBounds().height;this.scale.y=0!==e?t/e:1,this._height=t}};let ai=oi;ai.defaultSortableChildren=!1,ai.prototype.containerUpdateTransform=ai.prototype.updateTransform,Object.defineProperties(w,{SORTABLE_CHILDREN:{get(){return ai.defaultSortableChildren},set(t){K(0,"settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),ai.defaultSortableChildren=t}}});const hi=new Se,li=new Uint16Array([0,1,2,0,2,3]);class ui extends ai{constructor(t){super(),this._anchor=new Ge(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new Ct(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=o.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||Pn.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=li,this.pluginName="batch",this.isSprite=!0,this._roundPixels=w.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=kt(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=kt(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const e=this.transform.worldTransform,n=e.a,r=e.b,i=e.c,s=e.d,o=e.tx,a=e.ty,h=this.vertexData,l=t.trim,u=t.orig,c=this._anchor;let d=0,f=0,p=0,m=0;if(l?(f=l.x-c._x*u.width,d=f+l.width,m=l.y-c._y*u.height,p=m+l.height):(f=-c._x*u.width,d=f+u.width,m=-c._y*u.height,p=m+u.height),h[0]=n*f+i*m+o,h[1]=s*m+r*f+a,h[2]=n*d+i*m+o,h[3]=s*m+r*d+a,h[4]=n*d+i*p+o,h[5]=s*p+r*d+a,h[6]=n*f+i*p+o,h[7]=s*p+r*f+a,this._roundPixels){const t=w.RESOLUTION;for(let e=0;e<h.length;++e)h[e]=Math.round(h[e]*t)/t}}calculateTrimmedVertices(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const t=this._texture,e=this.vertexTrimmedData,n=t.orig,r=this._anchor,i=this.transform.worldTransform,s=i.a,o=i.b,a=i.c,h=i.d,l=i.tx,u=i.ty,c=-r._x*n.width,d=c+n.width,f=-r._y*n.height,p=f+n.height;e[0]=s*c+a*f+l,e[1]=h*f+o*c+u,e[2]=s*d+a*f+l,e[3]=h*f+o*d+u,e[4]=s*d+a*p+l,e[5]=h*p+o*d+u,e[6]=s*c+a*p+l,e[7]=h*p+o*c+u}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return 0===this.children.length?(this._localBounds||(this._localBounds=new ei),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new Ce),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,hi);const e=this._texture.orig.width,n=this._texture.orig.height,r=-e*this.anchor.x;let i=0;return hi.x>=r&&hi.x<r+e&&(i=-n*this.anchor.y,hi.y>=i&&hi.y<i+n)}destroy(t){super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null;if("boolean"==typeof t?t:t?.texture){const e="boolean"==typeof t?t:t?.baseTexture;this._texture.destroy(!!e)}this._texture=null}static from(t,e){const n=t instanceof Pn?t:Pn.from(t,e);return new ui(n)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const e=kt(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const e=kt(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||Pn.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}const ci=new Oe;ni.prototype._cacheAsBitmap=!1,ni.prototype._cacheData=null,ni.prototype._cacheAsBitmapResolution=null,ni.prototype._cacheAsBitmapMultisample=null;class di{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(ni.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(t){t!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(t){t!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(t){if(this._cacheAsBitmap===t)return;let e;this._cacheAsBitmap=t,t?(this._cacheData||(this._cacheData=new di),e=this._cacheData,e.originalRender=this.render,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this.calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(e=this._cacheData,e.sprite&&this._destroyCachedDisplayObject(),this.render=e.originalRender,this.renderCanvas=e.originalRenderCanvas,this.calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea)}}}),ni.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))},ni.prototype._initCachedDisplayObject=function(t){if(this._cacheData?.sprite)return;const e=this.alpha;this.alpha=1,t.batch.flush();const n=this.getLocalBounds(null,!0).clone();if(this.filters?.length){const t=this.filters[0].padding;n.pad(t)}n.ceil(w.RESOLUTION);const r=t.renderTexture.current,i=t.renderTexture.sourceFrame.clone(),s=t.renderTexture.destinationFrame.clone(),o=t.projection.transform,a=Mn.create({width:n.width,height:n.height,resolution:this.cacheAsBitmapResolution||t.resolution,multisample:this.cacheAsBitmapMultisample??t.multisample}),h=`cacheAsBitmap_${Ft()}`;this._cacheData.textureCacheId=h,ue.addToCache(a.baseTexture,h),Pn.addToCache(a,h);const l=this.transform.localTransform.copyTo(ci).invert().translate(-n.x,-n.y);this.render=this._cacheData.originalRender,t.render(this,{renderTexture:a,clear:!0,transform:l,skipUpdateTransform:!1}),t.framebuffer.blit(),t.projection.transform=o,t.renderTexture.bind(r,i,s),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=e;const u=new ui(a);u.transform.worldTransform=this.transform.worldTransform,u.anchor.x=-n.x/n.width,u.anchor.y=-n.y/n.height,u.alpha=e,u._bounds=this._bounds,this._cacheData.sprite=u,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=u.containsPoint.bind(u)},ni.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))},ni.prototype._initCachedDisplayObjectCanvas=function(t){if(this._cacheData?.sprite)return;const e=this.getLocalBounds(null,!0),n=this.alpha;this.alpha=1;const r=t.canvasContext.activeContext,i=t._projTransform;e.ceil(w.RESOLUTION);const s=Mn.create({width:e.width,height:e.height}),o=`cacheAsBitmap_${Ft()}`;this._cacheData.textureCacheId=o,ue.addToCache(s.baseTexture,o),Pn.addToCache(s,o);const a=ci;this.transform.localTransform.copyTo(a),a.invert(),a.tx-=e.x,a.ty-=e.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,{renderTexture:s,clear:!0,transform:a,skipUpdateTransform:!1}),t.canvasContext.activeContext=r,t._projTransform=i,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=n;const h=new ui(s);h.transform.worldTransform=this.transform.worldTransform,h.anchor.x=-e.x/e.width,h.anchor.y=-e.y/e.height,h.alpha=n,h._bounds=this._bounds,this._cacheData.sprite=h,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=h.containsPoint.bind(h)},ni.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID},ni.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)},ni.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,ue.removeFromCache(this._cacheData.textureCacheId),Pn.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},ni.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)},ni.prototype.name=null,ai.prototype.getChildByName=function(t,e){for(let n=0,r=this.children.length;n<r;n++)if(this.children[n].name===t)return this.children[n];if(e)for(let n=0,r=this.children.length;n<r;n++){const e=this.children[n];if(!e.getChildByName)continue;const r=e.getChildByName(t,!0);if(r)return r}return null},ni.prototype.getGlobalPosition=function(t=new Se,e=!1){return this.parent?this.parent.toGlobal(this.position,t,e):(t.x=this.position.x,t.y=this.position.y),t};const fi={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},pi=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n");class mi extends _n{constructor(t,e=8,n=4,r=_n.defaultResolution,i=5){const s=function(t,e){const n=Math.ceil(t/2);let r,i="\n    attribute vec2 aVertexPosition;\n\n    uniform mat3 projectionMatrix;\n\n    uniform float strength;\n\n    varying vec2 vBlurTexCoords[%size%];\n\n    uniform vec4 inputSize;\n    uniform vec4 outputFrame;\n\n    vec4 filterVertexPosition( void )\n    {\n        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n    }\n\n    vec2 filterTextureCoord( void )\n    {\n        return aVertexPosition * (outputFrame.zw * inputSize.zw);\n    }\n\n    void main(void)\n    {\n        gl_Position = filterVertexPosition();\n\n        vec2 textureCoord = filterTextureCoord();\n        %blur%\n    }",s="";r=e?"vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":"vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let o=0;o<t;o++){let t=r.replace("%index%",o.toString());t=t.replace("%sampleIndex%",o-(n-1)+".0"),s+=t,s+="\n"}return i=i.replace("%blur%",s),i=i.replace("%size%",t.toString()),i}(i,t),o=function(t){const e=fi[t],n=e.length;let r,i=pi,s="";for(let o=0;o<t;o++){let i="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;".replace("%index%",o.toString());r=o,o>=n&&(r=t-o-1),i=i.replace("%value%",e[r].toString()),s+=i,s+="\n"}return i=i.replace("%blur%",s),i=i.replace("%size%",t.toString()),i}(i);super(s,o),this.horizontal=t,this.resolution=r,this._quality=0,this.quality=n,this.blur=e}apply(t,e,n,r){if(n?this.horizontal?this.uniforms.strength=1/n.width*(n.width/e.width):this.uniforms.strength=1/n.height*(n.height/e.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/e.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/e.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)t.applyFilter(this,e,n,r);else{const i=t.getFilterTexture(),s=t.renderer;let o=e,a=i;this.state.blend=!1,t.applyFilter(this,o,a,g.CLEAR);for(let e=1;e<this.passes-1;e++){t.bindAndClear(o,g.BLIT),this.uniforms.uSampler=a;const e=a;a=o,o=e,s.shader.bind(this),s.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,a,n,r),t.returnFilterTexture(i)}}get blur(){return this.strength}set blur(t){this.padding=1+2*Math.abs(t),this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}}class gi extends _n{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(Ur,"varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n",t),this.alpha=1}_loadMatrix(t,e=!1){let n=t;e&&(this._multiply(n,this.uniforms.m,t),n=this._colorMatrix(n)),this.uniforms.m=n}_multiply(t,e,n){return t[0]=e[0]*n[0]+e[1]*n[5]+e[2]*n[10]+e[3]*n[15],t[1]=e[0]*n[1]+e[1]*n[6]+e[2]*n[11]+e[3]*n[16],t[2]=e[0]*n[2]+e[1]*n[7]+e[2]*n[12]+e[3]*n[17],t[3]=e[0]*n[3]+e[1]*n[8]+e[2]*n[13]+e[3]*n[18],t[4]=e[0]*n[4]+e[1]*n[9]+e[2]*n[14]+e[3]*n[19]+e[4],t[5]=e[5]*n[0]+e[6]*n[5]+e[7]*n[10]+e[8]*n[15],t[6]=e[5]*n[1]+e[6]*n[6]+e[7]*n[11]+e[8]*n[16],t[7]=e[5]*n[2]+e[6]*n[7]+e[7]*n[12]+e[8]*n[17],t[8]=e[5]*n[3]+e[6]*n[8]+e[7]*n[13]+e[8]*n[18],t[9]=e[5]*n[4]+e[6]*n[9]+e[7]*n[14]+e[8]*n[19]+e[9],t[10]=e[10]*n[0]+e[11]*n[5]+e[12]*n[10]+e[13]*n[15],t[11]=e[10]*n[1]+e[11]*n[6]+e[12]*n[11]+e[13]*n[16],t[12]=e[10]*n[2]+e[11]*n[7]+e[12]*n[12]+e[13]*n[17],t[13]=e[10]*n[3]+e[11]*n[8]+e[12]*n[13]+e[13]*n[18],t[14]=e[10]*n[4]+e[11]*n[9]+e[12]*n[14]+e[13]*n[19]+e[14],t[15]=e[15]*n[0]+e[16]*n[5]+e[17]*n[10]+e[18]*n[15],t[16]=e[15]*n[1]+e[16]*n[6]+e[17]*n[11]+e[18]*n[16],t[17]=e[15]*n[2]+e[16]*n[7]+e[17]*n[12]+e[18]*n[17],t[18]=e[15]*n[3]+e[16]*n[8]+e[17]*n[13]+e[18]*n[18],t[19]=e[15]*n[4]+e[16]*n[9]+e[17]*n[14]+e[18]*n[19]+e[19],t}_colorMatrix(t){const e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e}brightness(t,e){const n=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(n,e)}tint(t,e){const[n,r,i]=Ct.shared.setValue(t).toArray(),s=[n,0,0,0,0,0,r,0,0,0,0,0,i,0,0,0,0,0,1,0];this._loadMatrix(s,e)}greyscale(t,e){const n=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(n,e)}blackAndWhite(t){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],t)}hue(t,e){t=(t||0)/180*Math.PI;const n=Math.cos(t),r=Math.sin(t),i=1/3,s=(0,Math.sqrt)(i),o=[n+(1-n)*i,i*(1-n)-s*r,i*(1-n)+s*r,0,0,i*(1-n)+s*r,n+i*(1-n),i*(1-n)-s*r,0,0,i*(1-n)-s*r,i*(1-n)+s*r,n+i*(1-n),0,0,0,0,0,1,0];this._loadMatrix(o,e)}contrast(t,e){const n=(t||0)+1,r=-.5*(n-1),i=[n,0,0,0,r,0,n,0,0,r,0,0,n,0,r,0,0,0,1,0];this._loadMatrix(i,e)}saturate(t=0,e){const n=2*t/3+1,r=-.5*(n-1),i=[n,r,r,0,0,r,n,r,0,0,r,r,n,0,0,0,0,0,1,0];this._loadMatrix(i,e)}desaturate(){this.saturate(-1)}negative(t){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],t)}sepia(t){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],t)}technicolor(t){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],t)}polaroid(t){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],t)}toBGR(t){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],t)}kodachrome(t){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],t)}browni(t){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],t)}vintage(t){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],t)}colorTone(t,e,n,r,i){t=t||.2,e=e||.15,n=n||16770432,r=r||3375104;const s=Ct.shared,[o,a,h]=s.setValue(n).toArray(),[l,u,c]=s.setValue(r).toArray(),d=[.3,.59,.11,0,0,o,a,h,t,0,l,u,c,e,0,o-l,a-u,h-c,0,0];this._loadMatrix(d,i)}night(t,e){const n=[-2*(t=t||.1),-t,0,0,0,-t,0,t,0,0,0,t,2*t,0,0,0,0,0,1,0];this._loadMatrix(n,e)}predator(t,e){const n=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(n,e)}lsd(t){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],t)}reset(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}gi.prototype.grayscale=gi.prototype.greyscale;const _i={AlphaFilter:class extends _n{constructor(t=1){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n",{uAlpha:1}),this.alpha=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}},BlurFilter:class extends _n{constructor(t=8,e=4,n=_n.defaultResolution,r=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new mi(!0,t,e,n,r),this.blurYFilter=new mi(!1,t,e,n,r),this.resolution=n,this.quality=e,this.blur=t,this.repeatEdgePixels=!1}apply(t,e,n,r){const i=Math.abs(this.blurXFilter.strength),s=Math.abs(this.blurYFilter.strength);if(i&&s){const i=t.getFilterTexture();this.blurXFilter.apply(t,e,i,g.CLEAR),this.blurYFilter.apply(t,i,n,r),t.returnFilterTexture(i)}else s?this.blurYFilter.apply(t,e,n,r):this.blurXFilter.apply(t,e,n,r)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))}get blur(){return this.blurXFilter.blur}set blur(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get blurX(){return this.blurXFilter.blur}set blurX(t){this.blurXFilter.blur=t,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(t){this.blurYFilter.blur=t,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(t){this.blurYFilter.blendMode=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}},BlurFilterPass:mi,ColorMatrixFilter:gi,DisplacementFilter:class extends _n{constructor(t,e){const n=new Oe;t.renderable=!1,super("attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n\tgl_Position = filterVertexPosition();\n\tvTextureCoord = filterTextureCoord();\n\tvFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\nuniform mat2 rotation;\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform highp vec4 inputSize;\nuniform vec4 inputClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy = scale * inputSize.zw * (rotation * map.xy);\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));\n}\n",{mapSampler:t._texture,filterMatrix:n,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=t,this.maskMatrix=n,null==e&&(e=20),this.scale=new Se(e,e)}apply(t,e,n,r){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const i=this.maskSprite.worldTransform,s=Math.sqrt(i.a*i.a+i.b*i.b),o=Math.sqrt(i.c*i.c+i.d*i.d);0!==s&&0!==o&&(this.uniforms.rotation[0]=i.a/s,this.uniforms.rotation[1]=i.b/s,this.uniforms.rotation[2]=i.c/o,this.uniforms.rotation[3]=i.d/o),t.applyFilter(this,e,n,r)}get map(){return this.uniforms.mapSampler}set map(t){this.uniforms.mapSampler=t}},FXAAFilter:class extends _n{constructor(){super("\nattribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvoid texcoords(vec2 fragCoord, vec2 inverseVP,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = filterVertexPosition();\n\n   vFragCoord = aVertexPosition * outputFrame.zw;\n\n   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n",'varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\nuniform sampler2D uSampler;\nuniform highp vec4 inputSize;\n\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n\n --\n\n From:\n https://github.com/mitsuhiko/webgl-meincraft\n\n Copyright (c) 2011 by Armin Ronacher.\n\n Some rights reserved.\n\n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n\n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n\n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n\n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n\n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec4 color;\n\n      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n')}},NoiseFilter:class extends _n{constructor(t=.5,e=Math.random()){super(Ur,"precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n",{uNoise:0,uSeed:0}),this.noise=t,this.seed=e}get noise(){return this.uniforms.uNoise}set noise(t){this.uniforms.uNoise=t}get seed(){return this.uniforms.uSeed}set seed(t){this.uniforms.uSeed=t}}};Object.entries(_i).forEach((([t,e])=>{Object.defineProperty(_i,t,{get(){return K(0,`filters.${t} has moved to ${t}`),e}})}));const yi=new class{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(t){this.removeTickerListener(),this.events=t,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(t){this._pauseUpdate=t}addTickerListener(){!this.tickerAdded&&this.domElement&&(kr.system.add(this.tickerUpdate,this,Or.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(kr.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove)return void(this._didMove=!1);const t=this.events.rootPointerEvent;this.events.supportsTouchEvents&&"touch"===t.pointerType||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:t.clientX,clientY:t.clientY}))}tickerUpdate(t){this._deltaTime+=t,this._deltaTime<this.interactionFrequency||(this._deltaTime=0,this.update())}};class vi{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=vi.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new Se,this.page=new Se,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return!this.manager||this.path&&this.path[this.path.length-1]===this.target||(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,e,n){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,e,n,r,i){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class bi extends vi{constructor(){super(...arguments),this.client=new Se,this.movement=new Se,this.offset=new Se,this.global=new Se,this.screen=new Se}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(t,e,n){return t.worldTransform.applyInverse(n||this.global,e)}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,n,r,i,s,o,a,h,l,u,c,d,f,p){throw new Error("Method not implemented.")}}class xi extends bi{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return"pointermove"===this.type||"mousemove"===this.type||"touchmove"===this.type?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class Ei extends bi{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}Ei.DOM_DELTA_PIXEL=0,Ei.DOM_DELTA_LINE=1,Ei.DOM_DELTA_PAGE=2;const wi=new Se,Ti=new Se;class Si{constructor(t){this.dispatch=new H,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort(((t,e)=>t.priority-e.priority))}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const e=this.mappingTable[t.type];if(e)for(let n=0,r=e.length;n<r;n++)e[n].fn(t)}hitTest(t,e){yi.pauseUpdate=!0;const n=this[this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive"](this.rootTarget,this.rootTarget.eventMode,wi.set(t,e),this.hitTestFn,this.hitPruneFn);return n&&n[0]}propagate(t,e){if(!t.target)return;const n=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let r=0,i=n.length-1;r<i;r++)if(t.currentTarget=n[r],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!t.propagationStopped&&!t.propagationImmediatelyStopped){t.eventPhase=t.BUBBLING_PHASE;for(let r=n.length-2;r>=0;r--)if(t.currentTarget=n[r],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,e,n=this._allInteractiveElements){if(0===n.length)return;t.eventPhase=t.BUBBLING_PHASE;const r=Array.isArray(e)?e:[e];for(let i=n.length-1;i>=0;i--)r.forEach((e=>{t.currentTarget=n[i],this.notifyTarget(t,e)}))}propagationPath(t){const e=[t];for(let n=0;n<2048&&t!==this.rootTarget;n++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}hitTestMoveRecursive(t,e,n,r,i,s=!1){let o=!1;if(this._interactivePrune(t))return null;if("dynamic"!==t.eventMode&&"dynamic"!==e||(yi.pauseUpdate=!1),t.interactiveChildren&&t.children){const a=t.children;for(let h=a.length-1;h>=0;h--){const l=a[h],u=this.hitTestMoveRecursive(l,this._isInteractive(e)?e:l.eventMode,n,r,i,s||i(t,n));if(u){if(u.length>0&&!u[u.length-1].parent)continue;const e=t.isInteractive();(u.length>0||e)&&(e&&this._allInteractiveElements.push(t),u.push(t)),0===this._hitElements.length&&(this._hitElements=u),o=!0}}}const a=this._isInteractive(e),h=t.isInteractive();return h&&h&&this._allInteractiveElements.push(t),s||this._hitElements.length>0?null:o?this._hitElements:a&&!i(t,n)&&r(t,n)?h?[t]:[]:null}hitTestRecursive(t,e,n,r,i){if(this._interactivePrune(t)||i(t,n))return null;if("dynamic"!==t.eventMode&&"dynamic"!==e||(yi.pauseUpdate=!1),t.interactiveChildren&&t.children){const s=t.children;for(let o=s.length-1;o>=0;o--){const a=s[o],h=this.hitTestRecursive(a,this._isInteractive(e)?e:a.eventMode,n,r,i);if(h){if(h.length>0&&!h[h.length-1].parent)continue;const e=t.isInteractive();return(h.length>0||e)&&h.push(t),h}}}const s=this._isInteractive(e),o=t.isInteractive();return s&&r(t,n)?o?[t]:[]:null}_isInteractive(t){return"static"===t||"dynamic"===t}_interactivePrune(t){return!(t&&!t.isMask&&t.visible&&t.renderable)||("none"===t.eventMode||("passive"===t.eventMode&&!t.interactiveChildren||!!t.isMask))}hitPruneFn(t,e){if(t.hitArea&&(t.worldTransform.applyInverse(e,Ti),!t.hitArea.contains(Ti.x,Ti.y)))return!0;if(t._mask){const n=t._mask.isMaskData?t._mask.maskObject:t._mask;if(n&&!n.containsPoint?.(e))return!0}return!1}hitTestFn(t,e){return"passive"!==t.eventMode&&(!!t.hitArea||!!t.containsPoint&&t.containsPoint(e))}notifyTarget(t,e){const n=`on${e=e??t.type}`;t.currentTarget[n]?.(t);const r=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,r),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}mapPointerDown(t){if(!(t instanceof xi))return;const e=this.createPointerEvent(t);if(this.dispatchEvent(e,"pointerdown"),"touch"===e.pointerType)this.dispatchEvent(e,"touchstart");else if("mouse"===e.pointerType||"pen"===e.pointerType){const t=2===e.button;this.dispatchEvent(e,t?"rightdown":"mousedown")}this.trackingData(t.pointerId).pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e)}mapPointerMove(t){if(!(t instanceof xi))return;this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const e=this.createPointerEvent(t);this._isPointerMoveEvent=!1;const n="mouse"===e.pointerType||"pen"===e.pointerType,r=this.trackingData(t.pointerId),i=this.findMountedTarget(r.overTargets);if(r.overTargets?.length>0&&i!==e.target){const r="mousemove"===t.type?"mouseout":"pointerout",s=this.createPointerEvent(t,r,i);if(this.dispatchEvent(s,"pointerout"),n&&this.dispatchEvent(s,"mouseout"),!e.composedPath().includes(i)){const r=this.createPointerEvent(t,"pointerleave",i);for(r.eventPhase=r.AT_TARGET;r.target&&!e.composedPath().includes(r.target);)r.currentTarget=r.target,this.notifyTarget(r),n&&this.notifyTarget(r,"mouseleave"),r.target=r.target.parent;this.freeEvent(r)}this.freeEvent(s)}if(i!==e.target){const r="mousemove"===t.type?"mouseover":"pointerover",s=this.clonePointerEvent(e,r);this.dispatchEvent(s,"pointerover"),n&&this.dispatchEvent(s,"mouseover");let o=i?.parent;for(;o&&o!==this.rootTarget.parent&&o!==e.target;)o=o.parent;if(!o||o===this.rootTarget.parent){const t=this.clonePointerEvent(e,"pointerenter");for(t.eventPhase=t.AT_TARGET;t.target&&t.target!==i&&t.target!==this.rootTarget.parent;)t.currentTarget=t.target,this.notifyTarget(t),n&&this.notifyTarget(t,"mouseenter"),t.target=t.target.parent;this.freeEvent(t)}this.freeEvent(s)}const s=[],o=this.enableGlobalMoveEvents??!0;this.moveOnAll?s.push("pointermove"):this.dispatchEvent(e,"pointermove"),o&&s.push("globalpointermove"),"touch"===e.pointerType&&(this.moveOnAll?s.splice(1,0,"touchmove"):this.dispatchEvent(e,"touchmove"),o&&s.push("globaltouchmove")),n&&(this.moveOnAll?s.splice(1,0,"mousemove"):this.dispatchEvent(e,"mousemove"),o&&s.push("globalmousemove"),this.cursor=e.target?.cursor),s.length>0&&this.all(e,s),this._allInteractiveElements.length=0,this._hitElements.length=0,r.overTargets=e.composedPath(),this.freeEvent(e)}mapPointerOver(t){if(!(t instanceof xi))return;const e=this.trackingData(t.pointerId),n=this.createPointerEvent(t),r="mouse"===n.pointerType||"pen"===n.pointerType;this.dispatchEvent(n,"pointerover"),r&&this.dispatchEvent(n,"mouseover"),"mouse"===n.pointerType&&(this.cursor=n.target?.cursor);const i=this.clonePointerEvent(n,"pointerenter");for(i.eventPhase=i.AT_TARGET;i.target&&i.target!==this.rootTarget.parent;)i.currentTarget=i.target,this.notifyTarget(i),r&&this.notifyTarget(i,"mouseenter"),i.target=i.target.parent;e.overTargets=n.composedPath(),this.freeEvent(n),this.freeEvent(i)}mapPointerOut(t){if(!(t instanceof xi))return;const e=this.trackingData(t.pointerId);if(e.overTargets){const n="mouse"===t.pointerType||"pen"===t.pointerType,r=this.findMountedTarget(e.overTargets),i=this.createPointerEvent(t,"pointerout",r);this.dispatchEvent(i),n&&this.dispatchEvent(i,"mouseout");const s=this.createPointerEvent(t,"pointerleave",r);for(s.eventPhase=s.AT_TARGET;s.target&&s.target!==this.rootTarget.parent;)s.currentTarget=s.target,this.notifyTarget(s),n&&this.notifyTarget(s,"mouseleave"),s.target=s.target.parent;e.overTargets=null,this.freeEvent(i),this.freeEvent(s)}this.cursor=null}mapPointerUp(t){if(!(t instanceof xi))return;const e=performance.now(),n=this.createPointerEvent(t);if(this.dispatchEvent(n,"pointerup"),"touch"===n.pointerType)this.dispatchEvent(n,"touchend");else if("mouse"===n.pointerType||"pen"===n.pointerType){const t=2===n.button;this.dispatchEvent(n,t?"rightup":"mouseup")}const r=this.trackingData(t.pointerId),i=this.findMountedTarget(r.pressTargetsByButton[t.button]);let s=i;if(i&&!n.composedPath().includes(i)){let e=i;for(;e&&!n.composedPath().includes(e);){if(n.currentTarget=e,this.notifyTarget(n,"pointerupoutside"),"touch"===n.pointerType)this.notifyTarget(n,"touchendoutside");else if("mouse"===n.pointerType||"pen"===n.pointerType){const t=2===n.button;this.notifyTarget(n,t?"rightupoutside":"mouseupoutside")}e=e.parent}delete r.pressTargetsByButton[t.button],s=e}if(s){const i=this.clonePointerEvent(n,"click");i.target=s,i.path=null,r.clicksByButton[t.button]||(r.clicksByButton[t.button]={clickCount:0,target:i.target,timeStamp:e});const o=r.clicksByButton[t.button];if(o.target===i.target&&e-o.timeStamp<200?++o.clickCount:o.clickCount=1,o.target=i.target,o.timeStamp=e,i.detail=o.clickCount,"mouse"===i.pointerType){const t=2===i.button;this.dispatchEvent(i,t?"rightclick":"click")}else"touch"===i.pointerType&&this.dispatchEvent(i,"tap");this.dispatchEvent(i,"pointertap"),this.freeEvent(i)}this.freeEvent(n)}mapPointerUpOutside(t){if(!(t instanceof xi))return;const e=this.trackingData(t.pointerId),n=this.findMountedTarget(e.pressTargetsByButton[t.button]),r=this.createPointerEvent(t);if(n){let i=n;for(;i;)r.currentTarget=i,this.notifyTarget(r,"pointerupoutside"),"touch"===r.pointerType?this.notifyTarget(r,"touchendoutside"):"mouse"!==r.pointerType&&"pen"!==r.pointerType||this.notifyTarget(r,2===r.button?"rightupoutside":"mouseupoutside"),i=i.parent;delete e.pressTargetsByButton[t.button]}this.freeEvent(r)}mapWheel(t){if(!(t instanceof Ei))return;const e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let n=1;n<t.length&&t[n].parent===e;n++)e=t[n];return e}createPointerEvent(t,e,n){const r=this.allocateEvent(xi);return this.copyPointerData(t,r),this.copyMouseData(t,r),this.copyData(t,r),r.nativeEvent=t.nativeEvent,r.originalEvent=t,r.target=n??this.hitTest(r.global.x,r.global.y)??this._hitElements[0],"string"==typeof e&&(r.type=e),r}createWheelEvent(t){const e=this.allocateEvent(Ei);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e}clonePointerEvent(t,e){const n=this.allocateEvent(xi);return n.nativeEvent=t.nativeEvent,n.originalEvent=t.originalEvent,this.copyPointerData(t,n),this.copyMouseData(t,n),this.copyData(t,n),n.target=t.target,n.path=t.composedPath().slice(),n.type=e??n.type,n}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof xi&&e instanceof xi&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof bi&&e instanceof bi&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.shiftKey=t.shiftKey,e.global.copyFrom(t.global))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=null,e.target=null,e}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)}notifyListeners(t,e){const n=t.currentTarget._events[e];if(n&&t.currentTarget.isInteractive())if("fn"in n)n.once&&t.currentTarget.removeListener(e,n.fn,void 0,!0),n.fn.call(n.context,t);else for(let r=0,i=n.length;r<i&&!t.propagationImmediatelyStopped;r++)n[r].once&&t.currentTarget.removeListener(e,n[r].fn,void 0,!0),n[r].fn.call(n[r].context,t)}}const Ai={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},Ci=class{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new Si(null),yi.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new xi(null),this.rootWheelEvent=new Ei(null),this.cursorStyles={"default":"inherit",pointer:"pointer"},this.features=new Proxy({...Ci.defaultEventFeatures},{set:(t,e,n)=>("globalMove"===e&&(this.rootBoundary.enableGlobalMoveEvents=n),t[e]=n,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(t){const{view:e,resolution:n}=this.renderer;this.setTargetElement(e),this.resolution=n,Ci._defaultEventMode=t.eventMode??"auto",Object.assign(this.features,t.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this.currentCursor===t)return;this.currentCursor=t;const n=this.cursorStyles[t];if(n)switch(typeof n){case"string":e&&(this.domElement.style.cursor=n);break;case"function":n(t);break;case"object":e&&Object.assign(this.domElement.style,n)}else e&&"string"==typeof t&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}get pointer(){return this.rootPointerEvent}onPointerDown(t){if(!this.features.click)return;if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;const e=this.normalizeToPointerData(t);if(this.autoPreventDefault&&e[0].isNormalized){(t.cancelable||!("cancelable"in t))&&t.preventDefault()}for(let n=0,r=e.length;n<r;n++){const t=e[n],r=this.bootstrapEvent(this.rootPointerEvent,t);this.rootBoundary.mapEvent(r)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(!this.features.move)return;if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;yi.pointerMoved();const e=this.normalizeToPointerData(t);for(let n=0,r=e.length;n<r;n++){const t=this.bootstrapEvent(this.rootPointerEvent,e[n]);this.rootBoundary.mapEvent(t)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(!this.features.click)return;if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);const n=e!==this.domElement?"outside":"",r=this.normalizeToPointerData(t);for(let i=0,s=r.length;i<s;i++){const t=this.bootstrapEvent(this.rootPointerEvent,r[i]);t.type+=n,this.rootBoundary.mapEvent(t)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(!this.features.click)return;if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;const e=this.normalizeToPointerData(t);for(let n=0,r=e.length;n<r;n++){const t=this.bootstrapEvent(this.rootPointerEvent,e[n]);this.rootBoundary.mapEvent(t)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){if(!this.features.wheel)return;const e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this.removeEvents(),this.domElement=t,yi.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;yi.addTickerListener();const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0)),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;yi.removeTickerListener();const t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,e,n){let r;r=this.domElement.parentElement?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0};const i=1/this.resolution;t.x=(e-r.left)*(this.domElement.width/r.width)*i,t.y=(n-r.top)*(this.domElement.height/r.height)*i}normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let n=0,r=t.changedTouches.length;n<r;n++){const r=t.changedTouches[n];"undefined"==typeof r.button&&(r.button=0),"undefined"==typeof r.buttons&&(r.buttons=1),"undefined"==typeof r.isPrimary&&(r.isPrimary=1===t.touches.length&&"touchstart"===t.type),"undefined"==typeof r.width&&(r.width=r.radiusX||1),"undefined"==typeof r.height&&(r.height=r.radiusY||1),"undefined"==typeof r.tiltX&&(r.tiltX=0),"undefined"==typeof r.tiltY&&(r.tiltY=0),"undefined"==typeof r.pointerType&&(r.pointerType="touch"),"undefined"==typeof r.pointerId&&(r.pointerId=r.identifier||0),"undefined"==typeof r.pressure&&(r.pressure=r.force||.5),"undefined"==typeof r.twist&&(r.twist=0),"undefined"==typeof r.tangentialPressure&&(r.tangentialPressure=0),"undefined"==typeof r.layerX&&(r.layerX=r.offsetX=r.clientX),"undefined"==typeof r.layerY&&(r.layerY=r.offsetY=r.clientY),r.isNormalized=!0,r.type=t.type,e.push(r)}else if(globalThis.MouseEvent&&(!(t instanceof MouseEvent)||this.supportsPointerEvents&&t instanceof globalThis.PointerEvent))e.push(t);else{const n=t;"undefined"==typeof n.isPrimary&&(n.isPrimary=!0),"undefined"==typeof n.width&&(n.width=1),"undefined"==typeof n.height&&(n.height=1),"undefined"==typeof n.tiltX&&(n.tiltX=0),"undefined"==typeof n.tiltY&&(n.tiltY=0),"undefined"==typeof n.pointerType&&(n.pointerType="mouse"),"undefined"==typeof n.pointerId&&(n.pointerId=1),"undefined"==typeof n.pressure&&(n.pressure=.5),"undefined"==typeof n.twist&&(n.twist=0),"undefined"==typeof n.tangentialPressure&&(n.tangentialPressure=0),n.isNormalized=!0,e.push(n)}return e}normalizeWheelEvent(t){const e=this.rootWheelEvent;return this.transferMouseData(e,t),e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,e.deltaMode=t.deltaMode,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,"pointerleave"===t.type&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=Ai[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}};let Ii=Ci;function Ri(t){return"dynamic"===t||"static"===t}Ii.extension={name:"events",type:[qt.RendererSystem,qt.CanvasRendererSystem]},Ii.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0},Zt.add(Ii);const Pi={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??Ri(Ii.defaultEventMode)},set interactive(t){K(0,"Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=t,this.eventMode=t?"static":"auto"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??Ii.defaultEventMode},set eventMode(t){this._internalInteractive=Ri(t),this._internalEventMode=t},isInteractive(){return"static"===this.eventMode||"dynamic"===this.eventMode},interactiveChildren:!0,hitArea:null,addEventListener(t,e,n){const r="function"==typeof e?void 0:e;t="boolean"==typeof n&&n||"object"==typeof n&&n.capture?`${t}capture`:t,e="function"==typeof e?e:e.handleEvent,this.on(t,e,r)},removeEventListener(t,e,n){const r="function"==typeof e?void 0:e;t="boolean"==typeof n&&n||"object"==typeof n&&n.capture?`${t}capture`:t,e="function"==typeof e?e:e.handleEvent,this.off(t,e,r)},dispatchEvent(t){if(!(t instanceof vi))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return t.defaultPrevented=!1,t.path=null,t.target=this,t.manager.dispatchEvent(t),!t.defaultPrevented}};ni.mixin(Pi);ni.mixin({accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1});class Mi{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(G.tablet||G.phone)&&this.createTouchHook();const e=document.createElement("div");e.style.width="100px",e.style.height="100px",e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.zIndex=2..toString(),this.div=e,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const t=document.createElement("button");t.style.width="1px",t.style.height="1px",t.style.position="absolute",t.style.top="-1000px",t.style.left="-1000px",t.style.zIndex=2..toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",(()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()})),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode?.appendChild(this.div))}deactivate(){this._isActive&&!this._isMobileAccessibility&&(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode?.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.isInteractive()&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);const e=t.children;if(e)for(let n=0;n<e.length;n++)this.updateAccessibleObjects(e[n])}update(){const t=performance.now();if(G.android.device&&t<this.androidUpdateCount)return;if(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen)return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:e,y:n,width:r,height:i}=this.renderer.view.getBoundingClientRect(),{width:s,height:o,resolution:a}=this.renderer,h=r/s*a,l=i/o*a;let u=this.div;u.style.left=`${e}px`,u.style.top=`${n}px`,u.style.width=`${s}px`,u.style.height=`${o}px`;for(let c=0;c<this.children.length;c++){const t=this.children[c];if(t.renderId!==this.renderId)t._accessibleActive=!1,Nt(this.children,c,1),this.div.removeChild(t._accessibleDiv),this.pool.push(t._accessibleDiv),t._accessibleDiv=null,c--;else{u=t._accessibleDiv;let e=t.hitArea;const n=t.worldTransform;t.hitArea?(u.style.left=(n.tx+e.x*n.a)*h+"px",u.style.top=(n.ty+e.y*n.d)*l+"px",u.style.width=e.width*n.a*h+"px",u.style.height=e.height*n.d*l+"px"):(e=t.getBounds(),this.capHitArea(e),u.style.left=e.x*h+"px",u.style.top=e.y*l+"px",u.style.width=e.width*h+"px",u.style.height=e.height*l+"px",u.title!==t.accessibleTitle&&null!==t.accessibleTitle&&(u.title=t.accessibleTitle),u.getAttribute("aria-label")!==t.accessibleHint&&null!==t.accessibleHint&&u.setAttribute("aria-label",t.accessibleHint)),t.accessibleTitle===u.title&&t.tabIndex===u.tabIndex||(u.title=t.accessibleTitle,u.tabIndex=t.tabIndex,this.debug&&this.updateDebugHTML(u))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:e,height:n}=this.renderer;t.x+t.width>e&&(t.width=e-t.x),t.y+t.height>n&&(t.height=n-t.y)}addChild(t){let e=this.pool.pop();e||(e=document.createElement("button"),e.style.width="100px",e.style.height="100px",e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=2..toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&null!==t.accessibleTitle?e.title=t.accessibleTitle:t.accessibleHint&&null!==t.accessibleHint||(e.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&null!==t.accessibleHint&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,e){const{displayObject:n}=t.target,r=this.renderer.events.rootBoundary,i=Object.assign(new vi(r),{target:n});r.rootTarget=this.renderer.lastObjectRendered,e.forEach((t=>r.dispatchEvent(i,t)))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){9===t.keyCode&&this.activate()}_onMouseMove(t){0===t.movementX&&0===t.movementY||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}Mi.extension={name:"accessibility",type:[qt.RendererPlugin,qt.CanvasRendererPlugin]},Zt.add(Mi);const Oi=class{constructor(t){this.stage=new ai,t=Object.assign({forceCanvas:!1},t),this.renderer=Br(t),Oi._plugins.forEach((e=>{e.init.call(this,t)}))}render(){this.renderer.render(this.stage)}get view(){return this.renderer.view}get screen(){return this.renderer.screen}destroy(t,e){const n=Oi._plugins.slice(0);n.reverse(),n.forEach((t=>{t.destroy.call(this)})),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null}};let Di=Oi;Di._plugins=[],Zt.handleByList(qt.Application,Di._plugins);class Ni{static init(t){Object.defineProperty(this,"resizeTo",{set(t){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=t,t&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame((()=>this.resize())))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;let t,e;if(this.cancelResize(),this._resizeTo===globalThis.window)t=globalThis.innerWidth,e=globalThis.innerHeight;else{const{clientWidth:n,clientHeight:r}=this._resizeTo;t=n,e=r}this.renderer.resize(t,e),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}Ni.extension=qt.Application,Zt.add(Ni);const ki={loader:qt.LoadParser,resolver:qt.ResolveParser,cache:qt.CacheParser,detection:qt.DetectionParser};Zt.handle(qt.Asset,(t=>{const e=t.ref;Object.entries(ki).filter((([t])=>!!e[t])).forEach((([t,n])=>Zt.add(Object.assign(e[t],{extension:e[t].extension??n}))))}),(t=>{const e=t.ref;Object.keys(ki).filter((t=>!!e[t])).forEach((t=>Zt.remove(e[t])))}));class Li{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach((t=>{this._assetList.push(t)})),this.verbose,this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let n=0;n<e;n++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}function Fi(t,e){const n=t.split("?")[0],r=Y.extname(n).toLowerCase();return Array.isArray(e)?e.includes(r):r===e}const Bi=(t,e)=>(Array.isArray(t)||(t=[t]),e?t.map((t=>"string"==typeof t?e(t):t)):t);const Ui=new class{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const e=this._cache.get(t);return e}set(t,e){const n=Bi(t);let r;for(let o=0;o<this.parsers.length;o++){const t=this.parsers[o];if(t.test(e)){r=t.getCacheableAssets(n,e);break}}r||(r={},n.forEach((t=>{r[t]=e})));const i=Object.keys(r),s={cacheKeys:i,keys:n};if(n.forEach((t=>{this._cacheMap.set(t,s)})),i.forEach((t=>{this._cache.has(t)&&this._cache.get(t),this._cache.set(t,r[t])})),e instanceof Pn){const t=e;n.forEach((e=>{t.baseTexture!==Pn.EMPTY.baseTexture&&ue.addToCache(t.baseTexture,e),Pn.addToCache(t,e)}))}}remove(t){if(this._cacheMap.get(t),!this._cacheMap.has(t))return;const e=this._cacheMap.get(t);e.cacheKeys.forEach((t=>{this._cache["delete"](t)})),e.keys.forEach((t=>{this._cacheMap["delete"](t)}))}get parsers(){return this._parsers}},ji=t=>!Array.isArray(t);class Gi{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,e,n)=>(this._parsersValidated=!1,t[e]=n,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,e){const n={promise:null,parser:null};return n.promise=(async()=>{let r=null,i=null;if(e.loadParser&&(i=this._parserHash[e.loadParser]),!i){for(let n=0;n<this.parsers.length;n++){const r=this.parsers[n];if(r.load&&r.test?.(t,e,this)){i=r;break}}if(!i)return null}r=await i.load(t,e,this),n.parser=i;for(let t=0;t<this.parsers.length;t++){const i=this.parsers[t];i.parse&&i.parse&&await(i.testParse?.(r,e,this))&&(r=await i.parse(r,e,this)||r,n.parser=i)}return r})(),n}async load(t,e){this._parsersValidated||this._validateParsers();let n=0;const r={},i=ji(t),s=Bi(t,(t=>({src:t}))),o=s.length,a=s.map((async t=>{const i=Y.toAbsolute(t.src);if(!r[t.src])try{this.promiseCache[i]||(this.promiseCache[i]=this._getLoadPromiseAndParser(i,t)),r[t.src]=await this.promiseCache[i].promise,e&&e(++n/o)}catch(et){throw delete this.promiseCache[i],delete r[t.src],new Error(`[Loader.load] Failed to load ${i}.\n${et}`)}}));return await Promise.all(a),i?r[s[0].src]:r}async unload(t){const e=Bi(t,(t=>({src:t}))).map((async t=>{const e=Y.toAbsolute(t.src),n=this.promiseCache[e];if(n){const r=await n.promise;n.parser?.unload?.(r,t,this),delete this.promiseCache[e]}}));await Promise.all(e)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter((t=>t.name)).reduce(((t,e)=>(t[e.name],{...t,[e.name]:e})),{})}}var Hi=(t=>(t[t.Low=0]="Low",t[t.Normal=1]="Normal",t[t.High=2]="High",t))(Hi||{});function zi(t,e){if(Array.isArray(e)){for(const n of e)if(t.startsWith(`data:${n}`))return!0;return!1}return t.startsWith(`data:${e}`)}const Wi={extension:{type:qt.LoadParser,priority:Hi.Low},name:"loadJson",test(t){return zi(t,"application/json")||Fi(t,".json")},async load(t){const e=await w.ADAPTER.fetch(t);return await e.json()}};Zt.add(Wi);const Vi={name:"loadTxt",extension:{type:qt.LoadParser,priority:Hi.Low},test(t){return zi(t,"text/plain")||Fi(t,".txt")},async load(t){const e=await w.ADAPTER.fetch(t);return await e.text()}};Zt.add(Vi);const Xi=["normal","bold","100","200","300","400","500","600","700","800","900"],$i=[".ttf",".otf",".woff",".woff2"],Yi=["font/ttf","font/otf","font/woff","font/woff2"],qi=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;const Ki={extension:{type:qt.LoadParser,priority:Hi.Low},name:"loadWebFont",test(t){return zi(t,Yi)||Fi(t,$i)},async load(t,e){const n=w.ADAPTER.getFontFaceSet();if(n){const r=[],i=e.data?.family??function(t){const e=Y.extname(t),n=Y.basename(t,e).replace(/(-|_)/g," ").toLowerCase().split(" ").map((t=>t.charAt(0).toUpperCase()+t.slice(1)));let r=n.length>0;for(const s of n)if(!s.match(qi)){r=!1;break}let i=n.join(" ");return r||(i=`"${i.replace(/[\\"]/g,"\\$&")}"`),i}(t),s=e.data?.weights?.filter((t=>Xi.includes(t)))??["normal"],o=e.data??{};for(let e=0;e<s.length;e++){const a=s[e],h=new FontFace(i,`url(${encodeURI(t)})`,{...o,weight:a});await h.load(),n.add(h),r.push(h)}return 1===r.length?r[0]:r}return null},unload(t){(Array.isArray(t)?t:[t]).forEach((t=>w.ADAPTER.getFontFaceSet()["delete"](t)))}};Zt.add(Ki);let Qi,Zi=0;const Ji={id:"checkImageBitmap",code:"\n    async function checkImageBitmap()\n    {\n        try\n        {\n            if (typeof createImageBitmap !== 'function') return false;\n\n            const response = await fetch('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=');\n            const imageBlob =  await response.blob();\n            const imageBitmap = await createImageBitmap(imageBlob);\n\n            return imageBitmap.width === 1 && imageBitmap.height === 1;\n        }\n        catch (e)\n        {\n            return false;\n        }\n    }\n    checkImageBitmap().then((result) => { self.postMessage(result); });\n    "},ts={id:"loadImageBitmap",code:"\n    async function loadImageBitmap(url)\n    {\n        const response = await fetch(url);\n\n        if (!response.ok)\n        {\n            throw new Error(`[WorkerManager.loadImageBitmap] Failed to fetch ${url}: `\n                + `${response.status} ${response.statusText}`);\n        }\n\n        const imageBlob =  await response.blob();\n        const imageBitmap = await createImageBitmap(imageBlob);\n\n        return imageBitmap;\n    }\n    self.onmessage = async (event) =>\n    {\n        try\n        {\n            const imageBitmap = await loadImageBitmap(event.data.data[0]);\n\n            self.postMessage({\n                data: imageBitmap,\n                uuid: event.data.uuid,\n                id: event.data.id,\n            }, [imageBitmap]);\n        }\n        catch(e)\n        {\n            self.postMessage({\n                error: e,\n                uuid: event.data.uuid,\n                id: event.data.id,\n            });\n        }\n    };"};let es;const ns=new class{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return void 0!==this._isImageBitmapSupported||(this._isImageBitmapSupported=new Promise((t=>{const e=URL.createObjectURL(new Blob([Ji.code],{type:"application/javascript"})),n=new Worker(e);n.addEventListener("message",(r=>{n.terminate(),URL.revokeObjectURL(e),t(r.data)}))}))),this._isImageBitmapSupported}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){void 0===Qi&&(Qi=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<Qi&&(es||(es=URL.createObjectURL(new Blob([ts.code],{type:"application/javascript"}))),this._createdWorkers++,t=new Worker(es),t.addEventListener("message",(t=>{this.complete(t.data),this.returnWorker(t.target),this.next()}))),t}returnWorker(t){this.workerPool.push(t)}complete(t){void 0!==t.error?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,e){await this._initWorkers();const n=new Promise(((n,r)=>{this.queue.push({id:t,arguments:e,resolve:n,reject:r})}));return this.next(),n}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const e=this.queue.pop(),n=e.id;this.resolveHash[Zi]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:Zi++,id:n})}};function rs(t,e,n){const r=new Pn(t);return r.baseTexture.on("dispose",(()=>{delete e.promiseCache[n]})),r}const is=[".jpeg",".jpg",".png",".webp",".avif"],ss=["image/jpeg","image/png","image/webp","image/avif"];const os={name:"loadTextures",extension:{type:qt.LoadParser,priority:Hi.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(t){return zi(t,ss)||Fi(t,is)},async load(t,e,n){let r=null;r=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap?this.config.preferWorkers&&await ns.isImageBitmapSupported()?await ns.loadImageBitmap(t):await async function(t){const e=await w.ADAPTER.fetch(t);if(!e.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${t}: ${e.status} ${e.statusText}`);const n=await e.blob();return await createImageBitmap(n)}(t):await new Promise((e=>{r=new Image,r.crossOrigin=this.config.crossOrigin,r.src=t,r.complete?e(r):r.onload=()=>{e(r)}}));const i=new ue(r,{resolution:Yt(t),...e.data});return i.resource.src=t,rs(i,n,t)},unload(t){t.destroy(!0)}};Zt.add(os);const as={extension:{type:qt.LoadParser,priority:Hi.High},name:"loadSVG",test(t){return zi(t,"image/svg+xml")||Fi(t,".svg")},async testParse(t){return Qr.test(t)},async parse(t,e,n){const r=new Qr(t,e?.data?.resourceOptions);await r.load();const i=new ue(r,{resolution:Yt(t),...e?.data});i.resource.src=t;return rs(i,n,t)},async load(t,e){return(await w.ADAPTER.fetch(t)).text()},unload:os.unload};function hs(t,e,n,r,i){const s=e[n];for(let o=0;o<s.length;o++){const a=s[o];n<e.length-1?hs(t.replace(r[n],a),e,n+1,r,i):i.push(t.replace(r[n],a))}}function ls(t){const e=t.match(/\{(.*?)\}/g),n=[];if(e){const r=[];e.forEach((t=>{const e=t.substring(1,t.length-1).split(",");r.push(e)})),hs(t,r,0,e,n)}else n.push(t);return n}Zt.add(as);class us{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,e)=>`${t}${this._bundleIdConnector}${e}`,extractAssetIdFromBundle:(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,"bar"!==this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar")))throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach((t=>{this._preferredOrder.push(t),t.priority||(t.priority=Object.keys(t.params))})),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if("string"==typeof t)this._defaultSearchParams=t;else{const e=t;this._defaultSearchParams=Object.keys(e).map((t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`)).join("&")}}addManifest(t){this._manifest,this._manifest=t,t.bundles.forEach((t=>{this.addBundle(t.name,t.assets)}))}addBundle(t,e){const n=[];Array.isArray(e)?e.forEach((e=>{if("string"==typeof e.name){const r=this._createBundleAssetId(t,e.name);n.push(r),this.add([e.name,r],e.srcs,e.data)}else{const r=e.name.map((e=>this._createBundleAssetId(t,e)));r.forEach((t=>{n.push(t)})),this.add([...e.name,...r],e.srcs)}})):Object.keys(e).forEach((r=>{n.push(this._createBundleAssetId(t,r)),this.add([r,this._createBundleAssetId(t,r)],e[r])})),this._bundles[t]=n}add(t,e,n){const r=Bi(t);r.forEach((t=>{this.hasKey(t)})),Array.isArray(e)||(e="string"==typeof e?ls(e):[e]);const i=e.map((t=>{let e=t;if("string"==typeof t){let n=!1;for(let r=0;r<this._parsers.length;r++){const i=this._parsers[r];if(i.test(t)){e=i.parse(t),n=!0;break}}n||(e={src:t})}return e.format||(e.format=e.src.split(".").pop()),e.alias||(e.alias=r),(this._basePath||this._rootPath)&&(e.src=Y.toAbsolute(e.src,this._basePath,this._rootPath)),e.src=this._appendDefaultSearchParams(e.src),e.data=e.data??n,e}));r.forEach((t=>{this._assetMap[t]=i}))}resolveBundle(t){const e=ji(t);t=Bi(t);const n={};return t.forEach((t=>{const e=this._bundles[t];if(e){const r=this.resolve(e),i={};for(const e in r){const n=r[e];i[this._extractAssetIdFromBundle(t,e)]=n}n[t]=i}})),e?n[t[0]]:n}resolveUrl(t){const e=this.resolve(t);if("string"!=typeof t){const t={};for(const n in e)t[n]=e[n].src;return t}return e.src}resolve(t){const e=ji(t);t=Bi(t);const n={};return t.forEach((t=>{if(!this._resolverHash[t])if(this._assetMap[t]){let e=this._assetMap[t];const n=this._getPreferredOrder(e),r=e[0];n?.priority.forEach((t=>{n.params[t].forEach((n=>{const r=e.filter((e=>!!e[t]&&e[t]===n));r.length&&(e=r)}))})),this._resolverHash[t]=e[0]??r}else{let e=t;(this._basePath||this._rootPath)&&(e=Y.toAbsolute(e,this._basePath,this._rootPath)),e=this._appendDefaultSearchParams(e),this._resolverHash[t]={src:e}}n[t]=this._resolverHash[t]})),e?n[t[0]]:n}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const e=t[0],n=this._preferredOrder.find((t=>t.params.format.includes(e.format)));if(n)return n}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;return`${t}${/\?/.test(t)?"&":"?"}${this._defaultSearchParams}`}}const cs=new class{constructor(){this._detections=[],this._initialized=!1,this.resolver=new us,this.loader=new Gi,this.cache=Ui,this._backgroundLoader=new Li(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){if(this._initialized)return;if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let e=t.manifest;"string"==typeof e&&(e=await this.load(e)),this.resolver.addManifest(e)}const e=t.texturePreference?.resolution??1,n="number"==typeof e?[e]:e;let r=[];if(t.texturePreference?.format){const e=t.texturePreference?.format;r="string"==typeof e?[e]:e;for(const t of this._detections)await t.test()||(r=await t.remove(r))}else for(const i of this._detections)await i.test()&&(r=await i.add(r));this.resolver.prefer({params:{format:r,resolution:n}}),t.preferences&&this.setPreferences(t.preferences)}add(t,e,n){this.resolver.add(t,e,n)}async load(t,e){this._initialized||await this.init();const n=ji(t),r=Bi(t).map((t=>"string"!=typeof t?(this.resolver.add(t.src,t),t.src):(this.resolver.hasKey(t)||this.resolver.add(t,t),t))),i=this.resolver.resolve(r),s=await this._mapLoadToResolve(i,e);return n?s[r[0]]:s}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let n=!1;"string"==typeof t&&(n=!0,t=[t]);const r=this.resolver.resolveBundle(t),i={},s=Object.keys(r);let o=0,a=0;const h=()=>{e?.(++o/a)},l=s.map((t=>{const e=r[t];return a+=Object.keys(e).length,this._mapLoadToResolve(e,h).then((e=>{i[t]=e}))}));return await Promise.all(l),n?i[t[0]]:i}async backgroundLoad(t){this._initialized||await this.init(),"string"==typeof t&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),"string"==typeof t&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach((t=>{this._backgroundLoader.add(Object.values(t))}))}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if("string"==typeof t)return Ui.get(t);const e={};for(let n=0;n<t.length;n++)e[n]=Ui.get(t[n]);return e}async _mapLoadToResolve(t,e){const n=Object.values(t),r=Object.keys(t);this._backgroundLoader.active=!1;const i=await this.loader.load(n,e);this._backgroundLoader.active=!0;const s={};return n.forEach(((t,e)=>{const n=i[t.src],o=[t.src];t.alias&&o.push(...t.alias),s[r[e]]=n,Ui.set(o,n)})),s}async unload(t){this._initialized||await this.init();const e=Bi(t).map((t=>"string"!=typeof t?t.src:t)),n=this.resolver.resolve(e);await this._unloadFromResolved(n)}async unloadBundle(t){this._initialized||await this.init(),t=Bi(t);const e=this.resolver.resolveBundle(t),n=Object.keys(e).map((t=>this._unloadFromResolved(e[t])));await Promise.all(n)}async _unloadFromResolved(t){const e=Object.values(t);e.forEach((t=>{Ui.remove(t.src)})),await this.loader.unload(e)}get detections(){return this._detections}get preferWorkers(){return os.config.preferWorkers}set preferWorkers(t){K(0,"Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:t})}setPreferences(t){this.loader.parsers.forEach((e=>{e.config&&Object.keys(e.config).filter((e=>e in t)).forEach((n=>{e.config[n]=t[n]}))}))}};Zt.handleByList(qt.LoadParser,cs.loader.parsers).handleByList(qt.ResolveParser,cs.resolver.parsers).handleByList(qt.CacheParser,cs.cache.parsers).handleByList(qt.DetectionParser,cs.detections);const ds={extension:qt.CacheParser,test:t=>Array.isArray(t)&&t.every((t=>t instanceof Pn)),getCacheableAssets:(t,e)=>{const n={};return t.forEach((t=>{e.forEach(((e,r)=>{n[t+(0===r?"":r+1)]=e}))})),n}};Zt.add(ds);const fs={extension:{type:qt.DetectionParser,priority:1},test:async()=>{if(!globalThis.createImageBitmap)return!1;const t=await w.ADAPTER.fetch("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=").then((t=>t.blob()));return createImageBitmap(t).then((()=>!0),(()=>!1))},add:async t=>[...t,"avif"],remove:async t=>t.filter((t=>"avif"!==t))};Zt.add(fs);const ps={extension:{type:qt.DetectionParser,priority:0},test:async()=>{if(!globalThis.createImageBitmap)return!1;const t=await w.ADAPTER.fetch("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=").then((t=>t.blob()));return createImageBitmap(t).then((()=>!0),(()=>!1))},add:async t=>[...t,"webp"],remove:async t=>t.filter((t=>"webp"!==t))};Zt.add(ps);const ms=["png","jpg","jpeg"],gs={extension:{type:qt.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async t=>[...t,...ms],remove:async t=>t.filter((t=>!ms.includes(t)))};Zt.add(gs);const _s={extension:qt.ResolveParser,test:os.test,parse:t=>({resolution:parseFloat(w.RETINA_PREFIX.exec(t)?.[1]??"1"),format:t.split(".").pop(),src:t})};Zt.add(_s);const ys=(t,e)=>{const n=e.split("?")[1];return n&&(t+=`?${n}`),t};var vs=(t=>(t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t))(vs||{});const bs={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35986:1,34798:1,37808:1};let xs,Es;function ws(){Es={s3tc:xs.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:xs.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:xs.getExtension("WEBGL_compressed_texture_etc"),etc1:xs.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:xs.getExtension("WEBGL_compressed_texture_pvrtc")||xs.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:xs.getExtension("WEBGL_compressed_texture_atc"),astc:xs.getExtension("WEBGL_compressed_texture_astc")}}const Ts={extension:{type:qt.DetectionParser,priority:2},test:async()=>{const t=w.ADAPTER.createCanvas().getContext("webgl");return!!t&&(xs=t,!0)},add:async t=>{Es||ws();const e=[];for(const n in Es){Es[n]&&e.push(n)}return[...e,...t]},remove:async t=>(Es||ws(),t.filter((t=>!(t in Es))))};Zt.add(Ts);class Ss extends ae{constructor(t,e={width:1,height:1,autoLoad:!0}){let n,r;"string"==typeof t?(n=t,r=new Uint8Array):(n=null,r=t),super(r,e),this.origin=n,this.buffer=r?new Jt(r):null,this._load=null,this.loaded=!1,null!==this.origin&&!1!==e.autoLoad&&this.load(),null===this.origin&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}load(){return this._load||(this._load=fetch(this.origin).then((t=>t.blob())).then((t=>t.arrayBuffer())).then((t=>(this.data=new Uint32Array(t),this.buffer=new Jt(t),this.loaded=!0,this.onBlobLoaded(t),this.update(),this)))),this._load}}class As extends Ss{constructor(t,e){super(t,e),this.format=e.format,this.levels=e.levels||1,this._width=e.width,this._height=e.height,this._extension=As._formatToExtension(this.format),(e.levelBuffers||this.buffer)&&(this._levelBuffers=e.levelBuffers||As._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,e,n){const r=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;for(let i=0,s=this.levels;i<s;i++){const{levelID:t,levelWidth:e,levelHeight:n,levelBuffer:s}=this._levelBuffers[i];r.compressedTexImage2D(r.TEXTURE_2D,t,this.format,e,n,0,s)}return!0}onBlobLoaded(){this._levelBuffers=As._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t>=36196)return"etc1";if(t>=35986&&t<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers(t,e,n,r,i,s,o){const a=new Array(n);let h=t.byteOffset,l=s,u=o,c=l+r-1&~(r-1),d=u+i-1&~(i-1),f=c*d*bs[e];for(let p=0;p<n;p++)a[p]={levelID:p,levelWidth:n>1?l:c,levelHeight:n>1?u:d,levelBuffer:new Uint8Array(t.buffer,h,f)},h+=f,l=l>>1||1,u=u>>1||1,c=l+r-1&~(r-1),d=u+i-1&~(i-1),f=c*d*bs[e];return a}}const Cs=124,Is=3,Rs=4,Ps=7,Ms=19,Os=2,Ds=0,Ns=1,ks=2,Ls=3;const Fs={827611204:vs.COMPRESSED_RGBA_S3TC_DXT1_EXT,861165636:vs.COMPRESSED_RGBA_S3TC_DXT3_EXT,894720068:vs.COMPRESSED_RGBA_S3TC_DXT5_EXT},Bs={70:vs.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:vs.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:vs.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:vs.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:vs.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:vs.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:vs.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:vs.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:vs.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT};const Us=[171,75,84,88,32,49,49,187,13,10,26,10],js=12,Gs=16,Hs=24,zs=28,Ws=36,Vs=40,Xs=44,$s=48,Ys=52,qs=56,Ks=60,Qs=64,Zs={[u.UNSIGNED_BYTE]:1,[u.UNSIGNED_SHORT]:2,[u.INT]:4,[u.UNSIGNED_INT]:4,[u.FLOAT]:4,[u.HALF_FLOAT]:8},Js={[h.RGBA]:4,[h.RGB]:3,[h.RG]:2,[h.RED]:1,[h.LUMINANCE]:1,[h.LUMINANCE_ALPHA]:2,[h.ALPHA]:1},to={[u.UNSIGNED_SHORT_4_4_4_4]:2,[u.UNSIGNED_SHORT_5_5_5_1]:2,[u.UNSIGNED_SHORT_5_6_5]:2};function eo(t,e,n=!1){const r=new DataView(e);if(!function(t,e){for(let n=0;n<Us.length;n++)if(e.getUint8(n)!==Us[n])return!1;return!0}(0,r))return null;const i=67305985===r.getUint32(js,!0),s=r.getUint32(Gs,i),o=r.getUint32(Hs,i),a=r.getUint32(zs,i),h=r.getUint32(Ws,i),l=r.getUint32(Vs,i)||1,c=r.getUint32(Xs,i)||1,d=r.getUint32($s,i)||1,f=r.getUint32(Ys,i),p=r.getUint32(qs,i),m=r.getUint32(Ks,i);if(0===l||1!==c)throw new Error("Only 2D textures are supported");if(1!==f)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(1!==d)throw new Error("WebGL does not support array textures");const g=h+3&-4,_=l+3&-4,y=new Array(d);let v,b=h*l;if(0===s&&(b=g*_),v=0!==s?Zs[s]?Zs[s]*Js[o]:to[s]:bs[a],void 0===v)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const x=n?function(t,e,n){const r=new Map;let i=0;for(;i<e;){const s=t.getUint32(Qs+i,n),o=Qs+i+4,a=3-(s+3)%4;if(0===s||s>e-i)break;let h=0;for(;h<s&&0!==t.getUint8(o+h);h++);if(-1===h)break;const l=(new TextDecoder).decode(new Uint8Array(t.buffer,o,h)),u=new DataView(t.buffer,o+h+1,s-h-1);r.set(l,u),i+=4+s+a}return r}(r,m,i):null;let E=b*v,w=h,T=l,S=g,A=_,C=Qs+m;for(let u=0;u<p;u++){const t=r.getUint32(C,i);let n=C+4;for(let r=0;r<d;r++){let t=y[r];t||(t=y[r]=new Array(p)),t[u]={levelID:u,levelWidth:p>1||0!==s?w:S,levelHeight:p>1||0!==s?T:A,levelBuffer:new Uint8Array(e,n,E)},n+=E}C+=t+4,C=C%4!=0?C+4-C%4:C,w=w>>1||1,T=T>>1||1,S=w+4-1&-4,A=T+4-1&-4,E=S*A*v}return 0!==s?{uncompressed:y.map((t=>{let e=t[0].levelBuffer,n=!1;return s===u.FLOAT?e=new Float32Array(t[0].levelBuffer.buffer,t[0].levelBuffer.byteOffset,t[0].levelBuffer.byteLength/4):s===u.UNSIGNED_INT?(n=!0,e=new Uint32Array(t[0].levelBuffer.buffer,t[0].levelBuffer.byteOffset,t[0].levelBuffer.byteLength/4)):s===u.INT&&(n=!0,e=new Int32Array(t[0].levelBuffer.buffer,t[0].levelBuffer.byteOffset,t[0].levelBuffer.byteLength/4)),{resource:new ae(e,{width:t[0].levelWidth,height:t[0].levelHeight}),type:s,format:n?no(o):o}})),kvData:x}:{compressed:y.map((t=>new As(null,{format:a,width:h,height:l,levels:p,levelBuffers:t}))),kvData:x}}function no(t){switch(t){case h.RGBA:return h.RGBA_INTEGER;case h.RGB:return h.RGB_INTEGER;case h.RG:return h.RG_INTEGER;case h.RED:return h.RED_INTEGER;default:return t}}const ro={extension:{type:qt.LoadParser,priority:Hi.High},name:"loadDDS",test(t){return Fi(t,".dds")},async load(t,e,n){const r=await w.ADAPTER.fetch(t),i=function(t){const e=new Uint32Array(t);if(542327876!==e[0])throw new Error("Invalid DDS file magic word");const n=new Uint32Array(t,0,Cs/Uint32Array.BYTES_PER_ELEMENT),r=n[Is],i=n[Rs],s=n[Ps],o=new Uint32Array(t,Ms*Uint32Array.BYTES_PER_ELEMENT,32/Uint32Array.BYTES_PER_ELEMENT),a=o[1];if(4&a){const n=o[Os];if(808540228!==n){const e=Fs[n],o=new Uint8Array(t,128);return[new As(o,{format:e,width:i,height:r,levels:s})]}const a=128,h=new Uint32Array(e.buffer,a,20/Uint32Array.BYTES_PER_ELEMENT),l=h[Ds],u=h[Ns],c=h[ks],d=h[Ls],f=Bs[l];if(void 0===f)throw new Error(`DDSParser cannot parse texture data with DXGI format ${l}`);if(4===c)throw new Error("DDSParser does not support cubemap textures");if(6===u)throw new Error("DDSParser does not supported 3D texture data");const p=new Array,m=148;if(1===d)p.push(new Uint8Array(t,m));else{const e=bs[f];let n=0,o=i,a=r;for(let t=0;t<s;t++)n+=Math.max(1,o+3&-4)*Math.max(1,a+3&-4)*e,o>>>=1,a>>>=1;let h=m;for(let r=0;r<d;r++)p.push(new Uint8Array(t,h,n)),h+=n}return p.map((t=>new As(t,{format:f,width:i,height:r,levels:s})))}if(64&a)throw new Error("DDSParser does not support uncompressed texture data.");if(512&a)throw new Error("DDSParser does not supported YUV uncompressed texture data.");if(131072&a)throw new Error("DDSParser does not support single-channel (lumninance) texture data!");if(2&a)throw new Error("DDSParser does not support single-channel (alpha) texture data!");throw new Error("DDSParser failed to load a texture file due to an unknown reason!")}(await r.arrayBuffer()),s=i.map((r=>rs(new ue(r,{mipmap:p.OFF,alphaMode:m.NO_PREMULTIPLIED_ALPHA,resolution:Yt(t),...e.data}),n,t)));return 1===s.length?s[0]:s},unload(t){Array.isArray(t)?t.forEach((t=>t.destroy(!0))):t.destroy(!0)}};Zt.add(ro);const io={extension:{type:qt.LoadParser,priority:Hi.High},name:"loadKTX",test(t){return Fi(t,".ktx")},async load(t,e,n){const r=await w.ADAPTER.fetch(t),i=await r.arrayBuffer(),{compressed:s,uncompressed:o,kvData:a}=eo(0,i),h=s??o,l={mipmap:p.OFF,alphaMode:m.NO_PREMULTIPLIED_ALPHA,resolution:Yt(t),...e.data},u=h.map((e=>{h===o&&Object.assign(l,{type:e.type,format:e.format});const r=new ue(e,l);return r.ktxKeyValueData=a,rs(r,n,t)}));return 1===u.length?u[0]:u},unload(t){Array.isArray(t)?t.forEach((t=>t.destroy(!0))):t.destroy(!0)}};Zt.add(io);const so={extension:qt.ResolveParser,test:t=>{const e=t.split("?")[0].split(".").pop();return["basis","ktx","dds"].includes(e)},parse:t=>{if("ktx"===t.split("?")[0].split(".").pop()){const e=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(e.some((e=>t.endsWith(e))))return{resolution:parseFloat(w.RETINA_PREFIX.exec(t)?.[1]??"1"),format:e.find((e=>t.endsWith(e))),src:t}}return{resolution:parseFloat(w.RETINA_PREFIX.exec(t)?.[1]??"1"),format:t.split(".").pop(),src:t}}};Zt.add(so);const oo=new Ce,ao=class{constructor(t){this.renderer=t}async image(t,e,n){const r=new Image;return r.src=await this.base64(t,e,n),r}async base64(t,e,n){const r=this.canvas(t);if(void 0!==r.toBlob)return new Promise(((t,i)=>{r.toBlob((e=>{if(!e)return void i(new Error("ICanvas.toBlob failed!"));const n=new FileReader;n.onload=()=>t(n.result),n.onerror=i,n.readAsDataURL(e)}),e,n)}));if(void 0!==r.toDataURL)return r.toDataURL(e,n);if(void 0!==r.convertToBlob){const t=await r.convertToBlob({type:e,quality:n});return new Promise(((e,n)=>{const r=new FileReader;r.onload=()=>e(r.result),r.onerror=n,r.readAsDataURL(t)}))}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(t,e){const{pixels:n,width:r,height:i,flipY:s}=this._rawPixels(t,e);s&&ao._flipY(n,r,i),ao._unpremultiplyAlpha(n);const o=new zt(r,i,1),a=new ImageData(new Uint8ClampedArray(n.buffer),r,i);return o.context.putImageData(a,0,0),o.canvas}pixels(t,e){const{pixels:n,width:r,height:i,flipY:s}=this._rawPixels(t,e);return s&&ao._flipY(n,r,i),ao._unpremultiplyAlpha(n),n}_rawPixels(t,e){const n=this.renderer;if(!n)throw new Error("The Extract has already been destroyed");let r,i,s=!1,o=!1;if(t&&(t instanceof Mn?i=t:(i=n.generateTexture(t,{resolution:n.resolution,multisample:n.multisample}),o=!0)),i){if(r=i.baseTexture.resolution,e=e??i.frame,s=!1,!o){n.renderTexture.bind(i);const t=i.framebuffer.glFramebuffers[n.CONTEXT_UID];t.blitFramebuffer&&n.framebuffer.bind(t.blitFramebuffer)}}else r=n.resolution,e||((e=oo).width=n.width/r,e.height=n.height/r),s=!0,n.renderTexture.bind();const a=Math.round(e.width*r),h=Math.round(e.height*r),l=new Uint8Array(4*a*h),u=n.gl;return u.readPixels(Math.round(e.x*r),Math.round(e.y*r),a,h,u.RGBA,u.UNSIGNED_BYTE,l),o&&i?.destroy(!0),{pixels:l,width:a,height:h,flipY:s}}destroy(){this.renderer=null}static _flipY(t,e,n){const r=e<<2,i=n>>1,s=new Uint8Array(r);for(let o=0;o<i;o++){const e=o*r,i=(n-o-1)*r;s.set(t.subarray(e,e+r)),t.copyWithin(e,i,i+r),t.set(s,i)}}static _unpremultiplyAlpha(t){t instanceof Uint8ClampedArray&&(t=new Uint8Array(t.buffer));const e=t.length;for(let n=0;n<e;n+=4){const e=t[n+3];if(0!==e){const r=255.001/e;t[n]=t[n]*r+.5,t[n+1]=t[n+1]*r+.5,t[n+2]=t[n+2]*r+.5}}}};let ho=ao;ho.extension={name:"extract",type:qt.RendererSystem},Zt.add(ho);const lo={build(t){const e=t.points;let n,r,i,s,o,a;if(t.type===Te.CIRC){const e=t.shape;n=e.x,r=e.y,o=a=e.radius,i=s=0}else if(t.type===Te.ELIP){const e=t.shape;n=e.x,r=e.y,o=e.width,a=e.height,i=s=0}else{const e=t.shape,h=e.width/2,l=e.height/2;n=e.x+h,r=e.y+l,o=a=Math.max(0,Math.min(e.radius,Math.min(h,l))),i=h-o,s=l-a}if(!(o>=0&&a>=0&&i>=0&&s>=0))return void(e.length=0);const h=Math.ceil(2.3*Math.sqrt(o+a)),l=8*h+(i?4:0)+(s?4:0);if(e.length=l,0===l)return;if(0===h)return e.length=8,e[0]=e[6]=n+i,e[1]=e[3]=r+s,e[2]=e[4]=n-i,void(e[5]=e[7]=r-s);let u=0,c=4*h+(i?2:0)+2,d=c,f=l;{const t=i+o,a=s,h=n+t,l=n-t,p=r+a;if(e[u++]=h,e[u++]=p,e[--c]=p,e[--c]=l,s){const t=r-a;e[d++]=l,e[d++]=t,e[--f]=t,e[--f]=h}}for(let p=1;p<h;p++){const t=Math.PI/2*(p/h),l=i+Math.cos(t)*o,m=s+Math.sin(t)*a,g=n+l,_=n-l,y=r+m,v=r-m;e[u++]=g,e[u++]=y,e[--c]=y,e[--c]=_,e[d++]=_,e[d++]=v,e[--f]=v,e[--f]=g}{const t=s+a,o=n+i,h=n-i,l=r+t,c=r-t;e[u++]=o,e[u++]=l,e[--f]=c,e[--f]=o,i&&(e[u++]=h,e[u++]=l,e[--f]=c,e[--f]=h)}},triangulate(t,e){const n=t.points,r=e.points,i=e.indices;if(0===n.length)return;let s=r.length/2;const o=s;let a,h;if(t.type!==Te.RREC){const e=t.shape;a=e.x,h=e.y}else{const e=t.shape;a=e.x+e.width/2,h=e.y+e.height/2}const l=t.matrix;r.push(t.matrix?l.a*a+l.c*h+l.tx:a,t.matrix?l.b*a+l.d*h+l.ty:h),s++,r.push(n[0],n[1]);for(let u=2;u<n.length;u+=2)r.push(n[u],n[u+1]),i.push(s++,o,s);i.push(o+1,o,s)}};function uo(t,e=!1){const n=t.length;if(n<6)return;let r=0;for(let i=0,s=t[n-2],o=t[n-1];i<n;i+=2){const e=t[i],n=t[i+1];r+=(e-s)*(n+o),s=e,o=n}if(!e&&r>0||e&&r<=0){const e=n/2;for(let r=e+e%2;r<n;r+=2){const e=n-r-2,i=n-r-1,s=r,o=r+1;[t[e],t[s]]=[t[s],t[e]],[t[i],t[o]]=[t[o],t[i]]}}}const co={build(t){t.points=t.shape.points.slice()},triangulate(t,e){let n=t.points;const r=t.holes,i=e.points,s=e.indices;if(n.length>=6){uo(n,!1);const t=[];for(let i=0;i<r.length;i++){const e=r[i];uo(e.points,!0),t.push(n.length/2),n=n.concat(e.points)}const e=z(n,t,2);if(!e)return;const o=i.length/2;for(let n=0;n<e.length;n+=3)s.push(e[n]+o),s.push(e[n+1]+o),s.push(e[n+2]+o);for(let r=0;r<n.length;r++)i.push(n[r])}}},fo={build(t){const e=t.shape,n=e.x,r=e.y,i=e.width,s=e.height,o=t.points;o.length=0,i>=0&&s>=0&&o.push(n,r,n+i,r,n+i,r+s,n,r+s)},triangulate(t,e){const n=t.points,r=e.points;if(0===n.length)return;const i=r.length/2;r.push(n[0],n[1],n[2],n[3],n[6],n[7],n[4],n[5]),e.indices.push(i,i+1,i+2,i+1,i+2,i+3)}},po={build(t){lo.build(t)},triangulate(t,e){lo.triangulate(t,e)}};var mo=(t=>(t.MITER="miter",t.BEVEL="bevel",t.ROUND="round",t))(mo||{}),go=(t=>(t.BUTT="butt",t.ROUND="round",t.SQUARE="square",t))(go||{});const _o={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(t,e=20){if(!this.adaptive||!t||isNaN(t))return e;let n=Math.ceil(t/this.maxLength);return n<this.minSegments?n=this.minSegments:n>this.maxSegments&&(n=this.maxSegments),n}};class yo{static curveTo(t,e,n,r,i,s){const o=s[s.length-2],a=s[s.length-1]-e,h=o-t,l=r-e,u=n-t,c=Math.abs(a*u-h*l);if(c<1e-8||0===i)return s[s.length-2]===t&&s[s.length-1]===e||s.push(t,e),null;const d=a*a+h*h,f=l*l+u*u,p=a*l+h*u,m=i*Math.sqrt(d)/c,g=i*Math.sqrt(f)/c,_=m*p/d,y=g*p/f,v=m*u+g*h,b=m*l+g*a,x=h*(g+_),E=a*(g+_),w=u*(m+y),T=l*(m+y);return{cx:v+t,cy:b+e,radius:i,startAngle:Math.atan2(E-b,x-v),endAngle:Math.atan2(T-b,w-v),anticlockwise:h*l>u*a}}static arc(t,e,n,r,i,s,o,a,h){const l=o-s,u=_o._segmentsCount(Math.abs(l)*i,40*Math.ceil(Math.abs(l)/xe)),c=l/(2*u),d=2*c,f=Math.cos(c),p=Math.sin(c),m=u-1,g=m%1/m;for(let _=0;_<=m;++_){const t=c+s+d*(_+g*_),e=Math.cos(t),o=-Math.sin(t);h.push((f*e+p*o)*i+n,(f*-o+p*e)*i+r)}}}class vo{static curveLength(t,e,n,r,i,s,o,a){let h=0,l=0,u=0,c=0,d=0,f=0,p=0,m=0,g=0,_=0,y=0,v=t,b=e;for(let x=1;x<=10;++x)l=x/10,u=l*l,c=u*l,d=1-l,f=d*d,p=f*d,m=p*t+3*f*l*n+3*d*u*i+c*o,g=p*e+3*f*l*r+3*d*u*s+c*a,_=v-m,y=b-g,v=m,b=g,h+=Math.sqrt(_*_+y*y);return h}static curveTo(t,e,n,r,i,s,o){const a=o[o.length-2],h=o[o.length-1];o.length-=2;const l=_o._segmentsCount(vo.curveLength(a,h,t,e,n,r,i,s));let u=0,c=0,d=0,f=0,p=0;o.push(a,h);for(let m=1,g=0;m<=l;++m)g=m/l,u=1-g,c=u*u,d=c*u,f=g*g,p=f*g,o.push(d*a+3*c*g*t+3*u*f*n+p*i,d*h+3*c*g*e+3*u*f*r+p*s)}}function bo(t,e,n,r,i,s,o,a){let h,l;o?(h=r,l=-n):(h=-r,l=n);const u=t-n*i+h,c=e-r*i+l,d=t+n*s+h,f=e+r*s+l;return a.push(u,c,d,f),2}function xo(t,e,n,r,i,s,o,a){const h=n-t,l=r-e;let u=Math.atan2(h,l),c=Math.atan2(i-t,s-e);a&&u<c?u+=2*Math.PI:!a&&u>c&&(c+=2*Math.PI);let d=u;const f=c-u,p=Math.abs(f),m=Math.sqrt(h*h+l*l),g=1+(15*p*Math.sqrt(m)/Math.PI>>0),_=f/g;if(d+=_,a){o.push(t,e,n,r);for(let n=1,r=d;n<g;n++,r+=_)o.push(t,e,t+Math.sin(r)*m,e+Math.cos(r)*m);o.push(t,e,i,s)}else{o.push(n,r,t,e);for(let n=1,r=d;n<g;n++,r+=_)o.push(t+Math.sin(r)*m,e+Math.cos(r)*m,t,e);o.push(i,s,t,e)}return 2*g}function Eo(t,e){t.lineStyle.native?function(t,e){let n=0;const r=t.shape,i=t.points||r.points,s=r.type!==Te.POLY||r.closeStroke;if(0===i.length)return;const o=e.points,a=e.indices,h=i.length/2,l=o.length/2;let u=l;for(o.push(i[0],i[1]),n=1;n<h;n++)o.push(i[2*n],i[2*n+1]),a.push(u,u+1),u++;s&&a.push(u,l)}(t,e):function(t,e){const n=t.shape;let r=t.points||n.points.slice();const i=e.closePointEps;if(0===r.length)return;const s=t.lineStyle,o=new Se(r[0],r[1]),a=new Se(r[r.length-2],r[r.length-1]),h=n.type!==Te.POLY||n.closeStroke,l=Math.abs(o.x-a.x)<i&&Math.abs(o.y-a.y)<i;if(h){r=r.slice(),l&&(r.pop(),r.pop(),a.set(r[r.length-2],r[r.length-1]));const t=.5*(o.x+a.x),e=.5*(a.y+o.y);r.unshift(t,e),r.push(t,e)}const u=e.points,c=r.length/2;let d=r.length;const f=u.length/2,p=s.width/2,m=p*p,g=s.miterLimit*s.miterLimit;let _=r[0],y=r[1],v=r[2],b=r[3],x=0,E=0,w=-(y-b),T=_-v,S=0,A=0,C=Math.sqrt(w*w+T*T);w/=C,T/=C,w*=p,T*=p;const I=s.alignment,R=2*(1-I),P=2*I;h||(s.cap===go.ROUND?d+=xo(_-w*(R-P)*.5,y-T*(R-P)*.5,_-w*R,y-T*R,_+w*P,y+T*P,u,!0)+2:s.cap===go.SQUARE&&(d+=bo(_,y,w,T,R,P,!0,u))),u.push(_-w*R,y-T*R,_+w*P,y+T*P);for(let D=1;D<c-1;++D){_=r[2*(D-1)],y=r[2*(D-1)+1],v=r[2*D],b=r[2*D+1],x=r[2*(D+1)],E=r[2*(D+1)+1],w=-(y-b),T=_-v,C=Math.sqrt(w*w+T*T),w/=C,T/=C,w*=p,T*=p,S=-(b-E),A=v-x,C=Math.sqrt(S*S+A*A),S/=C,A/=C,S*=p,A*=p;const t=v-_,e=y-b,n=v-x,i=E-b,o=t*n+e*i,a=e*n-i*t,h=a<0;if(Math.abs(a)<.001*Math.abs(o)){u.push(v-w*R,b-T*R,v+w*P,b+T*P),o>=0&&(s.join===mo.ROUND?d+=xo(v,b,v-w*R,b-T*R,v-S*R,b-A*R,u,!1)+4:d+=2,u.push(v-S*P,b-A*P,v+S*R,b+A*R));continue}const l=(-w+_)*(-T+b)-(-w+v)*(-T+y),c=(-S+x)*(-A+b)-(-S+v)*(-A+E),f=(t*c-n*l)/a,I=(i*l-e*c)/a,M=(f-v)*(f-v)+(I-b)*(I-b),O=v+(f-v)*R,N=b+(I-b)*R,k=v-(f-v)*P,L=b-(I-b)*P,F=h?R:P,B=M<=Math.min(t*t+e*e,n*n+i*i)+F*F*m;let U=s.join;if(U===mo.MITER&&M/m>g&&(U=mo.BEVEL),B)switch(U){case mo.MITER:u.push(O,N,k,L);break;case mo.BEVEL:h?u.push(O,N,v+w*P,b+T*P,O,N,v+S*P,b+A*P):u.push(v-w*R,b-T*R,k,L,v-S*R,b-A*R,k,L),d+=2;break;case mo.ROUND:h?(u.push(O,N,v+w*P,b+T*P),d+=xo(v,b,v+w*P,b+T*P,v+S*P,b+A*P,u,!0)+4,u.push(O,N,v+S*P,b+A*P)):(u.push(v-w*R,b-T*R,k,L),d+=xo(v,b,v-w*R,b-T*R,v-S*R,b-A*R,u,!1)+4,u.push(v-S*R,b-A*R,k,L))}else{switch(u.push(v-w*R,b-T*R,v+w*P,b+T*P),U){case mo.MITER:h?u.push(k,L,k,L):u.push(O,N,O,N),d+=2;break;case mo.ROUND:d+=h?xo(v,b,v+w*P,b+T*P,v+S*P,b+A*P,u,!0)+2:xo(v,b,v-w*R,b-T*R,v-S*R,b-A*R,u,!1)+2}u.push(v-S*R,b-A*R,v+S*P,b+A*P),d+=2}}_=r[2*(c-2)],y=r[2*(c-2)+1],v=r[2*(c-1)],b=r[2*(c-1)+1],w=-(y-b),T=_-v,C=Math.sqrt(w*w+T*T),w/=C,T/=C,w*=p,T*=p,u.push(v-w*R,b-T*R,v+w*P,b+T*P),h||(s.cap===go.ROUND?d+=xo(v-w*(R-P)*.5,b-T*(R-P)*.5,v-w*R,b-T*R,v+w*P,b+T*P,u,!1)+2:s.cap===go.SQUARE&&(d+=bo(v,b,w,T,R,P,!1,u)));const M=e.indices,O=_o.epsilon*_o.epsilon;for(let D=f;D<d+f-2;++D)_=u[2*D],y=u[2*D+1],v=u[2*(D+1)],b=u[2*(D+1)+1],x=u[2*(D+2)],E=u[2*(D+2)+1],Math.abs(_*(b-E)+v*(E-y)+x*(y-b))<O||M.push(D,D+1,D+2)}(t,e)}class wo{static curveLength(t,e,n,r,i,s){const o=t-2*n+i,a=e-2*r+s,h=2*n-2*t,l=2*r-2*e,u=4*(o*o+a*a),c=4*(o*h+a*l),d=h*h+l*l,f=2*Math.sqrt(u+c+d),p=Math.sqrt(u),m=2*u*p,g=2*Math.sqrt(d),_=c/p;return(m*f+p*c*(f-g)+(4*d*u-c*c)*Math.log((2*p+_+f)/(_+g)))/(4*m)}static curveTo(t,e,n,r,i){const s=i[i.length-2],o=i[i.length-1],a=_o._segmentsCount(wo.curveLength(s,o,t,e,n,r));let h=0,l=0;for(let u=1;u<=a;++u){const c=u/a;h=s+(t-s)*c,l=o+(e-o)*c,i.push(h+(t+(n-t)*c-h)*c,l+(e+(r-e)*c-l)*c)}}}const To={[Te.POLY]:co,[Te.CIRC]:lo,[Te.ELIP]:lo,[Te.RECT]:fo,[Te.RREC]:po},So=[],Ao=[];class Co{constructor(t,e=null,n=null,r=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=n,this.fillStyle=e,this.matrix=r,this.type=t.type}clone(){return new Co(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}class Io{constructor(){this.reset()}begin(t,e,n){this.reset(),this.style=t,this.start=e,this.attribStart=n}end(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}const Ro=new Se,Po=class extends be{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new ei,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),Ao.push(this.drawCalls[t]);this.drawCalls.length=0;for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e.reset(),So.push(e)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(t,e=null,n=null,r=null){const i=new Co(t,e,n,r);return this.graphicsData.push(i),this.dirty++,this}drawHole(t,e=null){if(!this.graphicsData.length)return null;const n=new Co(t,null,null,e),r=this.graphicsData[this.graphicsData.length-1];return n.lineStyle=r.lineStyle,r.holes.push(n),this.dirty++,this}destroy(){super.destroy();for(let t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(t){const e=this.graphicsData;for(let n=0;n<e.length;++n){const r=e[n];if(r.fillStyle.visible&&(r.shape&&(r.matrix?r.matrix.applyInverse(t,Ro):Ro.copyFrom(t),r.shape.contains(Ro.x,Ro.y)))){let t=!1;if(r.holes)for(let e=0;e<r.holes.length;e++){if(r.holes[e].shape.contains(Ro.x,Ro.y)){t=!0;break}}if(!t)return!0}}return!1}updateBatches(){if(!this.graphicsData.length)return void(this.batchable=!0);if(!this.validateBatching())return;this.cacheDirty=this.dirty;const t=this.uvs,e=this.graphicsData;let n=null,r=null;this.batches.length>0&&(n=this.batches[this.batches.length-1],r=n.style);for(let a=this.shapeIndex;a<e.length;a++){this.shapeIndex++;const i=e[a],s=i.fillStyle,o=i.lineStyle;To[i.type].build(i),i.matrix&&this.transformPoints(i.points,i.matrix),(s.visible||o.visible)&&this.processHoles(i.holes);for(let e=0;e<2;e++){const a=0===e?s:o;if(!a.visible)continue;const h=a.texture.baseTexture,l=this.indices.length,u=this.points.length/2;h.wrapMode=f.REPEAT,0===e?this.processFill(i):this.processLine(i);const c=this.points.length/2-u;0!==c&&(n&&!this._compareStyles(r,a)&&(n.end(l,u),n=null),n||(n=So.pop()||new Io,n.begin(a,l,u),this.batches.push(n),r=a),this.addUvs(this.points,t,a.texture,u,c,a.matrix))}}const i=this.indices.length,s=this.points.length/2;if(n&&n.end(i,s),0===this.batches.length)return void(this.batchable=!0);const o=s>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&o===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=o?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(t,e){return!(!t||!e)&&(t.texture.baseTexture===e.texture.baseTexture&&(t.color+t.alpha===e.color+e.alpha&&!!t.native==!!e.native))}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let t=0,e=this.graphicsData.length;t<e;t++){const e=this.graphicsData[t],n=e.fillStyle,r=e.lineStyle;if(n&&!n.texture.baseTexture.valid)return!1;if(r&&!r.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const t=this.batches;for(let e=0,n=t.length;e<n;e++){const n=t[e];for(let t=0;t<n.size;t++){const e=n.start+t;this.indicesUint16[e]=this.indicesUint16[e]-n.attribStart}}}isBatchable(){if(this.points.length>131070)return!1;const t=this.batches;for(let e=0;e<t.length;e++)if(t[e].style.native)return!1;return this.points.length<2*Po.BATCHABLE_SIZE}buildDrawCalls(){let t=++ue._globalBatch;for(let a=0;a<this.drawCalls.length;a++)this.drawCalls[a].texArray.clear(),Ao.push(this.drawCalls[a]);this.drawCalls.length=0;const e=this.colors,n=this.textureIds;let r=Ao.pop();r||(r=new ce,r.texArray=new dn),r.texArray.count=0,r.start=0,r.size=0,r.type=a.TRIANGLES;let i=0,s=null,o=0,h=!1,l=a.TRIANGLES,u=0;this.drawCalls.push(r);for(let c=0;c<this.batches.length;c++){const d=this.batches[c],p=8,m=d.style,g=m.texture.baseTexture;h!==!!m.native&&(h=!!m.native,l=h?a.LINES:a.TRIANGLES,s=null,i=p,t++),s!==g&&(s=g,g._batchEnabled!==t&&(i===p&&(t++,i=0,r.size>0&&(r=Ao.pop(),r||(r=new ce,r.texArray=new dn),this.drawCalls.push(r)),r.start=u,r.size=0,r.texArray.count=0,r.type=l),g.touched=1,g._batchEnabled=t,g._batchLocation=i,g.wrapMode=f.REPEAT,r.texArray.elements[r.texArray.count++]=g,i++)),r.size+=d.size,u+=d.size,o=g._batchLocation,this.addColors(e,m.color,m.alpha,d.attribSize,d.attribStart),this.addTextureIds(n,o,d.attribSize,d.attribStart)}ue._globalBatch=t,this.packAttributes()}packAttributes(){const t=this.points,e=this.uvs,n=this.colors,r=this.textureIds,i=new ArrayBuffer(3*t.length*4),s=new Float32Array(i),o=new Uint32Array(i);let a=0;for(let h=0;h<t.length/2;h++)s[a++]=t[2*h],s[a++]=t[2*h+1],s[a++]=e[2*h],s[a++]=e[2*h+1],o[a++]=n[h],s[a++]=r[h];this._buffer.update(i),this._indexBuffer.update(this.indicesUint16)}processFill(t){if(t.holes.length)co.triangulate(t,this);else{To[t.type].triangulate(t,this)}}processLine(t){Eo(t,this);for(let e=0;e<t.holes.length;e++)Eo(t.holes[e],this)}processHoles(t){for(let e=0;e<t.length;e++){const n=t[e];To[n.type].build(n),n.matrix&&this.transformPoints(n.points,n.matrix)}}calculateBounds(){const t=this._bounds;t.clear(),t.addVertexData(this.points,0,this.points.length),t.pad(this.boundsPadding,this.boundsPadding)}transformPoints(t,e){for(let n=0;n<t.length/2;n++){const r=t[2*n],i=t[2*n+1];t[2*n]=e.a*r+e.c*i+e.tx,t[2*n+1]=e.b*r+e.d*i+e.ty}}addColors(t,e,n,r,i=0){const s=Ct.shared.setValue(e).toLittleEndianNumber(),o=Ct.shared.setValue(s).toPremultiplied(n);t.length=Math.max(t.length,i+r);for(let a=0;a<r;a++)t[i+a]=o}addTextureIds(t,e,n,r=0){t.length=Math.max(t.length,r+n);for(let i=0;i<n;i++)t[r+i]=e}addUvs(t,e,n,r,i,s=null){let o=0;const a=e.length,h=n.frame;for(;o<i;){let n=t[2*(r+o)],i=t[2*(r+o)+1];if(s){const t=s.a*n+s.c*i+s.tx;i=s.b*n+s.d*i+s.ty,n=t}o++,e.push(n/h.width,i/h.height)}const l=n.baseTexture;(h.width<l.width||h.height<l.height)&&this.adjustUvs(e,n,a,i)}adjustUvs(t,e,n,r){const i=e.baseTexture,s=1e-6,o=n+2*r,a=e.frame,h=a.width/i.width,l=a.height/i.height;let u=a.x/a.width,c=a.y/a.height,d=Math.floor(t[n]+s),f=Math.floor(t[n+1]+s);for(let p=n+2;p<o;p+=2)d=Math.min(d,Math.floor(t[p]+s)),f=Math.min(f,Math.floor(t[p+1]+s));u-=d,c-=f;for(let p=n;p<o;p+=2)t[p]=(t[p]+u)*h,t[p+1]=(t[p+1]+c)*l}};let Mo=Po;Mo.BATCHABLE_SIZE=100;class Oo{constructor(){this.color=16777215,this.alpha=1,this.texture=Pn.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const t=new Oo;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=Pn.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class Do extends Oo{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=go.BUTT,this.join=mo.MITER,this.miterLimit=10}clone(){const t=new Do;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1}}const No={},ko=class extends ai{constructor(t=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new Oo,this._lineStyle=new Do,this._matrix=null,this._holeMode=!1,this.state=ne.for2d(),this._geometry=t||new Mo,this._geometry.refCount++,this._transformID=-1,this._tintColor=new Ct(16777215),this.blendMode=o.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new ko(this._geometry)}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(t=null,e=0,n,r=.5,i=!1){return"number"==typeof t&&(t={width:t,color:e,alpha:n,alignment:r,native:i}),this.lineTextureStyle(t)}lineTextureStyle(t){const e={width:0,texture:Pn.WHITE,color:t?.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:go.BUTT,join:mo.MITER,miterLimit:10};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const n=t.width>0&&t.alpha>0;return n?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:n},t)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new Pe,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new Pe,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this}lineTo(t,e){this.currentPath||this.moveTo(0,0);const n=this.currentPath.points,r=n[n.length-2],i=n[n.length-1];return r===t&&i===e||n.push(t,e),this}_initCurve(t=0,e=0){this.currentPath?0===this.currentPath.points.length&&(this.currentPath.points=[t,e]):this.moveTo(t,e)}quadraticCurveTo(t,e,n,r){this._initCurve();const i=this.currentPath.points;return 0===i.length&&this.moveTo(0,0),wo.curveTo(t,e,n,r,i),this}bezierCurveTo(t,e,n,r,i,s){return this._initCurve(),vo.curveTo(t,e,n,r,i,s,this.currentPath.points),this}arcTo(t,e,n,r,i){this._initCurve(t,e);const s=this.currentPath.points,o=yo.curveTo(t,e,n,r,i,s);if(o){const{cx:t,cy:e,radius:n,startAngle:r,endAngle:i,anticlockwise:s}=o;this.arc(t,e,n,r,i,s)}return this}arc(t,e,n,r,i,s=!1){if(r===i)return this;!s&&i<=r?i+=xe:s&&r<=i&&(r+=xe);if(0===i-r)return this;const o=t+Math.cos(r)*n,a=e+Math.sin(r)*n,h=this._geometry.closePointEps;let l=this.currentPath?this.currentPath.points:null;if(l){const t=Math.abs(l[l.length-2]-o),e=Math.abs(l[l.length-1]-a);t<h&&e<h||l.push(o,a)}else this.moveTo(o,a),l=this.currentPath.points;return yo.arc(o,a,t,e,n,r,i,s,l),this}beginFill(t=0,e){return this.beginTextureFill({texture:Pn.WHITE,color:t,alpha:e})}normalizeColor(t){const e=Ct.shared.setValue(t.color??0);t.color=e.toNumber(),t.alpha??(t.alpha=e.alpha)}beginTextureFill(t){const e={texture:Pn.WHITE,color:16777215,matrix:null};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const n=t.alpha>0;return n?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:n},t)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(t,e,n,r){return this.drawShape(new Ce(t,e,n,r))}drawRoundedRect(t,e,n,r,i){return this.drawShape(new Me(t,e,n,r,i))}drawCircle(t,e,n){return this.drawShape(new Ie(t,e,n))}drawEllipse(t,e,n,r){return this.drawShape(new Re(t,e,n,r))}drawPolygon(...t){let e,n=!0;const r=t[0];r.points?(n=r.closeStroke,e=r.points):e=Array.isArray(t[0])?t[0]:t;const i=new Pe(e);return i.closeStroke=n,this.drawShape(i),this}drawShape(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const t=this._geometry.graphicsData;return!(1!==t.length||t[0].shape.type!==Te.RECT||t[0].matrix||t[0].holes.length||t[0].lineStyle.visible&&t[0].lineStyle.width)}_render(t){this.finishPoly();const e=this._geometry;e.updateBatches(),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))}_populateBatches(){const t=this._geometry,e=this.blendMode,n=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=n,this.vertexData=new Float32Array(t.points);for(let r=0;r<n;r++){const n=t.batches[r],i=n.style.color,s=new Float32Array(this.vertexData.buffer,4*n.attribStart*2,2*n.attribSize),o=new Float32Array(t.uvsFloat32.buffer,4*n.attribStart*2,2*n.attribSize),a={vertexData:s,blendMode:e,indices:new Uint16Array(t.indicesUint16.buffer,2*n.start,n.size),uvs:o,_batchRGB:Ct.shared.setValue(i).toRgbArray(),_tintRGB:i,_texture:n.style.texture,alpha:n.style.alpha,worldAlpha:1};this.batches[r]=a}}_renderBatched(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let e=0,n=this.batches.length;e<n;e++){const n=this.batches[e];n.worldAlpha=this.worldAlpha*n.alpha,t.plugins[this.pluginName].render(n)}}}_renderDirect(t){const e=this._resolveDirectShader(t),n=this._geometry,r=this.worldAlpha,i=e.uniforms,s=n.drawCalls;i.translationMatrix=this.transform.worldTransform,Ct.shared.setValue(this._tintColor).premultiply(r).toArray(i.tint),t.shader.bind(e),t.geometry.bind(n,e),t.state.set(this.state);for(let o=0,a=s.length;o<a;o++)this._renderDrawCallDirect(t,n.drawCalls[o])}_renderDrawCallDirect(t,e){const{texArray:n,type:r,size:i,start:s}=e,o=n.count;for(let a=0;a<o;a++)t.texture.bind(n.elements[a],a);t.geometry.draw(r,i,s)}_resolveDirectShader(t){let e=this.shader;const n=this.pluginName;if(!e){if(!No[n]){const{maxTextures:e}=t.plugins[n],r=new Int32Array(e);for(let t=0;t<e;t++)r[t]=t;const i={tint:new Float32Array([1,1,1,1]),translationMatrix:new Oe,"default":ln.from({uSamplers:r},!0)},s=t.plugins[n]._shader.program;No[n]=new un(s,i)}e=No[n]}return e}_calculateBounds(){this.finishPoly();const t=this._geometry;if(!t.graphicsData.length)return;const{minX:e,minY:n,maxX:r,maxY:i}=t.bounds;this._bounds.addFrame(this.transform,e,n,r,i)}containsPoint(t){return this.worldTransform.applyInverse(t,ko._TEMP_POINT),this._geometry.containsPoint(ko._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e._tintRGB=Ct.shared.setValue(this._tintColor).multiply(e._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const t=this.transform._worldID;if(this._transformID===t)return;this._transformID=t;const e=this.transform.worldTransform,n=e.a,r=e.b,i=e.c,s=e.d,o=e.tx,a=e.ty,h=this._geometry.points,l=this.vertexData;let u=0;for(let c=0;c<h.length;c+=2){const t=h[c],e=h[c+1];l[u++]=n*t+i*e+o,l[u++]=s*e+r*t+a}}closePath(){const t=this.currentPath;return t&&(t.closeStroke=!0,this.finishPoly()),this}setMatrix(t){return this._matrix=t,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(t){this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(t)}};let Lo=ko;Lo.curves=_o,Lo._TEMP_POINT=new Se;class Fo{constructor(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const e=this.uvBuffer.data;this.data&&this.data.length===e.length||(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}}const Bo=new Se,Uo=new Pe,jo=class extends ai{constructor(t,e,n,r=a.TRIANGLES){super(),this.geometry=t,this.shader=e,this.state=n||ne.for2d(),this.drawMode=r,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=w.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(t){this._geometry!==t&&(this._geometry&&(this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose()),this._geometry=t,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(t){this.shader=t}get material(){return this.shader}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(t){this.shader.tint=t}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(t){this.shader.texture=t}_render(t){const e=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===a.TRIANGLES&&e.length<2*jo.BATCHABLE_SIZE?this._renderToBatch(t):this._renderDefault(t)}_renderDefault(t){const e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(t){const e=this.geometry,n=this.shader;n.uvMatrix&&(n.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=n._tintRGB,this._texture=n.texture;const r=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[r]),t.plugins[r].render(this)}calculateVertices(){const t=this.geometry.buffers[0],e=t.data,n=t._updateID;if(n===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));const r=this.transform.worldTransform,i=r.a,s=r.b,o=r.c,a=r.d,h=r.tx,l=r.ty,u=this.vertexData;for(let c=0;c<u.length/2;c++){const t=e[2*c],n=e[2*c+1];u[2*c]=i*t+o*n+h,u[2*c+1]=s*t+a*n+l}if(this._roundPixels){const t=w.RESOLUTION;for(let e=0;e<u.length;++e)u[e]=Math.round(u[e]*t)/t}this.vertexDirty=n}calculateUvs(){const t=this.geometry.buffers[1],e=this.shader;e.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new Fo(t,e.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,Bo);const e=this.geometry.getBuffer("aVertexPosition").data,n=Uo.points,r=this.geometry.getIndex().data,i=r.length,s=4===this.drawMode?3:1;for(let o=0;o+2<i;o+=s){const t=2*r[o],i=2*r[o+1],s=2*r[o+2];if(n[0]=e[t],n[1]=e[t+1],n[2]=e[i],n[3]=e[i+1],n[4]=e[s],n[5]=e[s+1],Uo.contains(Bo.x,Bo.y))return!0}return!1}destroy(t){super.destroy(t),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};let Go=jo;Go.BATCHABLE_SIZE=100;class Ho extends ve{constructor(t,e,n){super();const r=new fe(t),i=new fe(e,!0),s=new fe(n,!0,!0);this.addAttribute("aVertexPosition",r,2,!1,u.FLOAT).addAttribute("aTextureCoord",i,2,!1,u.FLOAT).addIndex(s),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}class zo extends un{constructor(t,e){const n={uSampler:t,alpha:1,uTextureMatrix:Oe.IDENTITY,uColor:new Float32Array([1,1,1,1])};(e=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},e)).uniforms&&Object.assign(n,e.uniforms),super(e.program||an.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n"),n),this._colorDirty=!1,this.uvMatrix=new Vn(t),this.batchable=void 0===e.program,this.pluginName=e.pluginName,this._tintColor=new Ct(e.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=e.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this.tint&&(this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const t=this.texture.baseTexture.alphaMode;Ct.shared.setValue(this._tintColor).premultiply(this._alpha,t).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class Wo{constructor(t,e,n){this.geometry=new ve,this.indexBuffer=null,this.size=n,this.dynamicProperties=[],this.staticProperties=[];for(let r=0;r<t.length;++r){let n=t[r];n={attributeName:n.attributeName,size:n.size,uploadFunction:n.uploadFunction,type:n.type||u.FLOAT,offset:n.offset},e[r]?this.dynamicProperties.push(n):this.staticProperties.push(n)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const t=this.geometry;let e=0;this.indexBuffer=new fe(function(t,e=null){const n=6*t;if((e=e||new Uint16Array(n)).length!==n)throw new Error(`Out buffer length is incorrect, got ${e.length} and expected ${n}`);for(let r=0,i=0;r<n;r+=6,i+=4)e[r+0]=i+0,e[r+1]=i+1,e[r+2]=i+2,e[r+3]=i+0,e[r+4]=i+2,e[r+5]=i+3;return e}(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let s=0;s<this.dynamicProperties.length;++s){const t=this.dynamicProperties[s];t.offset=e,e+=t.size,this.dynamicStride+=t.size}const n=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(n),this.dynamicDataUint32=new Uint32Array(n),this.dynamicBuffer=new fe(this.dynamicData,!1,!1);let r=0;this.staticStride=0;for(let s=0;s<this.staticProperties.length;++s){const t=this.staticProperties[s];t.offset=r,r+=t.size,this.staticStride+=t.size}const i=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(i),this.staticDataUint32=new Uint32Array(i),this.staticBuffer=new fe(this.staticData,!0,!1);for(let s=0;s<this.dynamicProperties.length;++s){const e=this.dynamicProperties[s];t.addAttribute(e.attributeName,this.dynamicBuffer,0,e.type===u.UNSIGNED_BYTE,e.type,4*this.dynamicStride,4*e.offset)}for(let s=0;s<this.staticProperties.length;++s){const e=this.staticProperties[s];t.addAttribute(e.attributeName,this.staticBuffer,0,e.type===u.UNSIGNED_BYTE,e.type,4*this.staticStride,4*e.offset)}}uploadDynamic(t,e,n){for(let r=0;r<this.dynamicProperties.length;r++){const i=this.dynamicProperties[r];i.uploadFunction(t,e,n,i.type===u.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,i.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,e,n){for(let r=0;r<this.staticProperties.length;r++){const i=this.staticProperties[r];i.uploadFunction(t,e,n,i.type===u.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,i.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}class Vo extends fn{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new Oe,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:u.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=un.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 translationMatrix;\nuniform vec4 uColor;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void){\n    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n\n    vec2 v = vec2(x, y);\n    v = v + aPositionCoord;\n\n    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vColor = aColor * uColor;\n}\n","varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n    gl_FragColor = color;\n}",{}),this.state=ne.for2d()}render(t){const e=t.children,n=t._maxSize,r=t._batchSize,i=this.renderer;let s=e.length;if(0===s)return;s>n&&!t.autoResize&&(s=n);let o=t._buffers;o||(o=t._buffers=this.generateBuffers(t));const a=e[0]._texture.baseTexture,h=a.alphaMode>0;this.state.blendMode=Rt(t.blendMode,h),i.state.set(this.state);const l=i.gl,u=t.worldTransform.copyTo(this.tempMatrix);u.prepend(i.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=u.toArray(!0),this.shader.uniforms.uColor=Ct.shared.setValue(t.tintRgb).premultiply(t.worldAlpha,h).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=a,this.renderer.shader.bind(this.shader);let c=!1;for(let d=0,f=0;d<s;d+=r,f+=1){let n=s-d;n>r&&(n=r),f>=o.length&&o.push(this._generateOneMoreBuffer(t));const a=o[f];a.uploadDynamic(e,d,n);const h=t._bufferUpdateIDs[f]||0;c=c||a._updateID<h,c&&(a._updateID=t._updateID,a.uploadStatic(e,d,n)),i.geometry.bind(a.geometry),l.drawElements(l.TRIANGLES,6*n,l.UNSIGNED_SHORT,0)}}generateBuffers(t){const e=[],n=t._maxSize,r=t._batchSize,i=t._properties;for(let s=0;s<n;s+=r)e.push(new Wo(this.properties,i,r));return e}_generateOneMoreBuffer(t){const e=t._batchSize,n=t._properties;return new Wo(this.properties,n,e)}uploadVertices(t,e,n,r,i,s){let o=0,a=0,h=0,l=0;for(let u=0;u<n;++u){const n=t[e+u],c=n._texture,d=n.scale.x,f=n.scale.y,p=c.trim,m=c.orig;p?(a=p.x-n.anchor.x*m.width,o=a+p.width,l=p.y-n.anchor.y*m.height,h=l+p.height):(o=m.width*(1-n.anchor.x),a=m.width*-n.anchor.x,h=m.height*(1-n.anchor.y),l=m.height*-n.anchor.y),r[s]=a*d,r[s+1]=l*f,r[s+i]=o*d,r[s+i+1]=l*f,r[s+2*i]=o*d,r[s+2*i+1]=h*f,r[s+3*i]=a*d,r[s+3*i+1]=h*f,s+=4*i}}uploadPosition(t,e,n,r,i,s){for(let o=0;o<n;o++){const n=t[e+o].position;r[s]=n.x,r[s+1]=n.y,r[s+i]=n.x,r[s+i+1]=n.y,r[s+2*i]=n.x,r[s+2*i+1]=n.y,r[s+3*i]=n.x,r[s+3*i+1]=n.y,s+=4*i}}uploadRotation(t,e,n,r,i,s){for(let o=0;o<n;o++){const n=t[e+o].rotation;r[s]=n,r[s+i]=n,r[s+2*i]=n,r[s+3*i]=n,s+=4*i}}uploadUvs(t,e,n,r,i,s){for(let o=0;o<n;++o){const n=t[e+o]._texture._uvs;n?(r[s]=n.x0,r[s+1]=n.y0,r[s+i]=n.x1,r[s+i+1]=n.y1,r[s+2*i]=n.x2,r[s+2*i+1]=n.y2,r[s+3*i]=n.x3,r[s+3*i+1]=n.y3,s+=4*i):(r[s]=0,r[s+1]=0,r[s+i]=0,r[s+i+1]=0,r[s+2*i]=0,r[s+2*i+1]=0,r[s+3*i]=0,r[s+3*i+1]=0,s+=4*i)}}uploadTint(t,e,n,r,i,s){for(let o=0;o<n;++o){const n=t[e+o],a=Ct.shared.setValue(n._tintRGB).toPremultiplied(n.alpha,n.texture.baseTexture.alphaMode>0);r[s]=a,r[s+i]=a,r[s+2*i]=a,r[s+3*i]=a,s+=4*i}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}Vo.extension={name:"particle",type:qt.RendererPlugin},Zt.add(Vo);var Xo=(t=>(t[t.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",t[t.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",t))(Xo||{});const $o={willReadFrequently:!0},Yo=class{static get experimentalLetterSpacingSupported(){let t=Yo._experimentalLetterSpacingSupported;if(void 0!==t){const e=w.ADAPTER.getCanvasRenderingContext2D().prototype;t=Yo._experimentalLetterSpacingSupported="letterSpacing"in e||"textLetterSpacing"in e}return t}constructor(t,e,n,r,i,s,o,a,h){this.text=t,this.style=e,this.width=n,this.height=r,this.lines=i,this.lineWidths=s,this.lineHeight=o,this.maxLineWidth=a,this.fontProperties=h}static measureText(t,e,n,r=Yo._canvas){n=null==n?e.wordWrap:n;const i=e.toFontString(),s=Yo.measureFont(i);0===s.fontSize&&(s.fontSize=e.fontSize,s.ascent=e.fontSize);const o=r.getContext("2d",$o);o.font=i;const a=(n?Yo.wordWrap(t,e,r):t).split(/(?:\r\n|\r|\n)/),h=new Array(a.length);let l=0;for(let f=0;f<a.length;f++){const t=Yo._measureText(a[f],e.letterSpacing,o);h[f]=t,l=Math.max(l,t)}let u=l+e.strokeThickness;e.dropShadow&&(u+=e.dropShadowDistance);const c=e.lineHeight||s.fontSize+e.strokeThickness;let d=Math.max(c,s.fontSize+2*e.strokeThickness)+(a.length-1)*(c+e.leading);return e.dropShadow&&(d+=e.dropShadowDistance),new Yo(t,e,u,d,a,h,c+e.leading,l,s)}static _measureText(t,e,n){let r=!1;Yo.experimentalLetterSpacingSupported&&(Yo.experimentalLetterSpacing?(n.letterSpacing=`${e}px`,n.textLetterSpacing=`${e}px`,r=!0):(n.letterSpacing="0px",n.textLetterSpacing="0px"));let i=n.measureText(t).width;return i>0&&(r?i-=e:i+=(Yo.graphemeSegmenter(t).length-1)*e),i}static wordWrap(t,e,n=Yo._canvas){const r=n.getContext("2d",$o);let i=0,s="",o="";const a=Object.create(null),{letterSpacing:h,whiteSpace:l}=e,u=Yo.collapseSpaces(l),c=Yo.collapseNewlines(l);let d=!u;const f=e.wordWrapWidth+h,p=Yo.tokenize(t);for(let m=0;m<p.length;m++){let t=p[m];if(Yo.isNewline(t)){if(!c){o+=Yo.addLine(s),d=!u,s="",i=0;continue}t=" "}if(u){const e=Yo.isBreakingSpace(t),n=Yo.isBreakingSpace(s[s.length-1]);if(e&&n)continue}const n=Yo.getFromCache(t,h,a,r);if(n>f)if(""!==s&&(o+=Yo.addLine(s),s="",i=0),Yo.canBreakWords(t,e.breakWords)){const n=Yo.wordWrapSplit(t);for(let l=0;l<n.length;l++){let u=n[l],c=u,p=1;for(;n[l+p];){const r=n[l+p];if(Yo.canBreakChars(c,r,t,l,e.breakWords))break;u+=r,c=r,p++}l+=p-1;const m=Yo.getFromCache(u,h,a,r);m+i>f&&(o+=Yo.addLine(s),d=!1,s="",i=0),s+=u,i+=m}}else{s.length>0&&(o+=Yo.addLine(s),s="",i=0);const e=m===p.length-1;o+=Yo.addLine(t,!e),d=!1,s="",i=0}else n+i>f&&(d=!1,o+=Yo.addLine(s),s="",i=0),(s.length>0||!Yo.isBreakingSpace(t)||d)&&(s+=t,i+=n)}return o+=Yo.addLine(s,!1),o}static addLine(t,e=!0){return t=Yo.trimRight(t),t=e?`${t}\n`:t}static getFromCache(t,e,n,r){let i=n[t];return"number"!=typeof i&&(i=Yo._measureText(t,e,r)+e,n[t]=i),i}static collapseSpaces(t){return"normal"===t||"pre-line"===t}static collapseNewlines(t){return"normal"===t}static trimRight(t){if("string"!=typeof t)return"";for(let e=t.length-1;e>=0;e--){const n=t[e];if(!Yo.isBreakingSpace(n))break;t=t.slice(0,-1)}return t}static isNewline(t){return"string"==typeof t&&Yo._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,e){return"string"==typeof t&&Yo._breakingSpaces.includes(t.charCodeAt(0))}static tokenize(t){const e=[];let n="";if("string"!=typeof t)return e;for(let r=0;r<t.length;r++){const i=t[r],s=t[r+1];Yo.isBreakingSpace(i,s)||Yo.isNewline(i)?(""!==n&&(e.push(n),n=""),e.push(i)):n+=i}return""!==n&&e.push(n),e}static canBreakWords(t,e){return e}static canBreakChars(t,e,n,r,i){return!0}static wordWrapSplit(t){return Yo.graphemeSegmenter(t)}static measureFont(t){if(Yo._fonts[t])return Yo._fonts[t];const e={ascent:0,descent:0,fontSize:0},n=Yo._canvas,r=Yo._context;r.font=t;const i=Yo.METRICS_STRING+Yo.BASELINE_SYMBOL,s=Math.ceil(r.measureText(i).width);let o=Math.ceil(r.measureText(Yo.BASELINE_SYMBOL).width);const a=Math.ceil(Yo.HEIGHT_MULTIPLIER*o);if(o=o*Yo.BASELINE_MULTIPLIER|0,0===s||0===a)return Yo._fonts[t]=e,e;n.width=s,n.height=a,r.fillStyle="#f00",r.fillRect(0,0,s,a),r.font=t,r.textBaseline="alphabetic",r.fillStyle="#000",r.fillText(i,0,o);const h=r.getImageData(0,0,s,a).data,l=h.length,u=4*s;let c=0,d=0,f=!1;for(c=0;c<o;++c){for(let t=0;t<u;t+=4)if(255!==h[d+t]){f=!0;break}if(f)break;d+=u}for(e.ascent=o-c,d=l-u,f=!1,c=a;c>o;--c){for(let t=0;t<u;t+=4)if(255!==h[d+t]){f=!0;break}if(f)break;d-=u}return e.descent=c-o,e.fontSize=e.ascent+e.descent,Yo._fonts[t]=e,e}static clearMetrics(t=""){t?delete Yo._fonts[t]:Yo._fonts={}}static get _canvas(){if(!Yo.__canvas){let e;try{const t=new OffscreenCanvas(0,0),n=t.getContext("2d",$o);if(n?.measureText)return Yo.__canvas=t,t;e=w.ADAPTER.createCanvas()}catch(t){e=w.ADAPTER.createCanvas()}e.width=e.height=10,Yo.__canvas=e}return Yo.__canvas}static get _context(){return Yo.__context||(Yo.__context=Yo._canvas.getContext("2d",$o)),Yo.__context}};let qo=Yo;qo.METRICS_STRING="|ÉqÅ",qo.BASELINE_SYMBOL="M",qo.BASELINE_MULTIPLIER=1.4,qo.HEIGHT_MULTIPLIER=2,qo.graphemeSegmenter=(()=>{if("function"==typeof Intl?.Segmenter){const t=new Intl.Segmenter;return e=>[...t.segment(e)].map((t=>t.segment))}return t=>[...t]})(),qo.experimentalLetterSpacing=!1,qo._fonts={},qo._newlines=[10,13],qo._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];const Ko=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],Qo=class{constructor(t){this.styleID=0,this.reset(),ta(this,t,t)}clone(){const t={};return ta(t,this,Qo.defaultStyle),new Qo(t)}reset(){ta(this,Qo.defaultStyle,Qo.defaultStyle)}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(t){const e=Jo(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)}get fill(){return this._fill}set fill(t){const e=Jo(t);this._fill!==e&&(this._fill=e,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(t){(function(t,e){if(!Array.isArray(t)||!Array.isArray(e))return!1;if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0})(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.styleID++)}get stroke(){return this._stroke}set stroke(t){const e=Jo(t);this._stroke!==e&&(this._stroke=e,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)}toFontString(){const t="number"==typeof this.fontSize?`${this.fontSize}px`:this.fontSize;let e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(let n=e.length-1;n>=0;n--){let t=e[n].trim();/([\"\'])[^\'\"]+\1/.test(t)||Ko.includes(t)||(t=`"${t}"`),e[n]=t}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${t} ${e.join(",")}`}};let Zo=Qo;function Jo(t){const e=Ct.shared;return Array.isArray(t)?t.map((t=>e.setValue(t).toHex())):e.setValue(t).toHex()}function ta(t,e,n){for(const r in n)Array.isArray(e[r])?t[r]=e[r].slice():t[r]=e[r]}Zo.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:Xo.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};const ea={texture:!0,children:!1,baseTexture:!0},na=class extends ui{constructor(t,e,n){let r=!1;n||(n=w.ADAPTER.createCanvas(),r=!0),n.width=3,n.height=3;const i=Pn.from(n);i.orig=new Ce,i.trim=new Ce,super(i),this._ownCanvas=r,this.canvas=n,this.context=n.getContext("2d",{willReadFrequently:!0}),this._resolution=na.defaultResolution??w.RESOLUTION,this._autoResolution=na.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=t,this.style=e,this.localStyleID=-1}static get experimentalLetterSpacing(){return qo.experimentalLetterSpacing}static set experimentalLetterSpacing(t){K(0,"Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),qo.experimentalLetterSpacing=t}updateText(t){const e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;this._font=this._style.toFontString();const n=this.context,r=qo.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),i=r.width,s=r.height,o=r.lines,a=r.lineHeight,h=r.lineWidths,l=r.maxLineWidth,u=r.fontProperties;let c,d;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,i)+2*e.padding)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,s)+2*e.padding)*this._resolution),n.scale(this._resolution,this._resolution),n.clearRect(0,0,this.canvas.width,this.canvas.height),n.font=this._font,n.lineWidth=e.strokeThickness,n.textBaseline=e.textBaseline,n.lineJoin=e.lineJoin,n.miterLimit=e.miterLimit;const f=e.dropShadow?2:1;for(let p=0;p<f;++p){const t=e.dropShadow&&0===p,i=t?Math.ceil(Math.max(1,s)+2*e.padding):0,f=i*this._resolution;if(t){n.fillStyle="black",n.strokeStyle="black";const t=e.dropShadowColor,r=e.dropShadowBlur*this._resolution,i=e.dropShadowDistance*this._resolution;n.shadowColor=Ct.shared.setValue(t).setAlpha(e.dropShadowAlpha).toRgbaString(),n.shadowBlur=r,n.shadowOffsetX=Math.cos(e.dropShadowAngle)*i,n.shadowOffsetY=Math.sin(e.dropShadowAngle)*i+f}else n.fillStyle=this._generateFillStyle(e,o,r),n.strokeStyle=e.stroke,n.shadowColor="black",n.shadowBlur=0,n.shadowOffsetX=0,n.shadowOffsetY=0;let m=(a-u.fontSize)/2;a-u.fontSize<0&&(m=0);for(let n=0;n<o.length;n++)c=e.strokeThickness/2,d=e.strokeThickness/2+n*a+u.ascent+m,"right"===e.align?c+=l-h[n]:"center"===e.align&&(c+=(l-h[n])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(o[n],c+e.padding,d+e.padding-i,!0),e.fill&&this.drawLetterSpacing(o[n],c+e.padding,d+e.padding-i)}this.updateTexture()}drawLetterSpacing(t,e,n,r=!1){const i=this._style.letterSpacing;let s=!1;if(qo.experimentalLetterSpacingSupported&&(qo.experimentalLetterSpacing?(this.context.letterSpacing=`${i}px`,this.context.textLetterSpacing=`${i}px`,s=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),0===i||s)return void(r?this.context.strokeText(t,e,n):this.context.fillText(t,e,n));let o=e;const a=qo.graphemeSegmenter(t);let h=this.context.measureText(t).width,l=0;for(let u=0;u<a.length;++u){const t=a[u];r?this.context.strokeText(t,o,n):this.context.fillText(t,o,n);let e="";for(let n=u+1;n<a.length;++n)e+=a[n];l=this.context.measureText(e).width,o+=h-l+i,h=l}}updateTexture(){const t=this.canvas;if(this._style.trim){const e=Xt(t);e.data&&(t.width=e.width,t.height=e.height,this.context.putImageData(e.data,0,0))}const e=this._texture,n=this._style,r=n.trim?0:n.padding,i=e.baseTexture;e.trim.width=e._frame.width=t.width/this._resolution,e.trim.height=e._frame.height=t.height/this._resolution,e.trim.x=-r,e.trim.y=-r,e.orig.width=e._frame.width-2*r,e.orig.height=e._frame.height-2*r,this._onTextureUpdate(),i.setRealSize(t.width,t.height,this._resolution),e.updateUvs(),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(t,e){return this.updateText(!0),-1===this._textureID&&(t=!1),super.getBounds(t,e)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds.call(this,t)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(t,e,n){const r=t.fill;if(!Array.isArray(r))return r;if(1===r.length)return r[0];let i;const s=t.dropShadow?t.dropShadowDistance:0,o=t.padding||0,a=this.canvas.width/this._resolution-s-2*o,h=this.canvas.height/this._resolution-s-2*o,l=r.slice(),u=t.fillGradientStops.slice();if(!u.length){const t=l.length+1;for(let e=1;e<t;++e)u.push(e/t)}if(l.unshift(r[0]),u.unshift(0),l.push(r[r.length-1]),u.push(1),t.fillGradientType===Xo.LINEAR_VERTICAL){i=this.context.createLinearGradient(a/2,o,a/2,h+o);const r=n.fontProperties.fontSize+t.strokeThickness;for(let t=0;t<e.length;t++){const s=n.lineHeight*(t-1)+r,o=n.lineHeight*t;let a=o;t>0&&s>o&&(a=(o+s)/2);const c=o+r,d=n.lineHeight*(t+1);let f=c;t+1<e.length&&d<c&&(f=(c+d)/2);const p=(f-a)/h;for(let t=0;t<l.length;t++){let e=0;e="number"==typeof u[t]?u[t]:t/l.length;let n=Math.min(1,Math.max(0,a/h+e*p));n=Number(n.toFixed(5)),i.addColorStop(n,l[t])}}}else{i=this.context.createLinearGradient(o,h/2,a+o,h/2);const t=l.length+1;let e=1;for(let n=0;n<l.length;n++){let r;r="number"==typeof u[n]?u[n]:e/t,i.addColorStop(r,l[n]),e++}}return i}destroy(t){"boolean"==typeof t&&(t={children:t}),t=Object.assign({},ea,t),super.destroy(t),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this.updateText(!0);const e=kt(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this.updateText(!0);const e=kt(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get style(){return this._style}set style(t){t=t||{},this._style=t instanceof Zo?t:new Zo(t),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}};let ra=na;ra.defaultAutoResolution=!0;class ia{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function sa(t,e){let n=!1;if(t?._textures?.length)for(let r=0;r<t._textures.length;r++)if(t._textures[r]instanceof Pn){const i=t._textures[r].baseTexture;e.includes(i)||(e.push(i),n=!0)}return n}function oa(t,e){if(t.baseTexture instanceof ue){const n=t.baseTexture;return e.includes(n)||e.push(n),!0}return!1}function aa(t,e){if(t._texture&&t._texture instanceof Pn){const n=t._texture.baseTexture;return e.includes(n)||e.push(n),!0}return!1}function ha(t,e){return e instanceof ra&&(e.updateText(!0),!0)}function la(t,e){if(e instanceof Zo){const t=e.toFontString();return qo.measureFont(t),!0}return!1}function ua(t,e){if(t instanceof ra){e.includes(t.style)||e.push(t.style),e.includes(t)||e.push(t);const n=t._texture.baseTexture;return e.includes(n)||e.push(n),!0}return!1}function ca(t,e){return t instanceof Zo&&(e.includes(t)||e.push(t),!0)}const da=class{constructor(t){this.limiter=new ia(da.uploadsPerFrame),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(ua),this.registerFindHook(ca),this.registerFindHook(sa),this.registerFindHook(oa),this.registerFindHook(aa),this.registerUploadHook(ha),this.registerUploadHook(la)}upload(t){return new Promise((e=>{t&&this.add(t),this.queue.length?(this.completes.push(e),this.ticking||(this.ticking=!0,kr.system.addOnce(this.tick,this,Or.UTILITY))):e()}))}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const t=this.queue[0];let e=!1;if(t&&!t._destroyed)for(let n=0,r=this.uploadHooks.length;n<r;n++)if(this.uploadHooks[n](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}e||this.queue.shift()}if(this.queue.length)kr.system.addOnce(this.tick,this,Or.UTILITY);else{this.ticking=!1;const t=this.completes.slice(0);this.completes.length=0;for(let e=0,n=t.length;e<n;e++)t[e]()}}registerFindHook(t){return t&&this.addHooks.push(t),this}registerUploadHook(t){return t&&this.uploadHooks.push(t),this}add(t){for(let e=0,n=this.addHooks.length;e<n&&!this.addHooks[e](t,this.queue);e++);if(t instanceof ai)for(let e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this}destroy(){this.ticking&&kr.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};let fa=da;function pa(t,e){return e instanceof ue&&(e._glTextures[t.CONTEXT_UID]||t.texture.bind(e),!0)}function ma(t,e){if(!(e instanceof Lo))return!1;const{geometry:n}=e;e.finishPoly(),n.updateBatches();const{batches:r}=n;for(let i=0;i<r.length;i++){const{texture:e}=r[i].style;e&&pa(t,e.baseTexture)}return n.batchable||t.geometry.bind(n,e._resolveDirectShader(t)),!0}function ga(t,e){return t instanceof Lo&&(e.push(t),!0)}fa.uploadsPerFrame=4,Object.defineProperties(w,{UPLOADS_PER_FRAME:{get(){return fa.uploadsPerFrame},set(t){K(0,"settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),fa.uploadsPerFrame=t}}});class _a extends fa{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(ga),this.registerUploadHook(pa),this.registerUploadHook(ma)}}_a.extension={name:"prepare",type:qt.RendererSystem},Zt.add(_a);new Se;var ya="#version 100\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n";const va=new Oe;class ba extends fn{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new Nn,this.state=ne.for2d()}contextChange(){const t=this.renderer,e={globals:t.globalUniforms};this.simpleShader=un.from(ya,"#version 100\n#define SHADER_NAME Tiling-Sprite-Simple-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 texSample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = texSample * uColor;\n}\n",e),this.shader=t.context.webGLVersion>1?un.from("#version 300 es\n#define SHADER_NAME Tiling-Sprite-300\n\nprecision lowp float;\n\nin vec2 aVertexPosition;\nin vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nout vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","#version 300 es\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nin vec2 vTextureCoord;\n\nout vec4 fragmentColor;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0\n\n    fragmentColor = texSample * uColor;\n}\n",e):un.from(ya,"#version 100\n#ifdef GL_EXT_shader_texture_lod\n    #extension GL_EXT_shader_texture_lod : enable\n#endif\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    #ifdef GL_EXT_shader_texture_lod\n        vec4 texSample = unclamped == coord\n            ? texture2D(uSampler, coord) \n            : texture2DLodEXT(uSampler, coord, 0);\n    #else\n        vec4 texSample = texture2D(uSampler, coord);\n    #endif\n\n    gl_FragColor = texSample * uColor;\n}\n",e)}render(t){const e=this.renderer,n=this.quad;let r=n.vertices;r[0]=r[6]=t._width*-t.anchor.x,r[1]=r[3]=t._height*-t.anchor.y,r[2]=r[4]=t._width*(1-t.anchor.x),r[5]=r[7]=t._height*(1-t.anchor.y);const i=t.uvRespectAnchor?t.anchor.x:0,s=t.uvRespectAnchor?t.anchor.y:0;r=n.uvs,r[0]=r[6]=-i,r[1]=r[3]=-s,r[2]=r[4]=1-i,r[5]=r[7]=1-s,n.invalidate();const o=t._texture,a=o.baseTexture,h=a.alphaMode>0,l=t.tileTransform.localTransform,u=t.uvMatrix;let c=a.isPowerOfTwo&&o.frame.width===a.width&&o.frame.height===a.height;c&&(a._glTextures[e.CONTEXT_UID]?c=a.wrapMode!==f.CLAMP:a.wrapMode===f.CLAMP&&(a.wrapMode=f.REPEAT));const d=c?this.simpleShader:this.shader,p=o.width,m=o.height,g=t._width,_=t._height;va.set(l.a*p/g,l.b*p/_,l.c*m/g,l.d*m/_,l.tx/g,l.ty/_),va.invert(),c?va.prepend(u.mapCoord):(d.uniforms.uMapCoord=u.mapCoord.toArray(!0),d.uniforms.uClampFrame=u.uClampFrame,d.uniforms.uClampOffset=u.uClampOffset),d.uniforms.uTransform=va.toArray(!0),d.uniforms.uColor=Ct.shared.setValue(t.tint).premultiply(t.worldAlpha,h).toArray(d.uniforms.uColor),d.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),d.uniforms.uSampler=o,e.shader.bind(d),e.geometry.bind(n),this.state.blendMode=Rt(t.blendMode,h),e.state.set(this.state),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}ba.extension={name:"tilingSprite",type:qt.RendererPlugin},Zt.add(ba);const xa=class{constructor(t,e,n=null){this.linkedSheets=[],this._texture=t instanceof Pn?t:null,this.baseTexture=t instanceof ue?t:this._texture.baseTexture,this.textures={},this.animations={},this.data=e;const r=this.baseTexture.resource;this.resolution=this._updateResolution(n||(r?r.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(t=null){const{scale:e}=this.data.meta;let n=Yt(t,null);return null===n&&(n=parseFloat(e??"1")),1!==n&&this.baseTexture.setResolution(n),n}parse(){return new Promise((t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=xa.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()}))}_processFrames(t){let e=t;const n=xa.BATCH_SIZE;for(;e-t<n&&e<this._frameKeys.length;){const t=this._frameKeys[e],n=this._frames[t],r=n.frame;if(r){let e=null,i=null;const s=!1!==n.trimmed&&n.sourceSize?n.sourceSize:n.frame,o=new Ce(0,0,Math.floor(s.w)/this.resolution,Math.floor(s.h)/this.resolution);e=n.rotated?new Ce(Math.floor(r.x)/this.resolution,Math.floor(r.y)/this.resolution,Math.floor(r.h)/this.resolution,Math.floor(r.w)/this.resolution):new Ce(Math.floor(r.x)/this.resolution,Math.floor(r.y)/this.resolution,Math.floor(r.w)/this.resolution,Math.floor(r.h)/this.resolution),!1!==n.trimmed&&n.spriteSourceSize&&(i=new Ce(Math.floor(n.spriteSourceSize.x)/this.resolution,Math.floor(n.spriteSourceSize.y)/this.resolution,Math.floor(r.w)/this.resolution,Math.floor(r.h)/this.resolution)),this.textures[t]=new Pn(this.baseTexture,e,o,i,n.rotated?2:0,n.anchor,n.borders),Pn.addToCache(this.textures[t],t)}e++}}_processAnimations(){const t=this.data.animations||{};for(const e in t){this.animations[e]=[];for(let n=0;n<t[e].length;n++){const r=t[e][n];this.animations[e].push(this.textures[r])}}}_parseComplete(){const t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*xa.BATCH_SIZE),this._batchIndex++,setTimeout((()=>{this._batchIndex*xa.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())}),0)}destroy(t=!1){for(const e in this.textures)this.textures[e].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&(this._texture?.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};let Ea=xa;Ea.BATCH_SIZE=1e3;const wa=["jpg","png","jpeg","avif","webp"];function Ta(t,e,n){const r={};if(t.forEach((t=>{r[t]=e})),Object.keys(e.textures).forEach((t=>{r[t]=e.textures[t]})),!n){const n=Y.dirname(t[0]);e.linkedSheets.forEach(((t,i)=>{const s=Ta([`${n}/${e.data.meta.related_multi_packs[i]}`],t,!0);Object.assign(r,s)}))}return r}const Sa={extension:qt.Asset,cache:{test:t=>t instanceof Ea,getCacheableAssets:(t,e)=>Ta(t,e,!1)},resolver:{test:t=>{const e=t.split("?")[0].split("."),n=e.pop(),r=e.pop();return"json"===n&&wa.includes(r)},parse:t=>{const e=t.split(".");return{resolution:parseFloat(w.RETINA_PREFIX.exec(t)?.[1]??"1"),format:e[e.length-2],src:t}}},loader:{name:"spritesheetLoader",extension:{type:qt.LoadParser,priority:Hi.Normal},async testParse(t,e){return".json"===Y.extname(e.src).toLowerCase()&&!!t.frames},async parse(t,e,n){let r=Y.dirname(e.src);r&&r.lastIndexOf("/")!==r.length-1&&(r+="/");let i=r+t.meta.image;i=ys(i,e.src);const s=(await n.load([i]))[i],o=new Ea(s.baseTexture,t,e.src);await o.parse();const a=t?.meta?.related_multi_packs;if(Array.isArray(a)){const t=[];for(const s of a){if("string"!=typeof s)continue;let i=r+s;e.data?.ignoreMultiPack||(i=ys(i,e.src),t.push(n.load({src:i,data:{ignoreMultiPack:!0}})))}const i=await Promise.all(t);o.linkedSheets=i,i.forEach((t=>{t.linkedSheets=[o].concat(o.linkedSheets.filter((e=>e!==t)))}))}return o},unload(t){t.destroy(!0)}}};Zt.add(Sa);class Aa{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class Ca{static test(t){return"string"==typeof t&&t.startsWith("info face=")}static parse(t){const e=t.match(/^[a-z]+\s+.+$/gm),n={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const i in e){const t=e[i].match(/^[a-z]+/gm)[0],r=e[i].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),s={};for(const e in r){const t=r[e].split("="),n=t[0],i=t[1].replace(/"/gm,""),o=parseFloat(i),a=isNaN(o)?i:o;s[n]=a}n[t].push(s)}const r=new Aa;return n.info.forEach((t=>r.info.push({face:t.face,size:parseInt(t.size,10)}))),n.common.forEach((t=>r.common.push({lineHeight:parseInt(t.lineHeight,10)}))),n.page.forEach((t=>r.page.push({id:parseInt(t.id,10),file:t.file}))),n.char.forEach((t=>r.char.push({id:parseInt(t.id,10),page:parseInt(t.page,10),x:parseInt(t.x,10),y:parseInt(t.y,10),width:parseInt(t.width,10),height:parseInt(t.height,10),xoffset:parseInt(t.xoffset,10),yoffset:parseInt(t.yoffset,10),xadvance:parseInt(t.xadvance,10)}))),n.kerning.forEach((t=>r.kerning.push({first:parseInt(t.first,10),second:parseInt(t.second,10),amount:parseInt(t.amount,10)}))),n.distanceField.forEach((t=>r.distanceField.push({distanceRange:parseInt(t.distanceRange,10),fieldType:t.fieldType}))),r}}class Ia{static test(t){const e=t;return"getElementsByTagName"in e&&e.getElementsByTagName("page").length&&null!==e.getElementsByTagName("info")[0].getAttribute("face")}static parse(t){const e=new Aa,n=t.getElementsByTagName("info"),r=t.getElementsByTagName("common"),i=t.getElementsByTagName("page"),s=t.getElementsByTagName("char"),o=t.getElementsByTagName("kerning"),a=t.getElementsByTagName("distanceField");for(let h=0;h<n.length;h++)e.info.push({face:n[h].getAttribute("face"),size:parseInt(n[h].getAttribute("size"),10)});for(let h=0;h<r.length;h++)e.common.push({lineHeight:parseInt(r[h].getAttribute("lineHeight"),10)});for(let h=0;h<i.length;h++)e.page.push({id:parseInt(i[h].getAttribute("id"),10)||0,file:i[h].getAttribute("file")});for(let h=0;h<s.length;h++){const t=s[h];e.char.push({id:parseInt(t.getAttribute("id"),10),page:parseInt(t.getAttribute("page"),10)||0,x:parseInt(t.getAttribute("x"),10),y:parseInt(t.getAttribute("y"),10),width:parseInt(t.getAttribute("width"),10),height:parseInt(t.getAttribute("height"),10),xoffset:parseInt(t.getAttribute("xoffset"),10),yoffset:parseInt(t.getAttribute("yoffset"),10),xadvance:parseInt(t.getAttribute("xadvance"),10)})}for(let h=0;h<o.length;h++)e.kerning.push({first:parseInt(o[h].getAttribute("first"),10),second:parseInt(o[h].getAttribute("second"),10),amount:parseInt(o[h].getAttribute("amount"),10)});for(let h=0;h<a.length;h++)e.distanceField.push({fieldType:a[h].getAttribute("fieldType"),distanceRange:parseInt(a[h].getAttribute("distanceRange"),10)});return e}}class Ra{static test(t){return!("string"!=typeof t||!t.includes("<font>"))&&Ia.test(w.ADAPTER.parseXML(t))}static parse(t){return Ia.parse(w.ADAPTER.parseXML(t))}}const Pa=[Ca,Ia,Ra];function Ma(t,e,n,r,i,s,o){const a=n.text,h=n.fontProperties;e.translate(r,i),e.scale(s,s);const l=o.strokeThickness/2,u=-o.strokeThickness/2;if(e.font=o.toFontString(),e.lineWidth=o.strokeThickness,e.textBaseline=o.textBaseline,e.lineJoin=o.lineJoin,e.miterLimit=o.miterLimit,e.fillStyle=function(t,e,n,r,i,s){const o=n.fill;if(!Array.isArray(o))return o;if(1===o.length)return o[0];let a;const h=n.dropShadow?n.dropShadowDistance:0,l=n.padding||0,u=t.width/r-h-2*l,c=t.height/r-h-2*l,d=o.slice(),f=n.fillGradientStops.slice();if(!f.length){const t=d.length+1;for(let e=1;e<t;++e)f.push(e/t)}if(d.unshift(o[0]),f.unshift(0),d.push(o[o.length-1]),f.push(1),n.fillGradientType===Xo.LINEAR_VERTICAL){a=e.createLinearGradient(u/2,l,u/2,c+l);let t=0;const r=(s.fontProperties.fontSize+n.strokeThickness)/c;for(let e=0;e<i.length;e++){const n=s.lineHeight*e;for(let e=0;e<d.length;e++){let i=0;i="number"==typeof f[e]?f[e]:e/d.length;const s=n/c+i*r;let o=Math.max(t,s);o=Math.min(o,1),a.addColorStop(o,d[e]),t=o}}}else{a=e.createLinearGradient(l,c/2,u+l,c/2);const t=d.length+1;let n=1;for(let e=0;e<d.length;e++){let r;r="number"==typeof f[e]?f[e]:n/t,a.addColorStop(r,d[e]),n++}}return a}(t,e,o,s,[a],n),e.strokeStyle=o.stroke,o.dropShadow){const t=o.dropShadowColor,n=o.dropShadowBlur*s,r=o.dropShadowDistance*s;e.shadowColor=Ct.shared.setValue(t).setAlpha(o.dropShadowAlpha).toRgbaString(),e.shadowBlur=n,e.shadowOffsetX=Math.cos(o.dropShadowAngle)*r,e.shadowOffsetY=Math.sin(o.dropShadowAngle)*r}else e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0;o.stroke&&o.strokeThickness&&e.strokeText(a,l,u+n.lineHeight-h.descent),o.fill&&e.fillText(a,l,u+n.lineHeight-h.descent),e.setTransform(1,0,0,1,0,0),e.fillStyle="rgba(0, 0, 0, 0)"}function Oa(t){return Array.from?Array.from(t):t.split("")}function Da(t){return t.codePointAt?t.codePointAt(0):t.charCodeAt(0)}const Na=class{constructor(t,e,n){const[r]=t.info,[i]=t.common,[s]=t.page,[o]=t.distanceField,a=Yt(s.file),h={};this._ownsTextures=n,this.font=r.face,this.size=r.size,this.lineHeight=i.lineHeight/a,this.chars={},this.pageTextures=h;for(let l=0;l<t.page.length;l++){const{id:n,file:r}=t.page[l];h[n]=e instanceof Array?e[l]:e[r],o?.fieldType&&"none"!==o.fieldType&&(h[n].baseTexture.alphaMode=m.NO_PREMULTIPLIED_ALPHA,h[n].baseTexture.mipmap=p.OFF)}for(let l=0;l<t.char.length;l++){const{id:e,page:n}=t.char[l];let{x:r,y:i,width:s,height:o,xoffset:u,yoffset:c,xadvance:d}=t.char[l];r/=a,i/=a,s/=a,o/=a,u/=a,c/=a,d/=a;const f=new Ce(r+h[n].frame.x/a,i+h[n].frame.y/a,s,o);this.chars[e]={xOffset:u,yOffset:c,xAdvance:d,kerning:{},texture:new Pn(h[n].baseTexture,f),page:n}}for(let l=0;l<t.kerning.length;l++){let{first:e,second:n,amount:r}=t.kerning[l];e/=a,n/=a,r/=a,this.chars[n]&&(this.chars[n].kerning[e]=r)}this.distanceFieldRange=o?.distanceRange,this.distanceFieldType=o?.fieldType?.toLowerCase()??"none"}destroy(){for(const t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(const t in this.pageTextures)this._ownsTextures&&this.pageTextures[t].destroy(!0),this.pageTextures[t]=null;this.chars=null,this.pageTextures=null}static install(t,e,n){let r;if(t instanceof Aa)r=t;else{const e=function(t){for(let e=0;e<Pa.length;e++)if(Pa[e].test(t))return Pa[e];return null}(t);if(!e)throw new Error("Unrecognized data format for font.");r=e.parse(t)}e instanceof Pn&&(e=[e]);const i=new Na(r,e,n);return Na.available[i.font]=i,i}static uninstall(t){const e=Na.available[t];if(!e)throw new Error(`No font found named '${t}'`);e.destroy(),delete Na.available[t]}static from(t,e,n){if(!t)throw new Error("[BitmapFont] Property `name` is required.");const{chars:r,padding:i,resolution:s,textureWidth:o,textureHeight:a,...h}=Object.assign({},Na.defaultOptions,n),l=function(t){"string"==typeof t&&(t=[t]);const e=[];for(let n=0,r=t.length;n<r;n++){const r=t[n];if(Array.isArray(r)){if(2!==r.length)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${r.length}.`);const t=r[0].charCodeAt(0),n=r[1].charCodeAt(0);if(n<t)throw new Error("[BitmapFont]: Invalid character range.");for(let r=t,i=n;r<=i;r++)e.push(String.fromCharCode(r))}else e.push(...Oa(r))}if(0===e.length)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}(r),u=e instanceof Zo?e:new Zo(e),c=o,d=new Aa;d.info[0]={face:u.fontFamily,size:u.fontSize},d.common[0]={lineHeight:u.fontSize};let f,p,m,g=0,_=0,y=0;const v=[],b=[];for(let E=0;E<l.length;E++){f||(f=w.ADAPTER.createCanvas(),f.width=o,f.height=a,p=f.getContext("2d"),m=new ue(f,{resolution:s,...h}),v.push(m),b.push(new Pn(m)),d.page.push({id:b.length-1,file:""}));const t=l[E],e=qo.measureText(t,u,!1,f),n=e.width,r=Math.ceil(e.height),x=Math.ceil(("italic"===u.fontStyle?2:1)*n);if(_>=a-r*s){if(0===_)throw new Error(`[BitmapFont] textureHeight ${a}px is too small (fontFamily: '${u.fontFamily}', fontSize: ${u.fontSize}px, char: '${t}')`);--E,f=null,p=null,m=null,_=0,g=0,y=0;continue}if(y=Math.max(r+e.fontProperties.descent,y),x*s+g>=c){if(0===g)throw new Error(`[BitmapFont] textureWidth ${o}px is too small (fontFamily: '${u.fontFamily}', fontSize: ${u.fontSize}px, char: '${t}')`);--E,_+=y*s,_=Math.ceil(_),g=0,y=0;continue}Ma(f,p,e,g,_,s,u);const T=Da(e.text);d.char.push({id:T,page:b.length-1,x:g/s,y:_/s,width:x,height:r,xoffset:0,yoffset:0,xadvance:n-(u.dropShadow?u.dropShadowDistance:0)-(u.stroke?u.strokeThickness:0)}),g+=(x+2*i)*s,g=Math.ceil(g)}for(let E=0,w=l.length;E<w;E++){const t=l[E];for(let e=0;e<w;e++){const n=l[e],r=p.measureText(t).width,i=p.measureText(n).width,s=p.measureText(t+n).width-(r+i);s&&d.kerning.push({first:Da(t),second:Da(n),amount:s})}}const x=new Na(d,b,!0);return void 0!==Na.available[t]&&Na.uninstall(t),Na.available[t]=x,x}};let ka=Na;ka.ALPHA=[["a","z"],["A","Z"]," "],ka.NUMERIC=[["0","9"]],ka.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],ka.ASCII=[[" ","~"]],ka.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:Na.ALPHANUMERIC},ka.available={};const La=[],Fa=[],Ba=[],Ua=class extends ai{constructor(t,e={}){super();const{align:n,tint:r,maxWidth:i,letterSpacing:s,fontName:o,fontSize:a}=Object.assign({},Ua.styleDefaults,e);if(!ka.available[o])throw new Error(`Missing BitmapFont "${o}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=n,this._tintColor=new Ct(r),this._font=void 0,this._fontName=o,this._fontSize=a,this.text=t,this._maxWidth=i,this._maxLineHeight=0,this._letterSpacing=s,this._anchor=new Ge((()=>{this.dirty=!0}),this,0,0),this._roundPixels=w.ROUND_PIXELS,this.dirty=!0,this._resolution=w.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){const t=ka.available[this._fontName],e=this.fontSize,n=e/t.size,r=new Se,i=[],s=[],a=[],h=Oa(this._text.replace(/(?:\r\n|\r)/g,"\n")||" "),l=this._maxWidth*t.size/e,u="none"===t.distanceFieldType?La:Fa;let c=null,d=0,f=0,p=0,m=-1,g=0,_=0,y=0,v=0;for(let o=0;o<h.length;o++){const e=h[o],n=Da(e);if(/(?:\s)/.test(e)&&(m=o,g=d,v++),"\r"===e||"\n"===e){s.push(d),a.push(-1),f=Math.max(f,d),++p,++_,r.x=0,r.y+=t.lineHeight,c=null,v=0;continue}const u=t.chars[n];if(!u)continue;c&&u.kerning[c]&&(r.x+=u.kerning[c]);const b=Ba.pop()||{texture:Pn.EMPTY,line:0,charCode:0,prevSpaces:0,position:new Se};b.texture=u.texture,b.line=p,b.charCode=n,b.position.x=Math.round(r.x+u.xOffset+this._letterSpacing/2),b.position.y=Math.round(r.y+u.yOffset),b.prevSpaces=v,i.push(b),d=b.position.x+Math.max(u.xAdvance-u.xOffset,u.texture.orig.width),r.x+=u.xAdvance+this._letterSpacing,y=Math.max(y,u.yOffset+u.texture.height),c=n,-1!==m&&l>0&&r.x>l&&(++_,Nt(i,1+m-_,1+o-m),o=m,m=-1,s.push(g),a.push(i.length>0?i[i.length-1].prevSpaces:0),f=Math.max(f,g),p++,r.x=0,r.y+=t.lineHeight,c=null,v=0)}const b=h[h.length-1];"\r"!==b&&"\n"!==b&&(/(?:\s)/.test(b)&&(d=g),s.push(d),f=Math.max(f,d),a.push(-1));const x=[];for(let o=0;o<=p;o++){let t=0;"right"===this._align?t=f-s[o]:"center"===this._align?t=(f-s[o])/2:"justify"===this._align&&(t=a[o]<0?0:(f-s[o])/a[o]),x.push(t)}const E=i.length,w={},T=[],S=this._activePagesMeshData;u.push(...S);for(let A=0;A<E;A++){const e=i[A].texture,n=e.baseTexture.uid;if(!w[n]){let r=u.pop();if(!r){const e=new Ho;let n,i;"none"===t.distanceFieldType?(n=new zo(Pn.EMPTY),i=o.NORMAL):(n=new zo(Pn.EMPTY,{program:an.from("// Mesh material default fragment\r\nattribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\n\r\nuniform mat3 projectionMatrix;\r\nuniform mat3 translationMatrix;\r\nuniform mat3 uTextureMatrix;\r\n\r\nvarying vec2 vTextureCoord;\r\n\r\nvoid main(void)\r\n{\r\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r\n\r\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r\n}\r\n","// Pixi texture info\r\nvarying vec2 vTextureCoord;\r\nuniform sampler2D uSampler;\r\n\r\n// Tint\r\nuniform vec4 uColor;\r\n\r\n// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r\nuniform float uFWidth;\r\n\r\nvoid main(void) {\r\n\r\n  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r\n  vec4 texColor = texture2D(uSampler, vTextureCoord);\r\n\r\n  // MSDF\r\n  float median = texColor.r + texColor.g + texColor.b -\r\n                  min(texColor.r, min(texColor.g, texColor.b)) -\r\n                  max(texColor.r, max(texColor.g, texColor.b));\r\n  // SDF\r\n  median = min(median, texColor.a);\r\n\r\n  float screenPxDistance = uFWidth * (median - 0.5);\r\n  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r\n  if (median < 0.01) {\r\n    alpha = 0.0;\r\n  } else if (median > 0.99) {\r\n    alpha = 1.0;\r\n  }\r\n\r\n  // Gamma correction for coverage-like alpha\r\n  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r\n  float gamma = mix(1.0, 1.0 / 2.2, luma);\r\n  float coverage = pow(uColor.a * alpha, gamma);  \r\n\r\n  // NPM Textures, NPM outputs\r\n  gl_FragColor = vec4(uColor.rgb, coverage);\r\n}\r\n"),uniforms:{uFWidth:0}}),i=o.NORMAL_NPM);const s=new Go(e,n);s.blendMode=i,r={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:s,vertices:null,uvs:null,indices:null}}r.index=0,r.indexCount=0,r.vertexCount=0,r.uvsCount=0,r.total=0;const{_textureCache:i}=this;i[n]=i[n]||new Pn(e.baseTexture),r.mesh.texture=i[n],r.mesh.tint=this._tintColor.value,T.push(r),w[n]=r}w[n].total++}for(let o=0;o<S.length;o++)T.includes(S[o])||this.removeChild(S[o].mesh);for(let o=0;o<T.length;o++)T[o].mesh.parent!==this&&this.addChild(T[o].mesh);this._activePagesMeshData=T;for(const o in w){const t=w[o],e=t.total;if(!(t.indices?.length>6*e)||t.vertices.length<2*Go.BATCHABLE_SIZE)t.vertices=new Float32Array(8*e),t.uvs=new Float32Array(8*e),t.indices=new Uint16Array(6*e);else{const e=t.total,n=t.vertices;for(let t=4*e*2;t<n.length;t++)n[t]=0}t.mesh.size=6*e}for(let o=0;o<E;o++){const t=i[o];let e=t.position.x+x[t.line]*("justify"===this._align?t.prevSpaces:1);this._roundPixels&&(e=Math.round(e));const r=e*n,s=t.position.y*n,a=t.texture,h=w[a.baseTexture.uid],l=a.frame,u=a._uvs,c=h.index++;h.indices[6*c+0]=0+4*c,h.indices[6*c+1]=1+4*c,h.indices[6*c+2]=2+4*c,h.indices[6*c+3]=0+4*c,h.indices[6*c+4]=2+4*c,h.indices[6*c+5]=3+4*c,h.vertices[8*c+0]=r,h.vertices[8*c+1]=s,h.vertices[8*c+2]=r+l.width*n,h.vertices[8*c+3]=s,h.vertices[8*c+4]=r+l.width*n,h.vertices[8*c+5]=s+l.height*n,h.vertices[8*c+6]=r,h.vertices[8*c+7]=s+l.height*n,h.uvs[8*c+0]=u.x0,h.uvs[8*c+1]=u.y0,h.uvs[8*c+2]=u.x1,h.uvs[8*c+3]=u.y1,h.uvs[8*c+4]=u.x2,h.uvs[8*c+5]=u.y2,h.uvs[8*c+6]=u.x3,h.uvs[8*c+7]=u.y3}this._textWidth=f*n,this._textHeight=(r.y+t.lineHeight)*n;for(const o in w){const t=w[o];if(0!==this.anchor.x||0!==this.anchor.y){let e=0;const n=this._textWidth*this.anchor.x,r=this._textHeight*this.anchor.y;for(let i=0;i<t.total;i++)t.vertices[e++]-=n,t.vertices[e++]-=r,t.vertices[e++]-=n,t.vertices[e++]-=r,t.vertices[e++]-=n,t.vertices[e++]-=r,t.vertices[e++]-=n,t.vertices[e++]-=r}this._maxLineHeight=y*n;const e=t.mesh.geometry.getBuffer("aVertexPosition"),r=t.mesh.geometry.getBuffer("aTextureCoord"),i=t.mesh.geometry.getIndex();e.data=t.vertices,r.data=t.uvs,i.data=t.indices,e.update(),r.update(),i.update()}for(let o=0;o<i.length;o++)Ba.push(i[o]);this._font=t,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0);const{distanceFieldRange:e,distanceFieldType:n,size:r}=ka.available[this._fontName];if("none"!==n){const{a:n,b:i,c:s,d:o}=this.worldTransform,a=Math.sqrt(n*n+i*i),h=Math.sqrt(s*s+o*o),l=(Math.abs(a)+Math.abs(h))/2,u=this.fontSize/r,c=t._view.resolution;for(const t of this._activePagesMeshData)t.mesh.shader.uniforms.uFWidth=l*e*u*c}super._render(t)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const t=ka.available[this._fontName];if(!t)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==t&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(t){if(this.tint!==t){this._tintColor.setValue(t);for(let e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=t}}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.dirty=!0)}get fontName(){return this._fontName}set fontName(t){if(!ka.available[t])throw new Error(`Missing BitmapFont "${t}"`);this._fontName!==t&&(this._fontName=t,this.dirty=!0)}get fontSize(){return this._fontSize??ka.available[this._fontName].size}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)}get anchor(){return this._anchor}set anchor(t){"number"==typeof t?this._anchor.set(t):this._anchor.copyFrom(t)}get text(){return this._text}set text(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}destroy(t){const{_textureCache:e}=this,n="none"===ka.available[this._fontName].distanceFieldType?La:Fa;n.push(...this._activePagesMeshData);for(const r of this._activePagesMeshData)this.removeChild(r.mesh);this._activePagesMeshData=[],n.filter((t=>e[t.mesh.texture.baseTexture.uid])).forEach((t=>{t.mesh.texture=Pn.EMPTY}));for(const r in e){e[r].destroy(),delete e[r]}this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(t)}};Ua.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const ja=[".xml",".fnt"],Ga={extension:{type:qt.LoadParser,priority:Hi.Normal},name:"loadBitmapFont",test(t){return ja.includes(Y.extname(t).toLowerCase())},async testParse(t){return Ca.test(t)||Ra.test(t)},async parse(t,e,n){const r=Ca.test(t)?Ca.parse(t):Ra.parse(t),{src:i}=e,{page:s}=r,o=[];for(let l=0;l<s.length;++l){const t=s[l].file;let e=Y.join(Y.dirname(i),t);e=ys(e,i),o.push(e)}const a=await n.load(o),h=o.map((t=>a[t]));return ka.install(r,h,!0)},async load(t,e){return(await w.ADAPTER.fetch(t)).text()},unload(t){t.destroy()}};Zt.add(Ga);const Ha=class extends Zo{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(t){return new Ha(Object.keys(Ha.defaultOptions).reduce(((e,n)=>({...e,[n]:t[n]})),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach((t=>{URL.revokeObjectURL(t.src),t.refs--,0===t.refs&&(t.fontFace&&document.fonts["delete"](t.fontFace),delete Ha.availableFonts[t.originalUrl])})),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(t,e={}){const{availableFonts:n}=Ha;if(n[t]){const e=n[t];return this._fonts.push(e),e.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return w.ADAPTER.fetch(t).then((t=>t.blob())).then((async t=>new Promise(((e,n)=>{const r=URL.createObjectURL(t),i=new FileReader;i.onload=()=>e([r,i.result]),i.onerror=n,i.readAsDataURL(t)})))).then((async([r,i])=>{const s=Object.assign({family:Y.basename(t,Y.extname(t)),weight:"normal",style:"normal",src:r,dataSrc:i,refs:1,originalUrl:t,fontFace:null},e);n[t]=s,this._fonts.push(s),this.styleID++;const o=new FontFace(s.family,`url(${s.src})`,{weight:s.weight,style:s.style});s.fontFace=o,await o.load(),document.fonts.add(o),await document.fonts.ready,this.styleID++,this.fontsDirty=!0}))}addOverride(...t){const e=t.filter((t=>!this._overrides.includes(t)));e.length>0&&(this._overrides.push(...e),this.styleID++)}removeOverride(...t){const e=t.filter((t=>this._overrides.includes(t)));e.length>0&&(this._overrides=this._overrides.filter((t=>!e.includes(t))),this.styleID++)}toCSS(t){return[`transform: scale(${t})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?["word-wrap: "+(this.breakWords?"break-all":"break-word"),`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce(((t,e)=>`${t}\n            @font-face {\n                font-family: "${e.family}";\n                src: url('${e.dataSrc}');\n                font-weight: ${e.weight};\n                font-style: ${e.style}; \n            }`),this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(t){this._stylesheet!==t&&(this._stylesheet=t,this.styleID++)}normalizeColor(t){var e,n;return Array.isArray(t)&&(e=t,K(0,"utils.rgb2hex is deprecated, use Color#toNumber instead"),t=Ct.shared.setValue(e).toNumber()),"number"==typeof t?(n=t,K(0,"utils.hex2string is deprecated, use Color#toHex instead"),Ct.shared.setValue(n).toHex()):t}dropShadowToCSS(){let t=this.normalizeColor(this.dropShadowColor);const e=this.dropShadowAlpha,n=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),r=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);t.startsWith("#")&&e<1&&(t+=(255*e|0).toString(16).padStart(2,"0"));const i=`${n}px ${r}px`;return this.dropShadowBlur>0?`text-shadow: ${i} ${this.dropShadowBlur}px ${t}`:`text-shadow: ${i} ${t}`}reset(){Object.assign(this,Ha.defaultOptions)}onBeforeDraw(){const{fontsDirty:t}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&t?new Promise((t=>setTimeout(t,100))):Promise.resolve()}get isSafari(){const{userAgent:t}=w.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(t)}set fillGradientStops(t){}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(t){}get fillGradientType(){return super.fillGradientType}set miterLimit(t){}get miterLimit(){return super.miterLimit}set trim(t){}get trim(){return super.trim}set textBaseline(t){}get textBaseline(){return super.textBaseline}set leading(t){}get leading(){return super.leading}set lineJoin(t){}get lineJoin(){return super.lineJoin}};let za=Ha;za.availableFonts={},za.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};const Wa=class extends ui{constructor(t="",e={}){super(Pn.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this._loading=!1,this.localStyleID=-1,this.dirty=!1,this.ownsStyle=!1;const n=new Image,r=Pn.from(n,{scaleMode:w.SCALE_MODE,resourceOptions:{autoLoad:!1}});r.orig=new Ce,r.trim=new Ce,this.texture=r;const i="http://www.w3.org/2000/svg",s="http://www.w3.org/1999/xhtml",o=document.createElementNS(i,"svg"),a=document.createElementNS(i,"foreignObject"),h=document.createElementNS(s,"div"),l=document.createElementNS(s,"style");a.setAttribute("width","10000"),a.setAttribute("height","10000"),a.style.overflow="hidden",o.appendChild(a),this.maxWidth=Wa.defaultMaxWidth,this.maxHeight=Wa.defaultMaxHeight,this._domElement=h,this._styleElement=l,this._svgRoot=o,this._foreignObject=a,this._foreignObject.appendChild(l),this._foreignObject.appendChild(h),this._image=n,this._loadImage=new Image,this._autoResolution=Wa.defaultAutoResolution,this._resolution=Wa.defaultResolution??w.RESOLUTION,this.text=t,this.style=e}measureText(t){const{text:e,style:n,resolution:r}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},t);Object.assign(this._domElement,{innerHTML:e,style:n.toCSS(r)}),this._styleElement.textContent=n.toGlobalCSS(),document.body.appendChild(this._svgRoot);const i=this._domElement.getBoundingClientRect();this._svgRoot.remove();const s=Math.min(this.maxWidth,Math.ceil(i.width)),o=Math.min(this.maxHeight,Math.ceil(i.height));return this._svgRoot.setAttribute("width",s.toString()),this._svgRoot.setAttribute("height",o.toString()),e!==this._text&&(this._domElement.innerHTML=this._text),n!==this._style&&(Object.assign(this._domElement,{style:this._style?.toCSS(r)}),this._styleElement.textContent=this._style?.toGlobalCSS()),{width:s+2*n.padding,height:o+2*n.padding}}async updateText(t=!0){const{style:e,_image:n,_loadImage:r}=this;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;const{width:i,height:s}=this.measureText();n.width=r.width=Math.ceil(Math.max(1,i)),n.height=r.height=Math.ceil(Math.max(1,s)),this._loading||(this._loading=!0,await new Promise((t=>{r.onload=async()=>{await e.onBeforeDraw(),this._loading=!1,n.src=r.src,r.onload=null,r.src="",this.updateTexture(),t()};const i=(new XMLSerializer).serializeToString(this._svgRoot);r.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(i)}`})))}get source(){return this._image}updateTexture(){const{style:t,texture:e,_image:n,resolution:r}=this,{padding:i}=t,{baseTexture:s}=e;e.trim.width=e._frame.width=n.width/r,e.trim.height=e._frame.height=n.height/r,e.trim.x=-i,e.trim.y=-i,e.orig.width=e._frame.width-2*i,e.orig.height=e._frame.height-2*i,this._onTextureUpdate(),s.setRealSize(n.width,n.height,r),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}_renderCanvas(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(t)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds(t)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(t){"boolean"==typeof t&&(t={children:t}),t=Object.assign({},Wa.defaultDestroyOptions,t),super.destroy(t);const e=null;this.ownsStyle&&this._style?.cleanFonts(),this._style=e,this._svgRoot?.remove(),this._svgRoot=e,this._domElement?.remove(),this._domElement=e,this._foreignObject?.remove(),this._foreignObject=e,this._styleElement?.remove(),this._styleElement=e,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=e,this._image.src="",this._image=e}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(t){this.updateText(!0);const e=kt(this.scale.x)||1;this.scale.x=e*t/this._image.width/this.resolution,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(t){this.updateText(!0);const e=kt(this.scale.y)||1;this.scale.y=e*t/this._image.height/this.resolution,this._height=t}get style(){return this._style}set style(t){this._style!==t&&((t=t||{})instanceof za?(this.ownsStyle=!1,this._style=t):t instanceof Zo?(this.ownsStyle=!0,this._style=za.from(t)):(this.ownsStyle=!0,this._style=new za(t)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(t){t=String(""===t||null==t?" ":t),t=this.sanitiseText(t),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}sanitiseText(t){return t.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};let Va=Wa;Va.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},Va.defaultMaxWidth=2024,Va.defaultMaxHeight=2024,Va.defaultAutoResolution=!0;var Xa=Object.defineProperty,$a=(t,e,n)=>(((t,e,n)=>{e in t?Xa(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n);class Ya extends ve{constructor(t=!1){super(),$a(this,"_buffer"),$a(this,"_indexBuffer"),this._buffer=new fe(null,t,!1),this._indexBuffer=new fe(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,u.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,u.FLOAT).addAttribute("aColor",this._buffer,4,!0,u.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,u.FLOAT).addAttribute("aFWidth",this._buffer,1,!0,u.FLOAT).addIndex(this._indexBuffer)}}var qa,Ka,Qa,Za=Object.defineProperty;class Ja extends mn{constructor(t){super(t),this.shaderGenerator=new cn("precision highp float;\r\nattribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\nattribute vec4 aColor;\r\nattribute float aTextureId;\r\nattribute float aFWidth;\r\n\r\nuniform mat3 projectionMatrix;\r\nuniform mat3 translationMatrix;\r\nuniform vec4 tint;\r\n\r\nvarying vec2 vTextureCoord;\r\nvarying vec4 vColor;\r\nvarying float vTextureId;\r\nvarying float vFWidth;\r\n\r\nvoid main(void) {\r\n  gl_Position = vec4(\r\n      (projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy,\r\n      0.0, 1.0);\r\n\r\n  vTextureCoord = aTextureCoord;\r\n  vTextureId = aTextureId;\r\n  vFWidth = aFWidth;\r\n  vColor = aColor * tint;\r\n}","// Pixi texture info\r\nvarying vec2 vTextureCoord;\r\nvarying float vTextureId;\r\nuniform sampler2D uSamplers[%count%];\r\n\r\n// Tint\r\nvarying vec4 vColor;\r\n\r\n// fwidth equivalent smoothing factor (in our case, spread * scale)\r\nvarying float vFWidth;\r\n\r\nvoid main(void) {\r\n  vec4 color;\r\n\r\n  %forloop%\r\n\r\n  float smoothing = vFWidth;\r\n\r\n  // un-pre multiplying alpha\r\n  // This _could_ be dangerous if alpha is 0 but we have a min ahead in the code\r\n  // so if alpha is 0 we will take that 0 and be happy.\r\n  color.rgb /= color.a;\r\n\r\n  // MSDF\r\n  float median = color.r + color.g + color.b -\r\n                 min(color.r, min(color.g, color.b)) -\r\n                 max(color.r, max(color.g, color.b));\r\n  // SDF\r\n  median = min(median, color.a);\r\n\r\n  float screenPxDistance = vFWidth*(median - 0.5);\r\n  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r\n\r\n  gl_FragColor = vec4(vColor * alpha);\r\n}"),this.geometryClass=Ya,this.vertexSize=7}packInterleavedGeometry(t,e,n,r,i){const{uint32View:s,float32View:o}=e,a=r/this.vertexSize,h=t.uvs,l=t.indices,u=t.vertexData,c=t._texture.baseTexture._batchLocation,d=Math.min(t.worldAlpha,1),f=d<1&&t._texture.baseTexture.alphaMode?function(t,e){return K(0,"utils.premultiplyTint has moved to Color.toPremultiplied"),Ct.shared.setValue(t).toPremultiplied(e)}(t._tintRGB,d):t._tintRGB+(255*d<<24),{a:p,b:m,c:g,d:_}=t.worldTransform,y=Math.sqrt(p*p+m*m),v=Math.sqrt(g*g+_*_),b=(Math.abs(y)+Math.abs(v))/2*t.range*this.renderer.resolution;for(let x=0;x<u.length;x+=2)o[r++]=u[x],o[r++]=u[x+1],o[r++]=h[x],o[r++]=h[x+1],s[r++]=f,o[r++]=c,o[r++]=b;for(let x=0;x<l.length;x++)n[i++]=a+l[x]}}let th;function eh(){return th}qa=Ja,Ka="extension",Qa={name:"mtsdf",type:qt.RendererPlugin},((t,e,n)=>{e in t?Za(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(qa,"symbol"!=typeof Ka?Ka+"":Ka,Qa);let nh=0;const rh=class extends H{constructor(t){super(),this.id=nh++,this.init(t)}set(t,e){if(void 0===this[t])throw new Error(`Property with name ${t} does not exist.`);switch(t){case"speed":this.speed=e;break;case"volume":this.volume=e;break;case"paused":this.paused=e;break;case"loop":this.loop=e;break;case"muted":this.muted=e}return this}get progress(){const{currentTime:t}=this._source;return t/this._duration}get paused(){return this._paused}set paused(t){this._paused=t,this.refreshPaused()}_onPlay(){this._playing=!0}_onPause(){this._playing=!1}init(t){this._playing=!1,this._duration=t.source.duration;const e=this._source=t.source.cloneNode(!1);e.src=t.parent.url,e.onplay=this._onPlay.bind(this),e.onpause=this._onPause.bind(this),t.context.on("refresh",this.refresh,this),t.context.on("refreshPaused",this.refreshPaused,this),this._media=t}_internalStop(){this._source&&this._playing&&(this._source.onended=null,this._source.pause())}stop(){this._internalStop(),this._source&&this.emit("stop")}get speed(){return this._speed}set speed(t){this._speed=t,this.refresh()}get volume(){return this._volume}set volume(t){this._volume=t,this.refresh()}get loop(){return this._loop}set loop(t){this._loop=t,this.refresh()}get muted(){return this._muted}set muted(t){this._muted=t,this.refresh()}get filters(){return null}set filters(t){}refresh(){const t=this._media.context,e=this._media.parent;this._source.loop=this._loop||e.loop;const n=t.volume*(t.muted?0:1),r=e.volume*(e.muted?0:1),i=this._volume*(this._muted?0:1);this._source.volume=i*n*r,this._source.playbackRate=this._speed*t.speed*e.speed}refreshPaused(){const t=this._media.context,e=this._media.parent,n=this._paused||e.paused||t.paused;n!==this._pausedReal&&(this._pausedReal=n,n?(this._internalStop(),this.emit("paused")):(this.emit("resumed"),this.play({start:this._source.currentTime,end:this._end,volume:this._volume,speed:this._speed,loop:this._loop})),this.emit("pause",n))}play(t){const{start:e,end:n,speed:r,loop:i,volume:s,muted:o}=t;this._speed=r,this._volume=s,this._loop=!!i,this._muted=o,this.refresh(),this.loop&&null!==n&&(this.loop=!1),this._start=e,this._end=n||this._duration,this._start=Math.max(0,this._start-rh.PADDING),this._end=Math.min(this._end+rh.PADDING,this._duration),this._source.onloadedmetadata=()=>{this._source&&(this._source.currentTime=e,this._source.onloadedmetadata=null,this.emit("progress",e,this._duration),kr.shared.add(this._onUpdate,this))},this._source.onended=this._onComplete.bind(this),this._source.play(),this.emit("start")}_onUpdate(){this.emit("progress",this.progress,this._duration),this._source.currentTime>=this._end&&!this._source.loop&&this._onComplete()}_onComplete(){kr.shared.remove(this._onUpdate,this),this._internalStop(),this.emit("progress",1,this._duration),this.emit("end",this)}destroy(){kr.shared.remove(this._onUpdate,this),this.removeAllListeners();const t=this._source;t&&(t.onended=null,t.onplay=null,t.onpause=null,this._internalStop()),this._source=null,this._speed=1,this._volume=1,this._loop=!1,this._end=null,this._start=0,this._duration=0,this._playing=!1,this._pausedReal=!1,this._paused=!1,this._muted=!1,this._media&&(this._media.context.off("refresh",this.refresh,this),this._media.context.off("refreshPaused",this.refreshPaused,this),this._media=null)}toString(){return`[HTMLAudioInstance id=${this.id}]`}};let ih=rh;ih.PADDING=.1;class sh extends H{init(t){this.parent=t,this._source=t.options.source||new Audio,t.url&&(this._source.src=t.url)}create(){return new ih(this)}get isPlayable(){return!!this._source&&4===this._source.readyState}get duration(){return this._source.duration}get context(){return this.parent.context}get filters(){return null}set filters(t){}destroy(){this.removeAllListeners(),this.parent=null,this._source&&(this._source.src="",this._source.load(),this._source=null)}get source(){return this._source}load(t){const e=this._source,n=this.parent;if(4===e.readyState){n.isLoaded=!0;const e=n.autoPlayStart();return void(t&&setTimeout((()=>{t(null,n,e)}),0))}if(!n.url)return void t(new Error("sound.url or sound.source must be set"));e.src=n.url;const r=()=>{o(),n.isLoaded=!0;const e=n.autoPlayStart();t&&t(null,n,e)},i=()=>{o(),t&&t(new Error("Sound loading has been aborted"))},s=()=>{o();const n=`Failed to load audio element (code: ${e.error.code})`;t&&t(new Error(n))},o=()=>{e.removeEventListener("canplaythrough",r),e.removeEventListener("load",r),e.removeEventListener("abort",i),e.removeEventListener("error",s)};e.addEventListener("canplaythrough",r,!1),e.addEventListener("load",r,!1),e.addEventListener("abort",i,!1),e.addEventListener("error",s,!1),e.load()}}class oh{constructor(t,e){this.parent=t,Object.assign(this,e),this.duration=this.end-this.start}play(t){return this.parent.play({complete:t,speed:this.speed||this.parent.speed,end:this.end,start:this.start,loop:this.loop})}destroy(){this.parent=null}}const ah=["ogg","oga","opus","m4a","mp3","mpeg","wav","aiff","wma","mid","caf"],hh={};!function(t){const e={m4a:"audio/mp4",oga:"audio/ogg",opus:'audio/ogg; codecs="opus"',caf:'audio/x-caf; codecs="opus"',...t||{}},n=document.createElement("audio"),r={},i=/^no$/;ah.forEach((t=>{const s=n.canPlayType(`audio/${t}`).replace(i,""),o=e[t]?n.canPlayType(e[t]).replace(i,""):"";r[t]=!!s||!!o})),Object.assign(hh,r)}();class lh{static setParamValue(t,e){if(t.setValueAtTime){const n=eh().context;t.setValueAtTime(e,n.audioContext.currentTime)}else t.value=e;return e}}let uh=0;class ch extends H{constructor(t){super(),this.id=uh++,this._media=null,this._paused=!1,this._muted=!1,this._elapsed=0,this.init(t)}set(t,e){if(void 0===this[t])throw new Error(`Property with name ${t} does not exist.`);switch(t){case"speed":this.speed=e;break;case"volume":this.volume=e;break;case"muted":this.muted=e;break;case"loop":this.loop=e;break;case"paused":this.paused=e}return this}stop(){this._source&&(this._internalStop(),this.emit("stop"))}get speed(){return this._speed}set speed(t){this._speed=t,this.refresh(),this._update(!0)}get volume(){return this._volume}set volume(t){this._volume=t,this.refresh()}get muted(){return this._muted}set muted(t){this._muted=t,this.refresh()}get loop(){return this._loop}set loop(t){this._loop=t,this.refresh()}get filters(){return this._filters}set filters(t){this._filters&&(this._filters?.filter((t=>t)).forEach((t=>t.disconnect())),this._filters=null,this._source.connect(this._gain)),this._filters=t?.length?t.slice(0):null,this.refresh()}refresh(){if(!this._source)return;const t=this._media.context,e=this._media.parent;this._source.loop=this._loop||e.loop;const n=t.volume*(t.muted?0:1),r=e.volume*(e.muted?0:1),i=this._volume*(this._muted?0:1);lh.setParamValue(this._gain.gain,i*r*n),lh.setParamValue(this._source.playbackRate,this._speed*e.speed*t.speed),this.applyFilters()}applyFilters(){if(this._filters?.length){this._source.disconnect();let t=this._source;this._filters.forEach((e=>{t.connect(e.destination),t=e})),t.connect(this._gain)}}refreshPaused(){const t=this._media.context,e=this._media.parent,n=this._paused||e.paused||t.paused;n!==this._pausedReal&&(this._pausedReal=n,n?(this._internalStop(),this.emit("paused")):(this.emit("resumed"),this.play({start:this._elapsed%this._duration,end:this._end,speed:this._speed,loop:this._loop,volume:this._volume})),this.emit("pause",n))}play(t){const{start:e,end:n,speed:r,loop:i,volume:s,muted:o,filters:a}=t;this._paused=!1;const{source:h,gain:l}=this._media.nodes.cloneBufferSource();this._source=h,this._gain=l,this._speed=r,this._volume=s,this._loop=!!i,this._muted=o,this._filters=a,this.refresh();const u=this._source.buffer.duration;this._duration=u,this._end=n,this._lastUpdate=this._now(),this._elapsed=e,this._source.onended=this._onComplete.bind(this),this._loop?(this._source.loopEnd=n,this._source.loopStart=e,this._source.start(0,e)):n?this._source.start(0,e,n-e):this._source.start(0,e),this.emit("start"),this._update(!0),this.enableTicker(!0)}enableTicker(t){kr.shared.remove(this._updateListener,this),t&&kr.shared.add(this._updateListener,this)}get progress(){return this._progress}get paused(){return this._paused}set paused(t){this._paused=t,this.refreshPaused()}destroy(){this.removeAllListeners(),this._internalStop(),this._gain&&(this._gain.disconnect(),this._gain=null),this._media&&(this._media.context.events.off("refresh",this.refresh,this),this._media.context.events.off("refreshPaused",this.refreshPaused,this),this._media=null),this._filters?.forEach((t=>t.disconnect())),this._filters=null,this._end=null,this._speed=1,this._volume=1,this._loop=!1,this._elapsed=0,this._duration=0,this._paused=!1,this._muted=!1,this._pausedReal=!1}toString(){return`[WebAudioInstance id=${this.id}]`}_now(){return this._media.context.audioContext.currentTime}_updateListener(){this._update()}_update(t=!1){if(this._source){const e=this._now(),n=e-this._lastUpdate;if(n>0||t){const t=this._source.playbackRate.value;this._elapsed+=n*t,this._lastUpdate=e;const r=this._duration;let i;if(this._source.loopStart){const t=this._source.loopEnd-this._source.loopStart;i=(this._source.loopStart+this._elapsed%t)/r}else i=this._elapsed%r/r;this._progress=i,this.emit("progress",this._progress,r)}}}init(t){this._media=t,t.context.events.on("refresh",this.refresh,this),t.context.events.on("refreshPaused",this.refreshPaused,this)}_internalStop(){if(this._source){this.enableTicker(!1),this._source.onended=null,this._source.stop(0),this._source.disconnect();try{this._source.buffer=null}catch(t){}this._source=null}}_onComplete(){if(this._source){this.enableTicker(!1),this._source.onended=null,this._source.disconnect();try{this._source.buffer=null}catch(t){}}this._source=null,this._progress=1,this.emit("progress",1,this._duration),this.emit("end",this)}}class dh{constructor(t,e){this._output=e,this._input=t}get destination(){return this._input}get filters(){return this._filters}set filters(t){if(this._filters&&(this._filters.forEach((t=>{t&&t.disconnect()})),this._filters=null,this._input.connect(this._output)),t&&t.length){this._filters=t.slice(0),this._input.disconnect();let e=null;t.forEach((t=>{null===e?this._input.connect(t.destination):e.connect(t.destination),e=t})),e.connect(this._output)}}destroy(){this.filters=null,this._input=null,this._output=null}}const fh=class extends dh{constructor(t){const e=t.audioContext,n=e.createBufferSource(),r=e.createGain(),i=e.createAnalyser();n.connect(i),i.connect(r),r.connect(t.destination),super(i,r),this.context=t,this.bufferSource=n,this.gain=r,this.analyser=i}get script(){return this._script||(this._script=this.context.audioContext.createScriptProcessor(fh.BUFFER_SIZE),this._script.connect(this.context.destination)),this._script}destroy(){super.destroy(),this.bufferSource.disconnect(),this._script&&this._script.disconnect(),this.gain.disconnect(),this.analyser.disconnect(),this.bufferSource=null,this._script=null,this.gain=null,this.analyser=null,this.context=null}cloneBufferSource(){const t=this.bufferSource,e=this.context.audioContext.createBufferSource();e.buffer=t.buffer,lh.setParamValue(e.playbackRate,t.playbackRate.value),e.loop=t.loop;const n=this.context.audioContext.createGain();return e.connect(n),n.connect(this.destination),{source:e,gain:n}}get bufferSize(){return this.script.bufferSize}};let ph=fh;ph.BUFFER_SIZE=0;class mh{init(t){this.parent=t,this._nodes=new ph(this.context),this._source=this._nodes.bufferSource,this.source=t.options.source}destroy(){this.parent=null,this._nodes.destroy(),this._nodes=null;try{this._source.buffer=null}catch(t){}this._source=null,this.source=null}create(){return new ch(this)}get context(){return this.parent.context}get isPlayable(){return!!this._source&&!!this._source.buffer}get filters(){return this._nodes.filters}set filters(t){this._nodes.filters=t}get duration(){return this._source.buffer.duration}get buffer(){return this._source.buffer}set buffer(t){this._source.buffer=t}get nodes(){return this._nodes}load(t){this.source?this._decode(this.source,t):this.parent.url?this._loadUrl(t):t&&t(new Error("sound.url or sound.source must be set"))}async _loadUrl(t){const e=this.parent.url,n=await w.ADAPTER.fetch(e);this._decode(await n.arrayBuffer(),t)}_decode(t,e){const n=(t,n)=>{if(t)e&&e(t);else{this.parent.isLoaded=!0,this.buffer=n;const t=this.parent.autoPlayStart();e&&e(null,this.parent,t)}};if(t instanceof AudioBuffer)n(null,t);else{this.parent.context.decode(t,n)}}}const gh=class{static from(t){let e={};"string"==typeof t?e.url=t:t instanceof ArrayBuffer||t instanceof AudioBuffer||t instanceof HTMLAudioElement?e.source=t:Array.isArray(t)?e.url=t:e=t,e={autoPlay:!1,singleInstance:!1,url:null,source:null,preload:!1,volume:1,speed:1,complete:null,loaded:null,loop:!1,...e},Object.freeze(e);const n=eh().useLegacy?new sh:new mh;return new gh(n,e)}constructor(t,e){this.media=t,this.options=e,this._instances=[],this._sprites={},this.media.init(this);const n=e.complete;this._autoPlayOptions=n?{complete:n}:null,this.isLoaded=!1,this._preloadQueue=null,this.isPlaying=!1,this.autoPlay=e.autoPlay,this.singleInstance=e.singleInstance,this.preload=e.preload||this.autoPlay,this.url=Array.isArray(e.url)?this.preferUrl(e.url):e.url,this.speed=e.speed,this.volume=e.volume,this.loop=e.loop,e.sprites&&this.addSprites(e.sprites),this.preload&&this._preload(e.loaded)}preferUrl(t){const[{url:e}]=t.map((t=>({url:t,ext:Y.extname(t).slice(1)}))).sort(((t,e)=>ah.indexOf(t.ext)-ah.indexOf(e.ext)));return e}get context(){return eh().context}pause(){return this.isPlaying=!1,this.paused=!0,this}resume(){return this.isPlaying=this._instances.length>0,this.paused=!1,this}get paused(){return this._paused}set paused(t){this._paused=t,this.refreshPaused()}get speed(){return this._speed}set speed(t){this._speed=t,this.refresh()}get filters(){return this.media.filters}set filters(t){this.media.filters=t}addSprites(t,e){if("object"==typeof t){const e={};for(const n in t)e[n]=this.addSprites(n,t[n]);return e}const n=new oh(this,e);return this._sprites[t]=n,n}destroy(){this._removeInstances(),this.removeSprites(),this.media.destroy(),this.media=null,this._sprites=null,this._instances=null}removeSprites(t){if(t){const e=this._sprites[t];void 0!==e&&(e.destroy(),delete this._sprites[t])}else for(const e in this._sprites)this.removeSprites(e);return this}get isPlayable(){return this.isLoaded&&this.media&&this.media.isPlayable}stop(){if(!this.isPlayable)return this.autoPlay=!1,this._autoPlayOptions=null,this;this.isPlaying=!1;for(let t=this._instances.length-1;t>=0;t--)this._instances[t].stop();return this}play(t,e){let n;if("string"==typeof t){n={sprite:t,loop:this.loop,complete:e}}else"function"==typeof t?(n={},n.complete=t):n=t;if(n={complete:null,loaded:null,sprite:null,end:null,start:0,volume:1,speed:1,muted:!1,loop:!1,...n||{}},n.sprite){const t=n.sprite,e=this._sprites[t];n.start=e.start+(n.start||0),n.end=e.end,n.speed=e.speed||1,n.loop=e.loop||n.loop,delete n.sprite}if(n.offset&&(n.start=n.offset),!this.isLoaded)return this._preloadQueue?new Promise((t=>{this._preloadQueue.push((()=>{t(this.play(n))}))})):(this._preloadQueue=[],this.autoPlay=!0,this._autoPlayOptions=n,new Promise(((t,e)=>{this._preload(((r,i,s)=>{this._preloadQueue.forEach((t=>t())),this._preloadQueue=null,r?e(r):(n.loaded&&n.loaded(r,i,s),t(s))}))})));(this.singleInstance||n.singleInstance)&&this._removeInstances();const r=this._createInstance();return this._instances.push(r),this.isPlaying=!0,r.once("end",(()=>{n.complete&&n.complete(this),this._onComplete(r)})),r.once("stop",(()=>{this._onComplete(r)})),r.play(n),r}refresh(){const t=this._instances.length;for(let e=0;e<t;e++)this._instances[e].refresh()}refreshPaused(){const t=this._instances.length;for(let e=0;e<t;e++)this._instances[e].refreshPaused()}get volume(){return this._volume}set volume(t){this._volume=t,this.refresh()}get muted(){return this._muted}set muted(t){this._muted=t,this.refresh()}get loop(){return this._loop}set loop(t){this._loop=t,this.refresh()}_preload(t){this.media.load(t)}get instances(){return this._instances}get sprites(){return this._sprites}get duration(){return this.media.duration}autoPlayStart(){let t;return this.autoPlay&&(t=this.play(this._autoPlayOptions)),t}_removeInstances(){for(let t=this._instances.length-1;t>=0;t--)this._poolInstance(this._instances[t]);this._instances.length=0}_onComplete(t){if(this._instances){const e=this._instances.indexOf(t);e>-1&&this._instances.splice(e,1),this.isPlaying=this._instances.length>0}this._poolInstance(t)}_createInstance(){if(gh._pool.length>0){const t=gh._pool.pop();return t.init(this.media),t}return this.media.create()}_poolInstance(t){t.destroy(),gh._pool.indexOf(t)<0&&gh._pool.push(t)}};let _h=gh;_h._pool=[];class yh extends H{constructor(){super(...arguments),this.speed=1,this.muted=!1,this.volume=1,this.paused=!1}refresh(){this.emit("refresh")}refreshPaused(){this.emit("refreshPaused")}get filters(){return null}set filters(t){}get audioContext(){return null}toggleMute(){return this.muted=!this.muted,this.refresh(),this.muted}togglePause(){return this.paused=!this.paused,this.refreshPaused(),this.paused}destroy(){this.removeAllListeners()}}class vh extends dh{constructor(){const t=window,e=new vh.AudioContext,n=e.createDynamicsCompressor(),r=e.createAnalyser();r.connect(n),n.connect(e.destination),super(r,n),this._ctx=e,this._offlineCtx=new vh.OfflineAudioContext(1,2,t.OfflineAudioContext?Math.max(8e3,Math.min(96e3,e.sampleRate)):44100),this.compressor=n,this.analyser=r,this.events=new H,this.volume=1,this.speed=1,this.muted=!1,this.paused=!1,this._locked="suspended"===e.state&&("ontouchstart"in globalThis||"onclick"in globalThis),this._locked&&(this._unlock(),this._unlock=this._unlock.bind(this),document.addEventListener("mousedown",this._unlock,!0),document.addEventListener("touchstart",this._unlock,!0),document.addEventListener("touchend",this._unlock,!0)),this.onFocus=this.onFocus.bind(this),this.onBlur=this.onBlur.bind(this),globalThis.addEventListener("focus",this.onFocus),globalThis.addEventListener("blur",this.onBlur)}onFocus(){const t=this._ctx.state;"suspended"!==t&&"interrupted"!==t&&this._locked||this._ctx.resume()}onBlur(){this._locked||this._ctx.suspend()}_unlock(){this._locked&&(this.playEmptySound(),"running"===this._ctx.state&&(document.removeEventListener("mousedown",this._unlock,!0),document.removeEventListener("touchend",this._unlock,!0),document.removeEventListener("touchstart",this._unlock,!0),this._locked=!1))}playEmptySound(){const t=this._ctx.createBufferSource();t.buffer=this._ctx.createBuffer(1,1,22050),t.connect(this._ctx.destination),t.start(0,0,0),"suspended"===t.context.state&&t.context.resume()}static get AudioContext(){const t=window;return t.AudioContext||t.webkitAudioContext||null}static get OfflineAudioContext(){const t=window;return t.OfflineAudioContext||t.webkitOfflineAudioContext||null}destroy(){super.destroy();const t=this._ctx;"undefined"!=typeof t.close&&t.close(),globalThis.removeEventListener("focus",this.onFocus),globalThis.removeEventListener("blur",this.onBlur),this.events.removeAllListeners(),this.analyser.disconnect(),this.compressor.disconnect(),this.analyser=null,this.compressor=null,this.events=null,this._offlineCtx=null,this._ctx=null}get audioContext(){return this._ctx}get offlineContext(){return this._offlineCtx}set paused(t){t&&"running"===this._ctx.state?this._ctx.suspend():t||"suspended"!==this._ctx.state||this._ctx.resume(),this._paused=t}get paused(){return this._paused}refresh(){this.events.emit("refresh")}refreshPaused(){this.events.emit("refreshPaused")}toggleMute(){return this.muted=!this.muted,this.refresh(),this.muted}togglePause(){return this.paused=!this.paused,this.refreshPaused(),this._paused}decode(t,e){const n=t=>{e(new Error(t?.message||"Unable to decode file"))},r=this._offlineCtx.decodeAudioData(t,(t=>{e(null,t)}),n);r&&r["catch"](n)}}class bh{constructor(t,e){this.init(t,e)}init(t,e){this.destination=t,this.source=e||t}connect(t){this.source.connect(t)}disconnect(){this.source.disconnect()}destroy(){this.disconnect(),this.destination=null,this.source=null}}const xh=class extends bh{constructor(t=0,e=0,n=0,r=0,i=0,s=0,o=0,a=0,h=0,l=0){var u=(...t)=>{super(...t)};if(eh().useLegacy)return void u(null);const c=[{f:xh.F32,type:"lowshelf",gain:t},{f:xh.F64,type:"peaking",gain:e},{f:xh.F125,type:"peaking",gain:n},{f:xh.F250,type:"peaking",gain:r},{f:xh.F500,type:"peaking",gain:i},{f:xh.F1K,type:"peaking",gain:s},{f:xh.F2K,type:"peaking",gain:o},{f:xh.F4K,type:"peaking",gain:a},{f:xh.F8K,type:"peaking",gain:h},{f:xh.F16K,type:"highshelf",gain:l}].map((t=>{const e=eh().context.audioContext.createBiquadFilter();return e.type=t.type,lh.setParamValue(e.Q,1),e.frequency.value=t.f,lh.setParamValue(e.gain,t.gain),e}));u(c[0],c[c.length-1]),this.bands=c,this.bandsMap={};for(let d=0;d<this.bands.length;d++){const t=this.bands[d];d>0&&this.bands[d-1].connect(t),this.bandsMap[t.frequency.value]=t}}setGain(t,e=0){if(!this.bandsMap[t])throw new Error(`No band found for frequency ${t}`);lh.setParamValue(this.bandsMap[t].gain,e)}getGain(t){if(!this.bandsMap[t])throw new Error(`No band found for frequency ${t}`);return this.bandsMap[t].gain.value}set f32(t){this.setGain(xh.F32,t)}get f32(){return this.getGain(xh.F32)}set f64(t){this.setGain(xh.F64,t)}get f64(){return this.getGain(xh.F64)}set f125(t){this.setGain(xh.F125,t)}get f125(){return this.getGain(xh.F125)}set f250(t){this.setGain(xh.F250,t)}get f250(){return this.getGain(xh.F250)}set f500(t){this.setGain(xh.F500,t)}get f500(){return this.getGain(xh.F500)}set f1k(t){this.setGain(xh.F1K,t)}get f1k(){return this.getGain(xh.F1K)}set f2k(t){this.setGain(xh.F2K,t)}get f2k(){return this.getGain(xh.F2K)}set f4k(t){this.setGain(xh.F4K,t)}get f4k(){return this.getGain(xh.F4K)}set f8k(t){this.setGain(xh.F8K,t)}get f8k(){return this.getGain(xh.F8K)}set f16k(t){this.setGain(xh.F16K,t)}get f16k(){return this.getGain(xh.F16K)}reset(){this.bands.forEach((t=>{lh.setParamValue(t.gain,0)}))}destroy(){this.bands.forEach((t=>{t.disconnect()})),this.bands=null,this.bandsMap=null}};let Eh=xh;Eh.F32=32,Eh.F64=64,Eh.F125=125,Eh.F250=250,Eh.F500=500,Eh.F1K=1e3,Eh.F2K=2e3,Eh.F4K=4e3,Eh.F8K=8e3,Eh.F16K=16e3;const wh=t=>{const e=t.src;return t?.alias?.[0]??Y.basename(e,Y.extname(e))},Th={extension:qt.Asset,detection:{test:async()=>!0,add:async t=>[...t,...ah.filter((t=>hh[t]))],remove:async t=>t.filter((e=>t.includes(e)))},loader:{extension:{type:[qt.LoadParser],priority:Hi.High},test(t){const e=Y.extname(t).slice(1);return!!hh[e]},async load(t,e){const n=await new Promise(((n,r)=>_h.from({...e.data,url:t,preload:!0,loaded(t,i){t?r(t):n(i),e.data?.loaded?.(t,i)}})));return eh().add(wh(e),n),n},async unload(t,e){eh().remove(wh(e))}}};Zt.add(Th);const Sh=function(t){return th=t,t}(new class{constructor(){this.init()}init(){return this.supported&&(this._webAudioContext=new vh),this._htmlAudioContext=new yh,this._sounds={},this.useLegacy=!this.supported,this}get context(){return this._context}get filtersAll(){return this.useLegacy?[]:this._context.filters}set filtersAll(t){this.useLegacy||(this._context.filters=t)}get supported(){return null!==vh.AudioContext}add(t,e){if("object"==typeof t){const n={};for(const r in t){const i=this._getOptions(t[r],e);n[r]=this.add(r,i)}return n}if(e instanceof _h)return this._sounds[t]=e,e;const n=this._getOptions(e),r=_h.from(n);return this._sounds[t]=r,r}_getOptions(t,e){let n;return n="string"==typeof t||Array.isArray(t)?{url:t}:t instanceof ArrayBuffer||t instanceof AudioBuffer||t instanceof HTMLAudioElement?{source:t}:t,n={...n,...e||{}},n}get useLegacy(){return this._useLegacy}set useLegacy(t){this._useLegacy=t,this._context=!t&&this.supported?this._webAudioContext:this._htmlAudioContext}remove(t){return this.exists(t,!0),this._sounds[t].destroy(),delete this._sounds[t],this}get volumeAll(){return this._context.volume}set volumeAll(t){this._context.volume=t,this._context.refresh()}get speedAll(){return this._context.speed}set speedAll(t){this._context.speed=t,this._context.refresh()}togglePauseAll(){return this._context.togglePause()}pauseAll(){return this._context.paused=!0,this._context.refreshPaused(),this}resumeAll(){return this._context.paused=!1,this._context.refreshPaused(),this}toggleMuteAll(){return this._context.toggleMute()}muteAll(){return this._context.muted=!0,this._context.refresh(),this}unmuteAll(){return this._context.muted=!1,this._context.refresh(),this}removeAll(){for(const t in this._sounds)this._sounds[t].destroy(),delete this._sounds[t];return this}stopAll(){for(const t in this._sounds)this._sounds[t].stop();return this}exists(t,e=!1){return!!this._sounds[t]}isPlaying(){for(const t in this._sounds)if(this._sounds[t].isPlaying)return!0;return!1}find(t){return this.exists(t,!0),this._sounds[t]}play(t,e){return this.find(t).play(e)}stop(t){return this.find(t).stop()}pause(t){return this.find(t).pause()}resume(t){return this.find(t).resume()}volume(t,e){const n=this.find(t);return void 0!==e&&(n.volume=e),n.volume}speed(t,e){const n=this.find(t);return void 0!==e&&(n.speed=e),n.speed}duration(t){return this.find(t).duration}close(){return this.removeAll(),this._sounds=null,this._webAudioContext&&(this._webAudioContext.destroy(),this._webAudioContext=null),this._htmlAudioContext&&(this._htmlAudioContext.destroy(),this._htmlAudioContext=null),this._context=null,this}});const Ah=["msdf","mtsdf","sdf"],Ch={extension:qt.Asset,loader:{extension:{type:qt.LoadParser,priority:Hi.Normal},testParse(t,e){return Promise.resolve(e.src.includes(".json")&&Ih.test(t))},parse(t,e,n){return r=this,i=null,s=function*(){const r=e.src.replace(/^.*[\\\/]/,"").replace(/\.[^/.]+$/,""),i=Ih.parse(t,r),{src:s}=e,{page:o}=i,a=[];for(let t=0;t<o.length;++t){const e=o[t].file,n=Y.join(Y.dirname(s),e);a.push(n)}const h=yield n.load(a),l=a.map((t=>h[t]));return ka.install(i,l,!0)},new Promise(((t,e)=>{var n=t=>{try{a(s.next(t))}catch(et){e(et)}},o=t=>{try{a(s["throw"](t))}catch(et){e(et)}},a=e=>e.done?t(e.value):Promise.resolve(e.value).then(n,o);a((s=s.apply(r,i)).next())}));var r,i,s},unload(t){t.destroy()}}};var Ih,Rh;function Ph(t){return Ph="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ph(t)}function Mh(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Oh(t){var e=function(t,e){if("object"!==Ph(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(n!==undefined){var r=n.call(t,e||"default");if("object"!==Ph(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===Ph(e)?e:String(e)}function Dh(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Oh(r.key),r)}}function Nh(t,e,n){return e&&Dh(t.prototype,e),n&&Dh(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function kh(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Lh(t,e){return Lh=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Lh(t,e)}function Fh(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Lh(t,e)}function Bh(t,e){if(e&&("object"===Ph(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return kh(t)}function Uh(t){return Uh=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Uh(t)}function jh(t,e,n){return(e=Oh(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Gh(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Hh(t){return function(t){if(Array.isArray(t))return t}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return Gh(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Gh(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function zh(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Wh(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?zh(Object(n),!0).forEach((function(e){jh(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):zh(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}Zt.add(Ch),(Rh=Ih||(Ih={})).test=function(t){var e;for(let n=0;n<Ah.length;n++)if((null==(e=null==t?void 0:t.atlas)?void 0:e.type)===Ah[n])return!0;return!1},Rh.parse=function(t,e){var n,r;const i=new Aa;i.info=[{face:t.name,size:t.atlas.size}],i.common=[{lineHeight:t.metrics.lineHeight*t.atlas.size}],i.page=[{file:`${e}.png`,id:0}];for(let s=0;s<t.glyphs.length;s++){const e=t.glyphs[s],o=null!=(n=e.atlasBounds)?n:{bottom:0,left:0,right:0,top:0},a=null!=(r=e.planeBounds)?r:{bottom:0,left:0,right:0,top:0},h=Math.abs(o.top-o.bottom);let l=o.top,u=(1+a.top)*t.atlas.size;"bottom"===t.atlas.yOrigin&&(l=t.atlas.height-l,u=(1-a.top)*t.atlas.size),i.char.push({id:e.unicode,page:0,height:h,width:Math.abs(o.left-o.right),x:o.left,y:l,xadvance:e.advance*t.atlas.size,xoffset:a.left*t.atlas.size,yoffset:u})}for(let s=0;s<t.kerning.length;s++){const e=t.kerning[s];i.kerning.push({amount:e.advance*t.atlas.size,first:e.unicode1,second:e.unicode2})}return i.distanceField=[{distanceRange:t.atlas.distanceRange,fieldType:t.atlas.type}],i};var Vh={type:"logger",log:function(t){this.output("log",t)},warn:function(t){this.output("warn",t)},error:function(t){this.output("error",t)},output:function(t,e){console&&console[t]}},Xh=new(function(){function t(e){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};Mh(this,t),this.init(e,n)}return Nh(t,[{key:"init",value:function(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};this.prefix=e.prefix||"i18next:",this.logger=t||Vh,this.options=e,this.debug=e.debug}},{key:"setDebug",value:function(t){this.debug=t}},{key:"log",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.forward(e,"log","",!0)}},{key:"warn",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.forward(e,"warn","",!0)}},{key:"error",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.forward(e,"error","")}},{key:"deprecate",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.forward(e,"warn","WARNING DEPRECATED: ",!0)}},{key:"forward",value:function(t,e,n,r){return r&&!this.debug?null:("string"==typeof t[0]&&(t[0]="".concat(n).concat(this.prefix," ").concat(t[0])),this.logger[e](t))}},{key:"create",value:function(e){return new t(this.logger,Wh(Wh({},{prefix:"".concat(this.prefix,":").concat(e,":")}),this.options))}},{key:"clone",value:function(e){return(e=e||this.options).prefix=e.prefix||this.prefix,new t(this.logger,e)}}]),t}()),$h=function(){function t(){Mh(this,t),this.observers={}}return Nh(t,[{key:"on",value:function(t,e){var n=this;return t.split(" ").forEach((function(t){n.observers[t]=n.observers[t]||[],n.observers[t].push(e)})),this}},{key:"off",value:function(t,e){this.observers[t]&&(e?this.observers[t]=this.observers[t].filter((function(t){return t!==e})):delete this.observers[t])}},{key:"emit",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];this.observers[t]&&[].concat(this.observers[t]).forEach((function(t){t.apply(void 0,n)}));this.observers["*"]&&[].concat(this.observers["*"]).forEach((function(e){e.apply(e,[t].concat(n))}))}}]),t}();function Yh(){var t,e,n=new Promise((function(n,r){t=n,e=r}));return n.resolve=t,n.reject=e,n}function qh(t){return null==t?"":""+t}function Kh(t,e,n){function r(t){return t&&t.indexOf("###")>-1?t.replace(/###/g,"."):t}function i(){return!t||"string"==typeof t}for(var s="string"!=typeof e?[].concat(e):e.split(".");s.length>1;){if(i())return{};var o=r(s.shift());!t[o]&&n&&(t[o]=new n),t=Object.prototype.hasOwnProperty.call(t,o)?t[o]:{}}return i()?{}:{obj:t,k:r(s.shift())}}function Qh(t,e,n){var r=Kh(t,e,Object);r.obj[r.k]=n}function Zh(t,e){var n=Kh(t,e),r=n.obj,i=n.k;return r?r[i]:undefined}function Jh(t,e,n){for(var r in e)"__proto__"!==r&&"constructor"!==r&&(r in t?"string"==typeof t[r]||t[r]instanceof String||"string"==typeof e[r]||e[r]instanceof String?n&&(t[r]=e[r]):Jh(t[r],e[r],n):t[r]=e[r]);return t}function tl(t){return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}var el={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function nl(t){return"string"==typeof t?t.replace(/[&<>"'\/]/g,(function(t){return el[t]})):t}var rl="undefined"!=typeof window&&window.navigator&&"undefined"==typeof window.navigator.userAgentData&&window.navigator.userAgent&&window.navigator.userAgent.indexOf("MSIE")>-1,il=[" ",",","?","!",";"];function sl(t,e){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:".";if(!t)return undefined;if(t[e])return t[e];for(var r=e.split(n),i=t,s=0;s<r.length;++s){if(!i)return undefined;if("string"==typeof i[r[s]]&&s+1<r.length)return undefined;if(i[r[s]]===undefined){for(var o=2,a=r.slice(s,s+o).join(n),h=i[a];h===undefined&&r.length>s+o;)o++,h=i[a=r.slice(s,s+o).join(n)];if(h===undefined)return undefined;if(null===h)return null;if(e.endsWith(a)){if("string"==typeof h)return h;if(a&&"string"==typeof h[a])return h[a]}var l=r.slice(s+o).join(n);return l?sl(h,l,n):undefined}i=i[r[s]]}return i}function ol(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function al(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ol(Object(n),!0).forEach((function(e){jh(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ol(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function hl(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(et){return!1}}();return function(){var n,r=Uh(t);if(e){var i=Uh(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Bh(this,n)}}var ll=function(t){Fh(n,t);var e=hl(n);function n(t){var r,i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{ns:["translation"],defaultNS:"translation"};return Mh(this,n),r=e.call(this),rl&&$h.call(kh(r)),r.data=t||{},r.options=i,r.options.keySeparator===undefined&&(r.options.keySeparator="."),r.options.ignoreJSONStructure===undefined&&(r.options.ignoreJSONStructure=!0),r}return Nh(n,[{key:"addNamespaces",value:function(t){this.options.ns.indexOf(t)<0&&this.options.ns.push(t)}},{key:"removeNamespaces",value:function(t){var e=this.options.ns.indexOf(t);e>-1&&this.options.ns.splice(e,1)}},{key:"getResource",value:function(t,e,n){var r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{},i=r.keySeparator!==undefined?r.keySeparator:this.options.keySeparator,s=r.ignoreJSONStructure!==undefined?r.ignoreJSONStructure:this.options.ignoreJSONStructure,o=[t,e];n&&"string"!=typeof n&&(o=o.concat(n)),n&&"string"==typeof n&&(o=o.concat(i?n.split(i):n)),t.indexOf(".")>-1&&(o=t.split("."));var a=Zh(this.data,o);return a||!s||"string"!=typeof n?a:sl(this.data&&this.data[t]&&this.data[t][e],n,i)}},{key:"addResource",value:function(t,e,n,r){var i=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{silent:!1},s=this.options.keySeparator;s===undefined&&(s=".");var o=[t,e];n&&(o=o.concat(s?n.split(s):n)),t.indexOf(".")>-1&&(r=e,e=(o=t.split("."))[1]),this.addNamespaces(e),Qh(this.data,o,r),i.silent||this.emit("added",t,e,n,r)}},{key:"addResources",value:function(t,e,n){var r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{silent:!1};for(var i in n)"string"!=typeof n[i]&&"[object Array]"!==Object.prototype.toString.apply(n[i])||this.addResource(t,e,i,n[i],{silent:!0});r.silent||this.emit("added",t,e,n)}},{key:"addResourceBundle",value:function(t,e,n,r,i){var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:{silent:!1},o=[t,e];t.indexOf(".")>-1&&(r=n,n=e,e=(o=t.split("."))[1]),this.addNamespaces(e);var a=Zh(this.data,o)||{};r?Jh(a,n,i):a=al(al({},a),n),Qh(this.data,o,a),s.silent||this.emit("added",t,e,n)}},{key:"removeResourceBundle",value:function(t,e){this.hasResourceBundle(t,e)&&delete this.data[t][e],this.removeNamespaces(e),this.emit("removed",t,e)}},{key:"hasResourceBundle",value:function(t,e){return this.getResource(t,e)!==undefined}},{key:"getResourceBundle",value:function(t,e){return e||(e=this.options.defaultNS),"v1"===this.options.compatibilityAPI?al(al({},{}),this.getResource(t,e)):this.getResource(t,e)}},{key:"getDataByLanguage",value:function(t){return this.data[t]}},{key:"hasLanguageSomeTranslations",value:function(t){var e=this.getDataByLanguage(t);return!!(e&&Object.keys(e)||[]).find((function(t){return e[t]&&Object.keys(e[t]).length>0}))}},{key:"toJSON",value:function(){return this.data}}]),n}($h),ul={processors:{},addPostProcessor:function(t){this.processors[t.name]=t},handle:function(t,e,n,r,i){var s=this;return t.forEach((function(t){s.processors[t]&&(e=s.processors[t].process(e,n,r,i))})),e}};function cl(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function dl(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?cl(Object(n),!0).forEach((function(e){jh(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):cl(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function fl(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(et){return!1}}();return function(){var n,r=Uh(t);if(e){var i=Uh(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Bh(this,n)}}var pl={},ml=function(t){Fh(n,t);var e=fl(n);function n(t){var r,i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return Mh(this,n),r=e.call(this),rl&&$h.call(kh(r)),function(t,e,n){t.forEach((function(t){e[t]&&(n[t]=e[t])}))}(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],t,kh(r)),r.options=i,r.options.keySeparator===undefined&&(r.options.keySeparator="."),r.logger=Xh.create("translator"),r}return Nh(n,[{key:"changeLanguage",value:function(t){t&&(this.language=t)}},{key:"exists",value:function(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{interpolation:{}};if(t===undefined||null===t)return!1;var n=this.resolve(t,e);return n&&n.res!==undefined}},{key:"extractFromKey",value:function(t,e){var n=e.nsSeparator!==undefined?e.nsSeparator:this.options.nsSeparator;n===undefined&&(n=":");var r=e.keySeparator!==undefined?e.keySeparator:this.options.keySeparator,i=e.ns||this.options.defaultNS||[],s=n&&t.indexOf(n)>-1,o=!(this.options.userDefinedKeySeparator||e.keySeparator||this.options.userDefinedNsSeparator||e.nsSeparator||function(t,e,n){e=e||"",n=n||"";var r=il.filter((function(t){return e.indexOf(t)<0&&n.indexOf(t)<0}));if(0===r.length)return!0;var i=new RegExp("(".concat(r.map((function(t){return"?"===t?"\\?":t})).join("|"),")")),s=!i.test(t);if(!s){var o=t.indexOf(n);o>0&&!i.test(t.substring(0,o))&&(s=!0)}return s}(t,n,r));if(s&&!o){var a=t.match(this.interpolator.nestingRegexp);if(a&&a.length>0)return{key:t,namespaces:i};var h=t.split(n);(n!==r||n===r&&this.options.ns.indexOf(h[0])>-1)&&(i=h.shift()),t=h.join(r)}return"string"==typeof i&&(i=[i]),{key:t,namespaces:i}}},{key:"translate",value:function(t,e,r){var i=this;if("object"!==Ph(e)&&this.options.overloadTranslationOptionHandler&&(e=this.options.overloadTranslationOptionHandler(arguments)),e||(e={}),t===undefined||null===t)return"";Array.isArray(t)||(t=[String(t)]);var s=e.returnDetails!==undefined?e.returnDetails:this.options.returnDetails,o=e.keySeparator!==undefined?e.keySeparator:this.options.keySeparator,a=this.extractFromKey(t[t.length-1],e),h=a.key,l=a.namespaces,u=l[l.length-1],c=e.lng||this.language,d=e.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(c&&"cimode"===c.toLowerCase()){if(d){var f=e.nsSeparator||this.options.nsSeparator;return s?{res:"".concat(u).concat(f).concat(h),usedKey:h,exactUsedKey:h,usedLng:c,usedNS:u}:"".concat(u).concat(f).concat(h)}return s?{res:h,usedKey:h,exactUsedKey:h,usedLng:c,usedNS:u}:h}var p=this.resolve(t,e),m=p&&p.res,g=p&&p.usedKey||h,_=p&&p.exactUsedKey||h,y=Object.prototype.toString.apply(m),v=e.joinArrays!==undefined?e.joinArrays:this.options.joinArrays,b=!this.i18nFormat||this.i18nFormat.handleAsObject;if(b&&m&&("string"!=typeof m&&"boolean"!=typeof m&&"number"!=typeof m)&&["[object Number]","[object Function]","[object RegExp]"].indexOf(y)<0&&("string"!=typeof v||"[object Array]"!==y)){if(!e.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");var x=this.options.returnedObjectHandler?this.options.returnedObjectHandler(g,m,dl(dl({},e),{},{ns:l})):"key '".concat(h," (").concat(this.language,")' returned an object instead of string.");return s?(p.res=x,p):x}if(o){var E="[object Array]"===y,w=E?[]:{},T=E?_:g;for(var S in m)if(Object.prototype.hasOwnProperty.call(m,S)){var A="".concat(T).concat(o).concat(S);w[S]=this.translate(A,dl(dl({},e),{joinArrays:!1,ns:l})),w[S]===A&&(w[S]=m[S])}m=w}}else if(b&&"string"==typeof v&&"[object Array]"===y)(m=m.join(v))&&(m=this.extendTranslation(m,t,e,r));else{var C=!1,I=!1,R=e.count!==undefined&&"string"!=typeof e.count,P=n.hasDefaultValue(e),M=R?this.pluralResolver.getSuffix(c,e.count,e):"",O=e["defaultValue".concat(M)]||e.defaultValue;!this.isValidLookup(m)&&P&&(C=!0,m=O),this.isValidLookup(m)||(I=!0,m=h);var D=(e.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&I?undefined:m,N=P&&O!==m&&this.options.updateMissing;if(I||C||N){if(this.logger.log(N?"updateKey":"missingKey",c,u,h,N?O:m),o){var k=this.resolve(h,dl(dl({},e),{},{keySeparator:!1}));k&&k.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}var L=[],F=this.languageUtils.getFallbackCodes(this.options.fallbackLng,e.lng||this.language);if("fallback"===this.options.saveMissingTo&&F&&F[0])for(var B=0;B<F.length;B++)L.push(F[B]);else"all"===this.options.saveMissingTo?L=this.languageUtils.toResolveHierarchy(e.lng||this.language):L.push(e.lng||this.language);var U=function(t,n,r){var s=P&&r!==m?r:D;i.options.missingKeyHandler?i.options.missingKeyHandler(t,u,n,s,N,e):i.backendConnector&&i.backendConnector.saveMissing&&i.backendConnector.saveMissing(t,u,n,s,N,e),i.emit("missingKey",t,u,n,m)};this.options.saveMissing&&(this.options.saveMissingPlurals&&R?L.forEach((function(t){i.pluralResolver.getSuffixes(t,e).forEach((function(n){U([t],h+n,e["defaultValue".concat(n)]||O)}))})):U(L,h,O))}m=this.extendTranslation(m,t,e,p,r),I&&m===h&&this.options.appendNamespaceToMissingKey&&(m="".concat(u,":").concat(h)),(I||C)&&this.options.parseMissingKeyHandler&&(m="v1"!==this.options.compatibilityAPI?this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?"".concat(u,":").concat(h):h,C?m:undefined):this.options.parseMissingKeyHandler(m))}return s?(p.res=m,p):m}},{key:"extendTranslation",value:function(t,e,n,r,i){var s=this;if(this.i18nFormat&&this.i18nFormat.parse)t=this.i18nFormat.parse(t,dl(dl({},this.options.interpolation.defaultVariables),n),r.usedLng,r.usedNS,r.usedKey,{resolved:r});else if(!n.skipInterpolation){n.interpolation&&this.interpolator.init(dl(dl({},n),{interpolation:dl(dl({},this.options.interpolation),n.interpolation)}));var o,a="string"==typeof t&&(n&&n.interpolation&&n.interpolation.skipOnVariables!==undefined?n.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);if(a){var h=t.match(this.interpolator.nestingRegexp);o=h&&h.length}var l=n.replace&&"string"!=typeof n.replace?n.replace:n;if(this.options.interpolation.defaultVariables&&(l=dl(dl({},this.options.interpolation.defaultVariables),l)),t=this.interpolator.interpolate(t,l,n.lng||this.language,n),a){var u=t.match(this.interpolator.nestingRegexp);o<(u&&u.length)&&(n.nest=!1)}!n.lng&&"v1"!==this.options.compatibilityAPI&&r&&r.res&&(n.lng=r.usedLng),!1!==n.nest&&(t=this.interpolator.nest(t,(function(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return i&&i[0]===r[0]&&!n.context?(s.logger.warn("It seems you are nesting recursively key: ".concat(r[0]," in key: ").concat(e[0])),null):s.translate.apply(s,r.concat([e]))}),n)),n.interpolation&&this.interpolator.reset()}var c=n.postProcess||this.options.postProcess,d="string"==typeof c?[c]:c;return t!==undefined&&null!==t&&d&&d.length&&!1!==n.applyPostProcessor&&(t=ul.handle(d,t,e,this.options&&this.options.postProcessPassResolved?dl({i18nResolved:r},n):n,this)),t}},{key:"resolve",value:function(t){var e,n,r,i,s,o=this,a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return"string"==typeof t&&(t=[t]),t.forEach((function(t){if(!o.isValidLookup(e)){var h=o.extractFromKey(t,a),l=h.key;n=l;var u=h.namespaces;o.options.fallbackNS&&(u=u.concat(o.options.fallbackNS));var c=a.count!==undefined&&"string"!=typeof a.count,d=c&&!a.ordinal&&0===a.count&&o.pluralResolver.shouldUseIntlApi(),f=a.context!==undefined&&("string"==typeof a.context||"number"==typeof a.context)&&""!==a.context,p=a.lngs?a.lngs:o.languageUtils.toResolveHierarchy(a.lng||o.language,a.fallbackLng);u.forEach((function(t){o.isValidLookup(e)||(s=t,!pl["".concat(p[0],"-").concat(t)]&&o.utils&&o.utils.hasLoadedNamespace&&!o.utils.hasLoadedNamespace(s)&&(pl["".concat(p[0],"-").concat(t)]=!0,o.logger.warn('key "'.concat(n,'" for languages "').concat(p.join(", "),'" won\'t get resolved as namespace "').concat(s,'" was not yet loaded'),"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),p.forEach((function(n){if(!o.isValidLookup(e)){i=n;var s,h=[l];if(o.i18nFormat&&o.i18nFormat.addLookupKeys)o.i18nFormat.addLookupKeys(h,l,n,t,a);else{var u;c&&(u=o.pluralResolver.getSuffix(n,a.count,a));var p="".concat(o.options.pluralSeparator,"zero");if(c&&(h.push(l+u),d&&h.push(l+p)),f){var m="".concat(l).concat(o.options.contextSeparator).concat(a.context);h.push(m),c&&(h.push(m+u),d&&h.push(m+p))}}for(;s=h.pop();)o.isValidLookup(e)||(r=s,e=o.getResource(n,t,s,a))}})))}))}})),{res:e,usedKey:n,exactUsedKey:r,usedLng:i,usedNS:s}}},{key:"isValidLookup",value:function(t){return!(t===undefined||!this.options.returnNull&&null===t||!this.options.returnEmptyString&&""===t)}},{key:"getResource",value:function(t,e,n){var r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};return this.i18nFormat&&this.i18nFormat.getResource?this.i18nFormat.getResource(t,e,n,r):this.resourceStore.getResource(t,e,n,r)}}],[{key:"hasDefaultValue",value:function(t){var e="defaultValue";for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&e===n.substring(0,12)&&undefined!==t[n])return!0;return!1}}]),n}($h);function gl(t){return t.charAt(0).toUpperCase()+t.slice(1)}var _l=function(){function t(e){Mh(this,t),this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=Xh.create("languageUtils")}return Nh(t,[{key:"getScriptPartFromCode",value:function(t){if(!t||t.indexOf("-")<0)return null;var e=t.split("-");return 2===e.length?null:(e.pop(),"x"===e[e.length-1].toLowerCase()?null:this.formatLanguageCode(e.join("-")))}},{key:"getLanguagePartFromCode",value:function(t){if(!t||t.indexOf("-")<0)return t;var e=t.split("-");return this.formatLanguageCode(e[0])}},{key:"formatLanguageCode",value:function(t){if("string"==typeof t&&t.indexOf("-")>-1){var e=["hans","hant","latn","cyrl","cans","mong","arab"],n=t.split("-");return this.options.lowerCaseLng?n=n.map((function(t){return t.toLowerCase()})):2===n.length?(n[0]=n[0].toLowerCase(),n[1]=n[1].toUpperCase(),e.indexOf(n[1].toLowerCase())>-1&&(n[1]=gl(n[1].toLowerCase()))):3===n.length&&(n[0]=n[0].toLowerCase(),2===n[1].length&&(n[1]=n[1].toUpperCase()),"sgn"!==n[0]&&2===n[2].length&&(n[2]=n[2].toUpperCase()),e.indexOf(n[1].toLowerCase())>-1&&(n[1]=gl(n[1].toLowerCase())),e.indexOf(n[2].toLowerCase())>-1&&(n[2]=gl(n[2].toLowerCase()))),n.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?t.toLowerCase():t}},{key:"isSupportedCode",value:function(t){return("languageOnly"===this.options.load||this.options.nonExplicitSupportedLngs)&&(t=this.getLanguagePartFromCode(t)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(t)>-1}},{key:"getBestMatchFromCodes",value:function(t){var e,n=this;return t?(t.forEach((function(t){if(!e){var r=n.formatLanguageCode(t);n.options.supportedLngs&&!n.isSupportedCode(r)||(e=r)}})),!e&&this.options.supportedLngs&&t.forEach((function(t){if(!e){var r=n.getLanguagePartFromCode(t);if(n.isSupportedCode(r))return e=r;e=n.options.supportedLngs.find((function(t){return t===r?t:t.indexOf("-")<0&&r.indexOf("-")<0?void 0:0===t.indexOf(r)?t:void 0}))}})),e||(e=this.getFallbackCodes(this.options.fallbackLng)[0]),e):null}},{key:"getFallbackCodes",value:function(t,e){if(!t)return[];if("function"==typeof t&&(t=t(e)),"string"==typeof t&&(t=[t]),"[object Array]"===Object.prototype.toString.apply(t))return t;if(!e)return t["default"]||[];var n=t[e];return n||(n=t[this.getScriptPartFromCode(e)]),n||(n=t[this.formatLanguageCode(e)]),n||(n=t[this.getLanguagePartFromCode(e)]),n||(n=t["default"]),n||[]}},{key:"toResolveHierarchy",value:function(t,e){var n=this,r=this.getFallbackCodes(e||this.options.fallbackLng||[],t),i=[],s=function(t){t&&(n.isSupportedCode(t)?i.push(t):n.logger.warn("rejecting language code not found in supportedLngs: ".concat(t)))};return"string"==typeof t&&t.indexOf("-")>-1?("languageOnly"!==this.options.load&&s(this.formatLanguageCode(t)),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&s(this.getScriptPartFromCode(t)),"currentOnly"!==this.options.load&&s(this.getLanguagePartFromCode(t))):"string"==typeof t&&s(this.formatLanguageCode(t)),r.forEach((function(t){i.indexOf(t)<0&&s(n.formatLanguageCode(t))})),i}}]),t}(),yl=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","pt","pt-BR","tg","tl","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","et","eu","fi","fo","fur","fy","gl","gu","ha","hi","hu","hy","ia","it","kk","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt-PT","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","ht","id","ja","jbo","ka","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","cnr","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21},{lngs:["he","iw"],nr:[1,2,20,21],fc:22}],vl={1:function(t){return Number(t>1)},2:function(t){return Number(1!=t)},3:function(t){return 0},4:function(t){return Number(t%10==1&&t%100!=11?0:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?1:2)},5:function(t){return Number(0==t?0:1==t?1:2==t?2:t%100>=3&&t%100<=10?3:t%100>=11?4:5)},6:function(t){return Number(1==t?0:t>=2&&t<=4?1:2)},7:function(t){return Number(1==t?0:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?1:2)},8:function(t){return Number(1==t?0:2==t?1:8!=t&&11!=t?2:3)},9:function(t){return Number(t>=2)},10:function(t){return Number(1==t?0:2==t?1:t<7?2:t<11?3:4)},11:function(t){return Number(1==t||11==t?0:2==t||12==t?1:t>2&&t<20?2:3)},12:function(t){return Number(t%10!=1||t%100==11)},13:function(t){return Number(0!==t)},14:function(t){return Number(1==t?0:2==t?1:3==t?2:3)},15:function(t){return Number(t%10==1&&t%100!=11?0:t%10>=2&&(t%100<10||t%100>=20)?1:2)},16:function(t){return Number(t%10==1&&t%100!=11?0:0!==t?1:2)},17:function(t){return Number(1==t||t%10==1&&t%100!=11?0:1)},18:function(t){return Number(0==t?0:1==t?1:2)},19:function(t){return Number(1==t?0:0==t||t%100>1&&t%100<11?1:t%100>10&&t%100<20?2:3)},20:function(t){return Number(1==t?0:0==t||t%100>0&&t%100<20?1:2)},21:function(t){return Number(t%100==1?1:t%100==2?2:t%100==3||t%100==4?3:0)},22:function(t){return Number(1==t?0:2==t?1:(t<0||t>10)&&t%10==0?2:3)}},bl=["v1","v2","v3"],xl={zero:0,one:1,two:2,few:3,many:4,other:5};var El=function(){function t(e){var n,r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};Mh(this,t),this.languageUtils=e,this.options=r,this.logger=Xh.create("pluralResolver"),this.options.compatibilityJSON&&"v4"!==this.options.compatibilityJSON||"undefined"!=typeof Intl&&Intl.PluralRules||(this.options.compatibilityJSON="v3",this.logger.error("Your environment seems not to be Intl API compatible, use an Intl.PluralRules polyfill. Will fallback to the compatibilityJSON v3 format handling.")),this.rules=(n={},yl.forEach((function(t){t.lngs.forEach((function(e){n[e]={numbers:t.nr,plurals:vl[t.fc]}}))})),n)}return Nh(t,[{key:"addRule",value:function(t,e){this.rules[t]=e}},{key:"getRule",value:function(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(this.shouldUseIntlApi())try{return new Intl.PluralRules(t,{type:e.ordinal?"ordinal":"cardinal"})}catch(n){return}return this.rules[t]||this.rules[this.languageUtils.getLanguagePartFromCode(t)]}},{key:"needsPlural",value:function(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},n=this.getRule(t,e);return this.shouldUseIntlApi()?n&&n.resolvedOptions().pluralCategories.length>1:n&&n.numbers.length>1}},{key:"getPluralFormsOfKey",value:function(t,e){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};return this.getSuffixes(t,n).map((function(t){return"".concat(e).concat(t)}))}},{key:"getSuffixes",value:function(t){var e=this,n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},r=this.getRule(t,n);return r?this.shouldUseIntlApi()?r.resolvedOptions().pluralCategories.sort((function(t,e){return xl[t]-xl[e]})).map((function(t){return"".concat(e.options.prepend).concat(t)})):r.numbers.map((function(r){return e.getSuffix(t,r,n)})):[]}},{key:"getSuffix",value:function(t,e){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{},r=this.getRule(t,n);return r?this.shouldUseIntlApi()?"".concat(this.options.prepend).concat(r.select(e)):this.getSuffixRetroCompatible(r,e):(this.logger.warn("no plural rule found for: ".concat(t)),"")}},{key:"getSuffixRetroCompatible",value:function(t,e){var n=this,r=t.noAbs?t.plurals(e):t.plurals(Math.abs(e)),i=t.numbers[r];this.options.simplifyPluralSuffix&&2===t.numbers.length&&1===t.numbers[0]&&(2===i?i="plural":1===i&&(i=""));var s=function(){return n.options.prepend&&i.toString()?n.options.prepend+i.toString():i.toString()};return"v1"===this.options.compatibilityJSON?1===i?"":"number"==typeof i?"_plural_".concat(i.toString()):s():"v2"===this.options.compatibilityJSON||this.options.simplifyPluralSuffix&&2===t.numbers.length&&1===t.numbers[0]?s():this.options.prepend&&r.toString()?this.options.prepend+r.toString():r.toString()}},{key:"shouldUseIntlApi",value:function(){return!bl.includes(this.options.compatibilityJSON)}}]),t}();function wl(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Tl(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?wl(Object(n),!0).forEach((function(e){jh(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):wl(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Sl(t,e,n){var r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:".",i=!(arguments.length>4&&arguments[4]!==undefined)||arguments[4],s=function(t,e,n){var r=Zh(t,n);return r!==undefined?r:Zh(e,n)}(t,e,n);return!s&&i&&"string"==typeof n&&(s=sl(t,n,r))===undefined&&(s=sl(e,n,r)),s}var Al=function(){function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};Mh(this,t),this.logger=Xh.create("interpolator"),this.options=e,this.format=e.interpolation&&e.interpolation.format||function(t){return t},this.init(e)}return Nh(t,[{key:"init",value:function(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};t.interpolation||(t.interpolation={escapeValue:!0});var e=t.interpolation;this.escape=e.escape!==undefined?e.escape:nl,this.escapeValue=e.escapeValue===undefined||e.escapeValue,this.useRawValueToEscape=e.useRawValueToEscape!==undefined&&e.useRawValueToEscape,this.prefix=e.prefix?tl(e.prefix):e.prefixEscaped||"{{",this.suffix=e.suffix?tl(e.suffix):e.suffixEscaped||"}}",this.formatSeparator=e.formatSeparator?e.formatSeparator:e.formatSeparator||",",this.unescapePrefix=e.unescapeSuffix?"":e.unescapePrefix||"-",this.unescapeSuffix=this.unescapePrefix?"":e.unescapeSuffix||"",this.nestingPrefix=e.nestingPrefix?tl(e.nestingPrefix):e.nestingPrefixEscaped||tl("$t("),this.nestingSuffix=e.nestingSuffix?tl(e.nestingSuffix):e.nestingSuffixEscaped||tl(")"),this.nestingOptionsSeparator=e.nestingOptionsSeparator?e.nestingOptionsSeparator:e.nestingOptionsSeparator||",",this.maxReplaces=e.maxReplaces?e.maxReplaces:1e3,this.alwaysFormat=e.alwaysFormat!==undefined&&e.alwaysFormat,this.resetRegExp()}},{key:"reset",value:function(){this.options&&this.init(this.options)}},{key:"resetRegExp",value:function(){var t="".concat(this.prefix,"(.+?)").concat(this.suffix);this.regexp=new RegExp(t,"g");var e="".concat(this.prefix).concat(this.unescapePrefix,"(.+?)").concat(this.unescapeSuffix).concat(this.suffix);this.regexpUnescape=new RegExp(e,"g");var n="".concat(this.nestingPrefix,"(.+?)").concat(this.nestingSuffix);this.nestingRegexp=new RegExp(n,"g")}},{key:"interpolate",value:function(t,e,n,r){var i,s,o,a=this,h=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{};function l(t){return t.replace(/\$/g,"$$$$")}var u=function(t){if(t.indexOf(a.formatSeparator)<0){var i=Sl(e,h,t,a.options.keySeparator,a.options.ignoreJSONStructure);return a.alwaysFormat?a.format(i,undefined,n,Tl(Tl(Tl({},r),e),{},{interpolationkey:t})):i}var s=t.split(a.formatSeparator),o=s.shift().trim(),l=s.join(a.formatSeparator).trim();return a.format(Sl(e,h,o,a.options.keySeparator,a.options.ignoreJSONStructure),l,n,Tl(Tl(Tl({},r),e),{},{interpolationkey:o}))};this.resetRegExp();var c=r&&r.missingInterpolationHandler||this.options.missingInterpolationHandler,d=r&&r.interpolation&&r.interpolation.skipOnVariables!==undefined?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:function(t){return l(t)}},{regex:this.regexp,safeValue:function(t){return a.escapeValue?l(a.escape(t)):l(t)}}].forEach((function(e){for(o=0;i=e.regex.exec(t);){var n=i[1].trim();if((s=u(n))===undefined)if("function"==typeof c){var h=c(t,i,r);s="string"==typeof h?h:""}else if(r&&Object.prototype.hasOwnProperty.call(r,n))s="";else{if(d){s=i[0];continue}a.logger.warn("missed to pass in variable ".concat(n," for interpolating ").concat(t)),s=""}else"string"==typeof s||a.useRawValueToEscape||(s=qh(s));var l=e.safeValue(s);if(t=t.replace(i[0],l),d?(e.regex.lastIndex+=s.length,e.regex.lastIndex-=i[0].length):e.regex.lastIndex=0,++o>=a.maxReplaces)break}})),t}},{key:"nest",value:function(t,e){var n,r,i,s=this,o=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};function a(t,e){var n=this.nestingOptionsSeparator;if(t.indexOf(n)<0)return t;var r=t.split(new RegExp("".concat(n,"[ ]*{"))),s="{".concat(r[1]);t=r[0];var o=(s=this.interpolate(s,i)).match(/'/g),a=s.match(/"/g);(o&&o.length%2==0&&!a||a.length%2!=0)&&(s=s.replace(/'/g,'"'));try{i=JSON.parse(s),e&&(i=Tl(Tl({},e),i))}catch(et){return this.logger.warn("failed parsing options string in nesting for key ".concat(t),et),"".concat(t).concat(n).concat(s)}return delete i.defaultValue,t}for(;n=this.nestingRegexp.exec(t);){var h=[];(i=(i=Tl({},o)).replace&&"string"!=typeof i.replace?i.replace:i).applyPostProcessor=!1,delete i.defaultValue;var l=!1;if(-1!==n[0].indexOf(this.formatSeparator)&&!/{.*}/.test(n[1])){var u=n[1].split(this.formatSeparator).map((function(t){return t.trim()}));n[1]=u.shift(),h=u,l=!0}if((r=e(a.call(this,n[1].trim(),i),i))&&n[0]===t&&"string"!=typeof r)return r;"string"!=typeof r&&(r=qh(r)),r||(this.logger.warn("missed to resolve ".concat(n[1]," for nesting ").concat(t)),r=""),l&&(r=h.reduce((function(t,e){return s.format(t,e,o.lng,Tl(Tl({},o),{},{interpolationkey:n[1].trim()}))}),r.trim())),t=t.replace(n[0],r),this.regexp.lastIndex=0}return t}}]),t}();function Cl(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Il(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Cl(Object(n),!0).forEach((function(e){jh(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Cl(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Rl(t){var e={};return function(n,r,i){var s=r+JSON.stringify(i),o=e[s];return o||(o=t(r,i),e[s]=o),o(n)}}var Pl=function(){function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};Mh(this,t),this.logger=Xh.create("formatter"),this.options=e,this.formats={number:Rl((function(t,e){var n=new Intl.NumberFormat(t,Il({},e));return function(t){return n.format(t)}})),currency:Rl((function(t,e){var n=new Intl.NumberFormat(t,Il(Il({},e),{},{style:"currency"}));return function(t){return n.format(t)}})),datetime:Rl((function(t,e){var n=new Intl.DateTimeFormat(t,Il({},e));return function(t){return n.format(t)}})),relativetime:Rl((function(t,e){var n=new Intl.RelativeTimeFormat(t,Il({},e));return function(t){return n.format(t,e.range||"day")}})),list:Rl((function(t,e){var n=new Intl.ListFormat(t,Il({},e));return function(t){return n.format(t)}}))},this.init(e)}return Nh(t,[{key:"init",value:function(t){var e=(arguments.length>1&&arguments[1]!==undefined?arguments[1]:{interpolation:{}}).interpolation;this.formatSeparator=e.formatSeparator?e.formatSeparator:e.formatSeparator||","}},{key:"add",value:function(t,e){this.formats[t.toLowerCase().trim()]=e}},{key:"addCached",value:function(t,e){this.formats[t.toLowerCase().trim()]=Rl(e)}},{key:"format",value:function(t,e,n){var r=this,i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{},s=e.split(this.formatSeparator).reduce((function(t,e){var s=function(t){var e=t.toLowerCase().trim(),n={};if(t.indexOf("(")>-1){var r=t.split("(");e=r[0].toLowerCase().trim();var i=r[1].substring(0,r[1].length-1);"currency"===e&&i.indexOf(":")<0?n.currency||(n.currency=i.trim()):"relativetime"===e&&i.indexOf(":")<0?n.range||(n.range=i.trim()):i.split(";").forEach((function(t){if(t){var e=Hh(t.split(":")),r=e[0],i=e.slice(1).join(":").trim().replace(/^'+|'+$/g,"");n[r.trim()]||(n[r.trim()]=i),"false"===i&&(n[r.trim()]=!1),"true"===i&&(n[r.trim()]=!0),isNaN(i)||(n[r.trim()]=parseInt(i,10))}}))}return{formatName:e,formatOptions:n}}(e),o=s.formatName,a=s.formatOptions;if(r.formats[o]){var h=t;try{var l=i&&i.formatParams&&i.formatParams[i.interpolationkey]||{},u=l.locale||l.lng||i.locale||i.lng||n;h=r.formats[o](t,u,Il(Il(Il({},a),i),l))}catch(zd){r.logger.warn(zd)}return h}return r.logger.warn("there was no format function for ".concat(o)),t}),t);return s}}]),t}();function Ml(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Ol(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ml(Object(n),!0).forEach((function(e){jh(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ml(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Dl(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(et){return!1}}();return function(){var n,r=Uh(t);if(e){var i=Uh(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Bh(this,n)}}var Nl=function(t){Fh(n,t);var e=Dl(n);function n(t,r,i){var s,o=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};return Mh(this,n),s=e.call(this),rl&&$h.call(kh(s)),s.backend=t,s.store=r,s.services=i,s.languageUtils=i.languageUtils,s.options=o,s.logger=Xh.create("backendConnector"),s.waitingReads=[],s.maxParallelReads=o.maxParallelReads||10,s.readingCalls=0,s.maxRetries=o.maxRetries>=0?o.maxRetries:5,s.retryTimeout=o.retryTimeout>=1?o.retryTimeout:350,s.state={},s.queue=[],s.backend&&s.backend.init&&s.backend.init(i,o.backend,o),s}return Nh(n,[{key:"queueLoad",value:function(t,e,n,r){var i=this,s={},o={},a={},h={};return t.forEach((function(t){var r=!0;e.forEach((function(e){var a="".concat(t,"|").concat(e);!n.reload&&i.store.hasResourceBundle(t,e)?i.state[a]=2:i.state[a]<0||(1===i.state[a]?o[a]===undefined&&(o[a]=!0):(i.state[a]=1,r=!1,o[a]===undefined&&(o[a]=!0),s[a]===undefined&&(s[a]=!0),h[e]===undefined&&(h[e]=!0)))})),r||(a[t]=!0)})),(Object.keys(s).length||Object.keys(o).length)&&this.queue.push({pending:o,pendingCount:Object.keys(o).length,loaded:{},errors:[],callback:r}),{toLoad:Object.keys(s),pending:Object.keys(o),toLoadLanguages:Object.keys(a),toLoadNamespaces:Object.keys(h)}}},{key:"loaded",value:function(t,e,n){var r=t.split("|"),i=r[0],s=r[1];e&&this.emit("failedLoading",i,s,e),n&&this.store.addResourceBundle(i,s,n),this.state[t]=e?-1:2;var o={};this.queue.forEach((function(n){!function(t,e,n,r){var i=Kh(t,e,Object),s=i.obj,o=i.k;s[o]=s[o]||[],r&&(s[o]=s[o].concat(n)),r||s[o].push(n)}(n.loaded,[i],s),function(t,e){t.pending[e]!==undefined&&(delete t.pending[e],t.pendingCount--)}(n,t),e&&n.errors.push(e),0!==n.pendingCount||n.done||(Object.keys(n.loaded).forEach((function(t){o[t]||(o[t]={});var e=n.loaded[t];e.length&&e.forEach((function(e){o[t][e]===undefined&&(o[t][e]=!0)}))})),n.done=!0,n.errors.length?n.callback(n.errors):n.callback())})),this.emit("loaded",o),this.queue=this.queue.filter((function(t){return!t.done}))}},{key:"read",value:function(t,e,n){var r=this,i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0,s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:this.retryTimeout,o=arguments.length>5?arguments[5]:undefined;if(!t.length)return o(null,{});if(this.readingCalls>=this.maxParallelReads)this.waitingReads.push({lng:t,ns:e,fcName:n,tried:i,wait:s,callback:o});else{this.readingCalls++;var a=function(a,h){if(r.readingCalls--,r.waitingReads.length>0){var l=r.waitingReads.shift();r.read(l.lng,l.ns,l.fcName,l.tried,l.wait,l.callback)}a&&h&&i<r.maxRetries?setTimeout((function(){r.read.call(r,t,e,n,i+1,2*s,o)}),s):o(a,h)},h=this.backend[n].bind(this.backend);if(2!==h.length)return h(t,e,a);try{var l=h(t,e);l&&"function"==typeof l.then?l.then((function(t){return a(null,t)}))["catch"](a):a(null,l)}catch(u){a(u)}}}},{key:"prepareLoading",value:function(t,e){var n=this,r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{},i=arguments.length>3?arguments[3]:undefined;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),i&&i();"string"==typeof t&&(t=this.languageUtils.toResolveHierarchy(t)),"string"==typeof e&&(e=[e]);var s=this.queueLoad(t,e,r,i);if(!s.toLoad.length)return s.pending.length||i(),null;s.toLoad.forEach((function(t){n.loadOne(t)}))}},{key:"load",value:function(t,e,n){this.prepareLoading(t,e,{},n)}},{key:"reload",value:function(t,e,n){this.prepareLoading(t,e,{reload:!0},n)}},{key:"loadOne",value:function(t){var e=this,n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"",r=t.split("|"),i=r[0],s=r[1];this.read(i,s,"read",undefined,undefined,(function(r,o){r&&e.logger.warn("".concat(n,"loading namespace ").concat(s," for language ").concat(i," failed"),r),!r&&o&&e.logger.log("".concat(n,"loaded namespace ").concat(s," for language ").concat(i),o),e.loaded(t,r,o)}))}},{key:"saveMissing",value:function(t,e,n,r,i){var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:{},o=arguments.length>6&&arguments[6]!==undefined?arguments[6]:function(){};if(this.services.utils&&this.services.utils.hasLoadedNamespace&&!this.services.utils.hasLoadedNamespace(e))this.logger.warn('did not save key "'.concat(n,'" as the namespace "').concat(e,'" was not yet loaded'),"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");else if(n!==undefined&&null!==n&&""!==n){if(this.backend&&this.backend.create){var a=Ol(Ol({},s),{},{isUpdate:i}),h=this.backend.create.bind(this.backend);if(h.length<6)try{var l;(l=5===h.length?h(t,e,n,r,a):h(t,e,n,r))&&"function"==typeof l.then?l.then((function(t){return o(null,t)}))["catch"](o):o(null,l)}catch(u){o(u)}else h(t,e,n,r,o,a)}t&&t[0]&&this.store.addResource(t[0],e,n,r)}}}]),n}($h);function kl(){return{debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!0,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:function(t){var e={};if("object"===Ph(t[1])&&(e=t[1]),"string"==typeof t[1]&&(e.defaultValue=t[1]),"string"==typeof t[2]&&(e.tDescription=t[2]),"object"===Ph(t[2])||"object"===Ph(t[3])){var n=t[3]||t[2];Object.keys(n).forEach((function(t){e[t]=n[t]}))}return e},interpolation:{escapeValue:!0,format:function(t,e,n,r){return t},prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}}function Ll(t){return"string"==typeof t.ns&&(t.ns=[t.ns]),"string"==typeof t.fallbackLng&&(t.fallbackLng=[t.fallbackLng]),"string"==typeof t.fallbackNS&&(t.fallbackNS=[t.fallbackNS]),t.supportedLngs&&t.supportedLngs.indexOf("cimode")<0&&(t.supportedLngs=t.supportedLngs.concat(["cimode"])),t}function Fl(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Bl(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Fl(Object(n),!0).forEach((function(e){jh(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Fl(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Ul(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(et){return!1}}();return function(){var n,r=Uh(t);if(e){var i=Uh(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Bh(this,n)}}function jl(){}var Gl=function(t){Fh(n,t);var e=Ul(n);function n(){var t,r,i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},s=arguments.length>1?arguments[1]:undefined;if(Mh(this,n),t=e.call(this),rl&&$h.call(kh(t)),t.options=Ll(i),t.services={},t.logger=Xh,t.modules={external:[]},r=kh(t),Object.getOwnPropertyNames(Object.getPrototypeOf(r)).forEach((function(t){"function"==typeof r[t]&&(r[t]=r[t].bind(r))})),s&&!t.isInitialized&&!i.isClone){if(!t.options.initImmediate)return t.init(i,s),Bh(t,kh(t));setTimeout((function(){t.init(i,s)}),0)}return t}return Nh(n,[{key:"init",value:function(){var t=this,e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},n=arguments.length>1?arguments[1]:undefined;"function"==typeof e&&(n=e,e={}),!e.defaultNS&&!1!==e.defaultNS&&e.ns&&("string"==typeof e.ns?e.defaultNS=e.ns:e.ns.indexOf("translation")<0&&(e.defaultNS=e.ns[0]));var r=kl();function i(t){return t?"function"==typeof t?new t:t:null}if(this.options=Bl(Bl(Bl({},r),this.options),Ll(e)),"v1"!==this.options.compatibilityAPI&&(this.options.interpolation=Bl(Bl({},r.interpolation),this.options.interpolation)),e.keySeparator!==undefined&&(this.options.userDefinedKeySeparator=e.keySeparator),e.nsSeparator!==undefined&&(this.options.userDefinedNsSeparator=e.nsSeparator),!this.options.isClone){var s;this.modules.logger?Xh.init(i(this.modules.logger),this.options):Xh.init(null,this.options),this.modules.formatter?s=this.modules.formatter:"undefined"!=typeof Intl&&(s=Pl);var o=new _l(this.options);this.store=new ll(this.options.resources,this.options);var a=this.services;a.logger=Xh,a.resourceStore=this.store,a.languageUtils=o,a.pluralResolver=new El(o,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),!s||this.options.interpolation.format&&this.options.interpolation.format!==r.interpolation.format||(a.formatter=i(s),a.formatter.init(a,this.options),this.options.interpolation.format=a.formatter.format.bind(a.formatter)),a.interpolator=new Al(this.options),a.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},a.backendConnector=new Nl(i(this.modules.backend),a.resourceStore,a,this.options),a.backendConnector.on("*",(function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];t.emit.apply(t,[e].concat(r))})),this.modules.languageDetector&&(a.languageDetector=i(this.modules.languageDetector),a.languageDetector.init&&a.languageDetector.init(a,this.options.detection,this.options)),this.modules.i18nFormat&&(a.i18nFormat=i(this.modules.i18nFormat),a.i18nFormat.init&&a.i18nFormat.init(this)),this.translator=new ml(this.services,this.options),this.translator.on("*",(function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];t.emit.apply(t,[e].concat(r))})),this.modules.external.forEach((function(e){e.init&&e.init(t)}))}if(this.format=this.options.interpolation.format,n||(n=jl),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){var h=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);h.length>0&&"dev"!==h[0]&&(this.options.lng=h[0])}this.services.languageDetector||this.options.lng||this.logger.warn("init: no languageDetector is used and no lng is defined");["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach((function(e){t[e]=function(){var n;return(n=t.store)[e].apply(n,arguments)}}));["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach((function(e){t[e]=function(){var n;return(n=t.store)[e].apply(n,arguments),t}}));var l=Yh(),u=function(){var e=function(e,r){t.isInitialized&&!t.initializedStoreOnce&&t.logger.warn("init: i18next is already initialized. You should call init just once!"),t.isInitialized=!0,t.options.isClone||t.logger.log("initialized",t.options),t.emit("initialized",t.options),l.resolve(r),n(e,r)};if(t.languages&&"v1"!==t.options.compatibilityAPI&&!t.isInitialized)return e(null,t.t.bind(t));t.changeLanguage(t.options.lng,e)};return this.options.resources||!this.options.initImmediate?u():setTimeout(u,0),l}},{key:"loadResources",value:function(t){var e=this,n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:jl,r="string"==typeof t?t:this.language;if("function"==typeof t&&(n=t),!this.options.resources||this.options.partialBundledLanguages){if(r&&"cimode"===r.toLowerCase())return n();var i=[],s=function(t){t&&e.services.languageUtils.toResolveHierarchy(t).forEach((function(t){i.indexOf(t)<0&&i.push(t)}))};if(r)s(r);else this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach((function(t){return s(t)}));this.options.preload&&this.options.preload.forEach((function(t){return s(t)})),this.services.backendConnector.load(i,this.options.ns,(function(t){t||e.resolvedLanguage||!e.language||e.setResolvedLanguage(e.language),n(t)}))}else n(null)}},{key:"reloadResources",value:function(t,e,n){var r=Yh();return t||(t=this.languages),e||(e=this.options.ns),n||(n=jl),this.services.backendConnector.reload(t,e,(function(t){r.resolve(),n(t)})),r}},{key:"use",value:function(t){if(!t)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!t.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return"backend"===t.type&&(this.modules.backend=t),("logger"===t.type||t.log&&t.warn&&t.error)&&(this.modules.logger=t),"languageDetector"===t.type&&(this.modules.languageDetector=t),"i18nFormat"===t.type&&(this.modules.i18nFormat=t),"postProcessor"===t.type&&ul.addPostProcessor(t),"formatter"===t.type&&(this.modules.formatter=t),"3rdParty"===t.type&&this.modules.external.push(t),this}},{key:"setResolvedLanguage",value:function(t){if(t&&this.languages&&!(["cimode","dev"].indexOf(t)>-1))for(var e=0;e<this.languages.length;e++){var n=this.languages[e];if(!(["cimode","dev"].indexOf(n)>-1)&&this.store.hasLanguageSomeTranslations(n)){this.resolvedLanguage=n;break}}}},{key:"changeLanguage",value:function(t,e){var n=this;this.isLanguageChangingTo=t;var r=Yh();this.emit("languageChanging",t);var i=function(t){n.language=t,n.languages=n.services.languageUtils.toResolveHierarchy(t),n.resolvedLanguage=undefined,n.setResolvedLanguage(t)},s=function(s){t||s||!n.services.languageDetector||(s=[]);var o="string"==typeof s?s:n.services.languageUtils.getBestMatchFromCodes(s);o&&(n.language||i(o),n.translator.language||n.translator.changeLanguage(o),n.services.languageDetector&&n.services.languageDetector.cacheUserLanguage&&n.services.languageDetector.cacheUserLanguage(o)),n.loadResources(o,(function(t){!function(t,s){s?(i(s),n.translator.changeLanguage(s),n.isLanguageChangingTo=undefined,n.emit("languageChanged",s),n.logger.log("languageChanged",s)):n.isLanguageChangingTo=undefined,r.resolve((function(){return n.t.apply(n,arguments)})),e&&e(t,(function(){return n.t.apply(n,arguments)}))}(t,o)}))};return t||!this.services.languageDetector||this.services.languageDetector.async?!t&&this.services.languageDetector&&this.services.languageDetector.async?0===this.services.languageDetector.detect.length?this.services.languageDetector.detect().then(s):this.services.languageDetector.detect(s):s(t):s(this.services.languageDetector.detect()),r}},{key:"getFixedT",value:function(t,e,n){var r=this,i=function s(t,e){var i;if("object"!==Ph(e)){for(var o=arguments.length,a=new Array(o>2?o-2:0),h=2;h<o;h++)a[h-2]=arguments[h];i=r.options.overloadTranslationOptionHandler([t,e].concat(a))}else i=Bl({},e);i.lng=i.lng||s.lng,i.lngs=i.lngs||s.lngs,i.ns=i.ns||s.ns,i.keyPrefix=i.keyPrefix||n||s.keyPrefix;var l,u=r.options.keySeparator||".";return l=i.keyPrefix&&Array.isArray(t)?t.map((function(t){return"".concat(i.keyPrefix).concat(u).concat(t)})):i.keyPrefix?"".concat(i.keyPrefix).concat(u).concat(t):t,r.t(l,i)};return"string"==typeof t?i.lng=t:i.lngs=t,i.ns=e,i.keyPrefix=n,i}},{key:"t",value:function(){var t;return this.translator&&(t=this.translator).translate.apply(t,arguments)}},{key:"exists",value:function(){var t;return this.translator&&(t=this.translator).exists.apply(t,arguments)}},{key:"setDefaultNamespace",value:function(t){this.options.defaultNS=t}},{key:"hasLoadedNamespace",value:function(t){var e=this,n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;var r=this.resolvedLanguage||this.languages[0],i=!!this.options&&this.options.fallbackLng,s=this.languages[this.languages.length-1];if("cimode"===r.toLowerCase())return!0;var o=function(t,n){var r=e.services.backendConnector.state["".concat(t,"|").concat(n)];return-1===r||2===r};if(n.precheck){var a=n.precheck(this,o);if(a!==undefined)return a}return!!this.hasResourceBundle(r,t)||(!(this.services.backendConnector.backend&&(!this.options.resources||this.options.partialBundledLanguages))||!(!o(r,t)||i&&!o(s,t)))}},{key:"loadNamespaces",value:function(t,e){var n=this,r=Yh();return this.options.ns?("string"==typeof t&&(t=[t]),t.forEach((function(t){n.options.ns.indexOf(t)<0&&n.options.ns.push(t)})),this.loadResources((function(t){r.resolve(),e&&e(t)})),r):(e&&e(),Promise.resolve())}},{key:"loadLanguages",value:function(t,e){var n=Yh();"string"==typeof t&&(t=[t]);var r=this.options.preload||[],i=t.filter((function(t){return r.indexOf(t)<0}));return i.length?(this.options.preload=r.concat(i),this.loadResources((function(t){n.resolve(),e&&e(t)})),n):(e&&e(),Promise.resolve())}},{key:"dir",value:function(t){if(t||(t=this.resolvedLanguage||(this.languages&&this.languages.length>0?this.languages[0]:this.language)),!t)return"rtl";var e=this.services&&this.services.languageUtils||new _l(kl());return["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"].indexOf(e.getLanguagePartFromCode(t))>-1||t.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}},{key:"cloneInstance",value:function(){var t=this,e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:jl,i=Bl(Bl(Bl({},this.options),e),{isClone:!0}),s=new n(i);e.debug===undefined&&e.prefix===undefined||(s.logger=s.logger.clone(e));return["store","services","language"].forEach((function(e){s[e]=t[e]})),s.services=Bl({},this.services),s.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},s.translator=new ml(s.services,s.options),s.translator.on("*",(function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];s.emit.apply(s,[t].concat(n))})),s.init(i,r),s.translator.options=s.options,s.translator.backendConnector.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},s}},{key:"toJSON",value:function(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}]),n}($h);jh(Gl,"createInstance",(function(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},e=arguments.length>1?arguments[1]:undefined;return new Gl(t,e)}));var Hl=Gl.createInstance();Hl.createInstance=Gl.createInstance;Hl.createInstance,Hl.dir,Hl.init,Hl.loadResources,Hl.reloadResources,Hl.use,Hl.changeLanguage,Hl.getFixedT,Hl.t,Hl.exists,Hl.setDefaultNamespace,Hl.hasLoadedNamespace,Hl.loadNamespaces,Hl.loadLanguages;const zl=JSON.parse('{"u2":"SaveDate","i8":"0.0.1"}'),Wl=1704742564009,Vl=!1,Xl=Vl,$l=!1,Yl=zl.i8,ql="1.0.0",Kl=zl.u2,Ql=Vl,Zl=(window.location.search.match(/[?&]lang=([a-z]{2}([-_][a-z]{2})?)/)||[])[1]||document.documentElement.lang||navigator.language,Jl={extension:qt.Asset,resolver:{test:t=>{const e=t.split("?")[0].split("."),n=e.pop(),r=e.pop();return"json"===n&&"i18"===r},parse:t=>{var e,n;const r=t.split("?")[0].split("/").pop().split(".").reverse();return{data:{lng:null!=(e=r[2])?e:"en",ns:null!=(n=r[3])?n:"translation"},src:t}}},loader:{extension:{type:qt.LoadParser,priority:Hi.Normal},testParse(t,e){return Promise.resolve(e.src.includes("i18.json")&&e.data.lng&&e.data.ns)},parse(t,e,n){return Hl.addResourceBundle(e.data.lng,e.data.ns,t,!0,!1),Promise.resolve(t)}}};let tu;Hl.init({debug:Vl,resources:{},lng:Zl,fallbackLng:Vl?"cimode":{"default":["en"]}}),Zt.add(Jl),Zt.add(Ja),tu="undefined"==typeof self&&"undefined"!=typeof process&&process.hrtime?function(){const t=process.hrtime();return 1e3*t[0]+t[1]/1e6}:"undefined"!=typeof self&&self.performance!==undefined&&self.performance.now!==undefined?self.performance.now.bind(self.performance):Date.now!==undefined?Date.now:function(){return(new Date).getTime()};class eu{constructor(){eu.prototype.__init.call(this),eu.prototype.__init2.call(this),eu.prototype.__init3.call(this),eu.prototype.__init4.call(this)}__init(){this._tweens={}}static get shared(){return eu._shared||(eu._shared=new eu),eu._shared}__init2(){this._paused=!1}isPaused(){return this._paused}pause(){this._paused=!0}resume(){this._paused=!1}__init3(){this._lastUpdateTime=undefined}__init4(){this.now=tu}getAll(){return Object.keys(this._tweens).map((t=>this._tweens[t]))}removeAll(){this._tweens={}}add(t){this._tweens[t.getId()]=t}remove(t){delete this._tweens[t.getId()]}update(t,e=!1){if(t==undefined&&(this._lastUpdateTime==undefined?(this._lastUpdateTime=this.now(),t=0):t=this.now()-this._lastUpdateTime),this._lastUpdateTime=this.now(),this._paused)return!1;const n=Object.keys(this._tweens);if(0==n.length)return!1;for(let r=0;r<n.length;r++){const i=this._tweens[n[r]];i&&0==i.update(t,!0)&&!e&&delete this._tweens[n[r]]}return!0}}const nu={Step:{None(t){return t<.5?0:1}},Linear:{None(t){return t}},Quadratic:{In(t){return t*t},Out(t){return t*(2-t)},InOut(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In(t){return t*t*t},Out(t){return--t*t*t+1},InOut(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In(t){return t*t*t*t},Out(t){return 1- --t*t*t*t},InOut(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In(t){return t*t*t*t*t},Out(t){return--t*t*t*t*t+1},InOut(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In(t){return 1-Math.cos(t*Math.PI/2)},Out(t){return Math.sin(t*Math.PI/2)},InOut(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In(t){return 0==t?0:Math.pow(1024,t-1)},Out(t){return 1==t?1:1-Math.pow(2,-10*t)},InOut(t){return 0==t?0:1==t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In(t){return 1-Math.sqrt(1-t*t)},Out(t){return Math.sqrt(1- --t*t)},InOut(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In(t){return 0==t?0:1==t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out(t){return 0==t?0:1==t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut(t){return 0==t?0:1==t?1:(t*=2)<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1}},Back:{In(t){const e=1.70158;return t*t*((e+1)*t-e)},Out(t){const e=1.70158;return--t*t*((e+1)*t+e)+1},InOut(t){const e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In(t){return 1-nu.Bounce.Out(1-t)},Out(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut(t){return t<.5?.5*nu.Bounce.In(2*t):.5*nu.Bounce.Out(2*t-1)+.5}}},ru={Geom:{Linear(t,e){const n=t.length-1,r=n*e,i=Math.floor(r),s=ru.Utils.Linear;return e<0?s(t[0],t[1],r):e>1?s(t[n],t[n-1],n-r):s(t[i],t[i+1>n?n:i+1],r-i)},Bezier(t,e){let n=0;const r=t.length-1,i=Math.pow,s=ru.Utils.Bernstein;for(let o=0;o<=r;o++)n+=s(r,o)*i(1-e,r-o)*i(e,o)*t[o];return n},QuadraticBezier(t,e){let n=0;const r=t.length-1;if(1==e)return t[r];const i=Math.pow,s=ru.Utils.Bernstein,o=r*e,a=Math.floor(o),h=.5*(o-a)+a%2*.5,l=a-a%2,u=l+1,c=l+2;return n+=s(2,0)*i(1-h,2)*i(h,0)*t[l],n+=s(2,1)*i(1-h,1)*i(h,1)*t[u],n+=s(2,2)*i(1-h,0)*i(h,2)*t[c],n},CubicBezier(t,e){let n=0;const r=t.length-1;if(1==e)return t[r];const i=Math.pow,s=ru.Utils.Bernstein,o=r*e,a=Math.floor(o),h=1/3*(o-a)+1/3*(a%3),l=a-a%3,u=l+1,c=l+2,d=l+3;return n+=s(3,0)*i(1-h,3)*i(h,0)*t[l],n+=s(3,1)*i(1-h,2)*i(h,1)*t[u],n+=s(3,2)*i(1-h,1)*i(h,2)*t[c],n+=s(3,3)*i(1-h,0)*i(h,3)*t[d],n},CatmullRom(t,e){const n=t.length-1;let r=n*e,i=Math.floor(r);const s=ru.Utils.CatmullRom;return t[0]==t[n]?(e<0&&(i=Math.floor(r=n*(1+e))),s(t[(i-1+n)%n],t[i],t[(i+1)%n],t[(i+2)%n],r-i)):e<0?t[0]-(s(t[0],t[0],t[1],t[1],-r)-t[0]):e>1?t[n]-(s(t[n],t[n],t[n-1],t[n-1],r-n)-t[n]):s(t[i?i-1:0],t[i],t[n<i+1?n:i+1],t[n<i+2?n:i+2],r-i)}},Angle:{Radians(t,e){const n=t.length-1,r=n*e,i=Math.floor(r),s=ru.Utils.WrapLinear;return e<0?s(t[0],t[1],r,2*Math.PI):e>1?s(t[n],t[n-1],n-r,2*Math.PI):s(t[i],t[i+1>n?n:i+1],r-i,2*Math.PI)},Degrees(t,e){const n=t.length-1,r=n*e,i=Math.floor(r),s=ru.Utils.WrapLinear;return e<0?s(t[0],t[1],r,360):e>1?s(t[n],t[n-1],n-r,360):s(t[i],t[i+1>n?n:i+1],r-i,360)}},Color:{RGB(t,e){const n=t.length-1,r=n*e,i=Math.floor(r),s=ru.Utils.RGBLinear;return e<0?s(t[0],t[1],r):e>1?s(t[n],t[n-1],n-r):s(t[i],t[i+1>n?n:i+1],r-i)},HSV(t,e){const n=t.length-1,r=n*e,i=Math.floor(r),s=ru.Utils.HSVLinear;return e<0?s(t[0],t[1],r):e>1?s(t[n],t[n-1],n-r):s(t[i],t[i+1>n?n:i+1],r-i)},HCL(t,e){const n=t.length-1,r=n*e,i=Math.floor(r),s=ru.Utils.HCLLinear;return e<0?s(t[0],t[1],r):e>1?s(t[n],t[n-1],n-r):s(t[i],t[i+1>n?n:i+1],r-i)}},Utils:{RGBsplit(t){return{a:t>>24&255,r:t>>16&255,g:t>>8&255,b:255&t}},HSVsplit(t){const e=ru.Utils.RGBsplit(t);e.r/=255,e.g/=255,e.b/=255;const n=Math.max(e.r,e.g,e.b),r=Math.min(e.r,e.g,e.b);let i;const s=n,o=n-r,a=0==n?0:o/n;if(n==r)i=0;else{switch(n){case e.r:i=(e.g-e.b)/o+(e.g<e.b?6:0);break;case e.g:i=(e.b-e.r)/o+2;break;case e.b:i=(e.r-e.g)/o+4}i/=6}return{a:e.a,h:i,s:a,v:s}},HSVJoin(t){let e,n,r;const i=Math.floor(6*t.h),s=6*t.h-i,o=t.v*(1-t.s),a=t.v*(1-s*t.s),h=t.v*(1-(1-s)*t.s);switch(i%6){case 0:e=t.v,n=h,r=o;break;case 1:e=a,n=t.v,r=o;break;case 2:e=o,n=t.v,r=h;break;case 3:e=o,n=a,r=t.v;break;case 4:e=h,n=o,r=t.v;break;case 5:e=t.v,n=o,r=a}return t.a<<24|e<<16|n<<8|r},HCLSplit(t){const e=ru.Utils.RGBsplit(t),n={a:e.a,h:0,c:0,l:0};let r=0;const i=Math.min(e.r,Math.min(e.g,e.b)),s=Math.max(e.r,Math.max(e.g,e.b));let o=.03;return n.c=s-i,0!=n.c&&(r=Math.atan2(e.g-e.b,e.r-e.g)/Math.PI,o*=i/s),o=Math.exp(o),n.h=(r/2-Math.min(r%1,-r%1)/6)%1,n.c*=o,n.l=ru.Utils.Linear(-i,s,o)/1.060909067907034,n},HCLJoin(t){const e={a:t.a,r:0,g:0,b:0};if(0!=t.l){let n=t.h;const r=t.c,i=.530454533953517*t.l,s=Math.exp(.03*(1-r/(2*i))),o=(2*i-r)/(2*s-1),a=r/s,h=(n+Math.min(2*n%1/4,-2*n%1/8))*Math.PI*2;let l;n*=6,n<=.999?(l=Math.tan(h),e.r=1,e.g=l/(1+l)):n<=1.001?(e.r=1,e.g=1):n<=2?(l=Math.tan(h),e.r=(1+l)/l,e.g=1):n<=3?(l=Math.tan(h),e.g=1,e.b=1+l):n<=3.999?(l=Math.tan(h),e.g=1/(1+l),e.b=1):n<=4.001?(e.g=0,e.b=1):n<=5?(l=Math.tan(h),e.r=-1/l,e.b=1):(l=Math.tan(h),e.r=1,e.b=-l),e.r=e.r*a+o,e.g=e.g*a+o,e.b=e.b*a+o}return e.a<<24|e.r<<16|e.g<<8|e.b},WrapLinear(t,e,n,r){let i;return t=(t+r*Math.trunc(Math.abs(t/r)))%r,e=(e+r*Math.trunc(Math.abs(e/r)))%r,Math.abs(t-e)<=.5*r?i=ru.Utils.Linear(t,e,n):(i=t<e?ru.Utils.Linear(t+r,e,n):ru.Utils.Linear(t,e+r,n),i%=r),i},RGBLinear(t,e,n){const r=ru.Utils.RGBsplit(t),i=ru.Utils.RGBsplit(e);return ru.Utils.Linear(r.a,i.a,n)<<24|ru.Utils.Linear(r.r,i.r,n)<<16|ru.Utils.Linear(r.g,i.g,n)<<8|ru.Utils.Linear(r.b,i.b,n)},HSVLinear(t,e,n){const r=ru.Utils.HSVsplit(t),i=ru.Utils.HSVsplit(e);let s;Math.abs(r.h-i.h)<=.5?s=ru.Utils.Linear(r.h,i.h,n):(s=r.h<i.h?ru.Utils.Linear(r.h+1,i.h,n):ru.Utils.Linear(r.h,i.h+1,n),s%=1);const o=ru.Utils.Linear(r.s,i.s,n),a=ru.Utils.Linear(r.v,i.v,n),h=ru.Utils.Linear(r.a,i.a,n);return ru.Utils.HSVJoin({a:h,h:s,s:o,v:a})},HCLLinear(t,e,n){const r=ru.Utils.HCLSplit(t),i=ru.Utils.HCLSplit(e);let s;Math.abs(r.h-i.h)<=.5?s=ru.Utils.Linear(r.h,i.h,n):(s=r.h<i.h?ru.Utils.Linear(r.h+1,i.h,n):ru.Utils.Linear(r.h,i.h+1,n),s%=1);const o=ru.Utils.Linear(r.c,i.c,n),a=ru.Utils.Linear(r.l,i.l,n),h=ru.Utils.Linear(r.a,i.a,n);return ru.Utils.HSVJoin({a:h,h:s,s:o,v:a})},Linear(t,e,n){return(e-t)*n+t},Bernstein(t,e){const n=ru.Utils.Factorial;return n(t)/n(e)/n(t-e)},Factorial:function(){const t=[1];return function(e){let n=1;if(t[e])return t[e];for(let t=e;t>1;t--)n*=t;return t[e]=n,n}}(),CatmullRom(t,e,n,r,i){const s=.5*(n-t),o=.5*(r-e),a=i*i;return(2*e-2*n+s+o)*(i*a)+(-3*e+3*n-2*s-o)*a+s*i+e}}};class iu{static __initStatic(){this._nextId=0}static nextId(){return iu._nextId++}}iu.__initStatic();const su={safetyCheckFunction:t=>!0,easingFunction:nu.Linear.None,yoyoEasingFunction:undefined,interpolationFunction:ru.Geom.Linear};var ou=Object.defineProperty,au=(t,e,n)=>(((t,e,n)=>{e in t?ou(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n);class hu extends ai{constructor(){super(),au(this,"pauseUpdateOnFocusLost",!0),au(this,"pauseTweenOnFocusLost"),au(this,"tweens"),au(this,"events"),au(this,"index"),au(this,"stages"),au(this,"closeHandler"),this.stages=[this],this.tweens=new eu,this.events=new H,this.name=this.constructor.name}requestClose(){return t=this,e=null,n=function*(){return this.closeHandler(),yield Promise.resolve(),!0},new Promise(((r,i)=>{var s=t=>{try{a(n.next(t))}catch(et){i(et)}},o=t=>{try{a(n["throw"](t))}catch(et){i(et)}},a=t=>t.done?r(t.value):Promise.resolve(t.value).then(s,o);a((n=n.apply(t,e)).next())}));var t,e,n}onPopupOpen(t,e){}onPopupClose(t,e){}onSceneOpen(t,e){}onSceneClose(t,e){}onStart(){}onShow(){}onDestroy(t){}onFocus(){}onFocusLost(){}onResize(t,e){}onPause(){}onResume(){}update(t){}onMessage(t){}destroy(){if(this.stages)for(const t of this.stages)t&&t!=this&&t.destroy({children:!0});this.tweens.removeAll(),this.events.removeAllListeners(),super.destroy({children:!0})}onChangeOrientation(){}onChangeKeyboard(){}}class lu extends hu{constructor(){super()}startCovering(){return Promise.resolve()}startResolving(){return Promise.resolve(void 0)}startUncovering(){return Promise.resolve()}onDownloadProgress(t,e){}}var uu=(t=>(t.BACKSPACE="Backspace",t.TAB="Tab",t.ENTER="Enter",t.SHIFT="ShiftLeft",t.CTRL="ControlLeft",t.ALT="AltLeft",t.PAUSE="Pause",t.CAPS_LOCK="CapsLock",t.ESCAPE="Escape",t.SPACE=" ",t.PAGE_UP="PageUp",t.PAGE_DOWN="PageDown",t.END="End",t.HOME="Home",t.LEFT_ARROW="ArrowLeft",t.UP_ARROW="ArrowUp",t.RIGHT_ARROW="ArrowRight",t.DOWN_ARROW="ArrowDown",t.INSERT="Insert",t.DELETE="Delete",t.KEY_0="Digit0",t.KEY_1="Digit1",t.KEY_2="Digit2",t.KEY_3="Digit3",t.KEY_4="Digit4",t.KEY_5="Digit5",t.KEY_6="Digit6",t.KEY_7="Digit7",t.KEY_8="Digit8",t.KEY_9="Digit9",t.KEY_A="KeyA",t.KEY_B="KeyB",t.KEY_C="KeyC",t.KEY_D="KeyD",t.KEY_E="KeyE",t.KEY_F="KeyF",t.KEY_G="KeyG",t.KEY_H="KeyH",t.KEY_I="KeyI",t.KEY_J="KeyJ",t.KEY_K="KeyK",t.KEY_L="KeyL",t.KEY_M="KeyM",t.KEY_N="KeyN",t.KEY_O="KeyO",t.KEY_P="KeyP",t.KEY_Q="KeyQ",t.KEY_R="KeyR",t.KEY_S="KeyS",t.KEY_T="KeyT",t.KEY_U="KeyU",t.KEY_V="KeyV",t.KEY_W="KeyW",t.KEY_X="KeyX",t.KEY_Y="KeyY",t.KEY_Z="KeyZ",t.LEFT_META="MetaLeft",t.RIGHT_META="MetaRight",t.SELECT="Select",t.NUMPAD_0="Numpad0",t.NUMPAD_1="Numpad1",t.NUMPAD_2="Numpad2",t.NUMPAD_3="Numpad3",t.NUMPAD_4="Numpad4",t.NUMPAD_5="Numpad5",t.NUMPAD_6="Numpad6",t.NUMPAD_7="Numpad7",t.NUMPAD_8="Numpad8",t.NUMPAD_9="Numpad9",t.MULTIPLY="NumpadMultiply",t.ADD="NumpadAdd",t.SUBTRACT="NumpadSubtract",t.DECIMAL="NumpadDecimal",t.DIVIDE="NumpadDivide",t.NUMPAD_ENTER="NumpadEnter",t.F1="F1",t.F2="F2",t.F3="F3",t.F4="F4",t.F5="F5",t.F6="F6",t.F7="F7",t.F8="F8",t.F9="F9",t.F10="F10",t.F11="F11",t.F12="F12",t.NUM_LOCK="NumLock",t.SCROLL_LOCK="ScrollLock",t.SEMICOLON="Semicolon",t.EQUALS="Equal",t.COMMA="Comma",t.DASH="Minus",t.PERIOD="Period",t.FORWARD_SLASH="Slash",t.GRAVE_ACCENT="Backquote",t.OPEN_BRACKET="BracketLeft",t.BACK_SLASH="Backslash",t.CLOSE_BRACKET="BracketRight",t.SINGLE_QUOTE="Quote",t.ANY="AnyKey",t))(uu||{});const cu={8:"Backspace",9:"Tab",13:"Enter",16:"ShiftLeft",17:"ControlLeft",18:"AltLeft",19:"Pause",20:"CapsLock",27:"Escape",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",48:"Digit0",49:"Digit1",50:"Digit2",51:"Digit3",52:"Digit4",53:"Digit5",54:"Digit6",55:"Digit7",56:"Digit8",57:"Digit9",65:"KeyA",66:"KeyB",67:"KeyC",68:"KeyD",69:"KeyE",70:"KeyF",71:"KeyG",72:"KeyH",73:"KeyI",74:"KeyJ",75:"KeyK",76:"KeyL",77:"KeyM",78:"KeyN",79:"KeyO",80:"KeyP",81:"KeyQ",82:"KeyR",83:"KeyS",84:"KeyT",85:"KeyU",86:"KeyV",87:"KeyW",88:"KeyX",89:"KeyY",90:"KeyZ",91:"MetaLeft",92:"MetaRight",93:"Select",96:"Numpad0",97:"Numpad1",98:"Numpad2",99:"Numpad3",100:"Numpad4",101:"Numpad5",102:"Numpad6",103:"Numpad7",104:"Numpad8",105:"Numpad9",106:"NumpadMultiply",107:"NumpadAdd",109:"NumpadSubtract",110:"NumpadDecimal",111:"NumpadDivide",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",186:"Semicolon",187:"Equal",188:"Comma",189:"Minus",190:"Period",191:"Slash",192:"Backquote",219:"BracketLeft",220:"Backslash",221:"BracketRight",222:"Quote"};var du=Object.defineProperty,fu=(t,e,n)=>(((t,e,n)=>{e in t?du(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n);const pu=class{constructor(){fu(this,"isDownMap",new Map),fu(this,"previousFrame",new Map),fu(this,"justPressedMap",new Map),fu(this,"justReleasedMap",new Map),fu(this,"pressed",new H),fu(this,"released",new H),fu(this,"stopRaf",!1),fu(this,"keydown"),fu(this,"keyUp"),fu(this,"_enabled",!0),this.keydown=t=>{if(this.enabled){let e=t.code;e||(e=cu[t.keyCode]),e&&(this.isDownMap.set(e,!0),this.pressed.emit(e,t)),this.pressed.emit(uu.ANY,t)}},window.addEventListener("keydown",this.keydown),this.keyUp=t=>{if(this.enabled){let e=t.code;e||(e=cu[t.keyCode]),e&&(this.isDownMap.set(e,!1),this.released.emit(e,t)),this.released.emit(uu.ANY,t)}},window.addEventListener("keyup",this.keyUp),this.update()}get enabled(){return this._enabled}set enabled(t){!t&&this._enabled&&this.clearState(),this._enabled=t}update(){this.enabled&&(this.isDownMap.forEach(((t,e)=>{t&&!this.previousFrame.get(e)?this.justPressedMap.set(e,!0):this.justPressedMap.set(e,!1),!t&&this.previousFrame.get(e)?this.justReleasedMap.set(e,!0):this.justReleasedMap.set(e,!1)})),this.isDownMap.forEach(((t,e)=>{this.previousFrame.set(e,t)}))),this.stopRaf||requestAnimationFrame(this.update.bind(this))}isDown(t){if(t==uu.ANY){let t=!1;return this.isDownMap.forEach((e=>e?t=!0:void 0)),t}return Boolean(this.isDownMap.get(t))}justPressed(t){if(t==uu.ANY){let t=!1;return this.justPressedMap.forEach((e=>e?t=!0:void 0)),t}return Boolean(this.justPressedMap.get(t))}justReleased(t){if(t==uu.ANY){let t=!1;return this.justReleasedMap.forEach((e=>e?t=!0:void 0)),t}return Boolean(this.justReleasedMap.get(t))}removeAllListeners(){this.pressed.removeAllListeners(),this.released.removeAllListeners()}clearState(){this.isDownMap.clear(),this.previousFrame.clear(),this.justPressedMap.clear(),this.justReleasedMap.clear()}destroy(){this.removeAllListeners(),this.clearState(),this!=pu.shared&&(this.stopRaf=!0,window.removeEventListener("keydown",this.keydown),window.removeEventListener("keyup",this.keyUp))}};let mu=pu;function gu(t,e){return t.map(((t,e)=>({item:t,index:e}))).sort(((t,n)=>e(t.item,n.item)||t.index-n.index)).map((({item:t})=>t))}fu(mu,"shared",new pu);var _u,yu,vu=n(466),bu=n.n(vu);(yu=_u||(_u={})).NEW=Symbol("scene_created"),yu.DESTROY=Symbol("scene_destroyed"),yu.START=Symbol("scene_started"),yu.SHOW=Symbol("scene_shown");var xu=Object.defineProperty,Eu=(t,e,n)=>(((t,e,n)=>{e in t?xu(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n);const wu=class{constructor(){}static idealScale(t=1,e,n,r=wu.IDEAL_WIDTH,i=wu.IDEAL_HEIGHT,s=wu.DEFAULT_TIEBREAKER){return s(e/r,n/i)*t}static setScaleRelativeToScreen(t,e,n,r,i,s=wu.DEFAULT_TIEBREAKER){const o=t.getLocalBounds();return t.scale.set(s(e*r/o.width,n*i/o.height)),t.scale.x}static screenScale(t,e,n,r,i,s,o=wu.DEFAULT_TIEBREAKER){return o(n*(null!=i?i:1)/t,r*(null!=s?s:1)/e)}static screenScale1D(t,e,n){return e*(null!=n?n:1)/t}static setScaleRelativeToIdeal(t,e,n,r=wu.IDEAL_WIDTH,i=wu.IDEAL_HEIGHT,s=wu.DEFAULT_TIEBREAKER){return t.scale.set(s(e/r,n/i)),t.scale.x}static forceWidth(t,e){return t}static forceHeight(t,e){return e}};let Tu=wu;Eu(Tu,"IDEAL_WIDTH",1080),Eu(Tu,"IDEAL_HEIGHT",1920),Eu(Tu,"DEFAULT_TIEBREAKER",Math.min),Eu(Tu,"FILL",Math.max),Eu(Tu,"FIT",Math.min);var Su=Object.defineProperty,Au=(t,e,n)=>(((t,e,n)=>{e in t?Su(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n),Cu=(t,e,n)=>new Promise(((r,i)=>{var s=t=>{try{a(n.next(t))}catch(et){i(et)}},o=t=>{try{a(n["throw"](t))}catch(et){i(et)}},a=t=>t.done?r(t.value):Promise.resolve(t.value).then(s,o);a((n=n.apply(t,e)).next())}));var Iu=Object.defineProperty,Ru=(t,e,n)=>(((t,e,n)=>{e in t?Iu(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n);const Pu=class{constructor(){}static initialize(t,e="1",n=(t=>({}))){Pu.instance=t,Pu.savedataVersion=e,Pu.savedataConflictSolver=n}static save(t){return Pu.instance?Pu.instance.save(null!=t?t:Pu.DEFAULT_SAVESLOT):Promise.reject("You didn't call Initialize!")}static load(t){return e=this,n=null,r=function*(){if(!Pu.instance)return Promise.reject("You didn't call Initialize!");yield Pu.instance.load(null!=t?t:Pu.DEFAULT_SAVESLOT);const e=yield Pu.instance.getSavedataVersion(null!=t?t:Pu.DEFAULT_SAVESLOT);e!=Pu.savedataVersion&&(Pu.instance.internalMap=this.savedataConflictSolver(Pu.instance.internalMap,e),yield Pu.instance.setSavedataVersion(Pu.savedataVersion,null!=t?t:Pu.DEFAULT_SAVESLOT),yield Pu.save(null!=t?t:Pu.DEFAULT_SAVESLOT))},new Promise(((t,i)=>{var s=t=>{try{a(r.next(t))}catch(et){i(et)}},o=t=>{try{a(r["throw"](t))}catch(et){i(et)}},a=e=>e.done?t(e.value):Promise.resolve(e.value).then(s,o);a((r=r.apply(e,n)).next())}));var e,n,r}static"delete"(t){return Pu.instance?Pu.instance["delete"](null!=t?t:Pu.DEFAULT_SAVESLOT):Promise.reject("You didn't call Initialize!")}static getValue(t){return Pu.instance?Pu.instance.getValue(t):null}static setValue(t,e){return Pu.instance?Pu.instance.setValue(t,e):null}};let Mu=Pu;Ru(Mu,"instance"),Ru(Mu,"savedataVersion"),Ru(Mu,"savedataConflictSolver"),Ru(Mu,"DEFAULT_SAVESLOT",`SAVEDATA_${Kl}`);var Ou=n(483),Du=n.n(Ou),Nu=Object.defineProperty,ku=(t,e,n)=>(((t,e,n)=>{e in t?Nu(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n),Lu=(t,e,n)=>new Promise(((r,i)=>{var s=t=>{try{a(n.next(t))}catch(et){i(et)}},o=t=>{try{a(n["throw"](t))}catch(et){i(et)}},a=t=>t.done?r(t.value):Promise.resolve(t.value).then(s,o);a((n=n.apply(t,e)).next())}));var Fu=Object.defineProperty,Bu=(t,e,n)=>(((t,e,n)=>{e in t?Fu(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n);class Uu extends hu{constructor(){super(),window.location.href="https://www.savedate.com.ar/alex-mica"}}const ju=!1,Gu=!1,Hu="${JSCORE_VERSION}",zu=function(t,e){if(!t)throw Wu(e)},Wu=function(t){return new Error("Firebase Database ("+Hu+") INTERNAL ASSERT FAILED: "+t)},Vu=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e},Xu={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<t.length;i+=3){const e=t[i],s=i+1<t.length,o=s?t[i+1]:0,a=i+2<t.length,h=a?t[i+2]:0,l=e>>2,u=(3&e)<<4|o>>4;let c=(15&o)<<2|h>>6,d=63&h;a||(d=64,s||(c=64)),r.push(n[l],n[u],n[c],n[d])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(Vu(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(s>>10)),e[r++]=String.fromCharCode(56320+(1023&s))}else{const s=t[n++],o=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<t.length;){const e=n[t.charAt(i++)],s=i<t.length?n[t.charAt(i)]:0;++i;const o=i<t.length?n[t.charAt(i)]:64;++i;const a=i<t.length?n[t.charAt(i)]:64;if(++i,null==e||null==s||null==o||null==a)throw new $u;const h=e<<2|s>>4;if(r.push(h),64!==o){const t=s<<4&240|o>>2;if(r.push(t),64!==a){const t=o<<6&192|a;r.push(t)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class $u extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Yu=function(t){const e=Vu(t);return Xu.encodeByteArray(e,!0)},qu=function(t){return Yu(t).replace(/\./g,"")},Ku=function(t){try{return Xu.decodeString(t,!0)}catch(et){}return null};function Qu(t){return Zu(undefined,t)}function Zu(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:t===undefined&&(t={});break;case Array:t=[];break;default:return e}for(const n in e)e.hasOwnProperty(n)&&Ju(n)&&(t[n]=Zu(t[n],e[n]));return t}function Ju(t){return"__proto__"!==t}const tc=()=>function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,ec=()=>{try{return tc()||(()=>{if("undefined"==typeof process||"undefined"==typeof process.env)return;const t=process.env.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"==typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(et){return}const e=t&&Ku(t[1]);return e&&JSON.parse(e)})()}catch(et){return}},nc=t=>{const e=(t=>{var e,n;return null===(n=null===(e=ec())||void 0===e?void 0:e.emulatorHosts)||void 0===n?void 0:n[t]})(t);if(!e)return undefined;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return"["===e[0]?[e.substring(1,n-1),r]:[e.substring(0,n),r]},rc=()=>{var t;return null===(t=ec())||void 0===t?void 0:t.config};class ic{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise["catch"]((()=>{})),1===t.length?t(e):t(e,n))}}}function sc(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function oc(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(sc())}function ac(){return!0===ju||!0===Gu}class hc extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,hc.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,lc.prototype.create)}}class lc{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},r=`${this.service}/${t}`,i=this.errors[t],s=i?function(t,e){return t.replace(uc,((t,n)=>{const r=e[n];return null!=r?String(r):`<${n}?>`}))}(i,n):"Error",o=`${this.serviceName}: ${s} (${r}).`;return new hc(r,o,n)}}const uc=/\{\$([^}]+)}/g;function cc(t){return JSON.parse(t)}function dc(t){return JSON.stringify(t)}const fc=function(t){let e={},n={},r={},i="";try{const s=t.split(".");e=cc(Ku(s[0])||""),n=cc(Ku(s[1])||""),i=s[2],r=n.d||{},delete n.d}catch(et){}return{header:e,claims:n,data:r,signature:i}};function pc(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function mc(t,e){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:undefined}function gc(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function _c(t,e,n){const r={};for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=e.call(n,t[i],i,t));return r}function yc(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const i of n){if(!r.includes(i))return!1;const n=t[i],s=e[i];if(vc(n)&&vc(s)){if(!yc(n,s))return!1}else if(n!==s)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function vc(t){return null!==t&&"object"==typeof t}class bc{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(t,e){e||(e=0);const n=this.W_;if("string"==typeof t)for(let u=0;u<16;u++)n[u]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(let u=0;u<16;u++)n[u]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(let u=16;u<80;u++){const t=n[u-3]^n[u-8]^n[u-14]^n[u-16];n[u]=4294967295&(t<<1|t>>>31)}let r,i,s=this.chain_[0],o=this.chain_[1],a=this.chain_[2],h=this.chain_[3],l=this.chain_[4];for(let u=0;u<80;u++){u<40?u<20?(r=h^o&(a^h),i=1518500249):(r=o^a^h,i=1859775393):u<60?(r=o&a|h&(o|a),i=2400959708):(r=o^a^h,i=3395469782);const t=(s<<5|s>>>27)+r+l+i+n[u]&4294967295;l=h,h=a,a=4294967295&(o<<30|o>>>2),o=s,s=t}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(t,e){if(null==t)return;e===undefined&&(e=t.length);const n=e-this.blockSize;let r=0;const i=this.buf_;let s=this.inbuf_;for(;r<e;){if(0===s)for(;r<=n;)this.compress_(t,r),r+=this.blockSize;if("string"==typeof t){for(;r<e;)if(i[s]=t.charCodeAt(r),++s,++r,s===this.blockSize){this.compress_(i),s=0;break}}else for(;r<e;)if(i[s]=t[r],++s,++r,s===this.blockSize){this.compress_(i),s=0;break}}this.inbuf_=s,this.total_+=e}digest(){const t=[];let e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let r=this.blockSize-1;r>=56;r--)this.buf_[r]=255&e,e/=256;this.compress_(this.buf_);let n=0;for(let r=0;r<5;r++)for(let e=24;e>=0;e-=8)t[n]=this.chain_[r]>>e&255,++n;return t}}function xc(t,e){return`${t} failed: ${e} argument `}const Ec=function(t){let e=0;for(let n=0;n<t.length;n++){const r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,n++):e+=3}return e};function wc(t){return t&&t._delegate?t._delegate:t}class Tc{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const Sc="[DEFAULT]";class Ac{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new ic;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(et){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),r=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(et){if(r)return null;throw et}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:Sc})}catch(et){}for(const[t,e]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:n});e.resolve(t)}catch(et){}}}}clearInstance(t=Sc){this.instancesDeferred["delete"](t),this.instancesOptions["delete"](t),this.instances["delete"](t)}async"delete"(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL["delete"]())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t=Sc){return this.instances.has(t)}getOptions(t=Sc){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[i,s]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(i)&&s.resolve(r)}return r}onInit(t,e){var n;const r=this.normalizeInstanceIdentifier(e),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(t),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&t(s,r),()=>{i["delete"](t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const i of n)try{i(t,e)}catch(r){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=t,r===Sc?undefined:r),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(i){}var r;return n||null}normalizeInstanceIdentifier(t=Sc){return this.component?this.component.multipleInstances?t:Sc:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class Cc{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers["delete"](t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new Ac(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}const Ic=[];var Rc;!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(Rc||(Rc={}));const Pc={debug:Rc.DEBUG,verbose:Rc.VERBOSE,info:Rc.INFO,warn:Rc.WARN,error:Rc.ERROR,silent:Rc.SILENT},Mc=Rc.INFO,Oc={[Rc.DEBUG]:"log",[Rc.VERBOSE]:"log",[Rc.INFO]:"info",[Rc.WARN]:"warn",[Rc.ERROR]:"error"},Dc=(t,e,...n)=>{if(e<t.logLevel)return;(new Date).toISOString();if(!Oc[e])throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Nc{constructor(t){this.name=t,this._logLevel=Mc,this._logHandler=Dc,this._userLogHandler=null,Ic.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in Rc))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?Pc[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,Rc.DEBUG,...t),this._logHandler(this,Rc.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,Rc.VERBOSE,...t),this._logHandler(this,Rc.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,Rc.INFO,...t),this._logHandler(this,Rc.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,Rc.WARN,...t),this._logHandler(this,Rc.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,Rc.ERROR,...t),this._logHandler(this,Rc.ERROR,...t)}}const kc=(t,e)=>e.some((e=>t instanceof e));let Lc,Fc;const Bc=new WeakMap,Uc=new WeakMap,jc=new WeakMap,Gc=new WeakMap,Hc=new WeakMap;let zc={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return Uc.get(t);if("objectStoreNames"===e)return t.objectStoreNames||jc.get(t);if("store"===e)return n.objectStoreNames[1]?undefined:n.objectStore(n.objectStoreNames[0])}return Xc(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t}};function Wc(t){return t!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(Fc||(Fc=[IDBCursor.prototype.advance,IDBCursor.prototype["continue"],IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply($c(this),e),Xc(Bc.get(this))}:function(...e){return Xc(t.apply($c(this),e))}:function(e,...n){const r=t.call($c(this),e,...n);return jc.set(r,e.sort?e.sort():[e]),Xc(r)}}function Vc(t){return"function"==typeof t?Wc(t):(t instanceof IDBTransaction&&function(t){if(Uc.has(t))return;const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",s),t.removeEventListener("abort",s)},i=()=>{e(),r()},s=()=>{n(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",i),t.addEventListener("error",s),t.addEventListener("abort",s)}));Uc.set(t,e)}(t),kc(t,Lc||(Lc=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,zc):t)}function Xc(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("success",i),t.removeEventListener("error",s)},i=()=>{e(Xc(t.result)),r()},s=()=>{n(t.error),r()};t.addEventListener("success",i),t.addEventListener("error",s)}));return e.then((e=>{e instanceof IDBCursor&&Bc.set(e,t)}))["catch"]((()=>{})),Hc.set(e,t),e}(t);if(Gc.has(t))return Gc.get(t);const e=Vc(t);return e!==t&&(Gc.set(t,e),Hc.set(e,t)),e}const $c=t=>Hc.get(t);const Yc=["get","getKey","getAll","getAllKeys","count"],qc=["put","add","delete","clear"],Kc=new Map;function Qc(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(Kc.get(e))return Kc.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=qc.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!Yc.includes(n))return;const s=async function(t,...e){const s=this.transaction(t,i?"readwrite":"readonly");let o=s.store;return r&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),i&&s.done]))[0]};return Kc.set(e,s),s}zc=(t=>({...t,get:(e,n,r)=>Qc(e,n)||t.get(e,n,r),has:(e,n)=>!!Qc(e,n)||t.has(e,n)}))(zc);class Zc{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const Jc="@firebase/app",td="0.9.19",ed=new Nc("@firebase/app"),nd="[DEFAULT]",rd={[Jc]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},id=new Map,sd=new Map;function od(t,e){try{t.container.addComponent(e)}catch(et){ed.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,et)}}function ad(t){const e=t.name;if(sd.has(e))return ed.debug(`There were multiple attempts to register component ${e}.`),!1;sd.set(e,t);for(const n of id.values())od(n,t);return!0}function hd(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}const ld=new lc("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class ud{constructor(t,e,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new Tc("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw ld.create("app-deleted",{appName:this._name})}}function cd(t,e={}){let n=t;if("object"!=typeof e){e={name:e}}const r=Object.assign({name:nd,automaticDataCollectionEnabled:!1},e),i=r.name;if("string"!=typeof i||!i)throw ld.create("bad-app-name",{appName:String(i)});if(n||(n=rc()),!n)throw ld.create("no-options");const s=id.get(i);if(s){if(yc(n,s.options)&&yc(r,s.config))return s;throw ld.create("duplicate-app",{appName:i})}const o=new Cc(i);for(const h of sd.values())o.addComponent(h);const a=new ud(n,r,o);return id.set(i,a),a}function dd(t,e,n){var r;let i=null!==(r=rd[t])&&void 0!==r?r:t;n&&(i+=`-${n}`);const s=i.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const t=[`Unable to register library "${i}" with version "${e}":`];return s&&t.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&t.push("and"),o&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void ed.warn(t.join(" "))}ad(new Tc(`${i}-version`,(()=>({library:i,version:e})),"VERSION"))}const fd="firebase-heartbeat-database",pd=1,md="firebase-heartbeat-store";let gd=null;function _d(){return gd||(gd=function(t,e,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(t,e),a=Xc(o);return r&&o.addEventListener("upgradeneeded",(t=>{r(Xc(o.result),t.oldVersion,t.newVersion,Xc(o.transaction),t)})),n&&o.addEventListener("blocked",(t=>n(t.oldVersion,t.newVersion,t))),a.then((t=>{s&&t.addEventListener("close",(()=>s())),i&&t.addEventListener("versionchange",(t=>i(t.oldVersion,t.newVersion,t)))}))["catch"]((()=>{})),a}(fd,pd,{upgrade:(t,e)=>{if(0===e)t.createObjectStore(md)}})["catch"]((t=>{throw ld.create("idb-open",{originalErrorMessage:t.message})}))),gd}async function yd(t,e){try{const n=(await _d()).transaction(md,"readwrite"),r=n.objectStore(md);await r.put(e,vd(t)),await n.done}catch(et){if(et instanceof hc)ed.warn(et.message);else{const e=ld.create("idb-set",{originalErrorMessage:null==et?void 0:et.message});ed.warn(e.message)}}}function vd(t){return`${t.name}!${t.options.appId}`}class bd{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new Ed(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),e=xd();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==e&&!this._heartbeatsCache.heartbeats.some((t=>t.date===e)))return this._heartbeatsCache.heartbeats.push({date:e,agent:t}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((t=>{const e=new Date(t.date).valueOf();return Date.now()-e<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const t=xd(),{heartbeatsToSend:e,unsentEntries:n}=function(t,e=1024){const n=[];let r=t.slice();for(const i of t){const t=n.find((t=>t.agent===i.agent));if(t){if(t.dates.push(i.date),wd(n)>e){t.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),wd(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),r=qu(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}}function xd(){return(new Date).toISOString().substring(0,10)}class Ed{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(et){return!1}}()&&new Promise(((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var t;e((null===(t=i.error)||void 0===t?void 0:t.message)||"")}}catch(zd){e(zd)}})).then((()=>!0))["catch"]((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const t=await async function(t){try{const e=await _d();return await e.transaction(md).objectStore(md).get(vd(t))}catch(et){if(et instanceof hc)ed.warn(et.message);else{const e=ld.create("idb-get",{originalErrorMessage:null==et?void 0:et.message});ed.warn(e.message)}}}(this.app);return t||{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return yd(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return yd(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}}}function wd(t){return qu(JSON.stringify({version:2,heartbeats:t})).length}var Td;Td="",ad(new Tc("platform-logger",(t=>new Zc(t)),"PRIVATE")),ad(new Tc("heartbeat",(t=>new bd(t)),"PRIVATE")),dd(Jc,td,Td),dd(Jc,td,"esm2017"),dd("fire-js","");dd("firebase","10.4.0","app");const Sd="@firebase/database",Ad="1.0.1";let Cd="";function Id(t){Cd=t}class Rd{constructor(t){this.domStorage_=t,this.prefix_="firebase:"}set(t,e){null==e?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),dc(e))}get(t){const e=this.domStorage_.getItem(this.prefixedName_(t));return null==e?null:cc(e)}remove(t){this.domStorage_.removeItem(this.prefixedName_(t))}prefixedName_(t){return this.prefix_+t}toString(){return this.domStorage_.toString()}}class Pd{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(t,e){null==e?delete this.cache_[t]:this.cache_[t]=e}get(t){return pc(this.cache_,t)?this.cache_[t]:null}remove(t){delete this.cache_[t]}}const Md=function(t){try{if("undefined"!=typeof window&&"undefined"!=typeof window[t]){const e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Rd(e)}}catch(et){}return new Pd},Od=Md("localStorage"),Dd=Md("sessionStorage"),Nd=new Nc("@firebase/database"),kd=function(){let t=1;return function(){return t++}}(),Ld=function(t){const e=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);if(i>=55296&&i<=56319){const e=i-55296;r++,zu(r<t.length,"Surrogate pair missing trail surrogate."),i=65536+(e<<10)+(t.charCodeAt(r)-56320)}i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):i<65536?(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e}(t),n=new bc;n.update(e);const r=n.digest();return Xu.encodeByteArray(r)},Fd=function(...t){let e="";for(let n=0;n<t.length;n++){const r=t[n];Array.isArray(r)||r&&"object"==typeof r&&"number"==typeof r.length?e+=Fd.apply(null,r):e+="object"==typeof r?dc(r):r,e+=" "}return e};let Bd=null,Ud=!0;const jd=function(t,e){zu(!e||!0===t||!1===t,"Can't turn on custom loggers persistently."),!0===t?(Nd.logLevel=Rc.VERBOSE,Bd=Nd.log.bind(Nd),e&&Dd.set("logging_enabled",!0)):"function"==typeof t?Bd=t:(Bd=null,Dd.remove("logging_enabled"))},Gd=function(...t){if(!0===Ud&&(Ud=!1,null===Bd&&!0===Dd.get("logging_enabled")&&jd(!0)),Bd){const e=Fd.apply(null,t);Bd(e)}},Hd=function(t){return function(...e){Gd(t,...e)}},zd=function(...t){const e="FIREBASE INTERNAL ERROR: "+Fd(...t);Nd.error(e)},Wd=function(...t){const e=`FIREBASE FATAL ERROR: ${Fd(...t)}`;throw Nd.error(e),new Error(e)},Vd=function(...t){const e="FIREBASE WARNING: "+Fd(...t);Nd.warn(e)},Xd=function(t){return"number"==typeof t&&(t!=t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},$d="[MIN_NAME]",Yd="[MAX_NAME]",qd=function(t,e){if(t===e)return 0;if(t===$d||e===Yd)return-1;if(e===$d||t===Yd)return 1;{const n=rf(t),r=rf(e);return null!==n?null!==r?n-r==0?t.length-e.length:n-r:-1:null!==r?1:t<e?-1:1}},Kd=function(t,e){return t===e?0:t<e?-1:1},Qd=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+dc(e))},Zd=function(t){if("object"!=typeof t||null===t)return dc(t);const e=[];for(const r in t)e.push(r);e.sort();let n="{";for(let r=0;r<e.length;r++)0!==r&&(n+=","),n+=dc(e[r]),n+=":",n+=Zd(t[e[r]]);return n+="}",n},Jd=function(t,e){const n=t.length;if(n<=e)return[t];const r=[];for(let i=0;i<n;i+=e)i+e>n?r.push(t.substring(i,n)):r.push(t.substring(i,i+e));return r};function tf(t,e){for(const n in t)t.hasOwnProperty(n)&&e(n,t[n])}const ef=function(t){zu(!Xd(t),"Invalid JSON number");const e=1023;let n,r,i,s,o;0===t?(r=0,i=0,n=1/t==-Infinity?1:0):(n=t<0,(t=Math.abs(t))>=Math.pow(2,-1022)?(s=Math.min(Math.floor(Math.log(t)/Math.LN2),e),r=s+e,i=Math.round(t*Math.pow(2,52-s)-Math.pow(2,52))):(r=0,i=Math.round(t/Math.pow(2,-1074))));const a=[];for(o=52;o;o-=1)a.push(i%2?1:0),i=Math.floor(i/2);for(o=11;o;o-=1)a.push(r%2?1:0),r=Math.floor(r/2);a.push(n?1:0),a.reverse();const h=a.join("");let l="";for(o=0;o<64;o+=8){let t=parseInt(h.substr(o,8),2).toString(16);1===t.length&&(t="0"+t),l+=t}return l.toLowerCase()};const nf=new RegExp("^-?(0*)\\d{1,10}$"),rf=function(t){if(nf.test(t)){const e=Number(t);if(e>=-2147483648&&e<=2147483647)return e}return null},sf=function(t){try{t()}catch(et){setTimeout((()=>{const e=et.stack||"";throw Vd("Exception was thrown by user callback.",e),et}),Math.floor(0))}},of=function(t,e){const n=setTimeout(t,e);return"number"==typeof n&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"==typeof n&&n.unref&&n.unref(),n};class af{constructor(t,e){this.appName_=t,this.appCheckProvider=e,this.appCheck=null==e?void 0:e.getImmediate({optional:!0}),this.appCheck||null==e||e.get().then((t=>this.appCheck=t))}getToken(t){return this.appCheck?this.appCheck.getToken(t):new Promise(((e,n)=>{setTimeout((()=>{this.appCheck?this.getToken(t).then(e,n):e(null)}),0)}))}addTokenChangeListener(t){var e;null===(e=this.appCheckProvider)||void 0===e||e.get().then((e=>e.addTokenListener(t)))}notifyForInvalidToken(){Vd(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}class hf{constructor(t,e,n){this.appName_=t,this.firebaseOptions_=e,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit((t=>this.auth_=t))}getToken(t){return this.auth_?this.auth_.getToken(t)["catch"]((t=>t&&"auth/token-not-initialized"===t.code?(Gd("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t))):new Promise(((e,n)=>{setTimeout((()=>{this.auth_?this.getToken(t).then(e,n):e(null)}),0)}))}addTokenChangeListener(t){this.auth_?this.auth_.addAuthTokenListener(t):this.authProvider_.get().then((e=>e.addAuthTokenListener(t)))}removeTokenChangeListener(t){this.authProvider_.get().then((e=>e.removeAuthTokenListener(t)))}notifyForInvalidToken(){let t='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?t+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?t+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':t+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Vd(t)}}class lf{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}lf.OWNER="owner";const uf="5",cf=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,df="ac",ff="websocket",pf="long_polling";class mf{constructor(t,e,n,r,i=!1,s="",o=!1,a=!1){this.secure=e,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=a,this._host=t.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Od.get("host:"+t)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&Od.set("host:"+this._host,this.internalHost))}toString(){let t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t}toURLString(){const t=this.secure?"https://":"http://",e=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${t}${this.host}/${e}`}}function gf(t,e,n){let r;if(zu("string"==typeof e,"typeof type must == string"),zu("object"==typeof n,"typeof params must == object"),e===ff)r=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else{if(e!==pf)throw new Error("Unknown connection type: "+e);r=(t.secure?"https://":"http://")+t.internalHost+"/.lp?"}(function(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams})(t)&&(n.ns=t.namespace);const i=[];return tf(n,((t,e)=>{i.push(t+"="+e)})),r+i.join("&")}class _f{constructor(){this.counters_={}}incrementCounter(t,e=1){pc(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e}get(){return Qu(this.counters_)}}const yf={},vf={};function bf(t){const e=t.toString();return yf[e]||(yf[e]=new _f),yf[e]}class xf{constructor(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(t,e){for(this.pendingResponses[t]=e;this.pendingResponses[this.currentResponseNum];){const t=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let e=0;e<t.length;++e)t[e]&&sf((()=>{this.onMessage_(t[e])}));if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const Ef="start";class wf{constructor(t,e,n,r,i,s,o){this.connId=t,this.repoInfo=e,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Hd(t),this.stats_=bf(e),this.urlFn=t=>(this.appCheckToken&&(t[df]=this.appCheckToken),gf(e,pf,t))}open(t,e){this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new xf(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null}),Math.floor(3e4)),function(t){if(ac()||"complete"===document.readyState)t();else{let e=!1;const n=function(){document.body?e||(e=!0,t()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(()=>{"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}}((()=>{if(this.isClosed_)return;this.scriptTagHolder=new Tf(((...t)=>{const[e,n,r,i,s]=t;if(this.incrementIncomingBytes_(t),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,e===Ef)this.id=n,this.password=r;else{if("close"!==e)throw new Error("Unrecognized command received: "+e);n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,(()=>{this.onClosed_()}))):this.onClosed_()}}),((...t)=>{const[e,n]=t;this.incrementIncomingBytes_(t),this.myPacketOrderer.handleResponse(e,n)}),(()=>{this.onClosed_()}),this.urlFn);const t={};t[Ef]="t",t.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=this.scriptTagHolder.uniqueCallbackIdentifier),t.v=uf,this.transportSessionId&&(t.s=this.transportSessionId),this.lastSessionId&&(t.ls=this.lastSessionId),this.applicationId&&(t.p=this.applicationId),this.appCheckToken&&(t[df]=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&cf.test(location.hostname)&&(t.r="f");const e=this.urlFn(t);this.log_("Connecting via long-poll to "+e),this.scriptTagHolder.addTag(e,(()=>{}))}))}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){wf.forceAllow_=!0}static forceDisallow(){wf.forceDisallow_=!0}static isAvailable(){return!ac()&&(!!wf.forceAllow_||!(wf.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(t){const e=dc(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);const n=Yu(e),r=Jd(n,1840);for(let i=0;i<r.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[i]),this.curSegmentNum++}addDisconnectPingFrame(t,e){if(ac())return;this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=t,n.pw=e,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(t){const e=dc(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)}}class Tf{constructor(t,e,n,r){if(this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,ac())this.commandCB=t,this.onMessageCB=e;else{this.uniqueCallbackIdentifier=kd(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=e,this.myIFrame=Tf.createIFrame_();let n="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)){n='<script>document.domain="'+document.domain+'";<\/script>'}const r="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(r),this.myIFrame.doc.close()}catch(et){Gd("frame writing exception"),et.stack&&Gd(et.stack),Gd(et)}}}static createIFrame_(){const t=document.createElement("iframe");if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{t.contentWindow.document||Gd("No IE domain setting required")}catch(et){const n=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout((()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)}),Math.floor(0)));const t=this.onDisconnect;t&&(this.onDisconnect=null,t())}startLongPoll(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const t={};t.id=this.myID,t.pw=this.myPW,t.ser=this.currentSerial;let e=this.urlFn(t),n="",r=0;for(;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+n.length<=1870))break;{const t=this.pendingSegs.shift();n=n+"&seg"+r+"="+t.seg+"&ts"+r+"="+t.ts+"&d"+r+"="+t.d,r++}}return e+=n,this.addLongPollTag_(e,this.currentSerial),!0}return!1}enqueueSegment(t,e,n){this.pendingSegs.push({seg:t,ts:e,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(t,e){this.outstandingRequests.add(e);const n=()=>{this.outstandingRequests["delete"](e),this.newRequest_()},r=setTimeout(n,Math.floor(25e3));this.addTag(t,(()=>{clearTimeout(r),n()}))}addTag(t,e){ac()?this.doNodeLongPoll(t,e):setTimeout((()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=t,n.onload=n.onreadystatechange=function(){const t=n.readyState;t&&"loaded"!==t&&"complete"!==t||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),e())},n.onerror=()=>{Gd("Long-poll script failed to load: "+t),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(et){}}),Math.floor(1))}}let Sf=null;"undefined"!=typeof MozWebSocket?Sf=MozWebSocket:"undefined"!=typeof WebSocket&&(Sf=WebSocket);class Af{constructor(t,e,n,r,i,s,o){this.connId=t,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Hd(this.connId),this.stats_=bf(e),this.connURL=Af.connectionURL_(e,s,o,r,n),this.nodeAdmin=e.nodeAdmin}static connectionURL_(t,e,n,r,i){const s={};return s.v=uf,!ac()&&"undefined"!=typeof location&&location.hostname&&cf.test(location.hostname)&&(s.r="f"),e&&(s.s=e),n&&(s.ls=n),r&&(s[df]=r),i&&(s.p=i),gf(t,ff,s)}open(t,e){this.onDisconnect=e,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Od.set("previous_websocket_failure",!0);try{let t;if(ac()){const e=this.nodeAdmin?"AdminNode":"Node";t={headers:{"User-Agent":`Firebase/${uf}/${Cd}/${process.platform}/${e}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(t.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(t.headers["X-Firebase-AppCheck"]=this.appCheckToken);const n=process.env,r=0===this.connURL.indexOf("wss://")?n.HTTPS_PROXY||n.https_proxy:n.HTTP_PROXY||n.http_proxy;r&&(t.proxy={origin:r})}this.mySock=new Sf(this.connURL,[],t)}catch(et){this.log_("Error instantiating WebSocket.");const e=et.message||et.data;return e&&this.log_(e),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=t=>{this.handleIncomingFrame(t)},this.mySock.onerror=t=>{this.log_("WebSocket error.  Closing connection.");const e=t.message||t.data;e&&this.log_(e),this.onClosed_()}}start(){}static forceDisallow(){Af.forceDisallow_=!0}static isAvailable(){let t=!1;if("undefined"!=typeof navigator&&navigator.userAgent){const e=/Android ([0-9]{0,}\.[0-9]{0,})/,n=navigator.userAgent.match(e);n&&n.length>1&&parseFloat(n[1])<4.4&&(t=!0)}return!t&&null!==Sf&&!Af.forceDisallow_}static previouslyFailed(){return Od.isInMemoryStorage||!0===Od.get("previous_websocket_failure")}markConnectionHealthy(){Od.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const e=cc(t);this.onMessage(e)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(zu(null===this.frames,"We already have a frame buffer"),t.length<=6){const e=Number(t);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(null===this.mySock)return;const e=t.data;if(this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(e);else{const t=this.extractFrameCount_(e);null!==t&&this.appendFrame_(t)}}send(t){this.resetKeepAlive();const e=dc(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);const n=Jd(e,16384);n.length>1&&this.sendString_(String(n.length));for(let r=0;r<n.length;r++)this.sendString_(n[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()}),Math.floor(45e3))}sendString_(t){try{this.mySock.send(t)}catch(et){this.log_("Exception thrown from WebSocket.send():",et.message||et.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Af.responsesRequiredToBeHealthy=2,Af.healthyTimeout=3e4;class Cf{constructor(t){this.initTransports_(t)}static get ALL_TRANSPORTS(){return[wf,Af]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(t){const e=Af&&Af.isAvailable();let n=e&&!Af.previouslyFailed();if(t.webSocketOnly&&(e||Vd("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[Af];else{const t=this.transports_=[];for(const e of Cf.ALL_TRANSPORTS)e&&e.isAvailable()&&t.push(e);Cf.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Cf.globalTransportInitialized_=!1;class If{constructor(t,e,n,r,i,s,o,a,h,l){this.id=t,this.repoInfo_=e,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=a,this.onKill_=h,this.lastSessionId=l,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Hd("c:"+this.id+":"),this.transportManager_=new Cf(e),this.log_("Connection created"),this.start_()}start_(){const t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;const e=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((()=>{this.conn_&&this.conn_.open(e,n)}),Math.floor(0));const r=t.healthyTimeout||0;r>0&&(this.healthyTimeout_=of((()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))}),Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(t){return e=>{t===this.conn_?this.onConnectionLost_(e):t===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(t){return e=>{2!==this.state_&&(t===this.rx_?this.onPrimaryMessageReceived_(e):t===this.secondaryConn_?this.onSecondaryMessageReceived_(e):this.log_("message on old connection"))}}sendRequest(t){const e={t:"d",d:t};this.sendData_(e)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(t){if("t"in t){const e=t.t;"a"===e?this.upgradeIfSecondaryHealthy_():"r"===e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===e&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(t){const e=Qd("t",t),n=Qd("d",t);if("c"===e)this.onSecondaryControl_(n);else{if("d"!==e)throw new Error("Unknown protocol layer: "+e);this.pendingDataMessages.push(n)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(t){const e=Qd("t",t),n=Qd("d",t);"c"===e?this.onControl_(n):"d"===e&&this.onDataMessage_(n)}onDataMessage_(t){this.onPrimaryResponse_(),this.onMessage_(t)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(t){const e=Qd("t",t);if("d"in t){const n=t.d;if("h"===e){const t=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(t.h=this.repoInfo_.host),this.onHandshake_(t)}else if("n"===e){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let t=0;t<this.pendingDataMessages.length;++t)this.onDataMessage_(this.pendingDataMessages[t]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===e?this.onConnectionShutdown_(n):"r"===e?this.onReset_(n):"e"===e?zd("Server Error: "+n):"o"===e?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):zd("Unknown control packet command: "+e)}}onHandshake_(t){const e=t.ts,n=t.v,r=t.h;this.sessionId=t.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),uf!==n&&Vd("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)}startUpgrade_(t){this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;const e=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(e,n),of((()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())}),Math.floor(6e4))}onReset_(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.host=t,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(t,e){this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):of((()=>{this.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const t=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==t&&this.rx_!==t||this.close()}onConnectionLost_(t){this.conn_=null,t||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Od.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(t){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(t)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class Rf{put(t,e,n,r){}merge(t,e,n,r){}refreshAuthToken(t){}refreshAppCheckToken(t){}onDisconnectPut(t,e,n){}onDisconnectMerge(t,e,n){}onDisconnectCancel(t,e){}reportStats(t){}}class Pf{constructor(t){this.allowedEvents_=t,this.listeners_={},zu(Array.isArray(t)&&t.length>0,"Requires a non-empty array")}trigger(t,...e){if(Array.isArray(this.listeners_[t])){const n=[...this.listeners_[t]];for(let t=0;t<n.length;t++)n[t].callback.apply(n[t].context,e)}}on(t,e,n){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:n});const r=this.getInitialEvent(t);r&&e.apply(n,r)}off(t,e,n){this.validateEventType_(t);const r=this.listeners_[t]||[];for(let i=0;i<r.length;i++)if(r[i].callback===e&&(!n||n===r[i].context))return void r.splice(i,1)}validateEventType_(t){zu(this.allowedEvents_.find((e=>e===t)),"Unknown event: "+t)}}class Mf extends Pf{constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||"undefined"==typeof window.addEventListener||oc()||(window.addEventListener("online",(()=>{this.online_||(this.online_=!0,this.trigger("online",!0))}),!1),window.addEventListener("offline",(()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))}),!1))}static getInstance(){return new Mf}getInitialEvent(t){return zu("online"===t,"Unknown event type: "+t),[this.online_]}currentlyOnline(){return this.online_}}const Of=32,Df=768;class Nf{constructor(t,e){if(void 0===e){this.pieces_=t.split("/");let e=0;for(let t=0;t<this.pieces_.length;t++)this.pieces_[t].length>0&&(this.pieces_[e]=this.pieces_[t],e++);this.pieces_.length=e,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}toString(){let t="";for(let e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"}}function kf(){return new Nf("")}function Lf(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function Ff(t){return t.pieces_.length-t.pieceNum_}function Bf(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new Nf(t.pieces_,e)}function Uf(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function jf(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function Gf(t){if(t.pieceNum_>=t.pieces_.length)return null;const e=[];for(let n=t.pieceNum_;n<t.pieces_.length-1;n++)e.push(t.pieces_[n]);return new Nf(e,0)}function Hf(t,e){const n=[];for(let r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);if(e instanceof Nf)for(let r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);else{const t=e.split("/");for(let e=0;e<t.length;e++)t[e].length>0&&n.push(t[e])}return new Nf(n,0)}function zf(t){return t.pieceNum_>=t.pieces_.length}function Wf(t,e){const n=Lf(t),r=Lf(e);if(null===n)return e;if(n===r)return Wf(Bf(t),Bf(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function Vf(t,e){if(Ff(t)!==Ff(e))return!1;for(let n=t.pieceNum_,r=e.pieceNum_;n<=t.pieces_.length;n++,r++)if(t.pieces_[n]!==e.pieces_[r])return!1;return!0}function Xf(t,e){let n=t.pieceNum_,r=e.pieceNum_;if(Ff(t)>Ff(e))return!1;for(;n<t.pieces_.length;){if(t.pieces_[n]!==e.pieces_[r])return!1;++n,++r}return!0}class $f{constructor(t,e){this.errorPrefix_=e,this.parts_=jf(t,0),this.byteLength_=Math.max(1,this.parts_.length);for(let n=0;n<this.parts_.length;n++)this.byteLength_+=Ec(this.parts_[n]);Yf(this)}}function Yf(t){if(t.byteLength_>Df)throw new Error(t.errorPrefix_+"has a key path longer than "+Df+" bytes ("+t.byteLength_+").");if(t.parts_.length>Of)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Of+") or object contains a cycle "+qf(t))}function qf(t){return 0===t.parts_.length?"":"in property '"+t.parts_.join(".")+"'"}class Kf extends Pf{constructor(){let t,e;super(["visible"]),"undefined"!=typeof document&&"undefined"!=typeof document.addEventListener&&("undefined"!=typeof document.hidden?(e="visibilitychange",t="hidden"):"undefined"!=typeof document.mozHidden?(e="mozvisibilitychange",t="mozHidden"):"undefined"!=typeof document.msHidden?(e="msvisibilitychange",t="msHidden"):"undefined"!=typeof document.webkitHidden&&(e="webkitvisibilitychange",t="webkitHidden")),this.visible_=!0,e&&document.addEventListener(e,(()=>{const e=!document[t];e!==this.visible_&&(this.visible_=e,this.trigger("visible",e))}),!1)}static getInstance(){return new Kf}getInitialEvent(t){return zu("visible"===t,"Unknown event type: "+t),[this.visible_]}}const Qf=1e3;class Zf extends Rf{constructor(t,e,n,r,i,s,o,a){if(super(),this.repoInfo_=t,this.applicationId_=e,this.onDataUpdate_=n,this.onConnectStatus_=r,this.onServerInfoUpdate_=i,this.authTokenProvider_=s,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=Zf.nextPersistentConnectionId_++,this.log_=Hd("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Qf,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a&&!ac())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Kf.getInstance().on("visible",this.onVisible_,this),-1===t.host.indexOf("fblocal")&&Mf.getInstance().on("online",this.onOnline_,this)}sendRequest(t,e,n){const r=++this.requestNumber_,i={r:r,a:t,b:e};this.log_(dc(i)),zu(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)}get(t){this.initConnection_();const e=new ic,n={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:t=>{const n=t.d;"ok"===t.s?e.resolve(n):e.reject(n)}};this.outstandingGets_.push(n),this.outstandingGetCount_++;const r=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(r),e.promise}listen(t,e,n,r){this.initConnection_();const i=t._queryIdentifier,s=t._path.toString();this.log_("Listen called for "+s+" "+i),this.listens.has(s)||this.listens.set(s,new Map),zu(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),zu(!this.listens.get(s).has(i),"listen() called twice for same path/queryId.");const o={onComplete:r,hashFn:e,query:t,tag:n};this.listens.get(s).set(i,o),this.connected_&&this.sendListen_(o)}sendGet_(t){const e=this.outstandingGets_[t];this.sendRequest("g",e.request,(n=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),e.onComplete&&e.onComplete(n)}))}sendListen_(t){const e=t.query,n=e._path.toString(),r=e._queryIdentifier;this.log_("Listen on "+n+" for "+r);const i={p:n};t.tag&&(i.q=e._queryObject,i.t=t.tag),i.h=t.hashFn(),this.sendRequest("q",i,(i=>{const s=i.d,o=i.s;Zf.warnOnListenWarnings_(s,e);(this.listens.get(n)&&this.listens.get(n).get(r))===t&&(this.log_("listen response",i),"ok"!==o&&this.removeListen_(n,r),t.onComplete&&t.onComplete(o,s))}))}static warnOnListenWarnings_(t,e){if(t&&"object"==typeof t&&pc(t,"w")){const n=mc(t,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const t='".indexOn": "'+e._queryParams.getIndex().toString()+'"',n=e._path.toString();Vd(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${t} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(()=>{})),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&40===t.length||function(t){const e=fc(t).claims;return"object"==typeof e&&!0===e.admin}(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},(()=>{}))}tryAuth(){if(this.connected_&&this.authToken_){const t=this.authToken_,e=function(t){const e=fc(t).claims;return!!e&&"object"==typeof e&&e.hasOwnProperty("iat")}(t)?"auth":"gauth",n={cred:t};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(e,n,(e=>{const n=e.s,r=e.d||"error";this.authToken_===t&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,r))}))}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},(t=>{const e=t.s,n=t.d||"error";"ok"===e?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(e,n)}))}unlisten(t,e){const n=t._path.toString(),r=t._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),zu(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query");this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,t._queryObject,e)}sendUnlisten_(t,e,n,r){this.log_("Unlisten on "+t+" for "+e);const i={p:t};r&&(i.q=n,i.t=r),this.sendRequest("n",i)}onDisconnectPut(t,e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:e,onComplete:n})}onDisconnectMerge(t,e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:e,onComplete:n})}onDisconnectCancel(t,e){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,e):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:e})}sendOnDisconnect_(t,e,n,r){const i={p:e,d:n};this.log_("onDisconnect "+t,i),this.sendRequest(t,i,(t=>{r&&setTimeout((()=>{r(t.s,t.d)}),Math.floor(0))}))}put(t,e,n,r){this.putInternal("p",t,e,n,r)}merge(t,e,n,r){this.putInternal("m",t,e,n,r)}putInternal(t,e,n,r,i){this.initConnection_();const s={p:e,d:n};i!==undefined&&(s.h=i),this.outstandingPuts_.push({action:t,request:s,onComplete:r}),this.outstandingPutCount_++;const o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+e)}sendPut_(t){const e=this.outstandingPuts_[t].action,n=this.outstandingPuts_[t].request,r=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(e,n,(n=>{this.log_(e+" response",n),delete this.outstandingPuts_[t],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),r&&r(n.s,n.d)}))}reportStats(t){if(this.connected_){const e={c:t};this.log_("reportStats",e),this.sendRequest("s",e,(t=>{if("ok"!==t.s){const e=t.d;this.log_("reportStats","Error sending stats: "+e)}}))}}onDataMessage_(t){if("r"in t){this.log_("from server: "+dc(t));const e=t.r,n=this.requestCBHash_[e];n&&(delete this.requestCBHash_[e],n(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,e){this.log_("handleServerMessage",t,e),"d"===t?this.onDataUpdate_(e.p,e.d,!1,e.t):"m"===t?this.onDataUpdate_(e.p,e.d,!0,e.t):"c"===t?this.onListenRevoked_(e.p,e.q):"ac"===t?this.onAuthRevoked_(e.s,e.d):"apc"===t?this.onAppCheckRevoked_(e.s,e.d):"sd"===t?this.onSecurityDebugPacket_(e):zd("Unrecognized action received from server: "+dc(t)+"\nAre you using the latest client?")}onReady_(t,e){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=e,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){zu(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((()=>{this.establishConnectionTimer_=null,this.establishConnection_()}),Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Qf,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=Qf,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=Qf),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();const t=(new Date).getTime()-this.lastConnectionAttemptTime_;let e=Math.max(0,this.reconnectDelay_-t);e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;const t=this.onDataMessage_.bind(this),e=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+Zf.nextConnectionId_++,i=this.lastSessionId;let s=!1,o=null;const a=function(){o?o.close():(s=!0,n())},h=function(t){zu(o,"sendRequest call when we're not connected not allowed."),o.sendRequest(t)};this.realtime_={close:a,sendRequest:h};const l=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[a,h]=await Promise.all([this.authTokenProvider_.getToken(l),this.appCheckTokenProvider_.getToken(l)]);s?Gd("getToken() completed but was canceled"):(Gd("getToken() completed. Creating connection."),this.authToken_=a&&a.accessToken,this.appCheckToken_=h&&h.token,o=new If(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,e,n,(t=>{Vd(t+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")}),i))}catch(zd){this.log_("Failed to get token: "+zd),s||(this.repoInfo_.nodeAdmin&&Vd(zd),a())}}}interrupt(t){Gd("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){Gd("Resuming connection for reason: "+t),delete this.interruptReasons_[t],gc(this.interruptReasons_)&&(this.reconnectDelay_=Qf,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){const e=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:e})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){const e=this.outstandingPuts_[t];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(t,e){let n;n=e?e.map((t=>Zd(t))).join("$"):"default";const r=this.removeListen_(t,n);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(t,e){const n=new Nf(t).toString();let r;if(this.listens.has(n)){const t=this.listens.get(n);r=t.get(e),t["delete"](e),0===t.size&&this.listens["delete"](n)}else r=undefined;return r}onAuthRevoked_(t,e){Gd("Auth token revoked: "+t+"/"+e),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,e){Gd("App check token revoked: "+t+"/"+e),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_&&this.securityDebugCallback_(t)}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const t of this.listens.values())for(const e of t.values())this.sendListen_(e);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){const t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){const t={};let e="js";ac()&&(e=this.repoInfo_.nodeAdmin?"admin_node":"node"),t["sdk."+e+"."+Cd.replace(/\./g,"-")]=1,oc()?t["framework.cordova"]=1:"object"==typeof navigator&&"ReactNative"===navigator.product&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){const t=Mf.getInstance().currentlyOnline();return gc(this.interruptReasons_)&&t}}Zf.nextPersistentConnectionId_=0,Zf.nextConnectionId_=0;class Jf{constructor(t,e){this.name=t,this.node=e}static Wrap(t,e){return new Jf(t,e)}}class tp{getCompare(){return this.compare.bind(this)}indexedValueChanged(t,e){const n=new Jf($d,t),r=new Jf($d,e);return 0!==this.compare(n,r)}minPost(){return Jf.MIN}}let ep;class np extends tp{static get __EMPTY_NODE(){return ep}static set __EMPTY_NODE(t){ep=t}compare(t,e){return qd(t.name,e.name)}isDefinedOn(t){throw Wu("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(t,e){return!1}minPost(){return Jf.MIN}maxPost(){return new Jf(Yd,ep)}makePost(t,e){return zu("string"==typeof t,"KeyIndex indexValue must always be a string."),new Jf(t,ep)}toString(){return".key"}}const rp=new np;class ip{constructor(t,e,n,r,i=null){this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];let s=1;for(;!t.isEmpty();)if(s=e?n(t.key,e):1,r&&(s*=-1),s<0)t=this.isReverse_?t.left:t.right;else{if(0===s){this.nodeStack_.push(t);break}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left}}getNext(){if(0===this.nodeStack_.length)return null;let t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}}}class sp{constructor(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:sp.RED,this.left=null!=r?r:op.EMPTY_NODE,this.right=null!=i?i:op.EMPTY_NODE}copy(t,e,n,r,i){return new sp(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let r=this;const i=n(t,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return op.EMPTY_NODE;let t=this;return t.left.isRed_()||t.left.left.isRed_()||(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,e){let n,r;if(n=this,e(t,n.key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(t,e),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===e(t,n.key)){if(n.right.isEmpty())return op.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(t,e))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){const t=this.copy(null,null,sp.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){const t=this.copy(null,null,sp.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth_(){const t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}sp.RED=!0,sp.BLACK=!1;class op{constructor(t,e=op.EMPTY_NODE){this.comparator_=t,this.root_=e}insert(t,e){return new op(this.comparator_,this.root_.insert(t,e,this.comparator_).copy(null,null,sp.BLACK,null,null))}remove(t){return new op(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,sp.BLACK,null,null))}get(t){let e,n=this.root_;for(;!n.isEmpty();){if(e=this.comparator_(t,n.key),0===e)return n.value;e<0?n=n.left:e>0&&(n=n.right)}return null}getPredecessorKey(t){let e,n=this.root_,r=null;for(;!n.isEmpty();){if(e=this.comparator_(t,n.key),0===e){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}e<0?n=n.left:e>0&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(t){return this.root_.inorderTraversal(t)}reverseTraversal(t){return this.root_.reverseTraversal(t)}getIterator(t){return new ip(this.root_,null,this.comparator_,!1,t)}getIteratorFrom(t,e){return new ip(this.root_,t,this.comparator_,!1,e)}getReverseIteratorFrom(t,e){return new ip(this.root_,t,this.comparator_,!0,e)}getReverseIterator(t){return new ip(this.root_,null,this.comparator_,!0,t)}}function ap(t,e){return qd(t.name,e.name)}function hp(t,e){return qd(t,e)}let lp;op.EMPTY_NODE=new class{copy(t,e,n,r,i){return this}insert(t,e,n){return new sp(t,e,null)}remove(t,e){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const up=function(t){return"number"==typeof t?"number:"+ef(t):"string:"+t},cp=function(t){if(t.isLeafNode()){const e=t.val();zu("string"==typeof e||"number"==typeof e||"object"==typeof e&&pc(e,".sv"),"Priority must be a string or number.")}else zu(t===lp||t.isEmpty(),"priority of unexpected type.");zu(t===lp||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let dp,fp,pp;class mp{constructor(t,e=mp.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=e,this.lazyHash_=null,zu(this.value_!==undefined&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),cp(this.priorityNode_)}static set __childrenNodeConstructor(t){dp=t}static get __childrenNodeConstructor(){return dp}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new mp(this.value_,t)}getImmediateChild(t){return".priority"===t?this.priorityNode_:mp.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return zf(t)?this:".priority"===Lf(t)?this.priorityNode_:mp.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,e){return null}updateImmediateChild(t,e){return".priority"===t?this.updatePriority(e):e.isEmpty()&&".priority"!==t?this:mp.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,e).updatePriority(this.priorityNode_)}updateChild(t,e){const n=Lf(t);return null===n?e:e.isEmpty()&&".priority"!==n?this:(zu(".priority"!==n||1===Ff(t),".priority must be the last token in a path"),this.updateImmediateChild(n,mp.__childrenNodeConstructor.EMPTY_NODE.updateChild(Bf(t),e)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,e){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+up(this.priorityNode_.val())+":");const e=typeof this.value_;t+=e+":",t+="number"===e?ef(this.value_):this.value_,this.lazyHash_=Ld(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===mp.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof mp.__childrenNodeConstructor?-1:(zu(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){const e=typeof t.value_,n=typeof this.value_,r=mp.VALUE_TYPE_ORDER.indexOf(e),i=mp.VALUE_TYPE_ORDER.indexOf(n);return zu(r>=0,"Unknown leaf type: "+e),zu(i>=0,"Unknown leaf type: "+n),r===i?"object"===n?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:i-r}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){const e=t;return this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}return!1}}mp.VALUE_TYPE_ORDER=["object","boolean","number","string"];const gp=new class extends tp{compare(t,e){const n=t.node.getPriority(),r=e.node.getPriority(),i=n.compareTo(r);return 0===i?qd(t.name,e.name):i}isDefinedOn(t){return!t.getPriority().isEmpty()}indexedValueChanged(t,e){return!t.getPriority().equals(e.getPriority())}minPost(){return Jf.MIN}maxPost(){return new Jf(Yd,new mp("[PRIORITY-POST]",pp))}makePost(t,e){const n=fp(t);return new Jf(e,new mp("[PRIORITY-POST]",n))}toString(){return".priority"}},_p=Math.log(2);class yp{constructor(t){var e;this.count=(e=t+1,parseInt(Math.log(e)/_p,10)),this.current_=this.count-1;const n=(r=this.count,parseInt(Array(r+1).join("1"),2));var r;this.bits_=t+1&n}nextBitIsOne(){const t=!(this.bits_&1<<this.current_);return this.current_--,t}}const vp=function(t,e,n,r){t.sort(e);const i=function(e,r){const s=r-e;let o,a;if(0===s)return null;if(1===s)return o=t[e],a=n?n(o):o,new sp(a,o.node,sp.BLACK,null,null);{const h=parseInt(s/2,10)+e,l=i(e,h),u=i(h+1,r);return o=t[h],a=n?n(o):o,new sp(a,o.node,sp.BLACK,l,u)}},s=function(e){let r=null,s=null,o=t.length;const a=function(e,r){const s=o-e,a=o;o-=e;const l=i(s+1,a),u=t[s],c=n?n(u):u;h(new sp(c,u.node,r,null,l))},h=function(t){r?(r.left=t,r=t):(s=t,r=t)};for(let t=0;t<e.count;++t){const n=e.nextBitIsOne(),r=Math.pow(2,e.count-(t+1));n?a(r,sp.BLACK):(a(r,sp.BLACK),a(r,sp.RED))}return s}(new yp(t.length));return new op(r||e,s)};let bp;const xp={};class Ep{constructor(t,e){this.indexes_=t,this.indexSet_=e}static get Default(){return zu(xp&&gp,"ChildrenNode.ts has not been loaded"),bp=bp||new Ep({".priority":xp},{".priority":gp}),bp}get(t){const e=mc(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e instanceof op?e:null}hasIndex(t){return pc(this.indexSet_,t.toString())}addIndex(t,e){zu(t!==rp,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let r=!1;const i=e.getIterator(Jf.Wrap);let s,o=i.getNext();for(;o;)r=r||t.isDefinedOn(o.node),n.push(o),o=i.getNext();s=r?vp(n,t.getCompare()):xp;const a=t.toString(),h=Object.assign({},this.indexSet_);h[a]=t;const l=Object.assign({},this.indexes_);return l[a]=s,new Ep(l,h)}addToIndexes(t,e){const n=_c(this.indexes_,((n,r)=>{const i=mc(this.indexSet_,r);if(zu(i,"Missing index implementation for "+r),n===xp){if(i.isDefinedOn(t.node)){const n=[],r=e.getIterator(Jf.Wrap);let s=r.getNext();for(;s;)s.name!==t.name&&n.push(s),s=r.getNext();return n.push(t),vp(n,i.getCompare())}return xp}{const r=e.get(t.name);let i=n;return r&&(i=i.remove(new Jf(t.name,r))),i.insert(t,t.node)}}));return new Ep(n,this.indexSet_)}removeFromIndexes(t,e){const n=_c(this.indexes_,(n=>{if(n===xp)return n;{const r=e.get(t.name);return r?n.remove(new Jf(t.name,r)):n}}));return new Ep(n,this.indexSet_)}}let wp;class Tp{constructor(t,e,n){this.children_=t,this.priorityNode_=e,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&cp(this.priorityNode_),this.children_.isEmpty()&&zu(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return wp||(wp=new Tp(new op(hp),null,Ep.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||wp}updatePriority(t){return this.children_.isEmpty()?this:new Tp(this.children_,t,this.indexMap_)}getImmediateChild(t){if(".priority"===t)return this.getPriority();{const e=this.children_.get(t);return null===e?wp:e}}getChild(t){const e=Lf(t);return null===e?this:this.getImmediateChild(e).getChild(Bf(t))}hasChild(t){return null!==this.children_.get(t)}updateImmediateChild(t,e){if(zu(e,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(e);{const n=new Jf(t,e);let r,i;e.isEmpty()?(r=this.children_.remove(t),i=this.indexMap_.removeFromIndexes(n,this.children_)):(r=this.children_.insert(t,e),i=this.indexMap_.addToIndexes(n,this.children_));const s=r.isEmpty()?wp:this.priorityNode_;return new Tp(r,s,i)}}updateChild(t,e){const n=Lf(t);if(null===n)return e;{zu(".priority"!==Lf(t)||1===Ff(t),".priority must be the last token in a path");const r=this.getImmediateChild(n).updateChild(Bf(t),e);return this.updateImmediateChild(n,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;const e={};let n=0,r=0,i=!0;if(this.forEachChild(gp,((s,o)=>{e[s]=o.val(t),n++,i&&Tp.INTEGER_REGEXP_.test(s)?r=Math.max(r,Number(s)):i=!1})),!t&&i&&r<2*n){const t=[];for(const n in e)t[n]=e[n];return t}return t&&!this.getPriority().isEmpty()&&(e[".priority"]=this.getPriority().val()),e}hash(){if(null===this.lazyHash_){let t="";this.getPriority().isEmpty()||(t+="priority:"+up(this.getPriority().val())+":"),this.forEachChild(gp,((e,n)=>{const r=n.hash();""!==r&&(t+=":"+e+":"+r)})),this.lazyHash_=""===t?"":Ld(t)}return this.lazyHash_}getPredecessorChildName(t,e,n){const r=this.resolveIndex_(n);if(r){const n=r.getPredecessorKey(new Jf(t,e));return n?n.name:null}return this.children_.getPredecessorKey(t)}getFirstChildName(t){const e=this.resolveIndex_(t);if(e){const t=e.minKey();return t&&t.name}return this.children_.minKey()}getFirstChild(t){const e=this.getFirstChildName(t);return e?new Jf(e,this.children_.get(e)):null}getLastChildName(t){const e=this.resolveIndex_(t);if(e){const t=e.maxKey();return t&&t.name}return this.children_.maxKey()}getLastChild(t){const e=this.getLastChildName(t);return e?new Jf(e,this.children_.get(e)):null}forEachChild(t,e){const n=this.resolveIndex_(t);return n?n.inorderTraversal((t=>e(t.name,t.node))):this.children_.inorderTraversal(e)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,e){const n=this.resolveIndex_(e);if(n)return n.getIteratorFrom(t,(t=>t));{const n=this.children_.getIteratorFrom(t.name,Jf.Wrap);let r=n.peek();for(;null!=r&&e.compare(r,t)<0;)n.getNext(),r=n.peek();return n}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,e){const n=this.resolveIndex_(e);if(n)return n.getReverseIteratorFrom(t,(t=>t));{const n=this.children_.getReverseIteratorFrom(t.name,Jf.Wrap);let r=n.peek();for(;null!=r&&e.compare(r,t)>0;)n.getNext(),r=n.peek();return n}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===Sp?-1:0}withIndex(t){if(t===rp||this.indexMap_.hasIndex(t))return this;{const e=this.indexMap_.addIndex(t,this.children_);return new Tp(this.children_,this.priorityNode_,e)}}isIndexed(t){return t===rp||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{const e=t;if(this.getPriority().equals(e.getPriority())){if(this.children_.count()===e.children_.count()){const t=this.getIterator(gp),n=e.getIterator(gp);let r=t.getNext(),i=n.getNext();for(;r&&i;){if(r.name!==i.name||!r.node.equals(i.node))return!1;r=t.getNext(),i=n.getNext()}return null===r&&null===i}return!1}return!1}}resolveIndex_(t){return t===rp?null:this.indexMap_.get(t.toString())}}Tp.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;const Sp=new class extends Tp{constructor(){super(new op(hp),Tp.EMPTY_NODE,Ep.Default)}compareTo(t){return t===this?0:1}equals(t){return t===this}getPriority(){return this}getImmediateChild(t){return Tp.EMPTY_NODE}isEmpty(){return!1}};Object.defineProperties(Jf,{MIN:{value:new Jf($d,Tp.EMPTY_NODE)},MAX:{value:new Jf(Yd,Sp)}}),np.__EMPTY_NODE=Tp.EMPTY_NODE,mp.__childrenNodeConstructor=Tp,lp=Sp,function(t){pp=t}(Sp);const Ap=!0;function Cp(t,e=null){if(null===t)return Tp.EMPTY_NODE;if("object"==typeof t&&".priority"in t&&(e=t[".priority"]),zu(null===e||"string"==typeof e||"number"==typeof e||"object"==typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"==typeof t&&".value"in t&&null!==t[".value"]&&(t=t[".value"]),"object"!=typeof t||".sv"in t){return new mp(t,Cp(e))}if(t instanceof Array||!Ap){let n=Tp.EMPTY_NODE;return tf(t,((e,r)=>{if(pc(t,e)&&"."!==e.substring(0,1)){const t=Cp(r);!t.isLeafNode()&&t.isEmpty()||(n=n.updateImmediateChild(e,t))}})),n.updatePriority(Cp(e))}{const n=[];let r=!1;if(tf(t,((t,e)=>{if("."!==t.substring(0,1)){const i=Cp(e);i.isEmpty()||(r=r||!i.getPriority().isEmpty(),n.push(new Jf(t,i)))}})),0===n.length)return Tp.EMPTY_NODE;const i=vp(n,ap,(t=>t.name),hp);if(r){const t=vp(n,gp.getCompare());return new Tp(i,Cp(e),new Ep({".priority":t},{".priority":gp}))}return new Tp(i,Cp(e),Ep.Default)}}!function(t){fp=t}(Cp);class Ip extends tp{constructor(t){super(),this.indexPath_=t,zu(!zf(t)&&".priority"!==Lf(t),"Can't create PathIndex with empty path or .priority key")}extractChild(t){return t.getChild(this.indexPath_)}isDefinedOn(t){return!t.getChild(this.indexPath_).isEmpty()}compare(t,e){const n=this.extractChild(t.node),r=this.extractChild(e.node),i=n.compareTo(r);return 0===i?qd(t.name,e.name):i}makePost(t,e){const n=Cp(t),r=Tp.EMPTY_NODE.updateChild(this.indexPath_,n);return new Jf(e,r)}maxPost(){const t=Tp.EMPTY_NODE.updateChild(this.indexPath_,Sp);return new Jf(Yd,t)}toString(){return jf(this.indexPath_,0).join("/")}}const Rp=new class extends tp{compare(t,e){const n=t.node.compareTo(e.node);return 0===n?qd(t.name,e.name):n}isDefinedOn(t){return!0}indexedValueChanged(t,e){return!t.equals(e)}minPost(){return Jf.MIN}maxPost(){return Jf.MAX}makePost(t,e){const n=Cp(t);return new Jf(e,n)}toString(){return".value"}};function Pp(t){return{type:"value",snapshotNode:t}}function Mp(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function Op(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function Dp(t,e,n){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:n}}class Np{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=gp}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return zu(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return zu(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:$d}hasEnd(){return this.endSet_}getIndexEndValue(){return zu(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return zu(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Yd}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return zu(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===gp}copy(){const t=new Np;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.startAfterSet_=this.startAfterSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.endBeforeSet_=this.endBeforeSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t}}function kp(t){const e={};if(t.isDefault())return e;let n;if(t.index_===gp?n="$priority":t.index_===Rp?n="$value":t.index_===rp?n="$key":(zu(t.index_ instanceof Ip,"Unrecognized index type!"),n=t.index_.toString()),e.orderBy=dc(n),t.startSet_){const n=t.startAfterSet_?"startAfter":"startAt";e[n]=dc(t.indexStartValue_),t.startNameSet_&&(e[n]+=","+dc(t.indexStartName_))}if(t.endSet_){const n=t.endBeforeSet_?"endBefore":"endAt";e[n]=dc(t.indexEndValue_),t.endNameSet_&&(e[n]+=","+dc(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?e.limitToFirst=t.limit_:e.limitToLast=t.limit_),e}function Lp(t){const e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_),e.sin=!t.startAfterSet_),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_),e.ein=!t.endBeforeSet_),t.limitSet_){e.l=t.limit_;let n=t.viewFrom_;""===n&&(n=t.isViewFromLeft()?"l":"r"),e.vf=n}return t.index_!==gp&&(e.i=t.index_.toString()),e}class Fp extends Rf{constructor(t,e,n,r){super(),this.repoInfo_=t,this.onDataUpdate_=e,this.authTokenProvider_=n,this.appCheckTokenProvider_=r,this.log_=Hd("p:rest:"),this.listens_={}}reportStats(t){throw new Error("Method not implemented.")}static getListenId_(t,e){return e!==undefined?"tag$"+e:(zu(t._queryParams.isDefault(),"should have a tag if it's not a default query."),t._path.toString())}listen(t,e,n,r){const i=t._path.toString();this.log_("Listen called for "+i+" "+t._queryIdentifier);const s=Fp.getListenId_(t,n),o={};this.listens_[s]=o;const a=kp(t._queryParams);this.restRequest_(i+".json",a,((t,e)=>{let a=e;if(404===t&&(a=null,t=null),null===t&&this.onDataUpdate_(i,a,!1,n),mc(this.listens_,s)===o){let e;e=t?401===t?"permission_denied":"rest_error:"+t:"ok",r(e,null)}}))}unlisten(t,e){const n=Fp.getListenId_(t,e);delete this.listens_[n]}get(t){const e=kp(t._queryParams),n=t._path.toString(),r=new ic;return this.restRequest_(n+".json",e,((t,e)=>{let i=e;404===t&&(i=null,t=null),null===t?(this.onDataUpdate_(n,i,!1,null),r.resolve(i)):r.reject(new Error(i))})),r.promise}refreshAuthToken(t){}restRequest_(t,e={},n){return e.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then((([r,i])=>{r&&r.accessToken&&(e.auth=r.accessToken),i&&i.token&&(e.ac=i.token);const s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+t+"?ns="+this.repoInfo_.namespace+function(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach((t=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(t))})):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}(e);this.log_("Sending REST request for "+s);const o=new XMLHttpRequest;o.onreadystatechange=()=>{if(n&&4===o.readyState){this.log_("REST Response for "+s+" received. status:",o.status,"response:",o.responseText);let t=null;if(o.status>=200&&o.status<300){try{t=cc(o.responseText)}catch(et){Vd("Failed to parse JSON response for "+s+": "+o.responseText)}n(null,t)}else 401!==o.status&&404!==o.status&&Vd("Got unsuccessful REST response for "+s+" Status: "+o.status),n(o.status);n=null}},o.open("GET",s,!0),o.send()}))}}class Bp{constructor(){this.rootNode_=Tp.EMPTY_NODE}getNode(t){return this.rootNode_.getChild(t)}updateSnapshot(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)}}function Up(){return{value:null,children:new Map}}function jp(t,e,n){if(zf(e))t.value=n,t.children.clear();else if(null!==t.value)t.value=t.value.updateChild(e,n);else{const r=Lf(e);t.children.has(r)||t.children.set(r,Up());jp(t.children.get(r),e=Bf(e),n)}}function Gp(t,e,n){null!==t.value?n(e,t.value):function(t,e){t.children.forEach(((t,n)=>{e(n,t)}))}(t,((t,r)=>{Gp(r,new Nf(e.toString()+"/"+t),n)}))}class Hp{constructor(t){this.collection_=t,this.last_=null}get(){const t=this.collection_.get(),e=Object.assign({},t);return this.last_&&tf(this.last_,((t,n)=>{e[t]=e[t]-n})),this.last_=t,e}}class zp{constructor(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new Hp(t);const n=1e4+2e4*Math.random();of(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const t=this.statsListener_.get(),e={};let n=!1;tf(t,((t,r)=>{r>0&&pc(this.statsToReport_,t)&&(e[t]=r,n=!0)})),n&&this.server_.reportStats(e),of(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var Wp;function Vp(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}!function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(Wp||(Wp={}));class Xp{constructor(t,e,n){this.path=t,this.affectedTree=e,this.revert=n,this.type=Wp.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(t){if(zf(this.path)){if(null!=this.affectedTree.value)return zu(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const e=this.affectedTree.subtree(new Nf(t));return new Xp(kf(),e,this.revert)}}return zu(Lf(this.path)===t,"operationForChild called for unrelated child."),new Xp(Bf(this.path),this.affectedTree,this.revert)}}class $p{constructor(t,e,n){this.source=t,this.path=e,this.snap=n,this.type=Wp.OVERWRITE}operationForChild(t){return zf(this.path)?new $p(this.source,kf(),this.snap.getImmediateChild(t)):new $p(this.source,Bf(this.path),this.snap)}}class Yp{constructor(t,e,n){this.source=t,this.path=e,this.children=n,this.type=Wp.MERGE}operationForChild(t){if(zf(this.path)){const e=this.children.subtree(new Nf(t));return e.isEmpty()?null:e.value?new $p(this.source,kf(),e.value):new Yp(this.source,kf(),e)}return zu(Lf(this.path)===t,"Can't get a merge for a child not on the path of the operation"),new Yp(this.source,Bf(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class qp{constructor(t,e,n){this.node_=t,this.fullyInitialized_=e,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(t){if(zf(t))return this.isFullyInitialized()&&!this.filtered_;const e=Lf(t);return this.isCompleteForChild(e)}isCompleteForChild(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)}getNode(){return this.node_}}function Kp(t,e,n,r,i,s){const o=r.filter((t=>t.type===n));o.sort(((e,n)=>function(t,e,n){if(null==e.childName||null==n.childName)throw Wu("Should only compare child_ events.");const r=new Jf(e.childName,e.snapshotNode),i=new Jf(n.childName,n.snapshotNode);return t.index_.compare(r,i)}(t,e,n))),o.forEach((n=>{const r=function(t,e,n){return"value"===e.type||"child_removed"===e.type||(e.prevName=n.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}(t,n,s);i.forEach((i=>{i.respondsTo(n.type)&&e.push(i.createEvent(r,t.query_))}))}))}function Qp(t,e){return{eventCache:t,serverCache:e}}function Zp(t,e,n,r){return Qp(new qp(e,n,r),t.serverCache)}function Jp(t,e,n,r){return Qp(t.eventCache,new qp(e,n,r))}function tm(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function em(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}let nm;class rm{constructor(t,e=(()=>(nm||(nm=new op(Kd)),nm))()){this.value=t,this.children=e}static fromObject(t){let e=new rm(null);return tf(t,((t,n)=>{e=e.set(new Nf(t),n)})),e}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(t,e){if(null!=this.value&&e(this.value))return{path:kf(),value:this.value};if(zf(t))return null;{const n=Lf(t),r=this.children.get(n);if(null!==r){const i=r.findRootMostMatchingPathAndValue(Bf(t),e);if(null!=i){return{path:Hf(new Nf(n),i.path),value:i.value}}return null}return null}}findRootMostValueAndPath(t){return this.findRootMostMatchingPathAndValue(t,(()=>!0))}subtree(t){if(zf(t))return this;{const e=Lf(t),n=this.children.get(e);return null!==n?n.subtree(Bf(t)):new rm(null)}}set(t,e){if(zf(t))return new rm(e,this.children);{const n=Lf(t),r=(this.children.get(n)||new rm(null)).set(Bf(t),e),i=this.children.insert(n,r);return new rm(this.value,i)}}remove(t){if(zf(t))return this.children.isEmpty()?new rm(null):new rm(null,this.children);{const e=Lf(t),n=this.children.get(e);if(n){const r=n.remove(Bf(t));let i;return i=r.isEmpty()?this.children.remove(e):this.children.insert(e,r),null===this.value&&i.isEmpty()?new rm(null):new rm(this.value,i)}return this}}get(t){if(zf(t))return this.value;{const e=Lf(t),n=this.children.get(e);return n?n.get(Bf(t)):null}}setTree(t,e){if(zf(t))return e;{const n=Lf(t),r=(this.children.get(n)||new rm(null)).setTree(Bf(t),e);let i;return i=r.isEmpty()?this.children.remove(n):this.children.insert(n,r),new rm(this.value,i)}}fold(t){return this.fold_(kf(),t)}fold_(t,e){const n={};return this.children.inorderTraversal(((r,i)=>{n[r]=i.fold_(Hf(t,r),e)})),e(t,this.value,n)}findOnPath(t,e){return this.findOnPath_(t,kf(),e)}findOnPath_(t,e,n){const r=!!this.value&&n(e,this.value);if(r)return r;if(zf(t))return null;{const r=Lf(t),i=this.children.get(r);return i?i.findOnPath_(Bf(t),Hf(e,r),n):null}}foreachOnPath(t,e){return this.foreachOnPath_(t,kf(),e)}foreachOnPath_(t,e,n){if(zf(t))return this;{this.value&&n(e,this.value);const r=Lf(t),i=this.children.get(r);return i?i.foreachOnPath_(Bf(t),Hf(e,r),n):new rm(null)}}foreach(t){this.foreach_(kf(),t)}foreach_(t,e){this.children.inorderTraversal(((n,r)=>{r.foreach_(Hf(t,n),e)})),this.value&&e(t,this.value)}foreachChild(t){this.children.inorderTraversal(((e,n)=>{n.value&&t(e,n.value)}))}}class im{constructor(t){this.writeTree_=t}static empty(){return new im(new rm(null))}}function sm(t,e,n){if(zf(e))return new im(new rm(n));{const r=t.writeTree_.findRootMostValueAndPath(e);if(null!=r){const i=r.path;let s=r.value;const o=Wf(i,e);return s=s.updateChild(o,n),new im(t.writeTree_.set(i,s))}{const r=new rm(n),i=t.writeTree_.setTree(e,r);return new im(i)}}}function om(t,e,n){let r=t;return tf(n,((t,n)=>{r=sm(r,Hf(e,t),n)})),r}function am(t,e){if(zf(e))return im.empty();{const n=t.writeTree_.setTree(e,new rm(null));return new im(n)}}function hm(t,e){return null!=lm(t,e)}function lm(t,e){const n=t.writeTree_.findRootMostValueAndPath(e);return null!=n?t.writeTree_.get(n.path).getChild(Wf(n.path,e)):null}function um(t){const e=[],n=t.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(gp,((t,n)=>{e.push(new Jf(t,n))})):t.writeTree_.children.inorderTraversal(((t,n)=>{null!=n.value&&e.push(new Jf(t,n.value))})),e}function cm(t,e){if(zf(e))return t;{const n=lm(t,e);return new im(null!=n?new rm(n):t.writeTree_.subtree(e))}}function dm(t){return t.writeTree_.isEmpty()}function fm(t,e){return pm(kf(),t.writeTree_,e)}function pm(t,e,n){if(null!=e.value)return n.updateChild(t,e.value);{let r=null;return e.children.inorderTraversal(((e,i)=>{".priority"===e?(zu(null!==i.value,"Priority writes must always be leaf nodes"),r=i.value):n=pm(Hf(t,e),i,n)})),n.getChild(t).isEmpty()||null===r||(n=n.updateChild(Hf(t,".priority"),r)),n}}function mm(t,e){return Im(e,t)}function gm(t,e){const n=t.allWrites.findIndex((t=>t.writeId===e));zu(n>=0,"removeWrite called with nonexistent writeId.");const r=t.allWrites[n];t.allWrites.splice(n,1);let i=r.visible,s=!1,o=t.allWrites.length-1;for(;i&&o>=0;){const e=t.allWrites[o];e.visible&&(o>=n&&_m(e,r.path)?i=!1:Xf(r.path,e.path)&&(s=!0)),o--}if(i){if(s)return function(t){t.visibleWrites=vm(t.allWrites,ym,kf()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}(t),!0;if(r.snap)t.visibleWrites=am(t.visibleWrites,r.path);else{tf(r.children,(e=>{t.visibleWrites=am(t.visibleWrites,Hf(r.path,e))}))}return!0}return!1}function _m(t,e){if(t.snap)return Xf(t.path,e);for(const n in t.children)if(t.children.hasOwnProperty(n)&&Xf(Hf(t.path,n),e))return!0;return!1}function ym(t){return t.visible}function vm(t,e,n){let r=im.empty();for(let i=0;i<t.length;++i){const s=t[i];if(e(s)){const t=s.path;let e;if(s.snap)Xf(n,t)?(e=Wf(n,t),r=sm(r,e,s.snap)):Xf(t,n)&&(e=Wf(t,n),r=sm(r,kf(),s.snap.getChild(e)));else{if(!s.children)throw Wu("WriteRecord should have .snap or .children");if(Xf(n,t))e=Wf(n,t),r=om(r,e,s.children);else if(Xf(t,n))if(e=Wf(t,n),zf(e))r=om(r,kf(),s.children);else{const t=mc(s.children,Lf(e));if(t){const n=t.getChild(Bf(e));r=sm(r,kf(),n)}}}}}return r}function bm(t,e,n,r,i){if(r||i){const s=cm(t.visibleWrites,e);if(!i&&dm(s))return n;if(i||null!=n||hm(s,kf())){const s=function(t){return(t.visible||i)&&(!r||!~r.indexOf(t.writeId))&&(Xf(t.path,e)||Xf(e,t.path))};return fm(vm(t.allWrites,s,e),n||Tp.EMPTY_NODE)}return null}{const r=lm(t.visibleWrites,e);if(null!=r)return r;{const r=cm(t.visibleWrites,e);if(dm(r))return n;if(null!=n||hm(r,kf())){return fm(r,n||Tp.EMPTY_NODE)}return null}}}function xm(t,e,n,r){return bm(t.writeTree,t.treePath,e,n,r)}function Em(t,e){return function(t,e,n){let r=Tp.EMPTY_NODE;const i=lm(t.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(gp,((t,e)=>{r=r.updateImmediateChild(t,e)})),r;if(n){const i=cm(t.visibleWrites,e);return n.forEachChild(gp,((t,e)=>{const n=fm(cm(i,new Nf(t)),e);r=r.updateImmediateChild(t,n)})),um(i).forEach((t=>{r=r.updateImmediateChild(t.name,t.node)})),r}return um(cm(t.visibleWrites,e)).forEach((t=>{r=r.updateImmediateChild(t.name,t.node)})),r}(t.writeTree,t.treePath,e)}function wm(t,e,n,r){return function(t,e,n,r,i){zu(r||i,"Either existingEventSnap or existingServerSnap must exist");const s=Hf(e,n);if(hm(t.visibleWrites,s))return null;{const e=cm(t.visibleWrites,s);return dm(e)?i.getChild(n):fm(e,i.getChild(n))}}(t.writeTree,t.treePath,e,n,r)}function Tm(t,e){return function(t,e){return lm(t.visibleWrites,e)}(t.writeTree,Hf(t.treePath,e))}function Sm(t,e,n,r,i,s){return function(t,e,n,r,i,s,o){let a;const h=cm(t.visibleWrites,e),l=lm(h,kf());if(null!=l)a=l;else{if(null==n)return[];a=fm(h,n)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const t=[],e=o.getCompare(),n=s?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o);let h=n.getNext();for(;h&&t.length<i;)0!==e(h,r)&&t.push(h),h=n.getNext();return t}}(t.writeTree,t.treePath,e,n,r,i,s)}function Am(t,e,n){return function(t,e,n,r){const i=Hf(e,n),s=lm(t.visibleWrites,i);if(null!=s)return s;if(r.isCompleteForChild(n))return fm(cm(t.visibleWrites,i),r.getNode().getImmediateChild(n));return null}(t.writeTree,t.treePath,e,n)}function Cm(t,e){return Im(Hf(t.treePath,e),t.writeTree)}function Im(t,e){return{treePath:t,writeTree:e}}class Rm{constructor(){this.changeMap=new Map}trackChildChange(t){const e=t.type,n=t.childName;zu("child_added"===e||"child_changed"===e||"child_removed"===e,"Only child changes supported for tracking"),zu(".priority"!==n,"Only non-priority child changes can be tracked.");const r=this.changeMap.get(n);if(r){const i=r.type;if("child_added"===e&&"child_removed"===i)this.changeMap.set(n,Dp(n,t.snapshotNode,r.snapshotNode));else if("child_removed"===e&&"child_added"===i)this.changeMap["delete"](n);else if("child_removed"===e&&"child_changed"===i)this.changeMap.set(n,Op(n,r.oldSnap));else if("child_changed"===e&&"child_added"===i)this.changeMap.set(n,Mp(n,t.snapshotNode));else{if("child_changed"!==e||"child_changed"!==i)throw Wu("Illegal combination of changes: "+t+" occurred after "+r);this.changeMap.set(n,Dp(n,t.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,t)}getChanges(){return Array.from(this.changeMap.values())}}const Pm=new class{getCompleteChild(t){return null}getChildAfterChild(t,e,n){return null}};class Mm{constructor(t,e,n=null){this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=n}getCompleteChild(t){const e=this.viewCache_.eventCache;if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);{const e=null!=this.optCompleteServerCache_?new qp(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Am(this.writes_,t,e)}}getChildAfterChild(t,e,n){const r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:em(this.viewCache_),i=Sm(this.writes_,r,e,1,n,t);return 0===i.length?null:i[0]}}function Om(t,e,n,r,i){const s=new Rm;let o,a;if(n.type===Wp.OVERWRITE){const h=n;h.source.fromUser?o=km(t,e,h.path,h.snap,r,i,s):(zu(h.source.fromServer,"Unknown source."),a=h.source.tagged||e.serverCache.isFiltered()&&!zf(h.path),o=Nm(t,e,h.path,h.snap,r,i,a,s))}else if(n.type===Wp.MERGE){const h=n;h.source.fromUser?o=function(t,e,n,r,i,s,o){let a=e;return r.foreach(((r,h)=>{const l=Hf(n,r);Lm(e,Lf(l))&&(a=km(t,a,l,h,i,s,o))})),r.foreach(((r,h)=>{const l=Hf(n,r);Lm(e,Lf(l))||(a=km(t,a,l,h,i,s,o))})),a}(t,e,h.path,h.children,r,i,s):(zu(h.source.fromServer,"Unknown source."),a=h.source.tagged||e.serverCache.isFiltered(),o=Bm(t,e,h.path,h.children,r,i,a,s))}else if(n.type===Wp.ACK_USER_WRITE){const a=n;o=a.revert?function(t,e,n,r,i,s){let o;if(null!=Tm(r,n))return e;{const a=new Mm(r,e,i),h=e.eventCache.getNode();let l;if(zf(n)||".priority"===Lf(n)){let n;if(e.serverCache.isFullyInitialized())n=xm(r,em(e));else{const t=e.serverCache.getNode();zu(t instanceof Tp,"serverChildren would be complete if leaf node"),n=Em(r,t)}l=t.filter.updateFullNode(h,n,s)}else{const i=Lf(n);let u=Am(r,i,e.serverCache);null==u&&e.serverCache.isCompleteForChild(i)&&(u=h.getImmediateChild(i)),l=null!=u?t.filter.updateChild(h,i,u,Bf(n),a,s):e.eventCache.getNode().hasChild(i)?t.filter.updateChild(h,i,Tp.EMPTY_NODE,Bf(n),a,s):h,l.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=xm(r,em(e)),o.isLeafNode()&&(l=t.filter.updateFullNode(l,o,s)))}return o=e.serverCache.isFullyInitialized()||null!=Tm(r,kf()),Zp(e,l,o,t.filter.filtersNodes())}}(t,e,a.path,r,i,s):function(t,e,n,r,i,s,o){if(null!=Tm(i,n))return e;const a=e.serverCache.isFiltered(),h=e.serverCache;if(null!=r.value){if(zf(n)&&h.isFullyInitialized()||h.isCompleteForPath(n))return Nm(t,e,n,h.getNode().getChild(n),i,s,a,o);if(zf(n)){let r=new rm(null);return h.getNode().forEachChild(rp,((t,e)=>{r=r.set(new Nf(t),e)})),Bm(t,e,n,r,i,s,a,o)}return e}{let l=new rm(null);return r.foreach(((t,e)=>{const r=Hf(n,t);h.isCompleteForPath(r)&&(l=l.set(t,h.getNode().getChild(r)))})),Bm(t,e,n,l,i,s,a,o)}}(t,e,a.path,a.affectedTree,r,i,s)}else{if(n.type!==Wp.LISTEN_COMPLETE)throw Wu("Unknown operation type: "+n.type);o=function(t,e,n,r,i){const s=e.serverCache,o=Jp(e,s.getNode(),s.isFullyInitialized()||zf(n),s.isFiltered());return Dm(t,o,n,r,Pm,i)}(t,e,n.path,r,s)}const h=s.getChanges();return function(t,e,n){const r=e.eventCache;if(r.isFullyInitialized()){const i=r.getNode().isLeafNode()||r.getNode().isEmpty(),s=tm(t);(n.length>0||!t.eventCache.isFullyInitialized()||i&&!r.getNode().equals(s)||!r.getNode().getPriority().equals(s.getPriority()))&&n.push(Pp(tm(e)))}}(e,o,h),{viewCache:o,changes:h}}function Dm(t,e,n,r,i,s){const o=e.eventCache;if(null!=Tm(r,n))return e;{let a,h;if(zf(n))if(zu(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const n=em(e),i=Em(r,n instanceof Tp?n:Tp.EMPTY_NODE);a=t.filter.updateFullNode(e.eventCache.getNode(),i,s)}else{const n=xm(r,em(e));a=t.filter.updateFullNode(e.eventCache.getNode(),n,s)}else{const l=Lf(n);if(".priority"===l){zu(1===Ff(n),"Can't have a priority with additional path components");const i=o.getNode();h=e.serverCache.getNode();const s=wm(r,n,i,h);a=null!=s?t.filter.updatePriority(i,s):o.getNode()}else{const u=Bf(n);let c;if(o.isCompleteForChild(l)){h=e.serverCache.getNode();const t=wm(r,n,o.getNode(),h);c=null!=t?o.getNode().getImmediateChild(l).updateChild(u,t):o.getNode().getImmediateChild(l)}else c=Am(r,l,e.serverCache);a=null!=c?t.filter.updateChild(o.getNode(),l,c,u,i,s):o.getNode()}}return Zp(e,a,o.isFullyInitialized()||zf(n),t.filter.filtersNodes())}}function Nm(t,e,n,r,i,s,o,a){const h=e.serverCache;let l;const u=o?t.filter:t.filter.getIndexedFilter();if(zf(n))l=u.updateFullNode(h.getNode(),r,null);else if(u.filtersNodes()&&!h.isFiltered()){const t=h.getNode().updateChild(n,r);l=u.updateFullNode(h.getNode(),t,null)}else{const t=Lf(n);if(!h.isCompleteForPath(n)&&Ff(n)>1)return e;const i=Bf(n),s=h.getNode().getImmediateChild(t).updateChild(i,r);l=".priority"===t?u.updatePriority(h.getNode(),s):u.updateChild(h.getNode(),t,s,i,Pm,null)}const c=Jp(e,l,h.isFullyInitialized()||zf(n),u.filtersNodes());return Dm(t,c,n,i,new Mm(i,c,s),a)}function km(t,e,n,r,i,s,o){const a=e.eventCache;let h,l;const u=new Mm(i,e,s);if(zf(n))l=t.filter.updateFullNode(e.eventCache.getNode(),r,o),h=Zp(e,l,!0,t.filter.filtersNodes());else{const i=Lf(n);if(".priority"===i)l=t.filter.updatePriority(e.eventCache.getNode(),r),h=Zp(e,l,a.isFullyInitialized(),a.isFiltered());else{const s=Bf(n),l=a.getNode().getImmediateChild(i);let c;if(zf(s))c=r;else{const t=u.getCompleteChild(i);c=null!=t?".priority"===Uf(s)&&t.getChild(Gf(s)).isEmpty()?t:t.updateChild(s,r):Tp.EMPTY_NODE}if(l.equals(c))h=e;else{h=Zp(e,t.filter.updateChild(a.getNode(),i,c,s,u,o),a.isFullyInitialized(),t.filter.filtersNodes())}}}return h}function Lm(t,e){return t.eventCache.isCompleteForChild(e)}function Fm(t,e,n){return n.foreach(((t,n)=>{e=e.updateChild(t,n)})),e}function Bm(t,e,n,r,i,s,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let h,l=e;h=zf(n)?r:new rm(null).setTree(n,r);const u=e.serverCache.getNode();return h.children.inorderTraversal(((n,r)=>{if(u.hasChild(n)){const h=Fm(0,e.serverCache.getNode().getImmediateChild(n),r);l=Nm(t,l,new Nf(n),h,i,s,o,a)}})),h.children.inorderTraversal(((n,r)=>{const h=!e.serverCache.isCompleteForChild(n)&&null===r.value;if(!u.hasChild(n)&&!h){const h=Fm(0,e.serverCache.getNode().getImmediateChild(n),r);l=Nm(t,l,new Nf(n),h,i,s,o,a)}})),l}function Um(t,e){const n=em(t.viewCache_);return n&&(t.query._queryParams.loadsAllData()||!zf(e)&&!n.getImmediateChild(Lf(e)).isEmpty())?n.getChild(e):null}function jm(t,e,n,r){e.type===Wp.MERGE&&null!==e.source.queryId&&(zu(em(t.viewCache_),"We should always have a full cache before handling merges"),zu(tm(t.viewCache_),"Missing event cache, even though we have a server cache"));const i=t.viewCache_,s=Om(t.processor_,i,e,n,r);var o,a;return o=t.processor_,a=s.viewCache,zu(a.eventCache.getNode().isIndexed(o.filter.getIndex()),"Event snap not indexed"),zu(a.serverCache.getNode().isIndexed(o.filter.getIndex()),"Server snap not indexed"),zu(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=s.viewCache,Gm(t,s.changes,s.viewCache.eventCache.getNode(),null)}function Gm(t,e,n,r){const i=r?[r]:t.eventRegistrations_;return function(t,e,n,r){const i=[],s=[];return e.forEach((e=>{var n;"child_changed"===e.type&&t.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&s.push((n=e.childName,{type:"child_moved",snapshotNode:e.snapshotNode,childName:n}))})),Kp(t,i,"child_removed",e,r,n),Kp(t,i,"child_added",e,r,n),Kp(t,i,"child_moved",s,r,n),Kp(t,i,"child_changed",e,r,n),Kp(t,i,"value",e,r,n),i}(t.eventGenerator_,e,n,i)}let Hm,zm;function Wm(t,e,n,r){const i=e.source.queryId;if(null!==i){const s=t.views.get(i);return zu(null!=s,"SyncTree gave us an op for an invalid query."),jm(s,e,n,r)}{let i=[];for(const s of t.views.values())i=i.concat(jm(s,e,n,r));return i}}function Vm(t,e){let n=null;for(const r of t.views.values())n=n||Um(r,e);return n}class Xm{constructor(t){this.listenProvider_=t,this.syncPointTree_=new rm(null),this.pendingWriteTree_={visibleWrites:im.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function $m(t,e,n,r,i){return function(t,e,n,r,i){zu(r>t.lastWriteId,"Stacking an older write on top of newer ones"),i===undefined&&(i=!0),t.allWrites.push({path:e,snap:n,writeId:r,visible:i}),i&&(t.visibleWrites=sm(t.visibleWrites,e,n)),t.lastWriteId=r}(t.pendingWriteTree_,e,n,r,i),i?Zm(t,new $p({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},e,n)):[]}function Ym(t,e,n=!1){const r=function(t,e){for(let n=0;n<t.allWrites.length;n++){const r=t.allWrites[n];if(r.writeId===e)return r}return null}(t.pendingWriteTree_,e);if(gm(t.pendingWriteTree_,e)){let e=new rm(null);return null!=r.snap?e=e.set(kf(),!0):tf(r.children,(t=>{e=e.set(new Nf(t),!0)})),Zm(t,new Xp(r.path,e,n))}return[]}function qm(t,e,n){return Zm(t,new $p({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e,n))}function Km(t,e,n,r){const i=eg(t,r);if(null!=i){const r=ng(i),s=r.path,o=r.queryId,a=Wf(s,e);return rg(t,s,new $p(Vp(o),a,n))}return[]}function Qm(t,e,n){const r=t.pendingWriteTree_,i=t.syncPointTree_.findOnPath(e,((t,n)=>{const r=Vm(n,Wf(t,e));if(r)return r}));return bm(r,e,i,n,!0)}function Zm(t,e){return Jm(e,t.syncPointTree_,null,mm(t.pendingWriteTree_,kf()))}function Jm(t,e,n,r){if(zf(t.path))return tg(t,e,n,r);{const i=e.get(kf());null==n&&null!=i&&(n=Vm(i,kf()));let s=[];const o=Lf(t.path),a=t.operationForChild(o),h=e.children.get(o);if(h&&a){const t=n?n.getImmediateChild(o):null,e=Cm(r,o);s=s.concat(Jm(a,h,t,e))}return i&&(s=s.concat(Wm(i,t,r,n))),s}}function tg(t,e,n,r){const i=e.get(kf());null==n&&null!=i&&(n=Vm(i,kf()));let s=[];return e.children.inorderTraversal(((e,i)=>{const o=n?n.getImmediateChild(e):null,a=Cm(r,e),h=t.operationForChild(e);h&&(s=s.concat(tg(h,i,o,a)))})),i&&(s=s.concat(Wm(i,t,r,n))),s}function eg(t,e){return t.tagToQueryMap.get(e)}function ng(t){const e=t.indexOf("$");return zu(-1!==e&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new Nf(t.substr(0,e))}}function rg(t,e,n){const r=t.syncPointTree_.get(e);zu(r,"Missing sync point for query tag that we're tracking");return Wm(r,n,mm(t.pendingWriteTree_,e),null)}class ig{constructor(t){this.node_=t}getImmediateChild(t){const e=this.node_.getImmediateChild(t);return new ig(e)}node(){return this.node_}}class sg{constructor(t,e){this.syncTree_=t,this.path_=e}getImmediateChild(t){const e=Hf(this.path_,t);return new sg(this.syncTree_,e)}node(){return Qm(this.syncTree_,this.path_)}}const og=function(t){return(t=t||{}).timestamp=t.timestamp||(new Date).getTime(),t},ag=function(t,e,n){return t&&"object"==typeof t?(zu(".sv"in t,"Unexpected leaf node or priority contents"),"string"==typeof t[".sv"]?hg(t[".sv"],e,n):"object"==typeof t[".sv"]?lg(t[".sv"],e):void zu(!1,"Unexpected server value: "+JSON.stringify(t,null,2))):t},hg=function(t,e,n){if("timestamp"===t)return n.timestamp;zu(!1,"Unexpected server value: "+t)},lg=function(t,e,n){t.hasOwnProperty("increment")||zu(!1,"Unexpected server value: "+JSON.stringify(t,null,2));const r=t.increment;"number"!=typeof r&&zu(!1,"Unexpected increment value: "+r);const i=e.node();if(zu(null!=i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;const s=i.getValue();return"number"!=typeof s?r:s+r},ug=function(t,e,n,r){return dg(e,new sg(n,t),r)},cg=function(t,e,n){return dg(t,new ig(e),n)};function dg(t,e,n){const r=t.getPriority().val(),i=ag(r,e.getImmediateChild(".priority"),n);let s;if(t.isLeafNode()){const r=t,s=ag(r.getValue(),e,n);return s!==r.getValue()||i!==r.getPriority().val()?new mp(s,Cp(i)):t}{const r=t;return s=r,i!==r.getPriority().val()&&(s=s.updatePriority(new mp(i))),r.forEachChild(gp,((t,r)=>{const i=dg(r,e.getImmediateChild(t),n);i!==r&&(s=s.updateImmediateChild(t,i))})),s}}class fg{constructor(t="",e=null,n={children:{},childCount:0}){this.name=t,this.parent=e,this.node=n}}function pg(t,e){let n=e instanceof Nf?e:new Nf(e),r=t,i=Lf(n);for(;null!==i;){const t=mc(r.node.children,i)||{children:{},childCount:0};r=new fg(i,r,t),n=Bf(n),i=Lf(n)}return r}function mg(t){return t.node.value}function gg(t,e){t.node.value=e,xg(t)}function _g(t){return t.node.childCount>0}function yg(t,e){tf(t.node.children,((n,r)=>{e(new fg(n,t,r))}))}function vg(t,e,n,r){n&&!r&&e(t),yg(t,(t=>{vg(t,e,!0,r)})),n&&r&&e(t)}function bg(t){return new Nf(null===t.parent?t.name:bg(t.parent)+"/"+t.name)}function xg(t){null!==t.parent&&function(t,e,n){const r=function(t){return mg(t)===undefined&&!_g(t)}(n),i=pc(t.node.children,e);r&&i?(delete t.node.children[e],t.node.childCount--,xg(t)):r||i||(t.node.children[e]=n.node,t.node.childCount++,xg(t))}(t.parent,t.name,t)}const Eg=/[\[\].#$\/\u0000-\u001F\u007F]/,wg=/[\[\].#$\u0000-\u001F\u007F]/,Tg=10485760,Sg=function(t){return"string"==typeof t&&0!==t.length&&!Eg.test(t)},Ag=function(t){return"string"==typeof t&&0!==t.length&&!wg.test(t)},Cg=function(t,e,n){const r=n instanceof Nf?new $f(n,t):n;if(e===undefined)throw new Error(t+"contains undefined "+qf(r));if("function"==typeof e)throw new Error(t+"contains a function "+qf(r)+" with contents = "+e.toString());if(Xd(e))throw new Error(t+"contains "+e.toString()+" "+qf(r));if("string"==typeof e&&e.length>Tg/3&&Ec(e)>Tg)throw new Error(t+"contains a string greater than "+Tg+" utf8 bytes "+qf(r)+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){let n=!1,i=!1;if(tf(e,((e,s)=>{if(".value"===e)n=!0;else if(".priority"!==e&&".sv"!==e&&(i=!0,!Sg(e)))throw new Error(t+" contains an invalid key ("+e+") "+qf(r)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');!function(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=Ec(e),Yf(t)}(r,e),Cg(t,s,r),function(t){const e=t.parts_.pop();t.byteLength_-=Ec(e),t.parts_.length>0&&(t.byteLength_-=1)}(r)})),n&&i)throw new Error(t+' contains ".value" child '+qf(r)+" in addition to actual children.")}},Ig=function(t,e){const n=e.path.toString();if("string"!=typeof e.repoInfo.host||0===e.repoInfo.host.length||!Sg(e.repoInfo.namespace)&&"localhost"!==e.repoInfo.host.split(":")[0]||0!==n.length&&!function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Ag(t)}(n))throw new Error(xc(t,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class Rg{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Pg(t,e){let n=null;for(let r=0;r<e.length;r++){const i=e[r],s=i.getPath();null===n||Vf(s,n.path)||(t.eventLists_.push(n),n=null),null===n&&(n={events:[],path:s}),n.events.push(i)}n&&t.eventLists_.push(n)}function Mg(t,e,n){Pg(t,n),Og(t,(t=>Xf(t,e)||Xf(e,t)))}function Og(t,e){t.recursionDepth_++;let n=!0;for(let r=0;r<t.eventLists_.length;r++){const i=t.eventLists_[r];if(i){e(i.path)?(Dg(t.eventLists_[r]),t.eventLists_[r]=null):n=!1}}n&&(t.eventLists_=[]),t.recursionDepth_--}function Dg(t){for(let e=0;e<t.events.length;e++){const n=t.events[e];if(null!==n){t.events[e]=null;const r=n.getEventRunner();Bd&&Gd("event: "+n.toString()),sf(r)}}}const Ng="repo_interrupt",kg=25;class Lg{constructor(t,e,n,r){this.repoInfo_=t,this.forceRestClient_=e,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Rg,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Up(),this.transactionQueueTree_=new fg,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Fg(t,e,n){if(t.stats_=bf(t.repoInfo_),t.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)t.server_=new Fp(t.repoInfo_,((e,n,r,i)=>{jg(t,e,n,r,i)}),t.authTokenProvider_,t.appCheckProvider_),setTimeout((()=>Gg(t,!0)),0);else{if(null!=n){if("object"!=typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{dc(n)}catch(et){throw new Error("Invalid authOverride provided: "+et)}}t.persistentConnection_=new Zf(t.repoInfo_,e,((e,n,r,i)=>{jg(t,e,n,r,i)}),(e=>{Gg(t,e)}),(e=>{!function(t,e){tf(e,((e,n)=>{Hg(t,e,n)}))}(t,e)}),t.authTokenProvider_,t.appCheckProvider_,n),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener((e=>{t.server_.refreshAuthToken(e)})),t.appCheckProvider_.addTokenChangeListener((e=>{t.server_.refreshAppCheckToken(e.token)})),t.statsReporter_=function(t,e){const n=t.toString();return vf[n]||(vf[n]=e()),vf[n]}(t.repoInfo_,(()=>new zp(t.stats_,t.server_))),t.infoData_=new Bp,t.infoSyncTree_=new Xm({startListening:(e,n,r,i)=>{let s=[];const o=t.infoData_.getNode(e._path);return o.isEmpty()||(s=qm(t.infoSyncTree_,e._path,o),setTimeout((()=>{i("ok")}),0)),s},stopListening:()=>{}}),Hg(t,"connected",!1),t.serverSyncTree_=new Xm({startListening:(e,n,r,i)=>(t.server_.listen(e,r,n,((n,r)=>{const s=i(n,r);Mg(t.eventQueue_,e._path,s)})),[]),stopListening:(e,n)=>{t.server_.unlisten(e,n)}})}function Bg(t){const e=t.infoData_.getNode(new Nf(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+e}function Ug(t){return og({timestamp:Bg(t)})}function jg(t,e,n,r,i){t.dataUpdateCount++;const s=new Nf(e);n=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,n):n;let o=[];if(i)if(r){const e=_c(n,(t=>Cp(t)));o=function(t,e,n,r){const i=eg(t,r);if(i){const r=ng(i),s=r.path,o=r.queryId,a=Wf(s,e),h=rm.fromObject(n);return rg(t,s,new Yp(Vp(o),a,h))}return[]}(t.serverSyncTree_,s,e,i)}else{const e=Cp(n);o=Km(t.serverSyncTree_,s,e,i)}else if(r){const e=_c(n,(t=>Cp(t)));o=function(t,e,n){const r=rm.fromObject(n);return Zm(t,new Yp({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e,r))}(t.serverSyncTree_,s,e)}else{const e=Cp(n);o=qm(t.serverSyncTree_,s,e)}let a=s;o.length>0&&(a=Yg(t,s)),Mg(t.eventQueue_,a,o)}function Gg(t,e){Hg(t,"connected",e),!1===e&&function(t){Vg(t,"onDisconnectEvents");const e=Ug(t),n=Up();Gp(t.onDisconnect_,kf(),((r,i)=>{const s=ug(r,i,t.serverSyncTree_,e);jp(n,r,s)}));let r=[];Gp(n,kf(),((e,n)=>{r=r.concat(qm(t.serverSyncTree_,e,n));const i=Jg(t,e);Yg(t,i)})),t.onDisconnect_=Up(),Mg(t.eventQueue_,kf(),r)}(t)}function Hg(t,e,n){const r=new Nf("/.info/"+e),i=Cp(n);t.infoData_.updateSnapshot(r,i);const s=qm(t.infoSyncTree_,r,i);Mg(t.eventQueue_,r,s)}function zg(t){return t.nextWriteId_++}function Wg(t){t.persistentConnection_&&t.persistentConnection_.interrupt(Ng)}function Vg(t,...e){let n="";t.persistentConnection_&&(n=t.persistentConnection_.id+":"),Gd(n,...e)}function Xg(t,e,n){return Qm(t.serverSyncTree_,e,n)||Tp.EMPTY_NODE}function $g(t,e=t.transactionQueueTree_){if(e||Zg(t,e),mg(e)){const n=Kg(t,e);zu(n.length>0,"Sending zero length transaction queue");n.every((t=>0===t.status))&&function(t,e,n){const r=n.map((t=>t.currentWriteId)),i=Xg(t,e,r);let s=i;const o=i.hash();for(let l=0;l<n.length;l++){const t=n[l];zu(0===t.status,"tryToSendTransactionQueue_: items in queue should all be run."),t.status=1,t.retryCount++;const r=Wf(e,t.path);s=s.updateChild(r,t.currentOutputSnapshotRaw)}const a=s.val(!0),h=e;t.server_.put(h.toString(),a,(r=>{Vg(t,"transaction put response",{path:h.toString(),status:r});let i=[];if("ok"===r){const r=[];for(let e=0;e<n.length;e++)n[e].status=2,i=i.concat(Ym(t.serverSyncTree_,n[e].currentWriteId)),n[e].onComplete&&r.push((()=>n[e].onComplete(null,!0,n[e].currentOutputSnapshotResolved))),n[e].unwatcher();Zg(t,pg(t.transactionQueueTree_,e)),$g(t,t.transactionQueueTree_),Mg(t.eventQueue_,e,i);for(let t=0;t<r.length;t++)sf(r[t])}else{if("datastale"===r)for(let t=0;t<n.length;t++)3===n[t].status?n[t].status=4:n[t].status=0;else{Vd("transaction at "+h.toString()+" failed: "+r);for(let t=0;t<n.length;t++)n[t].status=4,n[t].abortReason=r}Yg(t,e)}}),o)}(t,bg(e),n)}else _g(e)&&yg(e,(e=>{$g(t,e)}))}function Yg(t,e){const n=qg(t,e),r=bg(n);return function(t,e,n){if(0===e.length)return;const r=[];let i=[];const s=e.filter((t=>0===t.status)),o=s.map((t=>t.currentWriteId));for(let h=0;h<e.length;h++){const s=e[h],l=Wf(n,s.path);let u,c=!1;if(zu(null!==l,"rerunTransactionsUnderNode_: relativePath should not be null."),4===s.status)c=!0,u=s.abortReason,i=i.concat(Ym(t.serverSyncTree_,s.currentWriteId,!0));else if(0===s.status)if(s.retryCount>=kg)c=!0,u="maxretry",i=i.concat(Ym(t.serverSyncTree_,s.currentWriteId,!0));else{const n=Xg(t,s.path,o);s.currentInputSnapshot=n;const r=e[h].update(n.val());if(r!==undefined){Cg("transaction failed: Data returned ",r,s.path);let e=Cp(r);"object"==typeof r&&null!=r&&pc(r,".priority")||(e=e.updatePriority(n.getPriority()));const a=s.currentWriteId,h=Ug(t),l=cg(e,n,h);s.currentOutputSnapshotRaw=e,s.currentOutputSnapshotResolved=l,s.currentWriteId=zg(t),o.splice(o.indexOf(a),1),i=i.concat($m(t.serverSyncTree_,s.path,l,s.currentWriteId,s.applyLocally)),i=i.concat(Ym(t.serverSyncTree_,a,!0))}else c=!0,u="nodata",i=i.concat(Ym(t.serverSyncTree_,s.currentWriteId,!0))}Mg(t.eventQueue_,n,i),i=[],c&&(e[h].status=2,a=e[h].unwatcher,setTimeout(a,Math.floor(0)),e[h].onComplete&&("nodata"===u?r.push((()=>e[h].onComplete(null,!1,e[h].currentInputSnapshot))):r.push((()=>e[h].onComplete(new Error(u),!1,null)))))}var a;Zg(t,t.transactionQueueTree_);for(let h=0;h<r.length;h++)sf(r[h]);$g(t,t.transactionQueueTree_)}(t,Kg(t,n),r),r}function qg(t,e){let n,r=t.transactionQueueTree_;for(n=Lf(e);null!==n&&mg(r)===undefined;)r=pg(r,n),n=Lf(e=Bf(e));return r}function Kg(t,e){const n=[];return Qg(t,e,n),n.sort(((t,e)=>t.order-e.order)),n}function Qg(t,e,n){const r=mg(e);if(r)for(let i=0;i<r.length;i++)n.push(r[i]);yg(e,(e=>{Qg(t,e,n)}))}function Zg(t,e){const n=mg(e);if(n){let t=0;for(let e=0;e<n.length;e++)2!==n[e].status&&(n[t]=n[e],t++);n.length=t,gg(e,n.length>0?n:undefined)}yg(e,(e=>{Zg(t,e)}))}function Jg(t,e){const n=bg(qg(t,e)),r=pg(t.transactionQueueTree_,e);return function(t,e,n){let r=n?t:t.parent;for(;null!==r;){if(e(r))return!0;r=r.parent}}(r,(e=>{t_(t,e)})),t_(t,r),vg(r,(e=>{t_(t,e)})),n}function t_(t,e){const n=mg(e);if(n){const r=[];let i=[],s=-1;for(let e=0;e<n.length;e++)3===n[e].status||(1===n[e].status?(zu(s===e-1,"All SENT items should be at beginning of queue."),s=e,n[e].status=3,n[e].abortReason="set"):(zu(0===n[e].status,"Unexpected transaction status in abort"),n[e].unwatcher(),i=i.concat(Ym(t.serverSyncTree_,n[e].currentWriteId,!0)),n[e].onComplete&&r.push(n[e].onComplete.bind(null,new Error("set"),!1,null))));-1===s?gg(e,undefined):n.length=s+1,Mg(t.eventQueue_,bg(e),i);for(let t=0;t<r.length;t++)sf(r[t])}}const e_=function(t,e){const n=n_(t),r=n.namespace;"firebase.com"===n.domain&&Wd(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||Wd("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&Vd("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");const i="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new mf(n.host,n.secure,r,i,e,"",r!==n.subdomain),path:new Nf(n.pathString)}},n_=function(t){let e="",n="",r="",i="",s="",o=!0,a="https",h=443;if("string"==typeof t){let l=t.indexOf("//");l>=0&&(a=t.substring(0,l-1),t=t.substring(l+2));let u=t.indexOf("/");-1===u&&(u=t.length);let c=t.indexOf("?");-1===c&&(c=t.length),e=t.substring(0,Math.min(u,c)),u<c&&(i=function(t){let e="";const n=t.split("/");for(let r=0;r<n.length;r++)if(n[r].length>0){let t=n[r];try{t=decodeURIComponent(t.replace(/\+/g," "))}catch(et){}e+="/"+t}return e}(t.substring(u,c)));const d=function(t){const e={};"?"===t.charAt(0)&&(t=t.substring(1));for(const n of t.split("&")){if(0===n.length)continue;const r=n.split("=");2===r.length?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):Vd(`Invalid query segment '${n}' in query '${t}'`)}return e}(t.substring(Math.min(t.length,c)));l=e.indexOf(":"),l>=0?(o="https"===a||"wss"===a,h=parseInt(e.substring(l+1),10)):l=e.length;const f=e.slice(0,l);if("localhost"===f.toLowerCase())n="localhost";else if(f.split(".").length<=2)n=f;else{const t=e.indexOf(".");r=e.substring(0,t).toLowerCase(),n=e.substring(t+1),s=r}"ns"in d&&(s=d.ns)}return{host:e,port:h,domain:n,subdomain:r,secure:o,scheme:a,pathString:i,namespace:s}},r_="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz";!function(){let t=0;const e=[]}();class i_{constructor(t,e,n,r){this._repo=t,this._path=e,this._queryParams=n,this._orderByCalled=r}get key(){return zf(this._path)?null:Uf(this._path)}get ref(){return new s_(this._repo,this._path)}get _queryIdentifier(){const t=Lp(this._queryParams),e=Zd(t);return"{}"===e?"default":e}get _queryObject(){return Lp(this._queryParams)}isEqual(t){if(!((t=wc(t))instanceof i_))return!1;const e=this._repo===t._repo,n=Vf(this._path,t._path),r=this._queryIdentifier===t._queryIdentifier;return e&&n&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(t){let e="";for(let n=t.pieceNum_;n<t.pieces_.length;n++)""!==t.pieces_[n]&&(e+="/"+encodeURIComponent(String(t.pieces_[n])));return e||"/"}(this._path)}}class s_ extends i_{constructor(t,e){super(t,e,new Np,!1)}get parent(){const t=Gf(this._path);return null===t?null:new s_(this._repo,t)}get root(){let t=this;for(;null!==t.parent;)t=t.parent;return t}}!function(t){zu(!Hm,"__referenceConstructor has already been defined"),Hm=t}(s_),function(t){zu(!zm,"__referenceConstructor has already been defined"),zm=t}(s_);const o_="FIREBASE_DATABASE_EMULATOR_HOST",a_={};let h_=!1;function l_(t,e,n,r,i){let s=r||t.options.databaseURL;s===undefined&&(t.options.projectId||Wd("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Gd("Using default host for project ",t.options.projectId),s=`${t.options.projectId}-default-rtdb.firebaseio.com`);let o,a=e_(s,i),h=a.repoInfo,l=undefined;"undefined"!=typeof process&&process.env&&(l=process.env[o_]),l?(o=!0,s=`http://${l}?ns=${h.namespace}`,a=e_(s,i),h=a.repoInfo):o=!a.repoInfo.secure;const u=i&&o?new lf(lf.OWNER):new hf(t.name,t.options,e);Ig("Invalid Firebase Database URL",a),zf(a.path)||Wd("Database URL must point to the root of a Firebase Database (not including a child path).");const c=function(t,e,n,r){let i=a_[e.name];i||(i={},a_[e.name]=i);let s=i[t.toURLString()];s&&Wd("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.");return s=new Lg(t,h_,n,r),i[t.toURLString()]=s,s}(h,t,u,new af(t.name,n));return new u_(c,t)}class u_{constructor(t,e){this._repoInternal=t,this.app=e,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Fg(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new s_(this._repo,kf())),this._rootInternal}_delete(){return null!==this._rootInternal&&(!function(t,e){const n=a_[e];n&&n[t.key]===t||Wd(`Database ${e}(${t.repoInfo_}) has already been deleted.`),Wg(t),delete n[t.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(t){null===this._rootInternal&&Wd("Cannot call "+t+" on a deleted database.")}}Zf.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)},Zf.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};!function(t){Id("10.4.0"),ad(new Tc("database",((t,{instanceIdentifier:e})=>l_(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"),t.getProvider("app-check-internal"),e)),"PUBLIC").setMultipleInstances(!0)),dd(Sd,Ad,t),dd(Sd,Ad,"esm2017")}(),w.RENDER_OPTIONS.hello=!1,su.safetyCheckFunction=t=>!(null==t?void 0:t.destroyed);const c_={backgroundColor:2236962,width:Tu.IDEAL_WIDTH,resolution:window.devicePixelRatio||1,autoDensity:!0,height:Tu.IDEAL_HEIGHT,autoStart:!1,view:document.getElementById("pixi-canvas"),interactionTestsAllScenes:!0};document.getElementById("pixi-content").style.background="#222222",document.getElementById("pixi-content").appendChild(c_.view),window.addEventListener("touchmove",(function(t){t.preventDefault()}),{capture:!1,passive:!1}),function(t=[uu.UP_ARROW,uu.DOWN_ARROW,uu.RIGHT_ARROW,uu.LEFT_ARROW,uu.ENTER,uu.SPACE]){document.addEventListener("keydown",(e=>{(t.includes(e.code)||t.includes(cu[e.keyCode]))&&e.preventDefault()}))}(),function(){document.addEventListener("click",(()=>t())),document.addEventListener("mouseup",(()=>t())),document.addEventListener("pointerup",(()=>t())),document.addEventListener("touchend",(()=>t())),document.addEventListener("touchstart",(()=>t())),document.addEventListener("mouseup",(()=>t())),document.addEventListener("pointerdown",(()=>t())),document.addEventListener("mousedown",(()=>t()));const t=()=>{if(window.focus(),G.any){const t=document.getElementById("pixi-content");t.requestFullscreen&&t.requestFullscreen({navigationUI:"hide"})}}}();const d_=new class{constructor(t,e=new kr){Au(this,"pauseGlobalTweenOnFocusLost",!0),Au(this,"pauseSoundOnFocusLost",!0),Au(this,"destroyGlobalTweensOnSceneChange",!0),Au(this,"removeKeyboardEventsOnSceneChange",!0),Au(this,"closeAllScenesOnSceneChange",!1),Au(this,"defaultTransition",lu),Au(this,"defaultTransitionParams",[]),Au(this,"sceneRenderer"),Au(this,"popupQueue",[]),Au(this,"popupQueueParams",[]),Au(this,"mainScene"),Au(this,"currentScenes"),Au(this,"currentPopups"),Au(this,"currentTransition",null),Au(this,"lockScene"),Au(this,"preferredOrientation","portrait"),Au(this,"_currentOrientation","portrait"),Au(this,"_onKeyboard"),Au(this,"ticker"),Au(this,"hasFocus",!0),Au(this,"stats"),Au(this,"updateTimeStats"),Au(this,"_isChangingScene",!1),Au(this,"initializedAssets"),this.initializedAssets=this.initAssets(),this.sceneRenderer=t,this.ticker=e,this.currentPopups=[],this.currentScenes=[],window.addEventListener("pointerdown",(()=>{this.hasFocus||this.focus()})),window.addEventListener("focus",this.focus.bind(this)),window.addEventListener("blur",this.focusLost.bind(this)),window.addEventListener("message",this.postMessage.bind(this)),this.ticker.add(this.update,this),this.ticker.start(),$l&&(this.stats=new(bu()),this.updateTimeStats=this.stats.addPanel(new(bu().Panel)("UPD %","#ff8","#221")),this.stats.showPanel(0),document.body.appendChild(this.stats.dom))}get width(){return this.sceneRenderer.width}get height(){return this.sceneRenderer.height}get devicePixelRatio(){return this.sceneRenderer.devicePixelRatio}get minAllowedFPS(){return this.ticker.minFPS}set minAllowedFPS(t){this.ticker.minFPS=t}get globalDtScale(){return this.ticker.speed}set globalDtScale(t){this.ticker.speed=t}get dt(){return this.ticker.deltaMS}get numPopupsOpen(){return this.currentPopups.length}get numScenesOpen(){return this.currentScenes.length}set currentOrientation(t){this._currentOrientation!=t&&(this._currentOrientation=t,Tu.IDEAL_HEIGHT=this.isPortrait?1920:1080,Tu.IDEAL_WIDTH=this.isPortrait?1080:1920,this.onChangeOrientation(this._currentOrientation))}get isPortrait(){return"portrait"==this._currentOrientation}onChangeOrientation(t){var e;this.currentOrientation=t,null==(e=this.mainScene)||e.onChangeOrientation();for(const n of this.currentPopups)n.onChangeOrientation()}get onKeyboard(){return this._onKeyboard}set onKeyboard(t){this._onKeyboard=t}get isChangingScene(){return this._isChangingScene}changeScene(t,e){return Cu(this,null,(function*(){var n;const{transitionClass:r,transitionParams:i}=e||{};let{sceneParams:s}=e||{};this._isChangingScene=!0,this.currentTransition&&this.destroyScene(this.currentTransition);let o=this.defaultTransition,a=this.defaultTransitionParams;r&&(a=i,r instanceof Promise?(o=yield this.extractSceneFromPromise(r),this.currentTransition=i?new o(...i):new o):o=r),yield this.loadAssetBundles(o,void 0,!0),this.currentTransition=a?new o(...a):new o,this.currentTransition.onResize(this.width,this.height),this.currentTransition.events.emit(_u.START),this.currentTransition.onStart(),this.currentTransition.events.emit(_u.SHOW),this.currentTransition.onShow(),yield this.currentTransition.startCovering(),this.destroyGlobalTweensOnSceneChange&&eu.shared.removeAll(),this.removeKeyboardEventsOnSceneChange&&mu.shared.removeAllListeners(),this.closeAllScenesOnSceneChange?this.closeAllScenes():this.mainScene&&this.mainScene.closeHandler();const{overrideScene:h,overrideSceneParams:l}=null!=(n=yield this.currentTransition.startResolving())?n:{};return null!=h&&(t=h),null!=l&&(s=l),this.mainScene=yield this.openScene(t,{sceneParams:s,skipShowCall:!0,onBundleDownloadProgress:this.currentTransition.onDownloadProgress.bind(this.currentTransition)}),this.mainScene}))}resumeTransition(){this.currentTransition.startUncovering().then((()=>{var t,e;this._isChangingScene=!1,null==(t=this.mainScene)||t.events.emit(_u.SHOW),null==(e=this.mainScene)||e.onShow(),this.destroyScene(this.currentTransition),this.currentTransition=null}))}setRotateScene(t,e,n){this.preferredOrientation=t,this.lockScene&&(this.lockScene.events.emit(_u.DESTROY),this.lockScene.onDestroy(null),this.destroyScene(this.lockScene)),this.lockScene=new e(...n),this.lockScene.onResize(this.width,this.height),this.lockScene.events.emit(_u.START),this.lockScene.onStart()}isOrientationCorect(){return!this.lockScene||(this.currentOrientation=this.width>this.height?"landscape":"portrait",this.currentOrientation==this.preferredOrientation)}queuePopup(t,e){this.currentPopups.length>0?(this.popupQueue.push(t),this.popupQueueParams.push(null!=e?e:[])):this.openPopup(t,e)}openPopup(t,e,n=!0){return Cu(this,null,(function*(){var r,i;if(!1===n&&this.currentPopups.length>0)return null;let s;s=t instanceof Promise?yield this.extractSceneFromPromise(t):t,yield this.loadAssetBundles(s);const o=null!=e&&null!=e?new s(...e):new s;o.events.emit(_u.NEW);for(const t of this.currentScenes)t.onPopupOpen(o,e);null==(r=this.currentTransition)||r.onPopupOpen(o,e),null==(i=this.lockScene)||i.onPopupOpen(o,e);for(const t of this.currentPopups)t.onPopupOpen(o,e);return o.closeHandler=this.closePopup.bind(this,o,s),this.currentPopups.push(o),o.onResize(this.width,this.height),o.events.emit(_u.START),o.onStart(),o.events.emit(_u.SHOW),o.onShow(),o}))}closePopup(t,e,n){var r,i;if(this.currentPopups.includes(t)){e||(e=t.constructor),t.events.emit(_u.DESTROY),t.onDestroy(null),this.currentPopups.includes(t)&&this.currentPopups.splice(this.currentPopups.indexOf(t),1),this.destroyScene(t);for(const t of this.currentScenes)t.onPopupClose(e,n);null==(r=this.currentTransition)||r.onPopupClose(e,n),null==(i=this.lockScene)||i.onPopupClose(e,n);for(const t of this.currentPopups)t.onPopupClose(e,n)}}requestClosePopup(t,e){return Cu(this,null,(function*(){const{timeout:n,force:r}=null!=e?e:{};let i;if(n){const e=Promise.race([t.requestClose(),new Promise((t=>setTimeout((()=>t("timeout")),n)))]);i=yield e.then((e=>"string"==typeof e?(this.closePopup(t),!0):e))}else i=yield t.requestClose();return!i&&r?(this.closePopup(t),!0):i}))}requestCloseAllPopups(t){return Promise.all(this.currentPopups.map((e=>this.requestClosePopup(e,t))))}closeAllPopups(){let t=this.currentPopups.length;for(;t-- >0;)this.closePopup(this.currentPopups[t])}openScene(t,e){return Cu(this,null,(function*(){var n,r;const{sceneParams:i,skipShowCall:s,onBundleDownloadProgress:o}=e||{};let a;a=t instanceof Promise?yield this.extractSceneFromPromise(t):t,yield this.loadAssetBundles(a,o);const h=null!=i&&null!=i?new a(...i):new a;h.events.emit(_u.NEW);for(const t of this.currentScenes)t.onSceneOpen(h,i);null==(n=this.currentTransition)||n.onSceneOpen(h,i),null==(r=this.lockScene)||r.onSceneOpen(h,i);for(const t of this.currentPopups)t.onSceneOpen(h,i);return h.closeHandler=this.closeScene.bind(this,h,a),this.currentScenes.push(h),h.onResize(this.width,this.height),h.events.emit(_u.START),h.onStart(),s||(h.events.emit(_u.SHOW),h.onShow()),h}))}closeScene(t,e,n){var r,i;if(this.currentScenes.includes(t)){null!=e&&null!=e||(e=t.constructor),t.events.emit(_u.DESTROY),t.onDestroy(null),this.currentScenes.includes(t)&&this.currentScenes.splice(this.currentScenes.indexOf(t),1),this.destroyScene(t);for(const t of this.currentScenes)t.onSceneClose(e,n);null==(r=this.currentTransition)||r.onSceneClose(e,n),null==(i=this.lockScene)||i.onSceneClose(e,n);for(const t of this.currentPopups)t.onSceneClose(e,n)}}requestCloseScene(t,e){return Cu(this,null,(function*(){const{timeout:n,force:r}=null!=e?e:{};let i;if(n){const e=Promise.race([t.requestClose(),new Promise((t=>setTimeout((()=>t("timeout")),n)))]);i=yield e.then((e=>"string"==typeof e?(this.closeScene(t),!0):e))}else i=yield t.requestClose();return!i&&r?(this.closeScene(t),!0):i}))}requestCloseAllscenes(t){return Promise.all(this.currentScenes.map((e=>this.requestCloseScene(e,t))))}closeAllScenes(){let t=this.currentScenes.length;for(;t-- >0;)this.closeScene(this.currentScenes[t])}resize(t,e,n){var r,i;this.currentOrientation=t>e?"landscape":"portrait",this.sceneRenderer.resize(t,e,n);for(const s of this.currentScenes)s.onResize(t,e),this.onKeyboard&&s.onChangeKeyboard();null==(r=this.currentTransition)||r.onResize(t,e),null==(i=this.lockScene)||i.onResize(t,e);for(const s of this.currentPopups)s.onResize(t,e),this.onKeyboard&&s.onChangeKeyboard()}update(){var t,e,n,r,i,s,o,a,h,l,u,c;let d=0,f=0;$l&&(null==(t=this.stats)||t.begin(),d=(performance||Date).now());const p=this.ticker.deltaMS;this.pauseGlobalTweenOnFocusLost&&!this.hasFocus||eu.shared.update(p);for(const m of this.currentScenes)m.pauseUpdateOnFocusLost&&!this.hasFocus||m.update(p),m.pauseTweenOnFocusLost&&!this.hasFocus||m.tweens.update(p);(null==(e=this.currentTransition)?void 0:e.pauseUpdateOnFocusLost)&&!this.hasFocus||null==(n=this.currentTransition)||n.update(p),(null==(r=this.currentTransition)?void 0:r.pauseTweenOnFocusLost)&&!this.hasFocus||null==(s=null==(i=this.currentTransition)?void 0:i.tweens)||s.update(p),(null==(o=this.lockScene)?void 0:o.pauseUpdateOnFocusLost)&&!this.hasFocus||null==(a=this.lockScene)||a.update(p),(null==(h=this.lockScene)?void 0:h.pauseTweenOnFocusLost)&&!this.hasFocus||null==(u=null==(l=this.lockScene)?void 0:l.tweens)||u.update(p);for(const m of this.currentPopups)m.pauseUpdateOnFocusLost&&!this.hasFocus||m.update(p),m.pauseTweenOnFocusLost&&!this.hasFocus||m.tweens.update(p);if($l&&(f=(performance||Date).now()),this.render(),$l){null==(c=this.stats)||c.end();const t=(performance||Date).now(),e=t-d,n=(e-(t-f))/e;this.updateTimeStats.update(Math.round(100*n),100)}}render(){this.sceneRenderer.preRender&&this.sceneRenderer.preRender(),this.currentScenes=gu(this.currentScenes,((t,e)=>{var n,r;return(null!=(n=t.index)?n:0)-(null!=(r=e.index)?r:0)})),this.currentScenes.forEach(this.sceneRenderer.renderScene.bind(this.sceneRenderer)),this.currentTransition&&this.sceneRenderer.renderScene(this.currentTransition),this.currentPopups=gu(this.currentPopups,((t,e)=>{var n,r;return(null!=(n=t.index)?n:0)-(null!=(r=e.index)?r:0)})),this.currentPopups.forEach(this.sceneRenderer.renderScene.bind(this.sceneRenderer)),this.isOrientationCorect()||this.sceneRenderer.renderScene(this.lockScene),this.sceneRenderer.postRender&&this.sceneRenderer.postRender()}focus(){var t,e;this.hasFocus=!0,this.pauseSoundOnFocusLost&&Sh._context.muted&&Sh.unmuteAll();for(const n of this.currentScenes)n.onFocus();null==(t=this.currentTransition)||t.onFocus(),null==(e=this.lockScene)||e.onFocus();for(const n of this.currentPopups)n.onFocus()}focusLost(){var t,e;this.hasFocus=!1,this.pauseSoundOnFocusLost&&(Sh._context.muted||Sh.muteAll());for(const n of this.currentScenes)n.onFocusLost();null==(t=this.currentTransition)||t.onFocusLost(),null==(e=this.lockScene)||e.onFocusLost();for(const n of this.currentPopups)n.onFocusLost()}postMessage(t){var e,n;for(const r of this.currentScenes)r.onMessage(t);null==(e=this.currentTransition)||e.onMessage(t),null==(n=this.lockScene)||n.onMessage(t);for(const r of this.currentPopups)r.onMessage(t)}externalPause(){var t,e;Sh._context.paused||Sh.pauseAll(),this.sceneRenderer.externalPause&&this.sceneRenderer.externalPause();for(const n of this.currentScenes)n.onPause();null==(t=this.currentTransition)||t.onPause(),null==(e=this.lockScene)||e.onPause();for(const n of this.currentPopups)n.onPause()}externalResume(){var t,e;this.sceneRenderer.externalResume&&this.sceneRenderer.externalResume(),Sh._context.paused&&Sh.resumeAll();for(const n of this.currentScenes)n.onResume();null==(t=this.currentTransition)||t.onResume(),null==(e=this.lockScene)||e.onResume();for(const n of this.currentPopups)n.onResume()}destroyScene(t){t.closeHandler=()=>{},t.destroy()}setDefaultTransition(t,e){this.defaultTransition=t,this.defaultTransitionParams=null!=e?e:[]}extractSceneFromPromise(t){return Cu(this,null,(function*(){const e=yield t;for(const t in e)if(t.toLowerCase().includes("scene"))return e[t];throw new Error("Could not find a scene in the package")}))}loadAssetBundles(t,e,n){return Cu(this,null,(function*(){if(yield this.initializedAssets,t.BUNDLES){let n=0,r=t.BUNDLES;r.includes("*")&&(r=Object.keys(cs.resolver._bundles));const i={};r.forEach((t=>i[t]=0));const s=[];for(const t of r)s.push(cs.loadBundle(t,(s=>{e&&(n+=s,i[t]=s,e(n/r.length,i))})));yield Promise.all(s)}}))}initAssets(){return Cu(this,null,(function*(){cs.init({defaultSearchParams:{v:Wl}});const[t,e]=yield Promise.all([cs.load("./assets.json"),cs.load("./atlas/autoPackedAtlas.json")]);for(const n of e){const e=`ATLAS:${n.name}`,r=t.bundles.find((t=>t.name==n.name));r?Array.isArray(r.assets)?r.assets.push({name:e,srcs:n.url}):r.assets[e]=n.url:t.bundles.push({name:n.name,assets:{[e]:n.url}})}cs.reset(),yield cs.init({manifest:t,defaultSearchParams:{v:Wl}}),yield cs.loadBundle("initialLoad")}))}}(new class{constructor(t,e){var n;Bu(this,"width"),Bu(this,"height"),Bu(this,"devicePixelRatio"),Bu(this,"letterboxScale"),Bu(this,"pixiRenderer"),Bu(this,"inputCatcher"),an.defaultFragmentPrecision=y.HIGH,this.devicePixelRatio=null!=(n=t.resolution)?n:devicePixelRatio||1,this.width=t.width,this.height=t.height;const r=Object.assign({clearBeforeRender:!1},t);this.pixiRenderer=Br(r),this.letterboxScale=Boolean(e),this.inputCatcher=new ai,t.interactionTestsAllScenes&&Object.defineProperty(this.pixiRenderer,"lastObjectRendered",{get:()=>this.inputCatcher}),Vl&&(globalThis.__PIXI_RENDERER__=this.pixiRenderer)}get canvas(){return this.pixiRenderer.view}get backgroundColor(){var t;const e=null!=(t=this.pixiRenderer.background.colorRgba)?t:[0,0,0,0];return{r:e[0],g:e[1],b:e[2],a:e[3]}}set backgroundColor(t){this.pixiRenderer.background.color=t.r<<16|t.g<<8|t.b,this.pixiRenderer.background.alpha=t.a}preRender(){"clear"in this.pixiRenderer&&this.pixiRenderer.clear(),this.inputCatcher.removeChildren()}postRender(){}renderScene(t){let e=!1;if(t.stages)for(const n of t.stages)n&&n instanceof ai&&(this.pixiRenderer.render(n),e=!0,n.interactiveChildren&&this.inputCatcher.addChild(n))}resize(t,e,n){if(document.getElementById("viewport").setAttribute("content","width=device-width, height=device-height, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no,"),this.devicePixelRatio=n||1,this.width=t,this.height=e,this.letterboxScale){this.width=Tu.IDEAL_WIDTH,this.height=Tu.IDEAL_HEIGHT;const n=this.pixiRenderer.view,r=Math.min(t/Tu.IDEAL_WIDTH,e/Tu.IDEAL_HEIGHT);n.style.width=`${Math.floor(r*Tu.IDEAL_WIDTH)}px`,n.style.height=`${Math.floor(r*Tu.IDEAL_HEIGHT)}px`,n.style.marginLeft=n.style.marginRight=(t-Math.floor(r*Tu.IDEAL_WIDTH))/2+"px",n.style.marginTop=n.style.marginBottom=(e-Math.floor(r*Tu.IDEAL_HEIGHT))/2+"px"}else this.devicePixelRatio=n||1,this.width=t,this.height=e,this.pixiRenderer.resolution=this.devicePixelRatio,this.pixiRenderer.resize(t,e)}externalPause(){this.pixiRenderer.plugins.interaction.useSystemTicker=!1}externalResume(){this.pixiRenderer.plugins.interaction.useSystemTicker=!0}getDetails(){return`Pixi Renderer - PixiJS v${ti}`}}(c_));if(window.addEventListener("orientationchange",(()=>{const t=window.screen.orientation.type.split("-")[0];d_.onChangeOrientation(t)})),Mu.initialize(new class{constructor(t){ku(this,"cryptoKey"),ku(this,"internalMap",{}),this.cryptoKey=t}xorCrypt(t){if(!this.cryptoKey)return t;let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t.charCodeAt(n)^this.cryptoKey.charCodeAt(n%this.cryptoKey.length));return e}save(t){return Lu(this,null,(function*(){yield Du().setItem(t,this.xorCrypt(JSON.stringify(this.internalMap)))}))}load(t){return Lu(this,null,(function*(){try{this.internalMap=JSON.parse(this.xorCrypt(yield Du().getItem(t))),this.internalMap||(this.internalMap={})}catch(zd){this["delete"](t)}}))}setSavedataVersion(t,e){return Lu(this,null,(function*(){yield Du().setItem(`${e}_VERSION`,t)}))}getSavedataVersion(t){return Lu(this,null,(function*(){return yield Du().getItem(`${t}_VERSION`)}))}"delete"(t){return Lu(this,null,(function*(){this.internalMap={},yield this.save(t)}))}getValue(t){return this.internalMap[t]}setValue(t,e){return this.internalMap[t]=e,e}},ql),Mu.load(),Vl)for(const n in t);window.addEventListener("resize",(()=>{const t=Math.max(document.documentElement.clientWidth,window.innerWidth||0),e=Math.max(document.documentElement.clientHeight,window.innerHeight||0);d_.resize(t,e,window.devicePixelRatio||1)})),window.dispatchEvent(new Event("resize"));!function(t=function(t=nd){const e=id.get(t);if(!e&&t===nd&&rc())return cd();if(!e)throw ld.create("no-app",{appName:t});return e}(),e){const n=hd(t,"database").getImmediate({identifier:e});if(!n._instanceStarted){const t=nc("database");t&&function(t,e,n,r={}){t=wc(t),t._checkNotDeleted("useEmulator"),t._instanceStarted&&Wd("Cannot call useEmulator() after instance has already been initialized.");const i=t._repoInternal;let s=undefined;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&Wd('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new lf(lf.OWNER);else if(r.mockUserToken){const e="string"==typeof r.mockUserToken?r.mockUserToken:function(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=e||"demo-project",r=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},t);return[qu(JSON.stringify({alg:"none",type:"JWT"})),qu(JSON.stringify(s)),""].join(".")}(r.mockUserToken,t.app.options.projectId);s=new lf(e)}!function(t,e,n,r){t.repoInfo_=new mf(`${e}:${n}`,!1,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0),r&&(t.authTokenProvider_=r)}(i,e,n,s)}(n,...t)}}(cd({apiKey:"AIzaSyCmoophIsOPgVPaxYgvudvR4H4M17FfoQM",authDomain:"invitations-327e5.firebaseapp.com",databaseURL:"https://invitations-327e5-default-rtdb.firebaseio.com",projectId:"invitations-327e5",storageBucket:"invitations-327e5.appspot.com",messagingSenderId:"532259494918",appId:"1:532259494918:web:c55129ebb04a541b8df787"}));d_.changeScene(Uu)})()})();